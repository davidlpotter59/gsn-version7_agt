%%                      
Screen
        Name = "agtmt4000";
        Type = "Detail" ;
        Highlight=Underscore ;
        highlightfield="Yes";
        Padcharacter=Space ;
        Screensize="dynamic";
        Windowtitle="%a     %s Rating Information - Ver. 7.00     %m";
        Domain="agqworkerscomp1" ;
        resizeable = yes ;
        iconline = 0 ;

        Global Unsigned Ascii Number G_APP_NO[11] ;
        Global Unsigned Ascii Number G_LINE_OF_BUSINESS[4] ;
        Global Unsigned Ascii Number G_OPT[2] ;
        global unsigned ascii number g_add_prem_no[1] ;
        global unsigned ascii number g_add_build_no[1] ;
        global unsigned ascii number g_add_new_quote[1] ;
        global unsigned ascii number g_prem_no[4] ;
        global unsigned ascii number g_build_no[4];
        global unsigned ascii number g_from_search_screen[1] ;
        global unsigned ascii number g_enhancement[1] ;
        global unsigned ascii number g_state[2] ;

        global string g_company_id[10] ,
                      g_initial_screen[50] ,
                      g_zipcode_change[1] ,
                      g_code[7] ,
                      g_portfolio[1];

        rwdate l_agqworkerscomp1_eff_date;
        wdate  l_rich_date;

        array[10] of string l_view_desc[85] ;
        array[10] of tag l_the_tag[15] ;

        Local Unsigned Ascii Number L_SUB_CODE[4] ,
                                    L_STATE[2],
                                    l_first_prem_no[4],
                                    l_first_build_no[4],
                                    l_val_zipcode[5],
                                    l_zipcode_5[5],
                                    l_restricted[1],
                                    l_restricted_distance[5]=0/dec=2,
                                    l_tier[2]=0,
                                    l_possible_counties[2],
                                    l_length[75],
                                    l_last_prem_no[4],
                                    l_last_build_no[4],
                                    l_agent_no[4],
                                    l_county[3],
                                    l_app_no[11],
                                    l_rating_territory[3],
                                    l_loop[4],
                                    l_exclude_terrorism[1]=0,
                                    l_prem_no[4]=0,
                                    l_first_bold_one[1]=0,
                                    l_second_bold_one[1]=0,
                                    l_no_locations[2]=0,
                                    l_build_no[4]=0,
                                    l_off_premises_limit[8]=0,
                                    l_mcp140_limit[8],
                                    l_signs_limit[5],
                                    l_valuable_papers_limit[5],
                                    l_water_limit[5],
                                    l_credit_card_limit[5],
                                    l_yyyy[4],
                                    l_territory[3],
                                    l_prior_no_employees[4],
                                    l_minimum_limit[8],
                                    l_maximum_limit[8],
                                    l_zipcode[9],
                                    l_building_minimum_limit[8],
                                    l_contents_minimum_limit[8],
                                    l_combined_minimum_limit[8],
                                    l_building_maximum_limit[8],
                                    l_contents_maximum_limit[8],
                                    l_combined_maximum_limit[8],
                                    l_building_binding_limit[8],
                                    l_contents_binding_limit[8],
                                    l_combined_binding_limit[8],
                                    l_min_error[1],
                                    l_sub[2],
                                    l_sub_1[5],
                                    l_field_no[4]=0,
                                    l_tag_position[2]=0,
                                    l_len_string[5]=0,
                                    l_max_error[1],
                                    l_binding_error[1],
                                    l_combined_limit[8]=0,
                                    l_rating_territory_group_1[1],
                                    l_rating_territory_group_2[1],
                                    l_rating_territory_group_3[1],
                                    l_group_1[5]=0/dec=3,
                                    l_group_2[5]=0/dec=3,
                                    L_CLASS_CODE[5],
                                    l_restaurant[1],
                                    l_year[4],
                                    l_end_sequence[4],
                                    L_PROPERTY_LIMIT[8]=0,
                                    l_property_limit_1[8]=0,
                                    L_LINE_OF_BUSINESS[4] ,
                                    L_AR_LIMIT[8],
                                    L_COMPUTER_LIMIT[8],
                                    l_computer_limit_1[8],
                                    l_computer_limit_2[8],
                                    l_csexec_number[12],
                                    l_percent[4],
                                    i_csexec_number[12],
                                    l_abort_program[1],
                                    L_UTILITY_LIMIT[8],
                                    L_MECHANICAL_LIMIT[8],
                                    L_EXTERIOR_SIGNS_LIMIT[8],
                                    L_EMPLOYEE_LIMIT[8],
                                    L_GLASS_LIMIT[8],
                                    L_SEWER_LIMIT[8],
                                    L_VALUABLE_LIMIT[8],
                                    l_mm[2],
                                    l_dd[2],
                                    l_yy[4],
                                    L_FORM[1] ,
                                    l_Form_1[1] ;

        local signed ascii number l_irpm[4]=0/dec=2 ;

        Local String L_DESC[50] ,
                     l_string_date[8],
                     L_REINSURANCE[1] ,
                     l_lob_code[10],
                     l_sub_line[2],
                     l_zip_code_5[5],
                     l_screen_name[15],
                     l_agent_wording[9]="Agent No:",
                     l_county_description[75],
                     l_fob[1],
                     l_fob_desc[50],
                     l_fob_description[50],
                     l_fob_description1[75],
                     l_form_of_business[1],
                     l_text_1[85],
                     l_text_2[85],
                     l_server_name[100],
                     l_current_web_page[50],
                     l_web_site_address[150],
                     l_first_bold[1]="Y",
                     l_last_bold[1]="N",
                     l_first_str_location[8],
                     l_last_str_location[8],
                     l_str_location[8],
                     i_csexec_application[25] ,
                     l_first_location[1]="Y",
                     l_string_view[15],
                     l_printers_credit_wording[23]="Printers Credit:",
                     l_total_printers_wording[23]="Total Printers:",
                     l_first[1],
                     l_str_zipcode[9]="",
                     l_buyback_option_wording[23]="Buyback Option Charge:",
                     l_fungi_mold_wording[23]="Fungi/Mold Limitations:",
                     l_irpm_wording[12]="IRPM:",
                     l_enter[1],
                     l_minimum_message[200],
                     l_combined_minimum_message[200],
                     l_maximum_message[200],
                     l_combined_maximum_message[200],
                     l_binding_message[200],
                     l_combined_binding_message[200],
                     l_contact_message[200],
                     l_mp_wording[4]="M.P.",
                     l_continue_1[3]="",
                     l_continue_2[3]="",
                     l_continue_3[3]="",
                     l_dec[15]="",
                     l_app[3]="agq",
                     L_CODE[7],
                     L_CODE_1[7],
                     L_CODE_2[7],
                     L_CODE_3[7],
                     L_CODE_4[7],
                     L_CODE_5[7],
                     L_CODE_6[7],
                     L_CODE_7[7],
                     L_CODE_8[7],
                     l_code_9[7],
                     l_code_10[7],
                     l_code_11[7],
                     l_code_12[7],
                     l_code_13[7],
                     l_code_14[7],
                     l_csexec_application[25],
                     l_processing_system[30],
                     l_rating_system[40],
                     l_territory_wording[10]="Territory:",
                     l_system_id[15],
                     L_SCREEN[15] ,
                     l_screen_1[9],
                     L_FORM_EDITION[18],
                     L_DESCRIPTION[75],
                     L_COMPUTER_DESC[50] ,
                     l_computer_desc_1[50],
                     L_DELETE_NONOWNED_HIRED[1]="N",
                     L_ADD_ENDORSEMENT[1]="Y",
                     L_PROPERTY_LIMIT_CHANGE[1]="N",
                     l_agqworkerscomp1_str[10],
                     l_attorney[1],
                     L_COMPANY_ID[10] ;

        local wdate l_eff_date ,
                    l_bpssupplemental_eff_date ,
                    l_exp_date ;

        include "print.var"

        include "virtualdecs.var"

        Access agqworkerscomp1,
           Set agqworkerscomp1:app_no = G_app_no, generic

        Include "stdkeys7.inc"

Style Definition
        Include "styles.inc"
        Displayonly Field Style {
                                  backgroundcolor="#CCCCCC"
                                }


Functions

        "redisplay" display/noreturn "agtmt4000" ;

        "add" sequence "new"      tagged add_fn ;
        "new" add/hidden ;

        "change" sequence "chg"   tagged change_fn ;
        "chg" change/hidden ;

        "func1" display "agtmt4001" tagged calc_fn ;
        "back" sequence "goto" tagged back_fn ;
        "goto" continue begin
                        if g_portfolio not one of "Y" then
                            l_screen_1 = "agtmt001"
                        else
                            l_screen_1 = "agtmt9999"
                        function = "popup"
                        end ;
        "popup" display/noreturn l_screen_1 ;

        "class" display "agtmt4000a" tagged class_fn ;

        reaccess ;

        include "stdfunc7b.inc"

EVENT DEFINITION
        default eventhandler {
                             "REMOVE_SCREEN" { function = "exit" abort () }
                             "reload" { function = "reaccess" abort () }
                             "display_message" { warning "" + event.value }
                             "current_line_of_business" {
                                                          g_line_of_business = val(event.value)
                                                        }
                             }
Menu Definition

Toolbar Definition

Screen Entry
access agqname, set agqname:app_no = g_app_no, generic

disable(accept_fn)
access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

g_initial_screen = ""
l_username = username
l_company_id = sfsdefault:company_id

access sfsprofile,
   set sfsprofile:user_id  = l_username, exact

If SFSPROFILE:USER_ID <> L_USERNAME Then
  Begin
    L_USERNAME = "default"
    Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact
  End

l_server_name = sfsprofile:UNIX_SERVER                            --"http://192.168.1.197/"

l_username = username
access sfsemail, set sfsemail:company_id = l_company_id,
                     sfsemail:user_id    = l_username, generic

access sfsagent, set sfsagent:company_id = l_company_id,
                     sfsagent:agent_no   = sfsemail:agent_no, generic

access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

setproperty(t_line_of_business,iconname,"title_workers_comp.bmp")

access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

if sfsdefault:company_id one of "FLEMINGTON" then
    begin
    hide(lebins_fn)
    hide(farmers_fn)
    end
else
if sfsdefault:company_id one of "FARMERS" then
    begin
    hide(ficof_fn)
    hide(lebins_fn)
    end
else
if sfsdefault:company_id one of "LEBINS" then
    begin
    hide(ficof_fn)
    hide(farmers_fn)
    end

l_state = sfsagent:state
if l_state = 0 then
    l_state = sfsdefault:state

if agqname:line_of_business = 99 then
    l_line_of_business = 9
else
    l_line_of_business = g_line_of_business
Access SFSLINE_ALIAS, Set SFSLINE_alias:COMPANY_ID       = l_company_id,
                          SFSLINE_alias:LINE_OF_BUSINESS = l_line_of_business,
                          SFSLINE_alias:LOB_SUBLINE      = "00", Generic

Access SFSLINE, Set SFSLINE:COMPANY_ID       = l_company_id,
                    SFSLINE:LINE_OF_BUSINESS = l_line_of_business,
                    SFSLINE:LOB_SUBLINE      = "00", Generic

access agqworkerscomp1,
   set agqworkerscomp1:app_no = g_app_no, generic

if l_company_id = "FLEMINGTON" then
    begin
    if agqworkerscomp1:app_no = 0 then
        {
        l_current_web_page = "webhelp_scr_bop_rating_no_proposal_num.htm"
        do change_current_browser(l_server_name,l_current_web_page)
        }
    else
        {
        l_current_web_page = "webhelp_scr_bop_rating_yes_proposal_num.htm"
        do change_current_browser(l_server_name,l_current_web_page)
        }
    end

access agqname, set agqname:app_no = g_app_no,generic

if agqname:quote_no <> 0 then
    begin
    disable(add_fn)
    disable(change_fn)
    disable(delete_fn)
    disable(accept_fn)
    end

if agqworkerscomp1:app_no = 0 then
    begin
    disable(previous_fn)
    disable(next_fn)
    end

access sfscompany, set sfscompany:company_id = l_company_id, generic

l_screen_name = "agtmt4000"
if g_app_no = 0 then
    l_field_no = 9997
else
    l_field_no = 9999


access validation
if agqworkerscomp1:app_no <> g_app_no then
    error 1000

access agqworkerscomp1_alias, set agqworkerscomp1_alias:app_no = agqworkerscomp1:app_no, generic

l_no_locations   = 0
l_first_location = "Y"
l_first_prem_no  = 0
l_first_build_no = 0
l_last_prem_no   = 0
l_last_build_no  = 0
while agqworkerscomp1_alias:app_no = agqworkerscomp1:app_no
    begin
    if l_first_location = "Y" then
        begin
        l_first_str_location  = str(agqworkerscomp1_alias:prem_no) +
                               str(agqworkerscomp1_alias:build_no)
        l_first_location = "N"
        end
    l_last_str_location  = str(agqworkerscomp1_alias:prem_no) +
                           str(agqworkerscomp1_alias:build_no)
    l_no_locations  = l_no_locations + 1

    next agqworkerscomp1_alias
    end

l_str_location = str(agqworkerscomp1:prem_no) +
                 str(agqworkerscomp1:build_no)

if l_no_locations one of 0, 1 then
    begin
    disable(next_fn)
    disable(previous_fn)
    end
else
if l_str_location = l_first_str_location and
   l_no_locations > 1 then
    begin
    disable(previous_fn)
    enable(next_fn)
    end
else
if l_str_location <> l_first_str_location and
   l_str_location <> l_last_str_location and
   l_no_locations > 1 then
    begin
    enable(next_fn)
    enable(previous_fn)
    end
else
if l_str_location = l_last_str_location and
   l_no_locations > 1 then
    begin
    disable(next_fn)
    enable(previous_fn)
    end

screen at 1,1 to 30,100
    Properties {
               Layouttype = screen
               transparent = False
               backgroundcolor = "#ADD8E6"
               scrollbarpolicy = always
               }
{

Panel at 1,1 to 2,100
    Properties {
               layouttype = screen
               }
{
components
    guidetext at 1,1 to 2,40
        properties {
                   iconname = "qp_logo.gif"
                   }

    guidetext at 1,83 to 2,100 tagged ficof_fn
        properties {
                   iconname = "ficof_logo.gif"
                   }

    guidetext at 1,83 to 2,100 tagged farmers_fn
        properties {
                   iconname = "salem_logo.gif"
                   }

    guidetext at 1,83 to 2,100 tagged lebins_fn
        properties {
                   iconname = ""
                   }

    guidetext at 1,30 to 2,100 tagged t_line_of_business
        Properties {
                   iconname = ""
                   }

}

panel at 3,1 to 4,100
    Properties {
               LayoutType = screen
               backgroundcolor = "Grey"
               transparent = False
               }
{
components
    guidetext at 1.45,1 to 1.45,40     tagged display_information_box
        properties {
                   text = "Rating Information..."
                   fontsize = 18
                   fontstyle = BOLD
                   fontname = "arial"
                   transparent = False
                   backgroundcolor = "Grey"
                   }

}

Panel at 3.45,75 to 4.45, 100
    Properties {
               LayoutType = screen
               }
{
%%
App No: ___________

%%

fields
101   begin
        l_agent_no   = sfsemail:agent_no
        if l_agent_no = 0 then
            {
            l_agent_no = 9999
            }
        l_company_id = sfsdefault:company_id
        access sfsagent, set sfsagent:company_id = l_company_id,
                             sfsagent:agent_no   = l_agent_no, generic

        l_state      = sfsagent:state
        if l_state = 0 then
            l_state = sfsdefault:state
        Access agsdefault_wcp, Set agsdefault_wcp:COMPANY_ID       = L_COMPANY_ID,
                                   agsdefault_wcp:state            = l_state,
                                   agsdefault_wcp:agent_no         = l_agent_no,
                                   agsdefault_wcp:LINE_OF_BUSINESS = l_line_of_business, generic

        g_add_prem_no  = 0
        g_add_build_no = 0
        g_prem_no      = 0
        if function one of "ADD", "NEW" then
            begin
            if g_app_no <> 0 and
               agqworkerscomp1:app_no = g_app_no then
                begin
                l_screen_1 = "agtmt4000c"
                display modal screen l_screen_1
                with initial function "CHANGE|BACK"

                if g_add_prem_no = 0 and
                   g_add_build_no = 0 then
                    begin
                    function = "redisplay"
                    abort()
                    end

                if g_add_prem_no = 1 then
                    begin
                    l_prem_no = 0
                    access agqworkerscomp1_alias, set agqworkerscomp1_alias:app_no = g_app_no, generic

                    while agqworkerscomp1_alias:app_no = g_app_no
                        begin
                        l_prem_no  = agqworkerscomp1_alias:prem_no

                        next agqworkerscomp1_alias
                        end

                    access agqmaster, set agqmaster:app_no = g_app_no, generic

                    access sfsfob, set sfsfob:company_id       = agqworkerscomp1:company_id,
                                       sfsfob:form_of_business = agqmaster:form_of_business, generic

                    l_fob_description  = sfsfob:description
                    l_fob_description1 = agqmaster:fob_description

                    access agqworkerscomp1_alias, set agqworkerscomp1_alias:app_no = g_app_no, generic

                    agqworkerscomp1:app_no            = g_app_no
                    agqworkerscomp1:prem_no           = l_prem_no + 1
                    agqworkerscomp1:build_no          = 1
                    agqworkerscomp1:entry_date        = todaysdate
                    agqworkerscomp1:business_name[1]  = agqworkerscomp1_alias:business_name[1]/raw
                    agqworkerscomp1:eff_date          = agqworkerscomp1_alias:eff_date
                    agqworkerscomp1:state             = agqworkerscomp1_alias:state
                    agqworkerscomp1:COUNTY            = agqworkerscomp1_alias:COUNTY
                    agqworkerscomp1:company_id        = agqworkerscomp1_alias:company_id
                    agqworkerscomp1:line_of_business  = agqworkerscomp1_alias:line_of_business
                    agqworkerscomp1:agent_no          = agqworkerscomp1_alias:agent_no
                    end
                else
                if g_add_build_no = 1 then
                    begin
                    access agqworkerscomp1_alias, set agqworkerscomp1_alias:app_no = g_app_no, generic

                    l_build_no = 0
                    while agqworkerscomp1_alias:app_no = g_app_no
                        begin
                        if agqworkerscomp1_alias:prem_no = g_prem_no then
                            l_build_no  = agqworkerscomp1_alias:build_no

                        next agqworkerscomp1_alias
                        end

                    access agqmaster, set agqmaster:app_no = g_app_no, generic

                    access sfsfob, set sfsfob:company_id       = agqworkerscomp1:company_id,
                                       sfsfob:form_of_business = agqmaster:form_of_business, generic

                    l_fob_description  = sfsfob:description
                    l_fob_description1 = agqmaster:fob_description

                    access agqworkerscomp1_alias, set agqworkerscomp1_alias:app_no = g_app_no, generic

                    agqworkerscomp1:app_no           = g_app_no
                    agqworkerscomp1:prem_no          = g_prem_no
                    agqworkerscomp1:build_no         = l_build_no + 1
                    agqworkerscomp1:entry_date       = agqworkerscomp1_alias:entry_date
                    agqworkerscomp1:business_name[1] = agqworkerscomp1_alias:business_name[1]/raw
                    agqworkerscomp1:eff_date         = agqworkerscomp1_alias:eff_date
                    agqworkerscomp1:state            = agqworkerscomp1_alias:state
                    agqworkerscomp1:COUNTY           = agqworkerscomp1_alias:COUNTY
                    agqworkerscomp1:company_id       = agqworkerscomp1_alias:company_id
                    agqworkerscomp1:line_of_business = agqworkerscomp1_alias:line_of_business
                    agqworkerscomp1:agent_no         = agqworkerscomp1_alias:agent_no
                    end
                end
            else
                begin
                if g_portfolio <> "Y" then
                    begin
                    do access_sfscsexec
                    agqworkerscomp1:app_no        = i_csexec_number
                    g_app_no                      = i_csexec_number
                    l_app_no                      = i_csexec_number
                    agqworkerscomp1:prem_no       = 1
                    agqworkerscomp1:build_no      = 1
                    agqworkerscomp1:agent_no      = l_agent_no
                    end
                else
                    begin
                    agqworkerscomp1:app_no        = g_app_no
                    g_app_no                      = g_app_no
                    l_app_no                      = g_app_no
                    agqworkerscomp1:prem_no       = 1
                    agqworkerscomp1:build_no      = 1
                    agqworkerscomp1:agent_no      = l_agent_no
                    end
                end

            access agqamt, set agqamt:app_no = g_app_no, generic

            if agqamt:app_no = g_app_no then
                begin
                agqworkerscomp1:business_name[1] = agqamt:name
                agqworkerscomp1:eff_date         = agqamt:eff_date
                end

            access agqmaster, set agqmaster:app_no = g_app_no, generic

            access sfsfob, set sfsfob:company_id       = agqworkerscomp1:company_id,
                               sfsfob:form_of_business = agqmaster:form_of_business, generic

            l_fob_description  = sfsfob:description
            l_fob_description1 = agqmaster:fob_description

            g_prem_no                   = agqworkerscomp1:prem_no
            g_build_no                  = agqworkerscomp1:build_no
            agqworkerscomp1:entry_date       = todaysdate
            if agqworkerscomp1:state = 0 then
                agqworkerscomp1:state            = agsdefault_wcp:state
            if agqworkerscomp1:county = 0 then
                agqworkerscomp1:COUNTY           = agsdefault_wcp:COUNTY
            if agqworkerscomp1:company_id = "" then
                agqworkerscomp1:company_id       = agsdefault_wcp:company_id
            if agqworkerscomp1:line_of_business = 0 then
                agqworkerscomp1:line_of_business = l_line_of_business
            if agqworkerscomp1:agent_no = 0 then
                agqworkerscomp1:agent_no         = l_agent_no

            end
        access agqmaster, set agqmaster:app_no = g_app_no, generic

        if agqmaster:app_no <> g_app_no then
            begin
            add agqmaster
                begin
                agqmaster:app_no = g_app_no
                agqmaster:extend_hired_nonowned = "N"
                agqmaster:delete_hired_nonowned = "N"
                end
            end

        if agqname:line_of_business = 99 then
            begin
            access agqmastsupp, set agqmastsupp:app_no = g_app_no,
                                    agqmastsupp:line_of_business = l_line_of_business, generic

            if agqmastsupp:app_no <> g_app_no or
               agqmastsupp:line_of_business <> l_line_of_business then
                begin
                add agqmastsupp
                    begin
                    agqmastsupp:app_no = g_app_no
                    agqmastsupp:line_of_business = l_line_of_business
                    agqmastsupp:extend_hired_nonowned = "N"
                    agqmastsupp:delete_hired_nonowned = "N"
                    end
                end
            end
        end
        agqworkerscomp1:APP_NO/displayonly ;

}

Panel at 5,1 to 6,100 Tagged icon_line2_tg
    Properties {
               LayoutType = screen
               }
{
Components
    Button at 1.5,1   tagged add_fn
        Properties {
                   Iconname = "btn_add.bmp"
                   }
        Events     {
                   Action = add_fn
                   }

    Button at 1.5,38    tagged change_fn
        Properties {
                   Iconname = "btn_edit.bmp"
                   }
        Events     {
                   Action = change_fn
                   }

    Button at 1.5, 70 tagged delete_fn
        Properties {
                   Iconname = "btn_delete.bmp"
                   }
        Events     {
                   Action = delete_fn
                   }

}

Panel at 5,94 to 6,96 tagged button_panel
    Properties {
               layouttype = column
               }
{
Components
    Button to 1,1
        properties {
                   Iconname = "btn_print_screen.bmp"
                   }
        events     {
                   action
                        {
                        function = "print"
                        abort()
                        }
                   }

}

Panel at 6.45,92
    Properties {
               layouttype = column
               }
{
Components
    guidetext to 1,1
        properties {
                   text = "agtmt4000.sd"
                   fontsize = 9
                   }

}

Panel at 7,1 to 9,100 Tagged location
    Properties {
               LayoutType = screen
               }
{
Components
    guidetext at 1.5,24 to 2.5,36
        properties {
                   text = "Location No:"
                   fontsize = 12
                   fontname = "arial"
                   }

    guidetext at 1.5,44 to 2.5,56
        properties {
                   text = "Building No:"
                   fontsize = 12
                   fontname = "arial"
                   }

}

Panel at 7.5,33 to 9,60 Tagged rating_pl
{
%%
____                ____
%%

components

fields
101   agqworkerscomp1:prem_no/displayonly ;
102   agqworkerscomp1:build_no/displayonly ;

}

Panel at 8,70 to 8,100
Properties {
           layouttype = row
           }
{
Components
    Button at 1,55 tagged accept_fn
        properties {
                   Iconname = "btn_accept_edits.bmp"
                   }
        Events    {
                  mouseclicked = accept
                  }

}

Panel at 9,1 to 23,100
    Properties {
               LayoutType = screen
               }
{
Components
    guidetext at 2,1 to 2,22
        properties {
                   text = "Insured's Name:"
                   fontsize = 12
                   contentalignment = right
                   fontname = "arial"
                   }

    guidetext at 3,1 to 3,22
        properties {
                   text = "Eff Date:"
                   fontsize = 12
                   contentalignment = right
                   fontname = "arial"
                   }

    guidetext at 4,1 to 4,22
        properties {
                   text = "Form Of Business:"
                   fontsize = 12
                   contentalignment = right
                   fontname = "arial"
                   }

    guidetext at 5,1 to 5,22
        properties {
                   text = "County:"
                   fontsize = 12
                   contentalignment = right
                   fontname = "arial"
                   }

    guidetext at 6,1 to 6,22
        properties {
                   text = "Bodily Injury By Accident:"
                   fontsize = 12
                   contentalignment = right
                   fontname = "arial"
                   }

    guidetext at 7,1 to 7,22
        properties {
                   text = "Bodily Injury By Disease:"
                   fontsize = 12
                   contentalignment = right
                   fontname = "arial"
                   }

    guidetext at 8,1 to 8,22
        properties {
                   text = "Bodily Injury By Disease:"
                   fontsize = 12
                   contentalignment = right
                   fontname = "arial"
                   }

    guidetext at 9,1 to 9,22
        properties {
                   text = "Anniversary Rating Date:"
                   fontsize = 12
                   contentalignment = right
                   fontname = "arial"
                   }

    guidetext at 10,1 to 10,22
        properties {
                   text = "Exp Mod Factor:"
                   fontsize = 12
                   contentalignment = right
                   fontname = "arial"
                   }

    guidetext at 11,1 to 11,22
        properties {
                   text = "Merit Rating:"
                   fontsize = 12
                   contentalignment = right
                   fontname = "arial"
                   }

    guidetext at 12,1 to 12,22
        properties {
                   text = "Exp Mod Factor:"
                   fontsize = 12
                   contentalignment = right
                   fontname = "arial"
                   }

    guidetext at 13,1 to 13,22
        properties {
                   text = "Merit Rating:"
                   fontsize = 12
                   contentalignment = right
                   fontname = "arial"
                   }

    guidetext at 14,1 to 14,22
        properties {
                   text = "PCCPAP Credit:"
                   fontsize = 12
                   contentalignment = right
                   fontname = "arial"
                   }

}


Panel at 9,24 to 23, 100
{
%%

___________________________________________________
__________                 _________  ____
____________________________  _________________________________________
___  ________________________________________________
__________ Each Accident
__________ Policy Limit
__________ Each Employee
__________
________   Eff Date: __________ Exp Date: __________ [R _~Final _~Tentative R]
[RNone~~_  %5~Credit~~_  0%~Credit~~_  5%~Debit~~_ R]
________   Eff Date: __________ Exp Date: __________ [R _~Final _~Tentative R]
[RNone~~_  %5~Credit~~_  0%~Credit~~_  5%~Debit~~_ R]
___        Safety Credit:~~_
%%

components

fields
201     begin
          if function one of "ADD","NEW","CHG","CHANGE" then
            {
              enable(accept_fn)
              disable(calc_fn)
            }
          else
            {
              disable(accept_fn)
              enable(calc_fn)
            }

        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                {
                l_current_web_page = "webhelp_tbx_insured_name.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                }
            end
        end
        agqworkerscomp1:business_name[1]/tabstop/uppercase/default mandatory;
301     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                {
                l_current_web_page = "webhelp_tbx_eff_date.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                }
            end
        if function one of "ADD", "NEW" then
            begin
            if agqworkerscomp1:eff_date = 0 then
                agqworkerscomp1:eff_date = todaysdate
            end
        end
        agqworkerscomp1:eff_date/tabstop/default mandatory
--        if agqworkerscomp1:eff_date < todaysdate - 30 then
--            error "The effective date can not be more than 30 days from todaysdate"

        agqworkerscomp1:exp_date = dateadd(agqworkerscomp1:eff_date,0,1) ;
302     l_agent_wording/displayonly/showasguidetext tagged ficof_fn
        hide if sfsemail:agent_No <> 0 ;
303     begin
        access sfsagent_alias, set sfsagent_alias:company_id = agqworkerscomp1:company_id, generic

        end
        agqworkerscomp1:agent_no/showasguidetext/default  tagged ficof_fn
        hide if sfsemail:agent_no <> 0
        access sfsagent, set sfsagent:company_id = agqworkerscomp1:company_id,
                             sfsagent:agent_no = agqworkerscomp1:agent_no, generic

        if agqworkerscomp1:agent_no <> sfsagent:agent_No then
            error "Invalid Agent No"

        activehelp sfsagent_alias:agent_no,
                   sfsagent_alias:name[1] ;
401     begin
        access agqmaster, set agqmaster:app_no = g_app_no, generic

        l_fob = agqmaster:form_of_business
        access sfsfob, set sfsfob:company_id       = agqworkerscomp1:company_id,
                           sfsfob:form_of_business = agqmaster:form_of_business, generic

        l_fob_desc = sfsfob:description

        access sfsfob, set sfsfob:company_id       = agqworkerscomp1:company_id, approximate

        if agqmaster:form_of_business <> "" then
            begin
            access sfsfob, set sfsfob:company_id       = agqworkerscomp1:company_id,
                               sfsfob:form_of_business = agqmaster:form_of_business, generic

            l_fob_description  = sfsfob:description
            l_form_of_business = agqmaster:form_of_business
            l_fob_description1 = agqmaster:fob_description
            end

        access sfsfob, set sfsfob:company_id       = agqworkerscomp1:company_id, approximate

        if agqmaster:form_of_business = "" then
            activehelp()
        end
        l_fob_description/default/tabstop/uppercase
        if l_fob <> agqmaster:form_of_business or
           l_fob_desc <> l_fob_description then
            begin
            l_form_of_business = sfsfob:form_of_business
            if l_form_of_business <> "T" then
                l_fob_description1 = ""
            do update_agqmaster
            end

        activehelp sfsfob:description;
402     l_fob_description1/default/tabstop/uppercase
        hide if trun(l_fob_description) not one of "OTHER", "Other"
        do update_agqmaster;

501     begin
        access sfsstate_alias, set sfsstate_alias:company_id = agqworkerscomp1:company_id,
                                   sfsstate_alias:state      = agqworkerscomp1:state, generic

        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                {
                l_current_web_page = "webhelp_dbx_county.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                }
            end
        if function one of "ADD", "NEW" then
            begin
            if agqworkerscomp1:county = 0 then
                agqworkerscomp1:county = agsdefault_wcp:county
            if agqworkerscomp1:county = 0 then
                agqworkerscomp1:county = 1
            end
        end
        agqworkerscomp1:COUNTY/default/tabstop

        activehelp if sfsstate_alias:county <> 0 then
                       sfsstate_alias:county
                   else
                       null,
                   if sfsstate_alias:county <> 0 then
                       sfsstate_alias:description
                   else
                       null ;
502     begin
        access sfscounty_lookup_alias, set sfscounty_lookup_alias:company_id  = agqworkerscomp1:company_id,
                                           sfscounty_lookup_alias:state       = agqworkerscomp1:state,
                                           sfscounty_lookup_alias:description = l_county_description, approximate

        end
        l_county_description/uppercase/tabstop
        hide if agqworkerscomp1:county <> 0
        l_length = len(trun(l_county_description))
        access sfscounty_lookup, set sfscounty_lookup:company_id  = agqworkerscomp1:company_id,
                                     sfscounty_lookup:state       = agqworkerscomp1:state,
                                     sfscounty_lookup:description = l_county_description, approximate

        l_possible_counties = 0
        while sfscounty_lookup:company_id = agqworkerscomp1:company_id and
              sfscounty_lookup:state      = agqworkerscomp1:state
                begin
                if sfscounty_lookup:description[1,l_length] = l_county_description[1,l_length] then
                    l_possible_counties = l_possible_counties + 1

                next sfscounty_lookup
                end

        if l_possible_counties = 1 then
            begin
            access sfscounty_lookup, set sfscounty_lookup:company_id  = agqworkerscomp1:company_id,
                                         sfscounty_lookup:state       = agqworkerscomp1:state,
                                         sfscounty_lookup:description = l_county_description, approximate

            l_county_description = sfscounty_lookup:description
            agqworkerscomp1:county = sfscounty_lookup:county
            end
        else
            begin
            activehelp()
            access sfscounty_lookup, set sfscounty_lookup:company_id  = agqworkerscomp1:company_id,
                                         sfscounty_lookup:state       = agqworkerscomp1:state,
                                         sfscounty_lookup:description = l_county_description, approximate

            agqworkerscomp1:county = sfscounty_lookup:county
            end

        activehelp if sfscounty_lookup_alias:state = agqworkerscomp1:state and
                      sfscounty_lookup_alias:county <> 0 and
                      sfscounty_lookup_alias:description[1,l_length] = l_county_description[1,l_length] then
                       sfscounty_lookup_alias:description
                   else
                       null/width=75 ;

501     agqworkerscomp1:county/displayonly ;
502     begin
        access sfsstate_alias, set sfsstate_alias:company_id = agqworkerscomp1:company_id,
                                   sfsstate_alias:state      = agqworkerscomp1:state,
                                   sfsstate_alias:county     = agqworkerscomp1:county, generic

        end
        SFSSTATE_ALIAS:DESCRIPTION ;
601     begin
        if function one of "ADD", "NEW" then
            begin
            if agqworkerscomp1_alias:employers_liability[1] <> 0 then
                begin
                agqworkerscomp1:accident_limit        = agqworkerscomp1_alias:accident_limit
                agqworkerscomp1:disease_limit         = agqworkerscomp1_alias:disease_limit
                agqworkerscomp1:disease_each_employee = agqworkerscomp1_alias:disease_each_employee
                end
            else
                begin
                agqworkerscomp1:accident_limit        = wcsdefault:employers_liability[1]
                agqworkerscomp1:disease_limit         = wcsdefault:employers_liability[2]
                agqworkerscomp1:disease_each_employee = wcsdefault:employers_liability[3]
                end
            end
        end
        agqworkerscomp1:accident_limit/default/tabstop
        access wcsacclimit, set wcsacclimit:company_id = agqworkerscomp1:company_id,
                                wcsacclimit:state = agqworkerscomp1:state,
                                wcsacclimit:line_of_business = agqworkerscomp1:line_of_business,
                                wcsacclimit:limit = agqworkerscomp1:accident_limit, generic

        if agqworkerscomp1:accident_limit <> wcsacclimit:limit then
            error 1238

        activehelp wcsacclimit_alias:limit ;
701     agqworkerscomp1:disease_limit/default/tabstop
        access wcsdislimit1, set wcsdislimit1:company_id = agqworkerscomp1:company_id,
                                 wcsdislimit1:state = agqworkerscomp1:state,
                                 wcsdislimit1:line_of_business = agqworkerscomp1:line_of_business,
                                 wcsdislimit1:limit = agqworkerscomp1:disease_limit, generic

        if agqworkerscomp1:disease_limit <> wcsdislimit1:limit then
            error 1238

        activehelp if wcsdislimit1_alias:limit >= agqworkerscomp1:accident_limit then
                       wcsdislimit1_alias:limit
                   else
                        null ;
801     begin
        if function one of "ADD", "NEW" then
            agqworkerscomp1:disease_each_employee = agqworkerscomp1:accident_limit
        end
        agqworkerscomp1:disease_each_employee/default/tabstop
        access wcsdislimit2, set wcsdislimit2:company_id = agqworkerscomp1:company_id,
                                 wcsdislimit2:state = agqworkerscomp1:state,
                                 wcsdislimit2:line_of_business = agqworkerscomp1:line_of_business,
                                 wcsdislimit2:limit = agqworkerscomp1:disease_each_employee, generic

        if agqworkerscomp1:disease_each_employee <> wcsdislimit2:limit then
            error 1238

        activehelp if wcsdislimit2_alias:limit = agqworkerscomp1:accident_limit then
                       wcsdislimit2_alias:limit
                   else
                       null    ;
901     begin
        if function one of "ADD", "NEW" then
            begin
            if agqworkerscomp1_alias:anniversary_eff_date <> 0 then
                begin
                agqworkerscomp1:anniversary_eff_date = agqworkerscomp1_alias:anniversary_eff_date
                end
            end
        end
        agqworkerscomp1:anniversary_eff_date/default/tabstop
        if agqworkerscomp1:anniversary_eff_date = 0 then
            agqworkerscomp1:anniversary_exp_date = 0
        if agqworkerscomp1:anniversary_eff_date <> 0 then
            agqworkerscomp1:anniversary_exp_date = dateadd(agqworkerscomp1:anniversary_eff_date,0,1);
1001    begin
        if function one of "ADD", "NEW" then
            begin
            if agqworkerscomp1_alias:exp_mod_factor[1] <> 0 then
                begin
                agqworkerscomp1:exp_mod_factor[1] = agqworkerscomp1_alias:exp_mod_factor[1]
                end
            end
        end
        agqworkerscomp1:exp_mod_factor[1]/mask="ZZZ.ZZZZ"/default/tabstop
        hide if agqworkerscomp1:merit_rating one of -5, 5
        if agqworkerscomp1:exp_mod_factor[1] = 0 and
           agqworkerscomp1:anniversary_eff_date = 0 then
            begin
            agqworkerscomp1:exp_mod_eff_date[1] = 0
            agqworkerscomp1:exp_mod_exp_date[1] = 0
            agqworkerscomp1:exp_mod_eff_date[2] = 0
            agqworkerscomp1:exp_mod_exp_date[2] = 0
            agqworkerscomp1:exp_mod_factor[2] = 0
            end
        else
            begin
            agqworkerscomp1:exp_mod_eff_date[1] = agqworkerscomp1:eff_date
            agqworkerscomp1:exp_mod_exp_date[1] = dateadd(agqworkerscomp1:exp_mod_eff_date[1],0,1)
            agqworkerscomp1:exp_mod_eff_date[2] = agqworkerscomp1:exp_mod_exp_date[1]
            agqworkerscomp1:exp_mod_exp_date[2] = agqworkerscomp1:exp_date
            end ;
1001    agqworkerscomp1:exp_mod_factor[1]/mask="ZZZ.ZZZZ"/displayonly ;
1002    begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" and
           agqworkerscomp1:exp_mod_eff_date[1] = 0 then
            begin
            agqworkerscomp1:exp_mod_eff_date[1] = agqworkerscomp1:eff_date
            agqworkerscomp1:exp_mod_exp_date[1] = dateadd(agqworkerscomp1:exp_mod_eff_date[1],0,1)
            end
        if function one of "ADD", "NEW", "CHANGE", "CHG" and
           agqworkerscomp1:anniversary_exp_date <> 0 and
           agqworkerscomp1:exp_mod_factor[1] <> 0 then
            begin
            agqworkerscomp1:exp_mod_eff_date[1] = agqworkerscomp1:eff_date
            l_mm = month(agqworkerscomp1:anniversary_eff_date)
            l_dd = day(agqworkerscomp1:anniversary_eff_date) - 1
            l_yy = year(agqworkerscomp1:anniversary_eff_date)
            l_string_date = str(l_mm,2) + str(l_dd,2) + str(l_yy,4)
            if l_dd = 0 and
               l_mm = 01 then
                begin
                l_mm = 12
                l_dd = 31
                l_yy = l_yy - 1
                l_string_date = str(l_mm,2) + str(l_dd,2) + str(l_yy,4)
                end

            if l_dd = 0 and
               l_mm <> 01 then
                begin
                l_exp_date = dateadd(01.01.2000,month((agqworkerscomp1:anniversary_eff_date) - 1),
                                                year(agqworkerscomp1:anniversary_eff_date) mod 100) -1
                end
            else
                l_exp_date = date(l_string_date)
            agqworkerscomp1:exp_mod_exp_date[1] = l_exp_date
            end
        end
        agqworkerscomp1:exp_mod_eff_date[1]/default/tabstop
        hide if agqworkerscomp1:exp_mod_factor[1] = 0 ;
1003    agqworkerscomp1:exp_mod_exp_date[1]/default/tabstop
        hide if agqworkerscomp1:exp_mod_factor[1] = 0 ;
1004    begin
        if function one of "ADD", "NEW" then
            begin
            if agqworkerscomp1_alias:exp_mod_type[1] <> "" then
                agqworkerscomp1:exp_mod_type[1] = agqworkerscomp1_alias:exp_mod_type[1]
            else
                agqworkerscomp1:exp_mod_type[1] = "F"
            end
        end
        agqworkerscomp1:exp_mod_type[1]/values="F,T"/default/tabstop
        hide if agqworkerscomp1:exp_mod_factor[1] = 0 ;
1101    agqworkerscomp1:merit_rating/values="0,-5,1,5"/tabstop
        hide if agqworkerscomp1:exp_mod_factor[1] not one of 0 ;
1201    begin
        if function one of "ADD", "NEW" then
            begin
            if agqworkerscomp1_alias:exp_mod_factor[2] <> 0 then
                begin
                agqworkerscomp1:exp_mod_factor[2] = agqworkerscomp1_alias:exp_mod_factor[2]
                end
            end
        end
        agqworkerscomp1:exp_mod_factor[2]/mask="ZZZ.ZZZZ"/default/tabstop
        hide if agqworkerscomp1:merit_rating_1 one of -5, 5
        if agqworkerscomp1:exp_mod_factor[2] = 0 and
           agqworkerscomp1:anniversary_eff_date = 0 then
            begin
            agqworkerscomp1:exp_mod_eff_date[2] = 0
            agqworkerscomp1:exp_mod_exp_date[2] = 0
            end ;
1201    agqworkerscomp1:exp_mod_factor[2]/mask="ZZZ.ZZZZ"/displayonly ;
1202    begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" and
           agqworkerscomp1:exp_mod_eff_date[1] <> 0 then
            begin
            agqworkerscomp1:exp_mod_eff_date[2] = agqworkerscomp1:exp_mod_exp_date[1]
            agqworkerscomp1:exp_mod_exp_date[2] = agqworkerscomp1:exp_date
            end
        if function one of "ADD", "NEW", "CHANGE", "CHG" and
           agqworkerscomp1:anniversary_eff_date <> 0 and
           agqworkerscomp1:exp_mod_factor[2] <> 0 then
            begin
            agqworkerscomp1:exp_mod_eff_date[2] = agqworkerscomp1:anniversary_eff_date
            agqworkerscomp1:exp_mod_exp_date[2] = agqworkerscomp1:exp_date
            end
        end
        agqworkerscomp1:exp_mod_eff_date[2]/default/tabstop
        hide if agqworkerscomp1:exp_mod_factor[2] = 0 ;
1203    agqworkerscomp1:exp_mod_exp_date[2]/default/tabstop
        hide if agqworkerscomp1:exp_mod_factor[2] = 0 ;
1204    begin
            begin
            if agqworkerscomp1_alias:exp_mod_type[2] <> "" then
                agqworkerscomp1:exp_mod_type[2] = agqworkerscomp1_alias:exp_mod_type[1]
            else
                agqworkerscomp1:exp_mod_type[2] = "F"
            end
        end
        agqworkerscomp1:exp_mod_type[2]/values="F,T"/default/tabstop
        hide if agqworkerscomp1:exp_mod_factor[2] = 0 ;
1301    agqworkerscomp1:merit_rating_1/values="0,-5,1,5"/tabstop
        hide if agqworkerscomp1:exp_mod_factor[2] not one of 0 ;
1401    agqworkerscomp1:njccpap_percent/mask="-ZZ"/tabstop ;
1402    agqworkerscomp1:safety_credit/checkbox/values="0,1"/tabstop ;
/*1403    begin
            l_eff_date = agqworkerscomp1:eff_date
        end
        agqworkerscomp1:deductible/tabstop
        if agqworkerscomp1:deductible <> wcsdeductible:deductible then
            error "Invalid Deductible"

        activehelp if (l_eff_date >= wcsdeductible_alias:eff_date and
                      (l_eff_date <= wcsdeductible_alias:exp_date or
                      wcsdeductible_alias:exp_date = 0)) then
                       wcsdeductible_alias:deductible
                   else
                       null ;*/

}


Panel at 25,1 to 25,120 Tagged icon_line2_tg
Properties {
           LayoutType = screen
           }
{
Components
    Button at 1,1   tagged back_fn
        Properties {
                   Iconname = "btn_back_to_main_screen.bmp"
                   }
        Events     {
                   Action {
                          if g_portfolio <> "Y" then
                              begin
                              l_continue_2 = dialog("EXITING","warning.bmp","You are about to leave the application, Do you wish to continue","Yes","No")
                              if l_continue_2 = "Yes" then
                                begin
                                function = "back"
                                abort()
                                end
                              end
                          else
                              begin
                              function = "back"
                              abort()
                              end
                          }
                    }

    Button at 1,32    tagged previous_fn
        Properties {
                   Iconname = "btn_previous.bmp"
                   }
        Events     {
                   Action = previous_fn
                   }

    Button at 1, 48 tagged next_fn
        Properties {
                   Iconname = "btn_next.bmp"
                   }
        Events     {
                   Action = next_fn
                   }


    Button at 1,75   tagged calc_fn
        Properties {
                   Iconname = "btn_view_summary_totals.bmp"
                   }
        Events     {
                   Action {
                          function = "func1"
                          abort()
                          }
                    }

}

panel at 26,1 to 26,120 tagged line_panel_1
    {
    Components
        line at 1,1 to 1,120
            Properties {
                       Linestyle = embossed
                       Linewidth = 5
                       foregroundcolor = "black"
                       }
    }

panel at 27,1 to 32,100  tagged ficof_fn
Properties {
           LayoutType = screen
           backgroundcolor = "white"
           }
{
Components
    browser at 1,1 to 7,100  tagged helper_tg
        properties {
                   url = ""
                   }
}

}

Update
if UPDATEOK = "NO" then
    begin
    access agqworkerscomp1_alias, set agqworkerscomp1_alias:app_no = g_app_no, generic

    if agqworkerscomp1_alias:app_no <> g_app_no then
        g_app_no = 0

    enable (calc_fn)
    disable(accept_fn)
    end

If UPDATEOK = "YES" And
   Abort = "NO" Then
    Begin
    enable(calc_fn)
    disable(accept_fn)
    if function one of "delete", "DELETE" then
        begin
        access agqworkplaces, set agqworkplaces:app_no   = agqworkerscomp1:app_no,
                                  agqworkplaces:prem_no  = agqworkerscomp1:prem_no,
                                  agqworkplaces:build_no = agqworkerscomp1:build_no, generic

        if agqworkplaces:app_no   = agqworkerscomp1:app_no and
           agqworkplaces:prem_no  = agqworkerscomp1:prem_no and
           agqworkplaces:build_no = agqworkerscomp1:build_no then
            delete agqworkplaces

        access agqclass, set agqclass:app_no   = agqworkerscomp1:app_no,
                             agqclass:prem_no  = agqworkerscomp1:prem_no,
                             agqclass:build_no = agqworkerscomp1:build_no, generic

        while agqclass:app_no   = agqworkerscomp1:app_no and
              agqclass:prem_no  = agqworkerscomp1:prem_no and
              agqclass:build_no = agqworkerscomp1:build_no
                begin
                delete agqclass

                next agqclass
                end

        access agqendorse4, set agqendorse4:app_no   = agqworkerscomp1:app_no,
                                agqendorse4:prem_no  = agqworkerscomp1:prem_no,
                                agqendorse4:build_no = agqworkerscomp1:build_no, generic

        while agqendorse4:app_no   = agqworkerscomp1:app_no and
              agqendorse4:prem_no  = agqworkerscomp1:prem_no and
              agqendorse4:build_no = agqworkerscomp1:build_no
                begin
                delete agqendorse4

                next agqendorse4
                end

        access agqcontact, set agqcontact:app_no   = agqworkerscomp1:app_no,
                               agqcontact:prem_no  = agqworkerscomp1:prem_no,
                               agqcontact:build_no = agqworkerscomp1:build_no, generic

        while agqcontact:app_no   = agqworkerscomp1:app_no and
              agqcontact:prem_no  = agqworkerscomp1:prem_no and
              agqcontact:build_no = agqworkerscomp1:build_no
                begin
                delete agqcontact

                next agqcontact
                end

        access sfsline, set sfsline:company_id       = agqname:company_id,
                            sfsline:line_of_business = agqname:line_of_business,
                            sfsline:lob_subline      = "00", generic

        access agqworkerscomp1_alias, set agqworkerscomp1_alias:app_no = g_app_no, generic

        if sfsline:lob_code = "CPORTFOLIO" then
            begin
            access agqmastsupp, set agqmastsupp:app_no           = g_app_no,
                                    agqmastsupp:line_of_business = agqworkerscomp1:line_of_business, generic

            if agqmastsupp:app_no           = g_app_no and
               agqmastsupp:line_of_business = agqworkerscomp1:line_of_business then
                begin
                if agqworkerscomp1_alias:app_no <> g_app_no then
                    delete agqmastsupp
                end
            end

        access agqend, set agqend:app_no = g_app_no, generic

        while agqend:app_no = g_app_no
            begin
            if agqend:lob_end_code = "Z" then
                begin
                if agqworkerscomp1_alias:app_no <> g_app_no then
                    delete agqend
                else
                if agqend:prem_no = agqworkerscomp1:prem_no and
                   agqend:build_no = agqworkerscomp1:build_no then
                    delete agqend
                end

            next agqend
            end

        access agqamt, set agqamt:app_no = g_app_no, generic

        if agqamt:app_no = g_app_no then
            begin
            if agqworkerscomp1_alias:app_no <> g_app_no then
                begin
                change agqamt
                    begin
                    agqamt:lob_totals[3]    = 0
                    agqamt:lob_terrorism[3] = 0
                    agqamt:lob_surcharge[3] = 0
                    end
                end
            end

        g_prem_no  = 1
        g_build_no = 1
        function   = "redisplay"
        end

    if function one of "ADD", "NEW", "CHANGE", "CHG" then
        begin
        if sfsline:lob_code = "CPORTFOLIO" then
            begin
            access agqmastsupp, set agqmastsupp:app_no         = g_app_no,
                                    agqmastsupp:line_of_business = l_line_of_business, generic

            If agqmastsupp:app_no = G_app_no and
               agqmastsupp:line_of_business = l_line_of_business Then
                begin
                l_form = agqmastsupp:form
                If L_DELETE_NONOWNED_HIRED = "Y" Then
                    begin
                    Change agqmastsupp
                        Begin
                        agqmastsupp:DELETE_HIRED_NONOWNED       = "Y"
                        agqmastsupp:DELETE_NONOWNED_HIRED_CLASS = "Y"
                        agqmastsupp:EXTEND_HIRED_NONOWNED       = "N"
                        end
                    End
                else
                if l_delete_nonowned_hired = "N" then
                    begin
                    If agqmastsupp:DELETE_NONOWNED_HIRED_CLASS = "Y" Then
                        begin
                        Change agqmastsupp
                            Begin
                            agqmastsupp:DELETE_HIRED_NONOWNED       = "N"
                            agqmastsupp:DELETE_NONOWNED_HIRED_CLASS = "N"
                            End
                        end
                    end
                end
            end
        else
            begin
            access agqmaster, set agqmaster:app_no = g_app_no, exact

            If agqMASTER:app_no = G_app_no Then
                begin
                l_form = agqmaster:form
                If L_DELETE_NONOWNED_HIRED = "Y" Then
                    begin
                    Change agqMASTER
                        Begin
                        agqMASTER:DELETE_HIRED_NONOWNED       = "Y"
                        agqMASTER:DELETE_NONOWNED_HIRED_CLASS = "Y"
                        agqMASTER:EXTEND_HIRED_NONOWNED       = "N"
                        end
                    End
                else
                if l_delete_nonowned_hired = "N" then
                    begin
                    If agqmaster:DELETE_NONOWNED_HIRED_CLASS = "Y" Then
                        Change agqmaster
                            Begin
                            agqmaster:DELETE_HIRED_NONOWNED       = "N"
                            agqmaster:DELETE_NONOWNED_HIRED_CLASS = "N"
                            End
                    end
                end
            end

        Access wcstrigger, Set wcstrigger:COMPANY_ID = agqworkerscomp1:COMPANY_ID,
                               wcstrigger:STATE = agqworkerscomp1:STATE,
                               wcstrigger:LINE_OF_BUSINESS = agqworkerscomp1:LINE_OF_BUSINESS, Generic

        Repeat Begin
            Exit If wcstrigger:COMPANY_ID <> agqworkerscomp1:COMPANY_ID Or
                    wcstrigger:STATE <> agqworkerscomp1:STATE Or
                    wcstrigger:LINE_OF_BUSINESS <> agqworkerscomp1:LINE_OF_BUSINESS

            If agqworkerscomp1:EFF_DATE >= wcstrigger:EFF_DATE Then
                Begin
                L_CODE_1 = wcstrigger:code[4] -- exp mod for NJ
                l_code_2 = wcstrigger:code[3] -- WC 00 04 02
                l_code_3 = wcstrigger:code[6] -- merit rate
                l_code_4 = wcstrigger:code[8] -- exp mod for PA
                l_code_5 = wcstrigger:code[9] -- WC370403
                l_code_6 = wcstrigger:code[10] -- wc290409
                l_code_7 = wcstrigger:code[11] -- 000421C
                l_code_8 = wcstrigger:code[12] -- 000422A
                End

            Next wcstrigger
            End

        If L_CODE_1 <> "" Then
            Begin
            L_CODE = L_CODE_1
            Do ACCESS_agqend
            If L_ADD_ENDORSEMENT = "Y" And
               agqworkerscomp1:exp_mod_type[1] one of "T", "C" Then
                Do ADD_agqend
            If L_ADD_ENDORSEMENT = "N" And
               agqworkerscomp1:exp_mod_type[1] not one of "T", "C" Then
                Do DELETE_agqend
            end

        If L_CODE_2 <> "" Then
            Begin
            L_CODE = L_CODE_2
            Do ACCESS_agqend
            If L_ADD_ENDORSEMENT = "Y" And
               agqworkerscomp1:anniversary_eff_date <> 0 Then
                Do ADD_agqend
            If L_ADD_ENDORSEMENT = "N" And
               agqworkerscomp1:anniversary_eff_date = 0 Then
                Do DELETE_agqend
            end

        If L_CODE_3 <> "" Then
            Begin
            L_CODE = L_CODE_3
            Do ACCESS_agqend
            If L_ADD_ENDORSEMENT = "Y" And
               agqworkerscomp1:merit_rating one of -5, 1, 5 Then
                Do ADD_agqend
            If L_ADD_ENDORSEMENT = "N" And
               agqworkerscomp1:merit_rating not one of -5, 1, 5 Then
                Do DELETE_agqend
            end

        If L_CODE_4 <> "" Then
            Begin
            L_CODE = L_CODE_4
            Do ACCESS_agqend
            If L_ADD_ENDORSEMENT = "Y" And
               agqworkerscomp1:exp_mod_factor[1] <> 0 Then
                Do ADD_agqend
            If L_ADD_ENDORSEMENT = "N" And
               agqworkerscomp1:exp_mod_factor[1] = 0 Then
                Do DELETE_agqend
            end

        If L_CODE_5 <> "" Then
            Begin
            L_CODE = L_CODE_5
            Do ACCESS_agqend
            If L_ADD_ENDORSEMENT = "Y" And
               agqworkerscomp1:deductible <> 0 Then
                Do ADD_agqend
            If L_ADD_ENDORSEMENT = "N" And
               agqworkerscomp1:deductible = 0 Then
                Do DELETE_agqend
            end

        If L_CODE_6 <> "" Then
            Begin
            L_CODE = L_CODE_6
            Do ACCESS_agqend
            If L_ADD_ENDORSEMENT = "Y" And
               agqworkerscomp1:managed_care_credit <> 0 Then
                begin
                Do ADD_agqend
                g_code = l_code
                display modal screen "agtmt383"
                with initial function "ADD"
                end
            If L_ADD_ENDORSEMENT = "N" And
               agqworkerscomp1:managed_care_credit = 0 Then
                begin
                Do DELETE_agqend
                do delete_agqendorse4
                end
            end

        If L_CODE_7 <> "" Then
            Begin
            L_CODE = L_CODE_7
            Do ACCESS_agqend
            If L_ADD_ENDORSEMENT = "Y" Then
                Do ADD_agqend
            end

        If L_CODE_8 <> "" Then
            Begin
            L_CODE = L_CODE_8
            Do ACCESS_agqend
            If L_ADD_ENDORSEMENT = "Y" Then
                Do ADD_agqend
            end

        if function one of "ADD", "NEW" then
            begin
            g_prem_no  = agqworkerscomp1:prem_no
            g_build_no = agqworkerscomp1:build_no
            function   = "class"
            end
        End
    End

screen exit
g_prem_no  = agqworkerscomp1:prem_no
g_build_no = agqworkerscomp1:build_no

Procedure Definition

Procedure DELETE_agqendorse4
Begin
Access agqendorse4, Set agqendorse4:app_no   = agqworkerscomp1:app_no ,
                        agqendorse4:PREM_NO  = agqworkerscomp1:PREM_NO,
                        agqendorse4:BUILD_NO = agqworkerscomp1:BUILD_NO, generic

Repeat Begin
    Exit If agqendorse4:app_no   <> agqworkerscomp1:app_no Or
            agqendorse4:PREM_NO  <> agqworkerscomp1:PREM_NO Or
            agqendorse4:BUILD_NO <> agqworkerscomp1:BUILD_NO

    If agqendorse4:CODE = L_CODE Then
        Delete agqendorse4

    Next agqendorse4
    End

End

procedure update_agqmaster
BEGIN
access agqmaster, set agqmaster:app_no = g_app_no, exact

if agqmaster:app_no = g_app_no then
    begin
    change agqmaster
        begin
        agqmaster:form_of_business  = l_form_of_business
        agqmaster:FOB_DESCRIPTION   = l_fob_description1
        end
    end

END

procedure change_current_browser (string p_server_name, string p_current_web_page)
BEGIN
l_web_site_address = trun(p_server_name) + trun(p_current_web_page)
setproperty(helper_tg,url,trun(l_web_site_address))
END

procedure access_sfscsexec
begin
i_csexec_application = "APQQUOTE                 "

access sfscsexec, set sfscsexec:application = i_csexec_application, generic

change sfscsexec
    begin
    i_csexec_number = sfscsexec:application_number + 1
    sfscsexec:application_number = i_csexec_number
    end

end

Procedure ACCESS_agqEND_1
Begin
Access agqEND, Set agqEND:app_no   = G_app_no ,
                   agqEND:PREM_NO  = 0,
                   agqEND:BUILD_NO = 0, Generic

L_ADD_ENDORSEMENT = "Y"
while agqEND:app_no   = G_app_no and
      agqEND:PREM_NO  = 0 and
      agqEND:BUILD_NO = 0
    begin
    If agqEND:CODE = L_CODE Then
        L_ADD_ENDORSEMENT = "N"

    Next agqEND
    End

End

Procedure ADD_agqEND_1
Begin
Access agqEND, Set agqEND:app_no   = G_app_no ,
                   agqEND:PREM_NO  = 0,
                   agqEND:BUILD_NO = 0, Generic

L_SUB_CODE = 0
while agqEND:app_no   = G_app_no and
      agqEND:PREM_NO  = 0 and
      agqEND:BUILD_NO = 0
    begin
    L_SUB_CODE = agqEND:SUB_CODE

    Next agqEND
    End

L_SUB_CODE = L_SUB_CODE + 10

Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqworkerscomp1:company_id,
                      SFSOPTEND:STATE            = agqworkerscomp1:STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = agqworkerscomp1:line_of_business,
                      SFSOPTEND:CODE             = L_CODE, Generic

while SFSOPTEND:COMPANY_ID       = agqworkerscomp1:company_id and
      SFSOPTEND:STATE            = agqworkerscomp1:STATE and
      SFSOPTEND:LINE_OF_BUSINESS = agqworkerscomp1:line_of_business and
      SFSOPTEND:CODE             = L_CODE
    begin
    If (agqworkerscomp1:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqworkerscomp1:eff_date <= sfsoptend:exp_date or
       sfsoptend:exp_date = 0)) Then
        Begin
        L_FORM_EDITION = SFSOPTEND:FORM_EDITION
        L_DESCRIPTION  = SFSOPTEND:DESCRIPTION
        End

    Next SFSOPTEND
    End

if l_form_edition <> "" then
    begin
    Add agqEND
        Begin
        agqEND:app_no               =       G_app_no
        agqEND:PREM_NO              =       0
        agqEND:BUILD_NO             =       0
        agqEND:SUB_CODE             =       L_SUB_CODE
        agqEND:CODE                 =       L_CODE
        agqEND:FORM_EDITION         =       L_FORM_EDITION
        agqEND:DESCRIPTION          =       L_DESCRIPTION
        agqEND:PREMIUM              =       0
        agqend:lob_end_code         =       "Z"
        end
    End

End

Procedure DELETE_agqEND_1
Begin
Access agqEND, Set agqEND:app_no   = G_app_no ,
                   agqEND:PREM_NO  = 0,
                   agqEND:BUILD_NO = 0, Generic

while agqEND:app_no   = G_app_no and
      agqEND:PREM_NO  = 0 and
      agqEND:BUILD_NO = 0
    begin
    If agqEND:CODE = L_CODE Then
        Delete agqEND

    Next agqEND
    End

End

Procedure ACCESS_agqEND
Begin
Access agqEND, Set agqEND:app_no   = G_app_no ,
                   agqEND:PREM_NO  = agqworkerscomp1:PREM_NO,
                   agqEND:BUILD_NO = agqworkerscomp1:BUILD_NO, Generic

L_ADD_ENDORSEMENT = "Y"
while agqEND:app_no   = G_app_no and
      agqEND:PREM_NO  = agqworkerscomp1:PREM_NO and
      agqEND:BUILD_NO = agqworkerscomp1:BUILD_NO
    begin
    If agqEND:CODE = L_CODE Then
        L_ADD_ENDORSEMENT = "N"

    Next agqEND
    End

End

Procedure ADD_agqEND
Begin
Access agqEND, Set agqEND:app_no   = G_app_no ,
                   agqEND:PREM_NO  = agqworkerscomp1:PREM_NO,
                   agqEND:BUILD_NO = agqworkerscomp1:BUILD_NO, Generic

L_SUB_CODE = 0
while agqEND:app_no   = G_app_no and
      agqEND:PREM_NO  = agqworkerscomp1:PREM_NO and
      agqEND:BUILD_NO = agqworkerscomp1:BUILD_NO
    begin
    L_SUB_CODE = agqEND:SUB_CODE

    Next agqEND
    End

L_SUB_CODE = L_SUB_CODE + 10

Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqworkerscomp1:company_id,
                      SFSOPTEND:STATE            = agqworkerscomp1:STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = agqworkerscomp1:line_of_business,
                      SFSOPTEND:CODE             = L_CODE, Generic

while SFSOPTEND:COMPANY_ID       = agqworkerscomp1:company_id and
      SFSOPTEND:STATE            = agqworkerscomp1:STATE and
      SFSOPTEND:LINE_OF_BUSINESS = agqworkerscomp1:line_of_business and
      SFSOPTEND:CODE             = L_CODE
    begin
    If (agqworkerscomp1:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqworkerscomp1:eff_date <= sfsoptend:exp_date or
       sfsoptend:exp_date = 0)) Then
        Begin
        L_FORM_EDITION = SFSOPTEND:FORM_EDITION
        L_DESCRIPTION  = SFSOPTEND:DESCRIPTION
        End

    Next SFSOPTEND
    End

if l_form_edition <> "" then
    begin
    Add agqEND
        Begin
        agqEND:app_no               =       G_app_no
        agqEND:PREM_NO              =       agqworkerscomp1:PREM_NO
        agqEND:BUILD_NO             =       agqworkerscomp1:BUILD_NO
        agqEND:SUB_CODE             =       L_SUB_CODE
        agqEND:CODE                 =       L_CODE
        agqEND:FORM_EDITION         =       L_FORM_EDITION
        agqEND:DESCRIPTION          =       L_DESCRIPTION
        agqEND:PREMIUM              =       0
        agqend:lob_end_code         =       "Z"
        end
    End

End

Procedure DELETE_agqEND
Begin
Access agqEND, Set agqEND:app_no   = G_app_no ,
                   agqEND:PREM_NO  = agqworkerscomp1:PREM_NO,
                   agqEND:BUILD_NO = agqworkerscomp1:BUILD_NO, Generic

while agqEND:app_no   = G_app_no and
      agqEND:PREM_NO  = agqworkerscomp1:PREM_NO and
      agqEND:BUILD_NO = agqworkerscomp1:BUILD_NO
    begin
    If agqEND:CODE = L_CODE Then
        Delete agqEND

    Next agqEND
    End

End

End
