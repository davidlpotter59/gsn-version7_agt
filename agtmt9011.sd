%%
Screen
        Name = "agtmt9011" ;
        Type = "Detail" ;
        Padcharacter = Space ;
        Highlight = Underscore ;
        Screensize = "dynamic" ;
        Domain = "agqpersonal" ;
        resizeable = yes ;
        iconline = 0 ;

        Global Unsigned Ascii Number G_app_NO[11] ;
        Global Unsigned Ascii Number G_PREM_NO[4] ;
        Global Unsigned Ascii Number G_BUILD_NO[4] ;
        Global Unsigned Ascii Number g_line_of_business[4],
                                     g_state[2],
                                     g_form[1] ;

        global string g_zipcode_change[1] ,
                      g_initial_screen[50] ,
                      g_daycare[1],
                      g_central_heat[1] ;


        Local Unsigned Ascii Number L_LINE_OF_BUSINESS[4]=0,
                                    l_val_zipcode[5],
                                    l_dollar_sign_at[2],
                                    l_sub[2],
                                    l_status[2],
                                    l_claim_year[2],
                                    l_zipcode_5[5],
                                    l_no_mtg[1],
                                    l_sub_code[4],
                                    l_total_paid[10],
                                    l_checkbox_1[1],
                                    l_checkbox_2[1],
                                    l_checkbox_3[1],
                                    l_checkbox_4[1],
                                    l_checkbox_5[1],
                                    l_checkbox_6[1],
                                    l_checkbox_7[1],
                                    l_warning[3],
                                    l_no_claims[2],
                                    l_sub_1[2],
                                    l_binding_limit[8],
                                    l_csexec_number[12],
                                    i_csexec_number[12],
                                    l_restricted[1]=0,
                                    l_prior_status[2],
                                    l_restricted_distance[5]=0/dec=2,
                                    l_tier[2]=0 ;

        local date l_loss_date[8] ;

        local string l_zipcode[9],
                     l_csexec_application[25],
                     l_continue[1],
                     l_submit[1],
                     l_subject[200],
                     l_loss_amount[8],
                     l_email[50],
                     l_bound[1],
                     l_user_id[15],
                     l_sent[1],
                     l_screen_1[10]="",
                     l_screen[9],
                     l_app[3]="agq",
                     l_printing[1],
                     l_dec[15],
                     l_business_desc_1[30],
                     l_business_desc_2[30],
                     l_continue_1[3],
                     l_continue_3[2],
                     l_str_zipcode[9],
                     l_str_state[2],
                     l_continue_2[3],
                     l_sub_line[2],
                     l_current_web_page[50],
                     l_enter,
                     l_web_site_address[150],
                     l_server_name[100],
                     l_lob_code[10],
                     l_over_10000[1]="N",
                     l_aplus_over_10000[1]="N",
                     l_code[7],
                     l_form_edition[25],
                     l_description[75],
                     L_COMPANY_ID[10] ;

        include "swsut100.var"

        include "virtualdecs.var"

        include "print.var"

        Access agqpersonal,
           Set agqpersonal:app_NO = G_app_NO, generic ;


-------------dont remove need the escape = noeffect
        !Escape=Cancel/error;
        !Escape=Abort/field/prompt;
        !Escape=Closewindow/help;
        !Escape="Exit"/function;
        !Escape=noeffect ;

        !F1=Help;                               !Sf1=Help;

        !F2=Activehelp/field/icon="ActHlp"

        !F3=Backfield/prompt/icon="|<-";
        !F3=Backtab/fields/icon="ABORT";
        !F3=Backtab/passivehelp;                !Sf3=Backfield/field/help;
        !F3=Pageup/activehelp;
        !F3="Prev"/function;                    !Sf3="Prev"/function;


        !F4=Forwardtab/fields/icon="OK"/edit ;
        !F4=Forwardtab/passivehelp;             !Sf4=Forwardfield/field/help;
        !F4=Pagedown/activehelp;
        !F4="Next"/function;                    !Sf4="Next"/function;

        !F5="Search"/function;                  !Sf5="Find"/function;
        !F5=Zoom/help;

--        !F6="Add"/function;                     !Sf6="Append"/function;

--        !F7="Change"/function;                  !Sf7="Delete"/function;

--        !F2="Delete"/function;

        !F9=Abort/error;
        !F9=Refresh/field/function/prompt;
        !F9=Closewindow/help/icon="Close";
        !F1="Print"/function/icon="Print"; /* this will display a list icon */

        !F10=Abort/field/prompt;
        !F10=Cancel/error/icon="Done";
        !F10="Exit"/function;                   !Sf10="Stop"/function;

        !C2=Backfield/prompt;
        !C2=Backtab/field;
        !C2=Backtab/passivehelp;                !Sc2=Backfield/field/help;
        !C2=Pageup/activehelp;
        !C2="Prev"/function;                    !Sc2="Prev"/function;

        !C4=Forwardtab/field;
        !C4=Forwardtab/passivehelp;             !Sc4=Forwardfield/field/help;
        !C4=Pagedown/activehelp;
        !C4="Next"/function;                    !Sc4="Next"/function;

/*----------------------------- End STDKEYS.INC ------------------------------*/


Style definition
                include "styles.inc"
                Displayonly Field Style {
                                  backgroundcolor="#CCCCCC"
                                }

Functions

        "redisplay" display/noreturn "agtmt9011" ;
        "func1" sequence "final" tagged submit_fn ;
        "final" continue begin
                         if l_checkbox_1 = 1 and
                            l_checkbox_2 = 1 and
                            l_checkbox_3 = 1 and
                            l_checkbox_4 = 1 and
                            l_checkbox_5 = 1 and
                            l_checkbox_6 = 1 and
                            agqpersonal:raters_name <> "" and
                            agqpersonal:company_id = "FARMERS" then
                             begin
                             if agqname:quote_no = 0 then
                                 begin
                                 l_continue_1 = dialog("Warning","question.bmp","You are about to submit your application to underwriting, do you wish to continue?","Yes","No")
                                 if l_continue_1 = "Yes" then
                                     begin
                                     l_continue_2 = dialog("Warning","question.bmp","Have you printed the Proposal and Application?","Yes","No")
                                     if l_continue_2 = "Yes" then
                                         begin
                                         l_screen_1 = "agtmt9012"
                                         function = "popup"
                                         end
                                     else
                                         begin
                                         l_continue_3 = dialog("Warning","question.bmp","Please print the proposal prior to issuance for signature","OK")
                                         end
                                     end
                                 end
                             else
                                 begin
                                 l_screen_1 = "agtmt9012"
                                 function = "popup"
                                 end
                             end
                         else
                         if l_checkbox_1 = 1 and
                            l_checkbox_2 = 1 and
                            l_checkbox_3 = 1 and
                            l_checkbox_4 = 1 and
                            l_checkbox_5 = 1 and
                            agqpersonal:company_id = "FLEMINGTON" then
                             begin
                             l_continue_1 = dialog("Warning","question.bmp","You are about to submit your application to underwriting, do you wish to continue?","Yes","No")
                             if l_continue_1 = "Yes" then
                                 begin
                                 l_screen_1 = "agtmt1208"
                                 function = "popup"
                                 end
                             end
                         else
                             begin
                             error "You need to complete all the information before you can submit to underwriting"
                             end
                         end ;
        "popup" display/noreturn l_screen_1 ;

        "func2" display "agtmt9006" tagged totals_fn ;
        "back" display/noreturn "agtmt001" tagged back_fn ;

        "func3" sequence "worksheet"  tagged worksheet_fn ;
        "worksheet" continue begin
                             l_printing = "Y"
                             do create_macro
                             end  ;

        "func4" sequence "quoteletter"  tagged quote_letter_fn ;
        "quoteletter" continue begin
                               l_printing = "Y"
                               do print_quote_letter
                               end ;
        "func5"  sequence "rating" tagged rating_info_fn ;
        "rating" continue begin
                          access sfsline, set sfsline:company_id       = agqpersonal:company_id,
                                              sfsline:line_of_business = agqpersonal:line_of_business,
                                              sfsline:lob_subline      = "00", generic

                          if sfsline:lob_code one of "HOME" then
                              begin
                              if agqpersonal:form = 3 then
                                  l_screen_1 = "agtmt9003"
                              else
                                  l_screen_1 = "agtmt9003f"
                              end
                          else
                              l_screen_1 = "agtmt1100"
                          function = "popup"
                          end ;
        "goto" display/noreturn l_screen ;
        "func6" display/noreturn "agtmt9004" tagged policy_info_fn ;
        "func7" sequence "opt" tagged optional_endorsement_fn ;
        "opt" continue begin
                       if agqpersonal:state = 19 then
                           l_screen_1 = "agtmt1000c"
                       else
                           l_screen_1 = "agtmt9005"
                       function = "popup"
                       end ;
--        "func33" display/noreturn l_screen_1 ;
        "func9" display/noreturn "agtmt9002" tagged mailing_address_fn ;
        "func10" display/noreturn "agtmt9002a" tagged location_address_fn ;
        "func11" display/noreturn "agtmt9008" tagged application1_fn ;
        "func12" display/noreturn "agtmt9007" tagged mtg_fn ;

        Include "stdfunc7.inc"

        reaccess ;

EVENT DEFINITION
        default eventhandler {
                                "REMOVE_SCREEN"  { function = "exit" abort () }
                             }

Toolbar Definition
-- needs to be blank

Screen Entry
l_warning = 0
g_initial_screen = ""
if g_form = 0 then
    g_form = agqpersonal:form
switch(g_line_of_business)
  case 1, 31  : switch(g_form)
                  case 1  : setproperty(t_mdw1,iconname,"title_cd_basic_mdw1.bmp")
                  case 2  : setproperty(t_mdw2,iconname,"title_cd_broad_mdw2.bmp")
                  case 3  : setproperty(t_mdw3,iconname,"title_cd_special_mdw3.bmp")
                  case 6  : setproperty(t_mdw6,iconname,"title_cd_condo_mdw6.bmp")
                  default : begin
                            setproperty(t_mdw1,iconname,"")
                            setproperty(t_mdw2,iconname,"")
                            setproperty(t_mdw3,iconname,"")
                            setproperty(t_mdw6,iconname,"")
                            end
                  end
  case 4, 34  : switch(g_form)
                  case 3  : setproperty(t_mho3,iconname,"title_mho3.bmp")
                  case 4  : setproperty(t_mho4,iconname,"title_mho4.bmp")
                  case 6  : setproperty(t_mho6,iconname,"title_mho6.bmp")
                  default : begin
                            setproperty(t_mho3,iconname,"")
                            setproperty(t_mho4,iconname,"")
                            setproperty(t_mho6,iconname,"")
                            end
                  end
  case 14, 44 : switch(g_form)
                  case 3  : setproperty(t_pref_mho3,iconname,"title_ho_preferred_mho3.bmp")
                  case 5  : setproperty(t_pref_mho5,iconname,"title_ho_preferred_mho5.bmp")
                  default : begin
                            setproperty(t_pref_mho3,iconname,"")
                            setproperty(t_pref_mho5,iconname,"")
                            end
                  end
  case 24, 54 : switch(g_form)
                  case 3  : setproperty(t_prem_mho3,iconname,"title_ho_premier_mho3.bmp")
                  default : setproperty(t_prem_mho3,iconname,"")
                  end
  end

access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

if sfsdefault:company_id one of "FLEMINGTON" then
    hide(farmers_fn)
else
if sfsdefault:company_id one of "FARMERS" then
    hide(ficof_fn)

l_username = username
access sfsprofile,
   set sfsprofile:user_id  = l_username, exact

If SFSPROFILE:USER_ID <> L_USERNAME Then
  Begin
    L_USERNAME = "default"
    Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact
  End

access agqname, set agqname:app_no = g_app_no, generic

l_user_Id = username
access sfsemail, set sfsemail:company_id = agqpersonal:company_id,
                     sfsemail:user_Id = l_user_id, generic

if agqname:policy_no <> 0 and
   sfsemail:agent_no <> 0 then
    disable(quote_letter_fn)

access sfsagent, set sfsagent:company_id = agqpersonal:company_id,
                     sfsagent:agent_no   = agqpersonal:agent_no, generic

if sfsagent:sub_producer_for <> 0 and
   sfsemail:agent_no = sfsagent:agent_no then
    setproperty(submit_info,iconname,"btn_submit_to_soa.bmp")
else
    setproperty(submit_info,iconname,"btn_submit_to_uw.bmp")

do check_files
if (sfsagent:sub_producer_for = 0 or
   (sfsagent:sub_producer_for <> 0 and
   agqpersonal:agent_no <> sfsemail:agent_no)) then
    begin
    if agqname:quote_no = 0 then
        begin
        if sfsdefault:company_Id = "FARMERS" then
            begin
            if l_checkbox_1 = 0 then
                begin
                l_submit = "N"
                disable(application_fn)
                end
            else
            if l_checkbox_2 = 0 then
                begin
                l_submit = "N"
                disable(application_fn)
                end
            else
            if l_checkbox_3 = 0 then
                begin
                l_submit = "N"
                disable(application_fn)
                end
            else
            if l_checkbox_4 = 0 then
                begin
                l_submit = "N"
                disable(application_fn)
                end
            else
            if l_checkbox_5 = 0 then
                begin
                l_submit = "N"
                disable(application_fn)
                end
            else
            if l_checkbox_6 = 0 then
                begin
                l_submit = "N"
                disable(application_fn)
                end

            if l_checkbox_6 = 0 then
                begin
                setproperty(wording,text,"Application not complete - all questions must be answered prior to referral")
                show(unbound_wording)
                end
/*            else
            if l_checkbox_1 = 1 and
               l_checkbox_2 = 1 and
               l_checkbox_3 = 1 and
               l_checkbox_4 = 1 and
               l_checkbox_5 = 1 and
               l_checkbox_6 = 1 then
                enable(submit_fn)*/
            end
--        else
--            enable(submit_fn)
        end
    end

if agqpersonal:raters_name = "" then
    function = "CHANGE"

if (sfsagent:sub_producer_for = 0 or
   (sfsagent:sub_producer_for <> 0 and
   agqpersonal:agent_no <> sfsemail:agent_no)) then
    begin
    access agqapplication, set agqapplication:app_no = g_app_no, generic

    while agqapplication:app_no = g_app_no
        begin
        if agqpersonal:form one of 3 then
            begin
            if agqapplication:sub_code = 17 and
               agqapplication:answer = "N" then
                begin
                g_central_heat = "N"
                end
            if agqapplication:sub_code = 15 then
                g_daycare = agqapplication:daycare
            end
        else
        if agqpersonal:form one of 4 then
            begin
            if agqapplication:sub_code = 13 then
                g_daycare = agqapplication:daycare
            end
        else
        if agqpersonal:form one of 6 then
            begin
            g_central_heat = ""
            if agqapplication:sub_code = 15 then
                g_daycare = agqapplication:daycare
            end

        next agqapplication
        end
    end

if (sfsagent:sub_producer_for = 0 or
   (sfsagent:sub_producer_for <> 0 and
   agqpersonal:agent_no <> sfsemail:agent_no)) then
    begin
    l_no_claims = 0
    access agqlosses, set agqlosses:app_no = g_app_no, generic

    l_sub_1 = 1
    l_total_paid = 0
    while l_sub_1 < 6
        begin
        l_loss_date = agqlosses:date_of_loss[l_sub_1]
        l_claim_year = year(agqname:eff_date) - year(l_loss_date)
        if l_loss_date <> 0 then
            begin
            if ((l_claim_year < 3 or
               (l_claim_year = 3 and
               month(l_loss_date) >= month(agqname:eff_date)))) then
                begin
                if ((day(l_loss_date) >= day(agqname:eff_date) and
                   l_claim_year = 3) or
                   l_claim_year < 3) then
                    begin
                    l_no_claims = l_no_claims + 1
                    end
                end
            end

        l_sub_1 = l_sub_1 + 1
        end

    access agqclaim, set agqclaim:app_no = g_app_no, generic

    l_aplus_over_10000 = "N"
    while agqclaim:app_no = g_app_no
        begin
        l_claim_year = year(agqname:eff_date) - year(agqclaim:loss_date)
        if ((l_claim_year < 3 or
           (l_claim_year = 3 and
           month(agqclaim:loss_date) >= month(agqname:eff_date))) and
           agqclaim:policy_type one of "HO", "H" and
           agqclaim:name <> "INSURED NAME DIFFERENT" and
           agqclaim:loss_amount not one of "", "0", "$0") then
            begin
            l_continue = "N"
            if l_claim_year = 3 and
               month(agqclaim:loss_date) = month(agqname:eff_date) and
               day(agqclaim:loss_date) >= day(agqname:eff_date) then
                l_continue = "Y"

            if l_claim_year = 3 and
               month(agqclaim:loss_date) > month(agqname:eff_date) then
                l_continue = "Y"

            if l_claim_year < 3 then
                l_continue = "Y"

            if l_continue = "Y" then
                begin
                l_no_claims = l_no_claims + 1
                end
            end

        next agqclaim
        end

    if ((g_daycare = "Y" and
       sfsemail:agent_no <> 0) or
       (g_central_heat = "N" and
       sfsemail:agent_no <> 0)) then
        l_submit = "N"

    if l_no_claims >= 3 and
       sfsemail:agent_no <> 0 then
        begin
        l_warning = l_warning + 1
        l_submit = "N"
        end

    l_no_mtg = 0
    access agqsupp_alias, set agqsupp_alias:app_no = g_app_no, generic

    while agqsupp_alias:app_no = g_app_no
        begin
        l_no_mtg = l_no_mtg + 1

    next agqsupp_alias
    end

    if l_no_mtg >= 3 then
        begin
        warning "Refer to Company-Exceeds Binding Authority"
        end

    do check_for_warnings
    end

l_server_name = sfsprofile:UNIX_SERVER

access agqpersonal, set agqpersonal:app_no = g_app_no, generic

if agqpersonal:company_id = "FLEMINGTON" then
    begin
    l_current_web_page = "23webhelp_agtmt9011_scr_final_check.htm"
    do change_current_browser(l_server_name,l_current_web_page)
    end

if g_form = 4 then
    disable(mtg_fn)

access agqsupp, set agqsupp:app_no = g_app_no, generic

if agqsupp:app_no <> g_app_no then
    disable(mtg_fn)

access agqpersonal, set agqpersonal:app_no = g_app_no, generic

access agsdefault_plp, set agsdefault_plp:company_id       = agqpersonal:company_id,
                           agsdefault_plp:state            = agqpersonal:state,
                           agsdefault_plp:agent_no         = agqpersonal:agent_no,
                           agsdefault_plp:line_of_business = agqpersonal:line_of_business,
                           agsdefault_plp:form             = agqpersonal:form, generic

if (sfsagent:sub_producer_for = 0 or
   (sfsagent:sub_producer_for <> 0 and
   agqpersonal:agent_no <> sfsemail:agent_no)) then
    begin
    access agqstatus, set agqstatus:app_no = agqpersonal:app_no, generic

    l_prior_status = agqstatus:status_code
    if l_bound = "" then
        l_bound = agqpersonal:bound
    if agqpersonal:company_id = "FARMERS" and
       l_bound = "N" and
       agsdefault_plp:allow_agent_to_print = 1 and
       agqname:quote_no = 0 and
       l_checkbox_6 = 1 then
        begin
        if agqstatus:status_code = 6 then
            begin
            l_submit = "Y"
--            enable(submit_fn)
            hide(unbound_wording)
            end
        else
        if agqstatus:status_code = 4 then
            begin
            l_submit = "N"
            disable(quote_letter_fn)
            setproperty(wording,text,"QUOTE DECLINED")
            show(unbound_wording)
            end
        else
        if agqstatus:status_code = 7 then
            begin
            l_submit = "N"
            setproperty(wording,text,"Need more information, contact your Underwriter")
            show(unbound_wording)
            end
        else
        if agqstatus:status_code one of 1, 3 then
            begin
            l_submit = "N"
            setproperty(wording,text,"Account Not Bound - Underwriting Action Pending")
            show(unbound_wording)
            end

        if agqpersonal:sent_email = 0 then
            begin
            do email_underwriter
            end
        end
    else
    if agqpersonal:company_id = "FARMERS" and
       l_bound = "Y" and
       agsdefault_plp:allow_agent_to_print = 1 and
       agqname:quote_no = 0 and
       l_checkbox_6 = 1 then
        begin
        hide(unbound_wording)
--        enable(submit_fn)
        end

    if agqstatus:status_code not one of 4, 6, 7 then
        do update_agqstatus
    if l_prior_status <> agqstatus:status_code then
        function = "redisplay"
    end

if agqpersonal:bound = "N" and
   agqstatus:status_code not one of 6 then
    l_submit = "N"

if agqname:quote_no <> 0 then
    l_submit = "N"

if agqname:sub_producer_submitted <> 0 and
   sfsagent:sub_producer_for <> 0 and
   agqpersonal:agent_no = sfsemail:agent_no then
    begin
    l_submit = "N"
    setproperty(wording,text,"Application already submitted for Approval")
    show(unbound_wording)
    end

if l_submit = "N" then
    disable(submit_fn)
else
    enable(submit_fn)

Access Validation
If agqpersonal:app_NO <> G_app_NO Then
    Error 1000 ;

screen at 1,1 to 30,100
Properties
        {
        Layouttype = screen
        transparent = False
        backgroundcolor = "#ADD8E6"
        scrollbarpolicy = always
        }
{

    Panel at 1,1 to 2,100
        Properties
            {
            layouttype = screen
            }
        {
        components
            guidetext at 1,1 to 2,40
                properties
                    {
                    iconname = "qp_logo.gif"
                    }
            guidetext at 1,83 to 2,100 tagged ficof_fn
                properties
                    {
                    iconname = "ficof_logo.gif"
                    }
            guidetext at 1,80 to 2,100 tagged farmers_fn
                properties
                    {
                    iconname = "salem_logo.gif"
                    }
            guidetext at 1.30,32 tagged t_mdw1
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_mdw2
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_mdw3
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_mdw6
                Properties
                   {
                   iconname = ""
                   }

            guidetext at 1.30,28 tagged t_mho3
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,20 tagged t_mho4
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,28 tagged t_mho6
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_pref_mho3
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_pref_mho5
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_prem_mho3
                Properties
                   {
                   iconname = ""
                   }
        }

  Panel at 3,1 to 4,100
        Properties {
                LayoutType = screen
                backgroundcolor = "Grey"
                transparent = False
        }
        {
         Components
           guidetext at 1.45,1 to 1.45,60
             properties
               {
                 text = "Final Checklist..."
                 fontsize = 18
                 fontstyle = BOLD
                 transparent = False
                 fontname = "Arial"
                 backgroundcolor = "Grey"
               }
         }

panel at 3.6,75 to 3.6, 100 Tagged quote_no
Properties
        {
                LayoutType = row
                transparent = false
        }
{
%%
App No:  ___________

%%
fields
101  agqpersonal:APP_NO/displayonly ;
}

Panel at 6,1 to 6,100 Tagged farmers_fn
Properties
        {
        LayoutType = screen
        }
{
Components

        Button at 1,7
        Properties {
                Iconname = "btn_view_print_quote.bmp"
                }
        Events  {
                Action = worksheet_fn
                }
        Button at 1,35   tagged back_fn
        Properties {
                Iconname = "btn_back_to_main_screen.bmp"
                }
        Events  {
                Action {
                          l_continue_2 = dialog("EXITING","warning.bmp","You are about to leave the application, Do you wish to continue","Yes","No")
                          if l_continue_2 = "Yes" then
                              begin
                              function = "back"
                              abort()
                              end
                       }
                }
        Button at 1,58 tagged application_fn
        Properties {
                Iconname = "btn_view_print_application.bmp"
                }
        Events  {
                Action = quote_letter_fn
                }
        }

Panel at 6,70 to 6,100 Tagged ficof_fn
Properties
        {
        LayoutType = screen
        }
{
Components

        Button at 1,7
        Properties {
                Iconname = "btn_view_print_worksheet.bmp"
                }
        Events  {
                Action = worksheet_fn
                }
        Button at 1,58
        Properties {
                Iconname = "btn_view_print_quote_and_app.bmp"
                }
        Events  {
                Action = quote_letter_fn
                }

}

Panel at 5.45,91
Properties
  {
    layouttype = column
  }
{
  Components
    guidetext to 1,1
       properties
         {
           text = "agtmt9011.sd"
           fontsize = 9
         }
}

-- draw a line
panel at 7,1 to 7,100 tagged line_panel_1
    {
    Components
        line at 1,1 to 1,100
            Properties
                {
                Linestyle = embossed
                Linewidth = 5
                Backgroundcolor = "black"
                }
    }


Panel at 10,30 to 10,60 Tagged icon_line2_tg
Properties
        {
        LayoutType = screen
        }
{
Components

        Button at 1,1   tagged rating_info
        Properties {
                Iconname = "btn_rating_infomation.bmp"
                }
        Events  {
                Action = rating_info_fn
                }
        }

Panel at 12,30 to 12,60 Tagged icon_line2_tg
Properties
        {
        LayoutType = screen
        }
{
Components

        Button at 1,1    tagged optional_endorsement_info
        Properties {
                Iconname = "btn_opt_endt.bmp"
                }
        Events  {
                Action = optional_endorsement_fn
                }

        }

Panel at 14,30 to 14,60 Tagged icon_line2_tg
Properties
        {
        LayoutType = screen
        }
{
Components
        Button at 1,1
        Properties {
                Iconname = "btn_view_mail_address.bmp"
                }
        Events  {
                Action = mailing_address_fn
                }

}

Panel at 16,30 to 16,60 Tagged icon_line2_tg
Properties
        {
        LayoutType = screen
        }
{
Components
        Button at 1,1
        Properties {
                Iconname = "btn_view_loc_address.bmp"
                }
        Events  {
                Action = location_address_fn
                }

}

Panel at 18,30 to 18,60 Tagged icon_line2_tg
Properties
        {
        LayoutType = screen
        }
{
Components
        Button at 1,1
        Properties {
                Iconname = "btn_view_mortgagee.bmp"
                }
        Events  {
                Action = mtg_fn
                }

}

Panel at 20,30 to 20,60 Tagged icon_line2_tg
Properties
        {
        LayoutType = screen
        }
{
Components
        Button at 1,1
        Properties {
                Iconname = "btn_view_application.bmp"
                }
        Events  {
                Action = application1_fn
                }

}

Panel at 10,65 to 10,90 Tagged rating_pl
Properties
        {
        Scrollbarpolicy    = asneeded
        }
{
%%
_

%%

components

Fields
101     l_checkbox_1/checkbox/values="0,1"/displayonly ;

}

Panel at 12,65 to 12,90 Tagged rating_pl
Properties
        {
        Scrollbarpolicy    = asneeded
        }
{
%%
_

%%

components

Fields
101     l_checkbox_3/checkbox/values="0,1"/displayonly ;

}

Panel at 14,65 to 14,90 Tagged rating_pl
Properties
        {
        Scrollbarpolicy    = asneeded
        }
{
%%
_

%%

components

Fields
101     l_checkbox_4/checkbox/values="0,1"/displayonly ;

}

Panel at 16,65 to 16,90 Tagged rating_pl
Properties
        {
        Scrollbarpolicy    = asneeded
        }
{
%%
_

%%

components

Fields
101     l_checkbox_5/checkbox/values="0,1"/displayonly ;

}

Panel at 18,65 to 18,90 Tagged rating_pl
Properties
        {
        Scrollbarpolicy    = asneeded
        }
{
%%
_

%%

components

Fields
101     l_checkbox_7/checkbox/values="0,1"/displayonly ;

}

Panel at 20,65 to 20,90 Tagged rating_pl
Properties
        {
        Scrollbarpolicy    = asneeded
        }
{
%%
_

%%

components

Fields
101     l_checkbox_6/checkbox/values="0,1"/displayonly ;

}

Panel at 22,5 to 23,90 Tagged rater_fn
Properties
        {
        Scrollbarpolicy    = asneeded
        fontstyle = bold
        }
{
%%
Enter CSR or Producer Name:  __________________________________________________
Enter CSR or Producer Email: __________________________________________________

%%

components

Fields
101     begin
        access agqagtcontact_alias, set agqagtcontact_alias:company_id = agqpersonal:company_id,
                                        agqagtcontact_alias:agent_no   = agqpersonal:agent_no, generic

        end
        agqpersonal:raters_name/uppercase mandatory
        if agqpersonal:raters_name = "" then
            error "You must enter CSR or Producer Name"

        activehelp agqagtcontact_alias:raters_name ;
201     begin
        access agqagtcontact_alt, set agqagtcontact_alt:company_id  = agqpersonal:company_id,
                                      agqagtcontact_alt:agent_no    = agqpersonal:agent_no,
                                      agqagtcontact_alt:raters_name = agqpersonal:raters_name, generic

        agqpersonal:email = agqagtcontact_alt:email
        end
        agqpersonal:email/default mandatory
        if agqpersonal:email = "" then
            error "You must enter CSR or Producer email address"

        activehelp agqagtcontact_alt:email ;


}

-- draw a line
panel at 24,1 to 24,100 tagged line_panel_1
    {
    Components
        line at 1.5,1 to 1.5,100
            Properties
                {
                Linestyle = embossed
                Linewidth = 5
                Backgroundcolor = "black"
                }
    }

Panel at 25,10 to 25,100 Tagged icon_line2_tg
Properties
        {
        LayoutType = screen
        }
{
Components

        Button at 1,1   tagged back_info
        Properties {
                Iconname = "btn_view_summary_totals.bmp"
                }
        Events  {
                Action = totals_fn
                }
        }

Panel at 25,70 to 25,100 Tagged icon_line2_tg
Properties
        {
        LayoutType = screen
        }
{
Components
        Button at 1,1   tagged submit_info
        Properties {
                Iconname = ""
                }
        Events  {
                Action = submit_fn
                }

}

-- draw a line
panel at 26,1 to 26,100 tagged line_panel_1
    {
      Components
        line at 1,1 to 1,100
            Properties
              {
                Linestyle = embossed
                Linewidth = 5
                Backgroundcolor = "black"
              }
    }

panel at 27,1 to 27, 100 tagged unbound_wording
        Properties {
                LayoutType = screen
        }
        {
         Components
           guidetext at 1,1 to 1,100 tagged wording
             properties
               {
                 text = ""
                 fontsize = 18
                 fontstyle = bold
                 fontname = "Arial"
                 contentalignment = middle
               }
         }

panel at 27,1 to 32,100  tagged ficof_fn

Properties
        {
          LayoutType = screen
--          Transparent = False
          backgroundcolor = "white"
        }
{
      Components
         browser at 1,1 to 7,100  tagged helper_tg
             properties {
                          url = ""
                        }
}

}

update
if updateok = "YES" and
   abort = "NO" then
    begin
    access agqagtcontact, set agqagtcontact:company_id  = agqpersonal:company_id,
                              agqagtcontact:agent_no    = agqpersonal:agent_no,
                              agqagtcontact:raters_name = agqpersonal:raters_name, generic

    if agqagtcontact:raters_name = agqpersonal:raters_name then
        begin
        change agqagtcontact
            begin
            agqagtcontact:email       = agqpersonal:email/raw
            agqagtcontact:expansion   = ""/raw
            end
        end
    else
        begin
        add agqagtcontact
            begin
            agqagtcontact:company_id  = agqpersonal:company_id/raw
            agqagtcontact:agent_no    = agqpersonal:agent_no
            agqagtcontact:raters_name = agqpersonal:raters_name/raw
            agqagtcontact:email       = agqpersonal:email/raw
            agqagtcontact:expansion   = ""/raw
            end
        end
    end

procedure definition

procedure update_agqstatus
begin
access agqpersonal_alias, set agqpersonal_alias:app_no = g_app_no, generic

access agqstatus, set agqstatus:app_no = g_app_no, generic

if agqpersonal_alias:bound = "Y" and
   sfsagent:sub_producer_for = 0 then
    l_status = 2
else
if agqpersonal_alias:bound = "Y" and
   sfsagent:sub_producer_for <> 0 then
    l_status = 9
else
if agqpersonal_alias:bound = "N" then
    l_status = 3

access agsstatus, set agsstatus:company_id  = agqpersonal:company_id,
                      agsstatus:status_code = l_status, generic

if agqstatus:app_no = g_app_no then
    begin
    change agqstatus
        begin
        agqstatus:trans_date         = todaysdate
        agqstatus:status_code        = l_status
        agqstatus:status_description = agsstatus:description/raw
        agqstatus:policy_no          = 0
        agqstatus:agent_no           = agqpersonal:agent_no
        agqstatus:company_id         = agqpersonal:company_id/raw
        end
    end
else
if agqstatus:app_no <> g_app_no then
    begin
    add agqstatus
        begin
        agqstatus:app_no             = g_app_no
        agqstatus:insured_name       = agqname:name[1]/raw
        agqstatus:trans_date         = todaysdate
        agqstatus:status_code        = l_status
        agqstatus:status_description = agsstatus:description/raw
        agqstatus:policy_no          = 0
        agqstatus:agent_no           = agqpersonal:agent_no
        agqstatus:company_id         = agqpersonal:company_id/raw
        end
    end

access agqstatusnotes, set agqstatusnotes:app_no = g_app_no, generic

do subcode
if agqpersonal_alias:bound = "Y" then
    begin
    if agqstatusnotes:app_no <> g_app_no then
        begin
        add agqstatusnotes
            begin
            agqstatusnotes:app_no            = g_app_no
            agqstatusnotes:trans_date        = todaysdate
            agqstatusnotes:sub_code          = l_sub_code
            agqstatusnotes:notes             = "Agent has submitted quote bound"
            agqstatusnotes:note_created_by   = "agtmt9011"
            agqstatusnotes:status_code       = l_status
            end
        end
    else
        begin
        change agqstatusnotes
            begin
            agqstatusnotes:trans_date        = todaysdate
            agqstatusnotes:sub_code          = l_sub_code
            agqstatusnotes:notes             = "Agent has submitted quote bound"
            agqstatusnotes:note_created_by   = "agtmt9011"
            agqstatusnotes:status_code       = l_status
            end
        end
    end
else
    begin
    if agqstatusnotes:app_no <> g_app_no then
        begin
        add agqstatusnotes
            begin
            agqstatusnotes:app_no            = g_app_no
            agqstatusnotes:trans_date        = todaysdate
            agqstatusnotes:sub_code          = l_sub_code
            agqstatusnotes:notes             = "Agent's quote has been emailed to the underwriter not bound"
            agqstatusnotes:note_created_by   = "agtmt9011"
            agqstatusnotes:status_code       = l_status
            end
        end
    else
        begin
        change agqstatusnotes
            begin
            agqstatusnotes:trans_date        = todaysdate
            agqstatusnotes:sub_code          = l_sub_code
            agqstatusnotes:notes             = "Agent's quote has been emailed to the underwriter not bound"
            agqstatusnotes:note_created_by   = "agtmt9011"
            agqstatusnotes:status_code       = l_status
            end
        end
    end
end

procedure subcode
begin
access agqstatusnotes_alias, set agqstatusnotes_alias:app_no = g_app_no, generic

l_sub_code = 0
while agqstatusnotes_alias:app_no = g_app_no
    begin
    l_sub_code = agqstatusnotes_alias:sub_code

    next agqstatusnotes_alias
    end

l_sub_code = l_sub_code + 10
end

procedure email_underwriter
begin
access sfsagent_alias, set sfsagent_alias:company_id = agqpersonal:company_id,
                           sfsagent_alias:agent_no   = sfsemail:agent_no, generic

access sfsperun, set sfsperun:company_id           = sfsagent:company_id,
                     sfsperun:personal_underwriter = sfsagent:personal_underwriter, generic

access scipsimage, set scipsimage:company_id = agqpersonal:company_id, generic

access agqpersonal, set agqpersonal:app_no = g_app_no, generic

access agqmailingaddress, set agqmailingaddress:app_no = g_app_no, generic

l_printing = "N"
do print_quote_letter
do create_macro
if sfsagent_alias:sub_producer_for <> 0 then
    l_email = scipsimage:email_address[2]
else
    L_EMAIL   = trun(sfsperun:email_1)
L_SUBJECT = "Referral to Review for app" + trun(str(agqpersonal:app_no)) + " - " + trun(toggle(agqmailingaddress:first_name_1)) + " " + trun(toggle(agqmailingaddress:last_name_1))

deletefile("referral.mf")
--Writefile ("referral.mf","cli uuencode ./referral.pdf referral1.pdf> referral.uue<nl>")
Writefile ("referral.mf","cli mail -s '%s' -a referral.pdf %s < /dev/null",trun(l_subject),Trun(L_EMAIL))
writefile ("referral.mf","<nl>")
--Writefile ("referral.mf","cli mail -s '%s' -a referral.pdf debbiep@scips.com < /dev/null",trun(l_subject))
Writefile ("referral.mf","cli mail -s '%s' -a referral.pdf mchambers@farmersofsalem.com < /dev/null",trun(l_subject))
writefile ("referral.mf","<nl>")
Closefile ("referral.mf")

Proc("cli chmod 777 referral.mf")/noconsole
Proc("cli cq referral")/noconsole

access agqpersonal_alias, set agqpersonal_alias:app_no = agqpersonal:app_no, generic

if agqpersonal_alias:app_no = agqpersonal:app_no and
   sfsagent_alias:sub_producer_for = 0 then
    begin
    change agqpersonal_alias
        begin
        agqpersonal_alias:sent_email = 1
        end
    end

end

procedure check_for_warnings
begin
do minimum_maximum_limits
if agqpersonal:form one of 3 and
   agqpersonal:limit > l_binding_limit then
    begin
    l_warning = l_warning + 1
    end

if agqpersonal:form one of 4 and
   agqpersonal:limit > l_binding_limit then
    begin
    l_warning = l_warning + 1
    end

if agqpersonal:form one of 6 and
   agqpersonal:limit > l_binding_limit then
    begin
    l_warning = l_warning + 1
    end

access agqend, set agqend:app_no = g_app_no, generic

while agqend:app_no = g_app_no
    begin
    if agqend:code = "MPL180" then
        l_warning = l_warning + 1

    next agqend
    end

if agqpersonal:year_construction < 1920 then
    begin
    l_warning = l_warning + 1
    end

access agqapplication, set agqapplication:app_no = g_app_no, generic

while agqapplication:app_no = g_app_no
    begin
    if ((agqapplication:sub_code = 4 and
       agqapplication:answer = "Y" and
       g_form one of 3, 6) or
       (agqapplication:sub_code = 3 and
       agqapplication:answer = "Y" and
       g_form one of 4)) then
        begin
        l_warning = l_warning + 1
        end

    if ((agqapplication:sub_code = 2 and
       agqapplication:answer = "Y" and
       g_form one of 3, 6) or
       (agqapplication:sub_code = 1 and
       agqapplication:answer = "Y" and
       g_form one of 4)) then
        begin
        l_warning = l_warning + 1
        end

    if ((agqapplication:sub_code = 13 and
       g_form one of 3, 6 and
       agqapplication:answer = "Y") or
       (agqapplication:sub_code = 12 and
       g_form = 4 and
       agqapplication:answer = "Y")) then
        begin
        l_warning = l_warning + 1
        end

    if ((agqapplication:sub_code = 21 and
       g_form one of 3 and
       agqapplication:answer = "Y" and
       agqapplication:breed_for_profit = "Y") or
       (agqapplication:sub_code = 17 and
       g_form one of 6 and
       agqapplication:answer = "Y" and
       agqapplication:breed_for_profit = "Y") or
       (agqapplication:sub_code = 15 and
       g_form one of 4 and
       agqapplication:answer = "Y" and
       agqapplication:breed_for_profit = "Y")) then
        begin
        l_warning = l_warning + 1
        end

    next agqapplication
    end

access agqpersonal2, set agqpersonal2:app_no = g_app_no, generic

if agqpersonal2:credit_score_tier >= 20 then
    begin
    l_warning = l_warning + 1
    end

if agqpersonal:no_families = 2 and
   agqpersonal:unoccupied = 1 and
   agqpersonal:form one of 3 then
    begin
    l_warning = l_warning + 1
    end

if agqpersonal:owner_occupied = "N" and
   agqpersonal:form one of 3 then
    begin
    l_warning = l_warning + 1
    end

access agqwatercraft, set agqwatercraft:app_no = g_app_no, generic

while agqwatercraft:app_no = g_app_no
    begin
    if agqwatercraft:horse_power[1] > 100 or
       agqwatercraft:horse_power[2] > 150 or
       agqwatercraft:sailboat_feet > 26 then
        l_warning = l_warning + 1

    next agqwatercraft
    end

access agqdesc1, set agqdesc1:app_no = g_app_no, generic

while agqdesc1:app_no = g_app_no
    begin
    if agqdesc1:code = "MPL15" then
        begin
        if agqdesc1:article = "JEWELRY" and
           agqdesc1:limit > 25000 then
            l_warning = l_warning + 1

        if agqdesc1:article = "FINE ARTS" and
           agqdesc1:limit > 50000 then
            l_warning = l_warning + 1
        end

    next agqdesc1
    end

l_no_mtg = 0
access agqsupp_alias, set agqsupp_alias:app_no = g_app_no, generic

while agqsupp_alias:app_no = g_app_no
    begin
    l_no_mtg = l_no_mtg + 1

    next agqsupp_alias
    end

if l_no_mtg >= 3 then
    begin
    l_warning = l_warning + 1
    end

l_no_claims = 0
access agqlosses, set agqlosses:app_no = g_app_no, generic

l_sub_1 = 1
l_total_paid = 0
while l_sub_1 < 6
    begin
    l_loss_date = agqlosses:date_of_loss[l_sub_1]
    l_claim_year = year(agqname:eff_date) - year(l_loss_date)
    if l_loss_date <> 0 then
        begin
        if ((l_claim_year < 3 or
           (l_claim_year = 3 and
           month(l_loss_date) >= month(agqname:eff_date)))) then
            begin
            if ((day(l_loss_date) >= day(agqname:eff_date) and
               l_claim_year = 3) or
               l_claim_year < 3) then
                begin
                l_no_claims = l_no_claims + 1
                l_total_paid = l_total_paid + agqlosses:paid_amount[l_sub_1]
                if agqlosses:paid_amount[l_sub_1] > 10000 then
                    l_over_10000 = "Y"
                end
            end
        end

    l_sub_1 = l_sub_1 + 1
    end

access agqclaim, set agqclaim:app_no = g_app_no, generic

l_aplus_over_10000 = "N"
while agqclaim:app_no = g_app_no
    begin
    l_claim_year = year(agqname:eff_date) - year(agqclaim:loss_date)
    if ((l_claim_year < 3 or
       (l_claim_year = 3 and
       month(agqclaim:loss_date) >= month(agqname:eff_date))) and
       agqclaim:name <> "INSURED NAME DIFFERENT" and
       agqclaim:policy_type one of "HO", "H" and
       agqclaim:loss_amount not one of "", "0", "$0") then
        begin
        l_continue = "N"
        if l_claim_year = 3 and
           month(agqclaim:loss_date) = month(agqname:eff_date) and
           day(agqclaim:loss_date) >= day(agqname:eff_date) then
            l_continue = "Y"

        if l_claim_year = 3 and
           month(agqclaim:loss_date) > month(agqname:eff_date) then
            l_continue = "Y"

        if l_claim_year < 3 then
            l_continue = "Y"

        if l_continue = "Y" then
            begin
            l_no_claims = l_no_claims + 1
            l_dollar_sign_at = 1
            l_sub = 1
            while l_sub < 10
                begin
                l_dollar_sign_at = pos("$",agqclaim:loss_amount)
                l_loss_amount = agqclaim:loss_amount[1,l_dollar_sign_at - 1] + agqclaim:loss_amount[l_dollar_sign_at + 1,len(agqclaim:loss_amount)]
                l_sub = l_sub + 1
                end

            l_total_paid = l_total_paid + val(l_loss_amount)
            if val(l_loss_amount) > 10000 then
                l_aplus_over_10000 = "Y"
            end
        end

    next agqclaim
    end

if l_no_claims >= 3 then
    begin
    l_warning = l_warning + 1
    end

if l_over_10000 = "Y" or
   l_aplus_over_10000 = "Y" then
    begin
    l_warning = l_warning + 1
    end

if l_total_paid >= 10000 and
   l_no_claims = 2 then
    begin
    l_warning = l_warning + 1
    end

access agqpersonal_alias, set agqpersonal_alias:app_no = g_app_no, generic

l_bound = "Y"
if agqpersonal_alias:app_no = g_app_no then
    begin
    change agqpersonal_alias
        begin
        if l_warning > 0 then
            begin
            l_bound = "N"
            agqpersonal_alias:bound = "N"
            end
        else
            begin
            l_bound = "Y"
            agqpersonal_alias:bound = "Y"
            end
        end
    end

end

procedure minimum_maximum_limits
begin
access sfsminmax, set sfsminmax:company_id       = agqpersonal:company_id,
                      sfsminmax:state            = agqpersonal:state,
                      sfsminmax:line_of_business = agqpersonal:line_of_business,
                      sfsminmax:form             = agqpersonal:form, generic

while sfsminmax:company_id        = agqpersonal:company_id and
      sfsminmax:state             = agqpersonal:state and
      sfsminmax:line_of_business  = agqpersonal:line_of_business and
      sfsminmax:form              = agqpersonal:form
        begin
        if (agqpersonal:eff_date >= sfsminmax:eff_date and
           (agqpersonal:eff_date <= sfsminmax:exp_date or
           sfsminmax:exp_date = 0)) then
            begin
            l_binding_limit   = sfsminmax:binding_maximum
            end

        next sfsminmax
        end

end

procedure change_current_browser (string p_server_name, string p_current_web_page)
BEGIN
l_web_site_address = trun(p_server_name) + trun(p_current_web_page)
setproperty(helper_tg,url,trun(l_web_site_address))

END

procedure check_files
begin
l_checkbox_1 = 1
l_checkbox_2 = 1
--l_checkbox_4 = 1

access agqend, set agqend:app_no = g_app_no, generic

if agqend:app_no = g_app_no then
    begin
    l_checkbox_3 = 1
    do check_endorsement_edition_dates
    end

access agqmailingaddress, set agqmailingaddress:app_no = g_app_no, generic

access agqmaster, set agqmaster:app_no = g_app_no, generic

if agqname:name[1] = "" or
   agqname:address[1] = "" or
   agqname:city = "" or
   agqname:str_state = "" or
   agqname:str_zipcode = "" then
    l_checkbox_4 = 0
else
    l_checkbox_4 = 1

access agqpersonal_alias, set agqpersonal_alias:app_no = g_app_no, generic

l_checkbox_5 = 1
while agqpersonal_alias:app_no = g_app_no
    begin
    access agqlocation, set agqlocation:app_no   = agqpersonal_alias:app_no, generic

    if agqlocation:address = "" or
       agqlocation:city = "" or
       agqlocation:str_state = "" or
       agqlocation:str_zipcode = "" then
        l_checkbox_5 = 0

    next agqpersonal_alias
    end

access agqapplication, set agqapplication:app_no = g_app_no, generic

l_checkbox_6 = 1
while agqapplication:app_no = g_app_no
    begin
    if agqapplication:literal <> "" and
       agqapplication:answer not one of "N", "Y" and
       agqapplication:sub_code >= 11 and
       agqapplication:sub_code < 60 then
        begin
        l_checkbox_6 = 0
        end

    next agqapplication
    end

access agqapplication, set agqapplication:app_no = g_app_no, generic

while agqapplication:app_no = g_app_no
    begin
    l_sub_code = agqapplication:sub_code

    next agqapplication
    end

if l_sub_code < 11 then
    l_checkbox_6 = 0

access agqsupp, set agqsupp:app_no = g_app_no, generic

if agqsupp:app_no = g_app_no then
    l_checkbox_7 = 1
else
    l_checkbox_7 = 0

end

procedure check_endorsement_edition_dates
begin
access agqpersonal, set agqpersonal:app_no = g_app_no, generic

access agqname, set agqname:app_no = agqpersonal:app_no, exact

Access agqend, Set agqend:app_no = g_app_no, generic

while agqend:app_no = g_app_no
    begin
    l_code = agqend:code
    access sfsoptend, set sfsoptend:company_id       = agqpersonal:company_id,
                          sfsoptend:state            = agqpersonal:state,
                          sfsoptend:line_of_business = agqpersonal:line_of_business,
                          sfsoptend:code             = l_code, generic

    l_form_edition = ""
    l_description  = ""
    while sfsoptend:company_id       = agqpersonal:company_id and
          sfsoptend:state            = agqpersonal:state and
          sfsoptend:line_of_business = agqpersonal:line_of_business and
          sfsoptend:code             = l_code
            begin
            if (agqname:eff_date >= sfsoptend:eff_date and
               (agqname:eff_date <= sfsoptend:exp_date or
               sfsoptend:exp_date = 0)) then
                begin
                l_form_edition = sfsoptend:form_edition
                l_description  = sfsoptend:description
                end

            next sfsoptend
            end

    if l_form_edition <> "" then
        begin
        change agqend
            Begin
            agqend:form_edition         =       l_form_edition/raw
            agqend:description          =       l_description/raw
            end
        End
    else
        begin
        delete agqend
        end

    Next agqend
    End

end

procedure print_quote_letter
begin
L_CSEXEC_APPLICATION = "PRINT"/raw

Access SFSCSEXEC, Set SFSCSEXEC:APPLICATION = L_CSEXEC_APPLICATION , Exact

If SFSCSEXEC:APPLICATION_NUMBER = 0 Then
    Begin
    L_CSEXEC_NUMBER = 99999
    End
Else
    Begin
    L_CSEXEC_NUMBER = SFSCSEXEC:APPLICATION_NUMBER + 1

    Change SFSCSEXEC
        Begin
        SFSCSEXEC:APPLICATION_NUMBER = L_CSEXEC_NUMBER
        End
    End

l_app           = "agq"
I_CSEXEC_NUMBER = L_CSEXEC_NUMBER
L_DEC           = L_APP+Str(I_CSEXEC_NUMBER)+".cq"
L_DEC_PDF       = L_APP+Str(I_CSEXEC_NUMBER)+".pdf"

if sfscompany:debug_mode = 0 then
    begin
    proc("cli csbatch agqmso9006 %s",str(g_app_no,11))/noconsole
    Proc("cli joinit agqmso9006.cq %s<nl>",l_dec)/noconsole

if agqpersonal:app_no = g_app_no then
  begin
    if agqpersonal:company_id = "FARMERS" and
       agqpersonal:eff_date >=  01.01.2012 then
      begin
        proc("cli csbatch agqfosis0311 %s",str(g_app_no,11))/noconsole
        Proc("cli joinit agqfosis0311.cq %s<nl>",l_dec)/noconsole
      end
                                                                       end
    access agqcreditscore, set agqcreditscore:app_no = g_app_no, generic

    access plsdefault, set plsdefault:company_id = agqpersonal:company_id,
                           plsdefault:line_of_business = agqpersonal:line_of_business, generic

    if agqcreditscore:app_no = g_app_no then
        begin
        if agqcreditscore:credit_score <= 845 and
           agqcreditscore:credit_score not one of 0, 111, 125, 999 and
           agqpersonal:tier <> 9 and
           agqpersonal:eff_date >= plsdefault:rating_algorithm_date and
           plsdefault:rating_algorithm_date <> 0 then
            begin
            proc("cli csbatch agqis0311 %s",str(g_app_no,11))/noconsole
            Proc("cli joinit agqis0311.cq %s<nl>",l_dec)/noconsole
            end
        end

    access agqpersonal2, set agqpersonal2:app_no = g_app_no, generic

    if agqpersonal2:app_no = g_app_no then
        begin
        if agqpersonal2:loss_exp_factor > 1.00 and
           agqpersonal2:loss_exp_factor <> 0 and
           agqpersonal:form not one of 4, 6 then
            begin
            proc("cli csbatch agqce0311 %s",str(g_app_no,11))/noconsole
            Proc("cli joinit agqce0311.cq %s<nl>",l_dec)/noconsole
            end
        end

    proc("cli csbatch agqmso9006a %s",str(g_app_no,11))/noconsole
    Proc("cli joinit agqmso9006a.cq %s<nl>",l_dec)/noconsole
    end
else
    begin
    proc("cli csbatch agqmso9006 %s",str(g_app_no,11))
    Proc("cli joinit agqmso9006.cq %s<nl>",l_dec)

    access plsdefault, set plsdefault:company_id = agqpersonal:company_id,
                           plsdefault:line_of_business = agqpersonal:line_of_business, generic

    if agqcreditscore:app_no = g_app_no then
        begin
        if agqcreditscore:credit_score <= 620 and
           agqcreditscore:credit_score not one of 0, 111, 999 and
           agqpersonal:eff_date >= plsdefault:rating_algorithm_date and
           plsdefault:rating_algorithm_date <> 0 then
            begin
            proc("cli csbatch agqis0311 %s",str(g_app_no,11))/noconsole
            Proc("cli joinit agqis0311.cq %s<nl>",l_dec)/noconsole
            end
        end

    access agqpersonal2, set agqpersonal2:app_no = g_app_no, generic

    if agqpersonal2:app_no = g_app_no then
        begin
        if agqpersonal2:loss_exp_factor > 1.00 and
           agqpersonal2:loss_exp_factor <> 0 then
            begin
            proc("cli csbatch agqce0311 %s",str(g_app_no,11))
            Proc("cli joinit agqce0311.cq %s<nl>",l_dec)
            end
        end

    proc("cli csbatch agqmso9006a %s",str(g_app_no,11))
    Proc("cli joinit agqmso9006a.cq %s<nl>",l_dec)
    end

access sfsline, set sfsline:company_id       = agqpersonal:company_id,
                    sfsline:line_of_business = agqpersonal:line_of_business,
                    sfsline:lob_subline      = "00", generic

L_LOB_CODE = SFSLINE:LOB_CODE
Access SCIPSCONTROL, Set SCIPSCONTROL:COMPANY_ID = agqpersonal:COMPANY_ID,
                         SCIPSCONTROL:STATE      = agqpersonal:STATE,
                         SCIPSCONTROL:LOB_CODE   = L_LOB_CODE,Exact

if scipscontrol:dont_print_tpd4_new_business = 0 and
   agqmaster:terrorism_premium <> 0 and
   sfsline:lob_code not one of "DWELLING" and
   agqpersonal:company_id = "FARMERS" then
    begin
    proc(":cli csbatch tpd7q %s",str(g_app_no,11))/noconsole
    Proc(":cli joinit tpd7q.cq %s<nl>",l_dec)/noconsole
    end
else
if scipscontrol:dont_print_tpd4_new_business = 0 and
   sfsline:lob_code one of "DWELLING" and
   agqmaster:terrorism_premium <> 0 and
   agqpersonal:company_id = "FARMERS" then
    begin
    proc(":cli csbatch tpd7q %s",str(g_app_no,11))/noconsole
    Proc(":cli joinit tpd7q.cq %s<nl>",l_dec)/noconsole
    end
else
if agqmaster:tpd6_terrorism_premium <> 0 and
   scipscontrol:dont_print_tpd4_new_business = 0 and
   agqpersonal:company_id = "FARMERS" then
    begin
    proc(":cli csbatch tpd7q %s",str(g_app_no,8))/noconsole
    Proc(":cli joinit tpd7q.cq %s<nl>",l_dec)/noconsole
    end

L_USERNAME = Trun(USERNAME)

Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact

If SFSPROFILE:USER_ID <> L_USERNAME Then
    Begin
    L_USERNAME = "default"
    Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact
    End

if l_printing = "Y" then
    begin
    L_UNIX_PATH   = SFSPROFILE:UNIX_PATH/raw
    L_UNIX_SERVER = SFSPROFILE:UNIX_SERVER/raw
    L_CLIENT_PATH = SFSPROFILE:CLIENT_PATH/raw

    If SFSCOMPANY:DEBUG_MODE = 0 Then
        Begin
        Proc("pcl2pdf -letter -csize -ra %s %s ",L_DEC, L_DEC_PDF)/noconsole
        Proc("chmod 777 %s ",L_DEC_PDF)/noconsole
        Proc("mv %s %s %s", L_DEC_PDF," ",Trun(L_UNIX_PATH))/noconsole
        End
    Else
        Begin
        Proc("pcl2pdf -letter -csize -ra %s %s ",L_DEC, L_DEC_PDF)
        Proc("chmod 777 %s ",L_DEC_PDF)
        Proc("mv %s %s %s", L_DEC_PDF," ",Trun(L_UNIX_PATH))
        End

    Proc("%s %s%s",L_CLIENT_PATH,Trun(L_UNIX_SERVER),Trun(L_DEC_PDF))/client
    end
else
    begin
    l_dec_pdf = "referral.pdf"
    If SFSCOMPANY:DEBUG_MODE = 0 Then
        Begin
        Proc("pcl2pdf -letter -csize -ra %s %s ",L_DEC, L_DEC_PDF)/noconsole
        Proc("chmod 777 %s ",L_DEC_PDF)/noconsole
        end
    else
        Begin
        Proc("pcl2pdf -letter -csize -ra %s %s ",L_DEC, L_DEC_PDF)
        Proc("chmod 777 %s ",L_DEC_PDF)
        end
    end

end

procedure create_macro
begin
L_CSEXEC_APPLICATION = "PRINT"/raw

Access SFSCSEXEC, Set SFSCSEXEC:APPLICATION = L_CSEXEC_APPLICATION , Exact

If SFSCSEXEC:APPLICATION_NUMBER = 0 Then
    Begin
    L_CSEXEC_NUMBER = 99999
    End
Else
    Begin
    L_CSEXEC_NUMBER = SFSCSEXEC:APPLICATION_NUMBER + 1

    Change SFSCSEXEC
        Begin
        SFSCSEXEC:APPLICATION_NUMBER = L_CSEXEC_NUMBER
        End
    End

l_app           = "agq"
I_CSEXEC_NUMBER = L_CSEXEC_NUMBER
L_DEC           = L_APP+Str(I_CSEXEC_NUMBER)+".cq"
if l_printing = "Y" then
    L_DEC_PDF   = L_APP+Str(I_CSEXEC_NUMBER)+".pdf"
else
    l_dec_pdf_wksht = l_app+str(i_csexec_number)+".pdf"

proc("cli csbatch agqpr9006 %s",str(g_app_no,11))/noconsole
Proc("cli joinit agqpr9006.cq %s<nl>",l_dec)/noconsole

L_USERNAME = Trun(USERNAME)

Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact

If SFSPROFILE:USER_ID <> L_USERNAME Then
    Begin
    L_USERNAME = "default"
    Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact
    End

if l_printing = "Y" then
    begin
    L_UNIX_PATH   = SFSPROFILE:UNIX_PATH/raw
    L_UNIX_SERVER = SFSPROFILE:UNIX_SERVER/raw
    L_CLIENT_PATH = SFSPROFILE:CLIENT_PATH/raw

    If SFSCOMPANY:DEBUG_MODE = 0 Then
        Begin
        Proc("pcl2pdf -letter -csize -ra %s %s ",L_DEC, L_DEC_PDF)/noconsole
        Proc("chmod 777 %s ",L_DEC_PDF)/noconsole
        Proc("mv %s %s %s", L_DEC_PDF," ",Trun(L_UNIX_PATH))/noconsole
        End
    Else
        Begin
        Proc("pcl2pdf -letter -csize -ra %s %s ",L_DEC, L_DEC_PDF)
        Proc("chmod 777 %s ",L_DEC_PDF)
        Proc("mv %s %s %s", L_DEC_PDF," ",Trun(L_UNIX_PATH))
        End

    Proc("%s %s%s",L_CLIENT_PATH,Trun(L_UNIX_SERVER),Trun(L_DEC_PDF))/client
    end
else
    begin
    If SFSCOMPANY:DEBUG_MODE = 0 Then
        Begin
        Proc("chmod 777 %s ",L_DEC)/noconsole
        proc("joinit %s %s",l_dec,l_dec_pdf)/noconsole
        end
    else
        Begin
        Proc("chmod 777 %s ",L_DEC)
        proc("joinit %s %s",l_dec,l_dec_pdf)
        end
    end

end

end
