%%                      
Screen
        Name = "agtmt9003f";
        Type = "Detail" ;
        Highlight=Underscore ;
        Padcharacter=Space ;
        Screensize="dynamic";
        Windowtitle="%a     %s Rating Information    %m";
        Domain="agqpersonal" ;
        resizeable = yes ;
        iconline = 0 ;
        autoaccept = true ;

        Global Unsigned Ascii Number G_APP_NO[11] ;
        Global Unsigned Ascii Number G_LINE_OF_BUSINESS[4] ;
        Global Unsigned Ascii Number G_OPT[2] ;
        global unsigned ascii number g_add_prem_no[1] ;
        global unsigned ascii number g_add_build_no[1] ;
        global unsigned ascii number g_add_new_quote[1] ;
        global unsigned ascii number g_prem_no[4] ;
        global unsigned ascii number g_build_no[4];
        global unsigned ascii number g_from_search_screen[1] ;
        global unsigned ascii number g_form[1] ;
        global unsigned ascii number g_state[2] ;
        global unsigned ascii number g_protection[2] ;
        global unsigned ascii number g_sub_code[4] ;

        global string g_company_id[10] ,
                      g_zipcode_change[1] ,
                      g_initial_screen[50],
                      g_inquiry[1] ,
                      g_code[7] ,
                      g_literal[100],
                      g_ok_to_continue[1] ;

        global wdate g_eff_date ;

        local array[10] of tag l_the_tag[15] ;

        local array[10] of string l_literal[100] ,
                                  l_screen_name[10] ,
                                  l_answer[1],
                                  l_view_1[4],
                                  l_value[1] ,
                                  l_old_answer[1],
                                  l_screen_name_2[10] ;

        local array[10] of unsigned ascii number l_view[1],
                                                 l_highlight[1],
                                                 l_fuel_oil_warning[1],
                                                 l_print_special_edit[1],
                                                 l_card_dialog[2] ;

        rwdate l_sfqname_eff_date;
        wdate  l_rich_date;
        rwdate l_score_received_date ;

        number function check_required_fields_for_credit_score();
        number function check_required_fields_for_claims();
        number function check_required_fields_for_property_characteristics();

        Local Unsigned Ascii Number L_SUB_CODE[4] ,
                                    L_STATE[2],
                                    l_none_apply[1],
                                    l_prior_county[3],
                                    l_roof_type[2],
                                    l_claim_year[2],
                                    l_structures_limit[8],
                                    l_book_roll_premium[8],
                                    l_changed_fire_safe[1],
                                    l_changed_credit_score[1],
                                    l_loss_limit[8],
                                    l_losses[1],
                                    l_allow_agent_to_view[1],
                                    l_hurricane[5],
                                    l_default_loss_limit[8],
                                    l_major_loss_found[2],
                                    l_minor_loss_found[2],
                                    l_no_major_losses_found[2],
                                    l_no_minor_losses_found[2],
                                    l_year_built[4],
                                    l_sub_code_1[4],
                                    l_popup_complete[1],
                                    l_construction[1],
                                    l_square_feet[5],
                                    l_swimming_pool[1],
                                    l_oil_heat[1],
                                    l_wood_stove[1],
                                    l_no_bathrooms[3]/dec=1,
                                    l_leed_certified[1],
                                    l_remove_new_cust_dis[1],
                                    l_no_stories[1],
                                    l_restricted[1]=0,
                                    l_new_home_discount_factor[4]=0/dec=3,
                                    l_restricted_distance[5]=0/dec=2,
                                    l_lib7_pos[4],
                                    l_start_dir_pos[4],
                                    l_prior_companion_discount[1],
                                    l_dont_get_credit_score[1],
                                    l_refused_credit_score[1],
                                    l_transunion_credit_score[4],
                                    l_initial_credit_score[4],
                                    l_val_zipcode[5],
                                    l_zipcode_5[5],
                                    l_agent_no[4],
                                    l_default_contents_limit[8],
                                    l_county[3],
                                    l_wind_deductible[5],
                                    l_hurricane_deductible[5],
                                    l_tier_1[2],
                                    l_protection[2],
                                    l_no_units[2],
                                    l_app_no[11],
                                    l_rating_territory[3],
                                    l_loop[4],
                                    l_exclude_terrorism[1]=0,
                                    l_prem_no[4]=0,
                                    l_group[2],
                                    l_table_1[2],
                                    l_binding_limit[8]=0,
                                    l_filed_limit[8]=0,
                                    l_dwelling_limit[8]=0,
                                    l_contents_limit[8]=0,
                                    l_no_years[4]=0,
                                    l_premium_1[8]=0/dec=4,
                                    l_premium_2[8]=0/dec=4,
                                    l_premium_3[8]=0/dec=4,
                                    l_premium_4[8]=0/dec=4,
                                    l_premium_5[8]=0/dec=4,
                                    l_premium_6[8]=0/dec=4,
                                    l_new_home_year[4]=0,
                                    l_new_year_2[2]=0,
                                    l_build_no[4]=0,
                                    l_off_premises_limit[8]=0,
                                    l_mcp140_limit[8],
                                    l_trampoline[1],
                                    l_swimming_pool_fenced[1],
                                    l_fire_resistive[1],
                                    l_original_owner[1],
                                    l_fire_safe_score[3],
                                    l_prior_fire_safe_score[3],
                                    l_prior_credit_score[4],
                                    l_rented_condo[1],
                                    l_tenure[1],
                                    l_loyalty[1],
                                    l_credit_score_tier[2],
                                    l_no_minor_losses[2],
                                    l_no_major_losses[2],
                                    l_mm[2],
                                    l_yyyy[4],
                                    l_dd[2],
                                    l_territory[3],
                                    l_increase_cov_c[8]=0/dec=4,
                                    l_prior_limit[8],
                                    l_townhouse[1],
                                    l_limit[8],
                                    l_minimum_limit[8],
                                    l_maximum_limit[8],
                                    l_zipcode[9],
                                    l_zipcode1_1[1],
                                    l_zipcode1_2[1],
                                    l_zipcode1_3[1],
                                    l_zipcode1_4[1],
                                    l_zipcode1_5[1],
                                    l_table[1],
                                    l_nonowned_factor[5]=0/dec=3,
                                    l_no_families[1],
                                    l_building_minimum_limit[8],
                                    l_contents_minimum_limit[8],
                                    l_combined_minimum_limit[8],
                                    l_building_maximum_limit[8],
                                    l_contents_maximum_limit[8],
                                    l_combined_maximum_limit[8],
                                    l_building_binding_limit[8],
                                    l_contents_binding_limit[8],
                                    l_combined_binding_limit[8],
                                    l_plspreprinted_alarm_factor[4]=0/dec=3,
                                    l_fpl01_form[1],
                                    l_min_error[1],
                                    l_max_error[1],
                                    l_binding_error[1],
                                    l_combined_limit[8]=0,
                                    l_rating_territory_group_1[1],
                                    l_rating_territory_group_2[1],
                                    l_rating_territory_group_3[1],
                                    l_group_1[5]=0/dec=3,
                                    l_group_2[5]=0/dec=3,
                                    L_CLASS_CODE[5],
                                    l_restaurant[1],
                                    l_year[4],
                                    l_end_sequence[4],
                                    L_PROPERTY_LIMIT[8]=0,
                                    l_property_limit_1[8]=0,
                                    L_LINE_OF_BUSINESS[2] ,
                                    l_credit_score[5],
                                    l_hardship[1],
                                    l_years_with_co[2],
                                    l_credit_score_1[4],
                                    L_AR_LIMIT[8],
                                    L_COMPUTER_LIMIT[8],
                                    l_csexec_number[12],
                                    i_csexec_number[12],
                                    l_abort_program[1],
                                    L_UTILITY_LIMIT[8],
                                    L_MECHANICAL_LIMIT[8],
                                    L_EXTERIOR_SIGNS_LIMIT[8],
                                    L_EMPLOYEE_LIMIT[8],
                                    L_GLASS_LIMIT[8],
                                    L_SEWER_LIMIT[8],
                                    L_VALUABLE_LIMIT[8],
                                    L_FORM[1] ,
                                    l_tier[2]=0,
                                    l_prior_address_less_then_x_years,
                                    l_same_as_agqname_address[1],
                                    l_ssn[9],
                                    l_Form_1[1] ;

        Local String L_DESC[50] ,
                     L_REINSURANCE[1] ,
                     l_found[1],
                     l_ok_to_add_sal01[1]="Y",
                     l_credit_score_2[4],
                     l_construction_type[50],
                     l_heat_type[50],
                     l_roof_type_desc[50],
                     l_county_name[75],
                     l_occupation[50],
                     l_first_name_1[15],
                     l_middle_initial_1[1],
                     l_last_name_1[25],
                     l_first_name_2[15],
                     l_losses_str[1],
                     l_prior_losses[1],
                     l_middle_initial_2[1],
                     l_last_name_2[25],
                     l_loyalty_str[1],
                     i_middle_initial[1],
                     l_name_1[50],
                     l_name_2[50],
                     l_credit_score_file[12]= "credit_score",
                     l_claim_file[5]="claim",
                     l_property_file[8]="property",
                     l_credit_score_error_message[18] = "error_credit_score" ,
                     l_limit_wording[15],
                     l_continue[1],
                     l_claim_error_message[11]="error_claim",
                     l_property_error_message[14]="error_property",
                     l_claim[5],
                     l_claim_type[14],
                     l_property[5],
                     l_credit_error_message[300],
                     l_claims_error_message[300],
                     l_companion_auto_credit[1] ,
                     l_property_char_error_message[300],
                     l_which_protocol[40],
                     l_which_protocol_1[40],
                     l_current_path[2048],
                     l_current_environment[100],
                     l_designation[7],
                     l_apt_number[5],
                     l_street_direction[2],
                     l_house_number[10],
                     l_street_name[27],
                     l_street_type[6],
                     l_prior_house_number[10],
                     l_prior_street_direction[2],
                     l_prior_street_name[27],
                     l_prior_street_type[6],
                     l_prior_apt_number[5],
                     l_prior_designation[7],
                     l_prior_city[27],
                     l_prior_state[2],
                     l_prior_zip_code[10],
                     l_filed_message[100],
                     l_hurricane_code[7],
                     l_sub_line[2],
                     l_record_key[2],
                     l_owner_occupied[1],
                     l_updated[1],
                     l_zip_code_5[5],
                     i_csexec_application[25] ,
                     l_mpl47[1],
                     l_agent_wording[9]="Agent No:",
                     l_current_web_page[55],
                     l_web_site_address[150],
                     l_server_name[100],
                     l_mpl49[1],
                     l_printers_credit_wording[23]="Printers Credit:",
                     l_total_printers_wording[23]="Total Printers:",
                     l_mho45[1],
                     l_mpl13[1],
                     l_first[1],
                     l_new_home_discount[1],
                     l_str_zipcode[9]="",
                     l_buyback_option_wording[23]="Buyback Option Charge:",
                     l_fungi_mold_wording[23]="Fungi/Mold Limitations:",
                     l_lob_code[10],
                     l_irpm_wording[12]="IRPM:",
                     l_enter[1],
                     l_minimum_message[200],
                     l_combined_minimum_message[200],
                     l_maximum_message[200],
                     l_combined_maximum_message[200],
                     l_binding_message[200],
                     l_combined_binding_message[200],
                     l_contact_message[200],
                     l_reason_code_1[3],
                     l_reason_code_2[3],
                     l_reason_code_3[3],
                     l_reason_code_4[3],
                     l_mp_wording[4]="M.P.",
                     l_continue_1[3]="",
                     l_continue_2[3]="",
                     l_continue_3[3]="",
                     l_dec[15]="",
                     l_app[3]="agq",
                     L_CODE[7],
                     L_CODE_1[7],
                     L_CODE_2[7],
                     L_CODE_3[7],
                     L_CODE_4[7],
                     L_CODE_5[7],
                     L_CODE_6[7],
                     L_CODE_7[7],
                     L_CODE_8[7],
                     l_code_9[7],
                     l_code_10[7],
                     l_code_11[7],
                     l_code_12[7],
                     l_code_13[7],
                     l_code_14[7],
                     l_code_15[7],
                     l_code_16[7],
                     l_code_17[7],
                     l_code_18[7],
                     l_code_19[7],
                     l_code_20[7],
                     l_code_21[7],
                     l_code_22[7],
                     l_code_23[7],
                     l_code_24[7],
                     l_code_25[7],
                     l_code_26[7],
                     l_code_27[7],
                     l_code_28[7],
                     l_code_29[7],
                     l_code_30[7],
                     l_code_31[7],
                     l_code_32[7],
                     l_username[15],
                     l_csexec_application[25],
                     l_processing_system[30],
                     l_rating_system[40],
                     l_continue_4[2],
                     l_territory_wording[10]="Territory:",
                     l_system_id[15],
                     L_SCREEN[15] ,
                     l_screen_1[9],
                     L_FORM_EDITION[18],
                     L_DESCRIPTION[55],
                     L_COMPUTER_DESC[50] ,
                     L_DELETE_NONOWNED_HIRED[1]="N",
                     L_ADD_ENDORSEMENT[1]="Y",
                     L_PROPERTY_LIMIT_CHANGE[1]="N",
                     l_sfqname_str[10],
                     L_COMPANY_ID[10] ;

        local wdate l_eff_date ,
                    l_sal_eff_date ;

        Access agqpersonal,
           Set agqpersonal:app_no = G_app_no, generic

        Include "stdkeys7.inc"

Style Definition
        Include "styles.inc"
        Displayonly Field Style {
                                  backgroundcolor="#CCCCCC"
                                }


Functions

        "redisplay" display/noreturn "agtmt9003f" ;

        "add" sequence "new"      tagged add_fn ;
        "new" add/hidden/autoupdate ;

--        change tagged update_fn ;
--        "chg" sequence "change 1-40" tagged change_fn;

        change tagged change_fn ;

        "func1" display/noreturn "agtmt9003f"   tagged calc_fn ;

        "back" display/noreturn "agtmt001" tagged back_fn ;
         reaccess ;

         "nextscreen"     display/noreturn "agtmt9005" tagged nextscreen_fn ;
         "previousscreen" display/noreturn "agtmt9002" tagged previousscreen_fn ;
         "quotesummary"   display/noreturn "agtmt9006" tagged quotesummary_fn ;

        include "stdfunc7b.inc"

EVENT DEFINITION
        default eventhandler {
                             "REMOVE_SCREEN" { function = "exit" abort () }
                             "reload" { function = "reaccess" abort () }
                             "display_message" { warning "" + event.value }
                             "current_line_of_business" {
                                                          g_line_of_business = val(event.value)
                                                        }
                             }
Menu Definition

Toolbar Definition

Screen Entry
if agqpersonal:form = 3 then
    begin
    hide(t_mho4)
    hide(t_mho6)
    end
else
if agqpersonal:form = 4 then
    begin
    hide(t_mho3)
    hide(t_mho6)
    end
else
if agqpersonal:form = 6 then
    begin
    hide(t_mho3)
    hide(t_mho4)
    end

access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

disable(accept_fn)
enable(back_fn)
g_initial_screen = ""
l_username = username
l_company_id = sfsdefault:company_id
access sfsemail, set sfsemail:company_id = l_company_id,
                     sfsemail:user_id    = l_username, generic

access sfsline, set sfsline:company_id = l_company_id,
                    sfsline:line_of_business = g_line_of_business,
                    sfsline:lob_subline      = "00", generic

Access agsdefault_plp, Set agsdefault_plp:COMPANY_ID       = agqpersonal:company_id,
                           agsdefault_plp:state            = agqpersonal:state,
                           agsdefault_plp:agent_no         = agqpersonal:agent_no,
                           agsdefault_plp:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS,
                           agsdefault_plp:form             = agqpersonal:form, generic

switch(g_line_of_business)
  case 1, 31  : switch(g_form)
                  case 1  : setproperty(t_mdw1,iconname,"title_cd_basic_mdw1.bmp")
                  case 2  : setproperty(t_mdw2,iconname,"title_cd_broad_mdw2.bmp")
                  case 3  : setproperty(t_mdw3,iconname,"title_cd_special_mdw3.bmp")
                  case 6  : setproperty(t_mdw6,iconname,"title_cd_condo_mdw6.bmp")
                  default : begin
                            setproperty(t_mdw1,iconname,"")
                            setproperty(t_mdw2,iconname,"")
                            setproperty(t_mdw3,iconname,"")
                            setproperty(t_mdw6,iconname,"")
                            end
                  end
  case 4, 34  : switch(g_form)
                  case 3  : setproperty(t_mho3,iconname,"title_mho3.bmp")
                  case 4  : setproperty(t_mho4,iconname,"title_mho4.bmp")
                  case 6  : setproperty(t_mho6,iconname,"title_mho6.bmp")
                  default : begin
                            setproperty(t_mho3,iconname,"")
                            setproperty(t_mho4,iconname,"")
                            setproperty(t_mho6,iconname,"")
                            end
                  end
  case 14, 44 : switch(g_form)
                  case 3  : setproperty(t_pref_mho3,iconname,"title_ho_preferred_mho3.bmp")
                  case 5  : setproperty(t_pref_mho5,iconname,"title_ho_preferred_mho5.bmp")
                  default : begin
                            setproperty(t_pref_mho3,iconname,"")
                            setproperty(t_pref_mho5,iconname,"")
                            end
                  end
  case 24, 54 : switch(g_form)
                  case 3  : setproperty(t_prem_mho3,iconname,"title_ho_premier_mho3.bmp")
                  default : setproperty(t_prem_mho3,iconname,"")
                  end
  end


switch(agqpersonal:form)
  case 4  : setproperty(limit_fn,text,"Personal Property: ")
  case 6  : setproperty(limit_fn,text,"Combined Property Limit: ")
  default : setproperty(limit_fn,text,"Dwelling Limit: ")
  end

access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

if sfsdefault:company_id one of "FLEMINGTON" then
    hide(farmers_fn)
else
if sfsdefault:company_id one of "FARMERS" then
    hide(ficof_fn)

access agqproperty, set agqproperty:app_no = g_app_no, generic

if g_inquiry <> "Y" then
    g_inquiry = "N"

if g_inquiry = "N" and
   function <> "redisplay" then
    do update_endorsements

if l_company_id <> "FARMERS" then
    hide(farmers_fn)

if sfsemail:agent_no <> 0 then
    hide(nj_policy)

Access plsdefault, Set plsdefault:COMPANY_ID       = l_company_id,
                       plsdefault:LINE_OF_BUSINESS = g_LINE_OF_BUSINESS, generic

if agqpersonal:eff_date >= plsdefault:rating_algorithm_date and
   plsdefault:rating_algorithm_date <> 0 then
    hide(protection_fn)
else
    show(protection_fn)

l_username = username
access sfsprofile,
   set sfsprofile:user_id  = l_username, exact

If SFSPROFILE:USER_ID <> L_USERNAME Then
  Begin
    L_USERNAME = "default"
    Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact
  End

l_server_name = sfsprofile:UNIX_SERVER

if l_company_id = "FLEMINGTON" then
    begin
    if agqpersonal:app_no = 0 then
        begin
        l_current_web_page = "01webhelp_agtmt1000_scr_rating_info_no_app_num.htm"
        do change_current_browser(l_server_name,l_current_web_page)
        end
    else
        begin
        l_current_web_page = "10webhelp_agtmt1000_scr_rating_info_yes_app_num.htm"
        do change_current_browser(l_server_name,l_current_web_page)
        end
    end


access agqname, set agqname:app_no = g_app_no, generic

if agqname:quote_no <> 0 then
    begin
    disable(change_fn)
    disable(delete_fn)
    disable(accept_fn)
    end

if sfsline:lob_code one of "HOME" then
    begin
    if agqpersonal:form one of 3, 5 then
        hide(not_form_3_fn)
    else
        hide(form_3_fn)
    end
else
    begin
    hide(not_form_3_fn)
    hide(form_3_fn)
    end

access agsdefault_plp, set agsdefault_plp:company_id       = agqpersonal:company_id,
                           agsdefault_plp:state            = agqpersonal:state,
                           agsdefault_plp:agent_no         = agqpersonal:agent_no,
                           agsdefault_plp:line_of_business = agqpersonal:line_of_business,
                           agsdefault_plp:form             = agqpersonal:form, generic

if sfsline:lob_code one of "HOME" then
    begin
--    hide(df_liability_form)
--    if agqpersonal:state <> 29 then
--        begin
--        hide(nj_exclusion)
--        end
--    if agqpersonal:state = 29 then
--        begin
--        hide(md_discount)
--        hide(md_exclusion)
--        end
    end
--else
--    begin
--    if agqpersonal:state <> 19 then
--        hide(md_discount)
--    hide(md_exclusion)
--    hide(nj_exclusion)
--    end

access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

l_tier = agqpersonal:tier   --used this because there is a complier error if you replace l_tier with agqpersonal:tier in the if statement below.

--if sfsdefault:company_id = "FARMERS" and
--   l_tier = 1 then
--    hide(companion_discount)

--if sfsdefault:company_id <> "FARMERS" then
--    hide(nj_exclusion)

access agqname, set agqname:app_no = g_app_no, generic

if agqpersonal:loss_rents_limit = 0 then
    function = "CHANGE"

if agqname:quote_no <> 0 then
    begin
    disable(change_fn)
    disable(add_fn)
    disable(delete_fn)
    end

if g_form = 4 then
    hide(owner_fn)

access validation
if agqpersonal:app_no <> g_app_no then
    error 1000 ;

screen at 1,1 to 30,100
    Properties
          {
          Layouttype = screen
          transparent = False
          backgroundcolor = "#ADD8E6"
          scrollbarpolicy = always
          fontstyle = BOLD
          }
    {

    Panel at 1,1 to 2,100
        Properties
            {
            layouttype = screen
            }
        {
        components
            guidetext at 1,1 to 2,40
                properties
                    {
                    iconname = "qp_logo.gif"
                    }
            guidetext at 1,83 to 2,100 tagged ficof_fn
                properties
                    {
                    iconname = "ficof_logo.gif"
                    }
            guidetext at 1,80 to 2,100 tagged farmers_fn
                properties
                    {
                    iconname = "salem_logo.gif"
                    }
            guidetext at 1.30,40 tagged t_mdw1
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,40 tagged t_mdw2
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,40 tagged t_mdw3
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,40 tagged t_mdw6
                Properties
                   {
                   iconname = ""
                   }

            guidetext at 1.30,28 tagged t_mho3
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,20 tagged t_mho4
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,28 tagged t_mho6
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_pref_mho3
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_pref_mho5
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_prem_mho3
                Properties
                   {
                   iconname = ""
                   }
        }

panel at 3,1 to 4,100
    Properties
        {
        LayoutType = screen
        backgroundcolor = "Grey"
        transparent = False
        }
    {
    components
        guidetext at 1.45,1 to 1.45,40     tagged display_information_box
            properties
                {
                text = "Rating Information"
                fontsize = 18
                fontstyle = BOLD
                fontname = "arial"
                transparent = False
                backgroundcolor = "Grey"
                }

    }

Panel at 3.45,75 to 4.45, 100
    Properties
        {
        LayoutType = screen
        }
{
%%
App No: ___________

%%

fields
101     begin
        end
        agqpersonal:app_no/displayonly ;

}

Panel at 5,1 to 6,100 Tagged icon_line2_tg
Properties
        {
        LayoutType = screen
        }
{
Components

        Button at 1.5,10    tagged change_fn
        Properties {
                Iconname = "btn_edit_entries.bmp"
                }
        Events  {
                Action = change_fn
                }

        Button at 1.5,35   tagged back_fn
        Properties {
                Iconname = "btn_back_to_main_screen.bmp"
                }
        Events  {
                Action {
                          l_continue_2 = dialog("EXITING","warning.bmp","You are about to leave the application, Do you wish to continue","Yes","No")
                          if l_continue_2 = "Yes" then
                              begin
                              function = "back"
                              abort()
                              end
                       }
                }
        Button at 1.5,60 tagged accept_fn
          properties
            {
              Iconname = "btn_accept_edits.bmp"
            }
          Events  {
                    mouseclicked = accept
                  }
    }

Panel at 5,94 to 6,96 tagged button_panel
    Properties
        {
        layouttype = column
        }
    {
    Components
        Button to 1,1
            properties
                {
                Iconname = "btn_print_screen.bmp"
                }
            events
                {
                action
                    {
                    function = "print"
                    abort()
                    }
                }
    }

Panel at 6.45,91
    Properties
        {
        layouttype = column
        }
    {
    Components
        guidetext to 1,1
            properties
                {
                text = "agtmt9003f.sd"
                fontsize = 9
                }
    }

/*panel at 7,1 to 7,100 tagged line_panel_1
    {
    Components
        line at 1,1 to 1,100
            Properties
                {
                Linestyle = embossed
                Linewidth = 5
                foregroundcolor = "black"
                }
    }*/

carddialog GUI at 7,3 to 26,90
Properties
        {
        layoutconstraints = stretch
        }
{
Panel
    properties
        {
        text = "Rating Information"
        transparent = false
        backgroundcolor = "#ADD8E6"
        }
{
Panel at 2,1 to 2,90 tagged farmers_fn
    Properties
        {
        LayoutType = screen
        }
    {
    Components
        guidetext at 1,1 to 1,18 tagged limit_fn
            properties
                {
                text = ""
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
        }

Panel at 2,20 to 2, 90  tagged farmers_fn
{
%%
___________

%%

components

fields
101     begin
        if function one of "CHG","CHANGE" then
            {
            disable(nextscreen_fn)
            disable(previousscreen_fn)
            disable(quotesummary_fn)
            enable(accept_fn)
            disable(back_fn)
            agqpersonal:trans_date = todaysdate
            }
        else
            {
            if g_ok_to_continue = "N" then
                begin
                disable(nextscreen_fn)
                disable(quotesummary_fn)
                end
            else
                begin
                enable(nextscreen_fn)
                enable(previousscreen_fn)
                enable(quotesummary_fn)
                disable(accept_fn)
                enable(back_fn)
                end
            }

        if agqname:quote_no <> 0 then
            begin
            disable(change_fn)
            end

        if function one of "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "02webhelp_agtmt1000_tbx_insured_name.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        if g_inquiry = "N" then
            begin
            Do ACCESS_SFSOPTEND_1

            l_prior_limit = agqpersonal:limit
            if function one of "CHANGE", "CHG" then
                begin
                access plspreprinted, set plspreprinted:company_id       = agqpersonal:company_id,
                                          plspreprinted:state            = agqpersonal:state,
                                          plspreprinted:line_of_business = agqpersonal:line_of_business, generic

                while plspreprinted:record_key       = "PF" and
                      plspreprinted:company_id       = agqpersonal:company_id and
                      plspreprinted:state            = agqpersonal:state and
                      plspreprinted:line_of_business = agqpersonal:line_of_business
                        begin
                        if agqpersonal:eff_date >= plspreprinted:reff_date then
                            l_plspreprinted_alarm_factor = plspreprinted:alarm_factor

                        next plspreprinted
                        end

                access sfscompany, set sfscompany:company_id = agqpersonal:company_id, generic

                access sfsline, set sfsline:company_id = agqpersonal:company_id,
                                    sfsline:line_of_business = agqpersonal:line_of_business,
                                    sfsline:lob_subline = "00", generic

                If SFSLINE:OPTION one of "P", "R" and
                   L_PLSPREPRINTED_ALARM_FACTOR <> 1.00 Then
                    Begin
                    agqPERSONAL:ALARM_OPTION[5] = 1
                    agqPERSONAL:ALARM_FACTOR[5] = 1.00
                    agqPERSONAL:ALARM_INCLUDED  = 1
                    agqpersonal:alarm_code      = 5
                    end
                else
                if sfsline:option one of "P", "R" and
                   sfscompany:boiler_rating = 1 and
                   agqpersonal:state = 19 then
                    begin
                    agqPERSONAL:ALARM_OPTION[5] = 1
                    agqPERSONAL:ALARM_FACTOR[5] = l_premium_5
                    agqPERSONAL:ALARM_INCLUDED  = 0
                    agqpersonal:alarm_code      = 5
                    end
                else
                if sfscompany:special_territory_rating = 1 and
                   agqpersonal:alarm_option[5] = 0 and
                   agqpersonal:alarm_factor[5] = 0 and
                   function one of "CHANGE", "CHG" then
                    begin
                    agqPERSONAL:ALARM_OPTION[5]  = 1
                    agqPERSONAL:ALARM_FACTOR[5]  = l_premium_5
                    agqpersonal:alarm_included   = 0
                    agqpersonal:alarm_code       = 5
                    l_plspreprinted_alarm_factor = 0
                    end
                else
                if sfscompany:boiler_rating = 1 and
                   agqpersonal:alarm_option[5] = 0 and
                   agqpersonal:alarm_factor[5] = 0 and
                   function one of "CHANGE", "CHG" then
                    begin
                    agqPERSONAL:ALARM_OPTION[5] = 1
                    agqPERSONAL:ALARM_FACTOR[5] = l_premium_5
                    agqpersonal:alarm_included  = 0
                    agqpersonal:alarm_code      = 5
                    end
                else
                if sfscompany:special_territory_rating <> 1 then
                    begin
                    agqpersonal:alarm_included  = 0
                    end
                end
            end
        if g_form one of 3, 5 then
            begin
            L_DWELLING_LIMIT = agqPERSONAL:LIMIT
            do minimum_maximum_limits
            If agqpersonal:limit = 0 and
               function one of "CHANGE", "CHG" Then
                begin
                if l_minimum_limit <> 0 then
                    agqPERSONAL:LIMIT = l_minimum_limit
                else
                    agqpersonal:limit = agsdefault_plp:coverage_a
                end
            end
        else
            begin
            L_CONTENTS_LIMIT = agqPERSONAL:LIMIT
            do minimum_maximum_limits
            If FUNCTION one of "CHANGE", "CHG" and
               agqpersonal:limit = 0 Then
                begin
                if l_minimum_limit <> 0 then
                    agqPERSONAL:LIMIT = l_minimum_limit
                else
                    agqpersonal:limit = agsdefault_plp:coverage_c
                end
            end
        if function one of "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "09webhelp_agtmt1000_tbx_dwelling_limit.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        end
        agqpersonal:LIMIT/tabstop/default
        l_username = username
        l_company_id = sfsdefault:company_id
        access sfsemail, set sfsemail:company_id = l_company_id,
                             sfsemail:user_id    = l_username, generic
        if g_form one of 4, 6 then
            begin
            agqpersonal:dwelling_limit = 0
            agqpersonal:contents_limit = agqpersonal:limit
            If agqPERSONAL:CONTENTS_LIMIT < l_minimum_limit and
               l_minimum_limit <> 0 and
               sfsemail:agent_no <> 0 Then
                Begin
                if l_min_error = 0 then
                    begin
                    l_continue_3 = dialog("MINIMUM LIMITS","warning.bmp",trun(l_minimum_message),"OK")
                    error "Please change the limit entered"
--                    if l_continue_2 = "No" then
--                        begin
--                        l_continue_3 = dialog("CONTACT UNDERWRITER","warning.bmp",trun(l_contact_message),"OK")
--                        end
--                    if l_continue_2 = "Yes" then
--                        begin
--                        error "Please change the limit entered"
--                        end
                    end
                else
                    error l_minimum_message
                end
            else
            if agqpersonal:contents_limit < agsdefault_plp:coverage_c and
               l_minimum_limit = 0 and
               sfsemail:agent_no <> 0 then
                begin
                warning 1236
                end

            if agqpersonal:contents_limit > l_binding_limit and
--               agqpersonal:contents_limit <= l_maximum_limit and
               l_binding_limit <> 0 and
               sfsemail:agent_no <> 0 then
                begin
                if l_binding_error = 0 then
                    begin
                    l_continue_2 = dialog("BINDING LIMITS","warning.bmp",trun(l_binding_message),"Yes","No")
                    if l_continue_2 = "No" then
                        begin
                        l_continue_3 = dialog("CONTACT UNDERWRITER","warning.bmp",trun(l_contact_message),"OK")
                        end
                    if l_continue_2 = "Yes" then
                        begin
                        error "Please change the limit entered"
                        end
                    end
                else
                    error l_binding_message
                end

            if agqpersonal:contents_limit > l_maximum_limit and
               l_maximum_limit <> 0 and
               sfsemail:agent_no <> 0 then
                begin
                if l_max_error = 0 then
                    begin
                    l_continue_2 = dialog("MAXIMUM LIMITS","warning.bmp",trun(l_maximum_message),"Yes","No")
                    if l_continue_2 = "No" then
                        begin
                        l_continue_3 = dialog("CONTACT UNDERWRITER","warning.bmp",trun(l_contact_message),"OK")
                        end
                    if l_continue_2 = "Yes" then
                        begin
                        error "Please change the limit entered"
                        end
                    end
                else
                    error l_maximum_message
                end
            end
        else
            begin
            agqpersonal:dwelling_limit = agqpersonal:limit
            If agqPERSONAL:DWELLING_LIMIT < l_minimum_limit and
               agqpersonal:dwelling_limit => l_filed_limit and
               l_minimum_limit <> 0 and
               sfsemail:agent_no <> 0 Then
                Begin
                if l_min_error = 0 then
                    begin
                    l_continue_3 = dialog("MINIMUM LIMITS","warning.bmp",trun(l_minimum_message),"OK")
                    error "Please change the limit entered"
                    end
                else
                    error trun(l_minimum_message)
                end
            else
            if agqpersonal:dwelling_limit < agsdefault_plp:coverage_a and
               l_minimum_limit = 0 and
               sfsemail:agent_no <> 0 then
                begin
                warning 1236
                end

            If agqPERSONAL:DWELLING_LIMIT < l_filed_limit and
               l_filed_limit <> 0 and
               sfsemail:agent_no <> 0 Then
                Begin
                error l_filed_message
                end

            if sfsemail:agent_no <> 0 and
               agqpersonal:dwelling_limit > l_binding_limit and
               l_binding_limit <> 0  then
--               agqpersonal:dwelling_limit <= l_maximum_limit and
--               l_maximum_limit <> 0) then
                begin
                if l_binding_error = 0 then
                    begin
                    l_continue_2 = dialog("BINDING LIMITS","warning.bmp",trun(l_binding_message),"Yes","No")
                    if l_continue_2 = "No" then
                        begin
                        l_continue_3 = dialog("CONTACT UNDERWRITER","warning.bmp",trun(l_contact_message),"OK")
                        end
                    if l_continue_2 = "Yes" then
                        begin
                        error "Please change the limit entered"
                        end
                    end
                else
                    error l_binding_message
                end

            if agqpersonal:dwelling_limit > l_maximum_limit and
               l_maximum_limit <> 0 and
               sfsemail:agent_no <> 0 then
                begin
                if l_max_error = 0 then
                    begin
                    l_continue_2 = dialog("MAXIMUM LIMITS","warning.bmp",trun(l_maximum_message),"Yes","No")
                    if l_continue_2 = "No" then
                        begin
                        l_continue_3 = dialog("CONTACT UNDERWRITER","warning.bmp",trun(l_contact_message),"OK")
                        end
                    if l_continue_2 = "Yes" then
                        begin
                        error "Please change the limit entered"
                        end
                    end
                else
                    error l_maximum_message
                end
            end ;

101     begin
        if agqpersonal:limit <> l_prior_limit or
           agqpersonal:loss_rents_limit = 0 then
            begin
            do update_limits
            end

        if function one of "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "10webhelp_agtmt1000_scr_rating_info_yes_app_num.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        end
        agqpersonal:LIMIT/displayonly;


}

Panel at 3,1 to 8,90  tagged form_3_fn
        Properties {
                LayoutType = screen
        }
        {
         Components
           guidetext at 1,1 to 1,18
             properties
               {
                 text = "Other Structures:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 2,1 to 2,18
             properties
               {
                 text = "Personal Property:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 3,1 to 3,18
             properties
               {
                 text = "Loss of Use:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
         }

Panel at 3,1 to 5,90  tagged not_form_3_fn
        Properties {
                LayoutType = screen
        }
        {
         Components
           guidetext at 1,1 to 1,18
             properties
               {
                 text = "Loss of Use:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
         }

Panel at 3,20 to 8,90 Tagged form_3_fn
Properties
        {
        Scrollbarpolicy    = asneeded
        }
{
%%
___________
___________
___________

%%

components

Fields
101     Begin
        L_STRUCTURES_LIMIT = agqpersonal:structures_limit[1]
        End
        L_STRUCTURES_LIMIT/default/tabstop/mask="ZZ,ZZZ,ZZZ"
        agqpersonal:structures_limit[1] = l_structures_limit;

201     Begin
        L_CONTENTS_LIMIT = agqPERSONAL:CONTENTS_LIMIT
        If SFSLINE:LOB_CODE <> "DWELLING" And
           FUNCTION one of "ADD", "NEW" Or
           SFSLINE:LOB_CODE <> "DWELLING" And
           agqPERSONAL:DWELLING_LIMIT <> L_DWELLING_LIMIT Then
            Begin
            L_UPDATED = "N"
            L_CODE = "MPL47"
            Do ACCESS_agqEND
            If L_ADD_ENDORSEMENT = "N" Then
                Begin
                Do ACCESS_SFSOPTEND
                L_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                          (L_INCREASE_COV_C Divide 100))
                L_DEFAULT_CONTENTS_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                                           (L_INCREASE_COV_C Divide 100))
                L_UPDATED = "Y"
                End

            L_CODE = "MPL49"
            Do ACCESS_agqEND
            If L_ADD_ENDORSEMENT = "N" Then
                Begin
                Do ACCESS_SFSOPTEND
                L_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                          (L_INCREASE_COV_C Divide 100))

                L_DEFAULT_CONTENTS_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                                           (L_INCREASE_COV_C Divide 100))
                L_UPDATED = "Y"
                End

            If L_ADD_ENDORSEMENT = "Y" And
               L_UPDATED = "N" Then
                Begin
                L_DEFAULT_CONTENTS_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                                           (agsdefault_plp:COVERAGE_C_PERCENT
                                           Divide 100))
                End
            End

        If SFSLINE:LOB_CODE <> "DWELLING" And
           FUNCTION one of "CHANGE", "CHG" Then
            Begin
            L_UPDATED = "N"
            L_CODE = "MPL47"
            Do ACCESS_agqEND
            If L_ADD_ENDORSEMENT = "N" Then
                Begin
                Do ACCESS_SFSOPTEND
                L_DEFAULT_CONTENTS_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                                           (L_INCREASE_COV_C Divide 100))
                L_UPDATED = "Y"
                End

            L_CODE = "MPL49"
            Do ACCESS_agqEND
            If L_ADD_ENDORSEMENT = "N" Then
                Begin
                Do ACCESS_SFSOPTEND
                L_DEFAULT_CONTENTS_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                                           (L_INCREASE_COV_C Divide 100))
                L_UPDATED = "Y"
                End

            If L_ADD_ENDORSEMENT = "Y" And
               L_UPDATED = "N" Then
                Begin
                L_DEFAULT_CONTENTS_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                                           (agsdefault_plp:COVERAGE_C_PERCENT
                                           Divide 100))
                End
            End
        End
        L_CONTENTS_LIMIT/default/tabstop/mask="ZZ,ZZZ,ZZZ"
        If L_CONTENTS_LIMIT < L_DEFAULT_CONTENTS_LIMIT Then
            Error "Limit may not be decreased"

        If L_CONTENTS_LIMIT < agsdefault_plp:COVERAGE_C And
           L_CONTENTS_LIMIT <> 0 Then
               Begin
               If agsdefault_plp:ERROR = 1 or
                  sfsemail:agent_no <> 0 Then
                   Error 1236
               End
        agqpersonal:contents_limit = l_contents_limit ;
301     Begin
        l_loss_limit = agqpersonal:loss_rents_limit
        If agqPERSONAL:DWELLING_LIMIT <> 0 Then
            begin
            L_DEFAULT_LOSS_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                                   (agsdefault_plp:COVERAGE_D_PERCENT
                                   Divide 100))
            end
        Else
        If agqPERSONAL:DWELLING_LIMIT = 0 And
           agqPERSONAL:CONTENTS_LIMIT <> 0 Then
            begin
            L_DEFAULT_LOSS_LIMIT = (agqPERSONAL:CONTENTS_LIMIT *
                                   (agsdefault_plp:COVERAGE_D_PERCENT
                                   Divide 100))
            end
        End
        L_LOSS_LIMIT/default/tabstop/mask="ZZ,ZZZ,ZZZ"
        If L_LOSS_LIMIT < L_DEFAULT_LOSS_LIMIT Then
            begin
            agqpersonal:loss_rents_limit = l_default_loss_limit
            Error "Limit may not be decreased"
            abort()
            end
        else
            agqpersonal:loss_rents_limit = l_loss_limit ;
301     agqpersonal:loss_rents_limit/displayonly ;

}

Panel at 3,20 to 5,90 Tagged not_form_3_fn
Properties
        {
        Scrollbarpolicy    = asneeded
        }
{
%%
___________

%%

components

Fields
101     begin
        l_loss_limit = agqpersonal:loss_rents_limit
        If agqPERSONAL:DWELLING_LIMIT = 0 And
           agqPERSONAL:CONTENTS_LIMIT <> 0 Then
            begin
            L_DEFAULT_LOSS_LIMIT = (agqPERSONAL:CONTENTS_LIMIT *
                                   (agsdefault_plp:COVERAGE_D_PERCENT
                                   Divide 100))
            end
        End
        L_LOSS_LIMIT/default/tabstop/mask="ZZ,ZZZ,ZZZ"
        If l_LOSS_LIMIT < L_DEFAULT_LOSS_LIMIT Then
            begin
            agqpersonal:loss_rents_limit = l_default_loss_limit
            Error "Limit may not be decreased"
            abort()
            end
        else
            agqpersonal:loss_rents_limit = l_loss_limit ;
101     agqpersonal:loss_rents_limit/displayonly ;

}

Panel at 2,50 to 3,85
        Properties {
                LayoutType = screen
        }
        {
         Components
           guidetext at 1,1 to 1,21
             properties
               {
                 text = "Personal Liability:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 2,1 to 2,21
             properties
               {
                 text = "Medical Payments:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
        }

Panel at 2,72 to 3,85
Properties
        {
        Scrollbarpolicy    = asneeded
        }
{
%%
___________
___________

%%

components

Fields
101     Begin
            l_allow_agent_to_view = sfsliability1:allow_agent_to_view
        End
        agqPERSONAL:LIABILITY_LIMIT/default/tabstop
        Hide If agqPERSONAL:SEASONAL = "Y"
        If agqPERSONAL:LIABILITY_LIMIT <> SFSLIABILITY1:LIMIT or
           sfsliability1:allow_agent_to_view = 1 Then
            Error "Invalid Limited Entered"

        if agqpersonal:liability_limit = 0 and
           sfsline:lob_code one of "HOME" then
            error "Invalid Limit Entered"

        If agqPERSONAL:LIABILITY_LIMIT = 0 And
           agqPERSONAL:SEASONAL = "N" And
           agqPERSONAL:FORM <> 6 And
           SFSLINE:LOB_CODE <> "DWELLING" Then
            error 1238

        Activehelp if sfsliability1_alias:allow_agent_to_view = 0 then
                       SFSLIABILITY1_ALIAS:LIMIT
                   else
                       null ;
101     agqPERSONAL:LIABILITY_LIMIT/default/tabstop
        Hide If agqPERSONAL:SEASONAL = "N"
        If (agqPERSONAL:LIABILITY_LIMIT <> SFSLIABILITY1:LIMIT or
           (agqpersonal:liability_limit = 0 and
           sfsline:lob_code one of "HOME")) Then
            Error "Invalid Limit Entered"

        if sfsliability1:allow_agent_to_view = 1 then
            error "Invalid Limit Entered"

        Activehelp if sfsliability1_alias:allow_agent_to_view = 0 then
                       SFSLIABILITY1_ALIAS:LIMIT
                   else
                       null ;
101     Begin
        If agqPERSONAL:LIABILITY_LIMIT = 0 Then
            agqPERSONAL:MEDICAL_LIMIT = 0
        End
        agqPERSONAL:LIABILITY_LIMIT/displayonly
        Hide If SFSLINE:LOB_CODE = "DWELLING" ;
101     Begin
        If agqPERSONAL:LIABILITY_LIMIT <> 0 And
           SFSLINE:LOB_CODE = "DWELLING" and
           agqpersonal:company_id = "FLEMINGTON" Then
            agqPERSONAL:LIABILITY_FORM = 1
        End
        agqPERSONAL:LIABILITY_LIMIT/displayonly
        Hide If SFSLINE:LOB_CODE <> "DWELLING" ;

201     agqPERSONAL:MEDICAL_LIMIT/default/tabstop
        Hide If agqPERSONAL:LIABILITY_LIMIT = 0
        If agqPERSONAL:MEDICAL_LIMIT <> SFSMEDICAL:LIMIT Or
           agqPERSONAL:MEDICAL_LIMIT = 0 Then
            Error 1238

        Activehelp SFSMEDICAL_ALIAS:LIMIT  ;
201     Begin
        If agqPERSONAL:LIABILITY_LIMIT = 0 Then
            agqPERSONAL:MEDICAL_LIMIT = 0
        End
        agqPERSONAL:MEDICAL_LIMIT/displayonly ;

}

Panel at 5,1 to 5,90 tagged territory_fn
    Properties
        {
        LayoutType = screen
        }
    {
    Components
        guidetext at 1,1 to 1,18
            properties
                {
                text = "Rating Territory:"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
    }

Panel at 5,20 to 5,95 tagged territory_fn
{
%%
____  ____________________

%%

components

fields
101     Begin
        l_eff_date = agqpersonal:eff_date
        g_state    = agqpersonal:state
        access sfsterritory_alias, set sfsterritory_alias:company_id       = agqpersonal:company_id,
                                       sfsterritory_alias:state            = agqpersonal:state,
                                       sfsterritory_alias:line_of_business = agqpersonal:line_of_business, generic

        access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                 sfsterritory:state            = agqpersonal:state,
                                 sfsterritory:line_of_business = agqpersonal:line_of_business,
                                 sfsterritory:county           = agqpersonal:county, generic

        if function one of "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "05webhelp_agtmt1000_dbx_rating_terr.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        l_prior_county = agqpersonal:county
        End
        agqPERSONAL:COUNTY/default/tabstop
        hide if agqproperty:county_name <> "" and
                agqpersonal:county <> 0 and
                sfsemail:agent_no <> 0
        access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                 sfsterritory:state            = agqpersonal:state,
                                 sfsterritory:line_of_business = agqpersonal:line_of_business,
                                 sfsterritory:county           = agqpersonal:county, generic

        If agqPERSONAL:COUNTY <> SFSTERRITORY:COUNTY or
           agqpersonal:county = 0 Then
            Error 1222

        Activehelp if ((l_eff_date >= sfsterritory_alias:eff_date and
                      l_eff_date <= sfsterritory_alias:exp_date and
                      sfsterritory_alias:hide_description = 0) or
                      (l_eff_date >= sfsterritory_alias:eff_date and
                      sfsterritory_alias:exp_date = 0 and
                      sfsterritory_alias:hide_description = 0)) then
                       SFSTERRITORY_ALIAS:COUNTY
                   else
                       null/width=6,
                   if ((l_eff_date >= sfsterritory_alias:eff_date and
                      l_eff_date <= sfsterritory_alias:exp_date and
                      sfsterritory_alias:hide_description = 0) or
                      (l_eff_date >= sfsterritory_alias:eff_date and
                      sfsterritory_alias:exp_date = 0 and
                      sfsterritory_alias:hide_description = 0)) then
                       SFSTERRITORY_ALIAS:DESCRIPTION
                   else
                       null/width=60 ;
101     begin
        access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                 sfsterritory:state            = agqpersonal:state,
                                 sfsterritory:line_of_business = agqpersonal:line_of_business,
                                 sfsterritory:county           = agqpersonal:county, generic

        access sfsterritory_alias, set sfsterritory_alias:company_id       = agqpersonal:company_id,
                                       sfsterritory_alias:state            = agqpersonal:state,
                                       sfsterritory_alias:line_of_business = agqpersonal:line_of_business, generic

        end
        agqpersonal:county/displayonly ;
101     begin
        l_eff_date = agqpersonal:eff_date
        g_state    = agqpersonal:state
        access sfsterritory_alias, set sfsterritory_alias:company_id       = agqpersonal:company_id,
                                       sfsterritory_alias:state            = agqpersonal:state,
                                       sfsterritory_alias:line_of_business = agqpersonal:line_of_business, generic

        access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                 sfsterritory:state            = agqpersonal:state,
                                 sfsterritory:line_of_business = agqpersonal:line_of_business,
                                 sfsterritory:county           = agqpersonal:county, generic

        if sfsterritory:county_have_city = 1 and
           agqpersonal:county_have_city = 0 then
            begin
--            l_continue_1 = dialog("warning","question.bmp","The county you have selected also has cities listed in the activehelp please review the list to make sure you have the correct county/city selected","OK")
            activehelp()
            end
        end
        agqpersonal:county/default/tabstop
        hide if sfsterritory:county_have_city = 0 and
                sfsterritory:city_county = 0
        access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                 sfsterritory:state            = agqpersonal:state,
                                 sfsterritory:line_of_business = agqpersonal:line_of_business,
                                 sfsterritory:county           = agqpersonal:county, generic

        if sfsterritory:county_have_city = 1 and
           agqpersonal:county_have_city = 0 then
            agqpersonal:county_have_city = 1

        If agqPERSONAL:COUNTY <> SFSTERRITORY:COUNTY or
           agqpersonal:county = 0 Then
            Error 1222

        Activehelp if ((l_eff_date >= sfsterritory_alias:eff_date and
                      l_eff_date <= sfsterritory_alias:exp_date and
                      (sfsterritory_alias:city_county = agqpersonal:county or
                      sfsterritory_alias:county = agqpersonal:county)) or

                      (l_eff_date >= sfsterritory_alias:eff_date and
                      sfsterritory_alias:exp_date = 0 and
                      (sfsterritory_alias:city_county = agqpersonal:county or
                      sfsterritory_alias:county = agqpersonal:county))) then
                       SFSTERRITORY_ALIAS:COUNTY
                   else
                        null/width=6,

                   if ((l_eff_date >= sfsterritory_alias:eff_date and
                      l_eff_date <= sfsterritory_alias:exp_date and
                      (sfsterritory_alias:city_county = agqpersonal:county or
                      sfsterritory_alias:county = agqpersonal:county)) or

                      (l_eff_date >= sfsterritory_alias:eff_date and
                      sfsterritory_alias:exp_date = 0 and
                      (sfsterritory_alias:city_county = agqpersonal:county or
                      sfsterritory_alias:county = agqpersonal:county))) then
                       SFSTERRITORY_ALIAS:DESCRIPTION
                   else
                       null/width=60 ;

102     begin
        access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                 sfsterritory:state            = agqpersonal:state,
                                 sfsterritory:line_of_business = agqpersonal:line_of_business,
                                 sfsterritory:county           = agqpersonal:county, generic
        end
        SFSTERRITORY:DESCRIPTION[1,20];


}

Panel at 6,1 to 6,90 tagged construction_fn
    Properties
        {
        LayoutType = screen
        }
    {
    Components
        guidetext at 1,1 to 1,18
            properties
                {
                text = "Construction:"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
    }

Panel at 6,20 to 6,95 tagged construction_fn
{
%%
____  __________

%%

components

fields
101     Begin
        If FUNCTION one of "CHANGE", "CHG" Then
            Begin
            access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                     sfsterritory:state            = agqpersonal:state,
                                     sfsterritory:line_of_business = agqpersonal:line_of_business,
                                     sfsterritory:county           = agqpersonal:county, generic

            while sfsterritory:company_id       = agqpersonal:company_id and
                  sfsterritory:state            = agqpersonal:state and
                  sfsterritory:line_of_business = agqpersonal:line_of_business and
                  sfsterritory:county           = agqpersonal:county
                begin
                if (agqpersonal:eff_date >= sfsterritory:eff_date and
                   (agqpersonal:eff_date <= sfsterritory:exp_date or
                   sfsterritory:exp_date = 0)) then
                    begin
                    agqPERSONAL:TERRITORY = SFSTERRITORY:TERRITORY
                    Switch(agqPERSONAL:STATE)
                      Case 37 : Begin
                                Switch(agqPERSONAL:FORM)
                                  Case 2  : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[1]
                                  Case 4  : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[3]
                                  Case 6  : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[4]
                                  Default : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[2]
                                  End
                                End
                      Default : Begin
                                agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[1]
                                if sfsterritory:territory_group[2] <> 0 and
                                   agqpersonal:form one of 4, 6 then
                                    begin
                                    agqpersonal:group = sfsterritory:territory_group[2]
                                    agqpersonal:territory = sfsterritory:territory_ho4_ho6
                                    end
                                End
                      End
                    If SFSLINE:LOB_CODE <> "DWELLING" Then
                        begin
                        agqPERSONAL:TABLE   = SFSTERRITORY:TERRITORY_GROUP[1]
                        agqpersonal:table_1 = sfsterritory:territory_group[1]
                        if sfsterritory:territory_group[2] <> 0 and
                           agqpersonal:form one of 4, 6 then
                            begin
                            agqPERSONAL:TABLE   = SFSTERRITORY:TERRITORY_GROUP[2]
                            agqpersonal:table_1 = sfsterritory:territory_group[2]
                            end
                        end
                    end

                next sfsterritory
                end
            end

        If FUNCTION one of "CHANGE", "CHG" Then
            Begin
            access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                     sfsterritory:state            = agqpersonal:state,
                                     sfsterritory:line_of_business = agqpersonal:line_of_business,
                                     sfsterritory:county           = agqpersonal:county, generic

            while sfsterritory:company_id       = agqpersonal:company_id and
                  sfsterritory:state            = agqpersonal:state and
                  sfsterritory:line_of_business = agqpersonal:line_of_business and
                  sfsterritory:county           = agqpersonal:county
                begin
                if (agqpersonal:eff_date >= sfsterritory:eff_date and
                   (agqpersonal:eff_date <= sfsterritory:exp_date or
                   sfsterritory:exp_date = 0)) then
                    begin
                    agqPERSONAL:TERRITORY = SFSTERRITORY:TERRITORY
                    Switch(agqPERSONAL:STATE)
                      Case 37 : Begin
                                Switch(agqPERSONAL:FORM)
                                  Case 2  : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[1]
                                  Case 4  : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[3]
                                  Case 6  : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[4]
                                  Default : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[2]
                                  End
                                End
                      Default : Begin
                                agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[1]
                                if sfsterritory:territory_group[2] <> 0 and
                                    agqpersonal:form one of 4, 6 then
                                     begin
                                     agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[2]
                                     agqpersonal:territory = sfsterritory:territory_ho4_ho6
                                     end
                                End
                      End
                    If SFSLINE:LOB_CODE <> "DWELLING" Then
                        begin
                        agqPERSONAL:TABLE   = SFSTERRITORY:TERRITORY_GROUP[1]
                        agqPERSONAL:TABLE_1 = SFSTERRITORY:TERRITORY_GROUP[1]
                        if sfsterritory:territory_group[2] <> 0 and
                           agqpersonal:form one of 4, 6 then
                           begin
                           agqPERSONAL:TABLE   = SFSTERRITORY:TERRITORY_GROUP[2]
                           agqPERSONAL:TABLE_1 = SFSTERRITORY:TERRITORY_GROUP[2]
                           end
                        end
                    end

                next sfsterritory
                end
            end

        agqPERSONAL:INFLATION_GUARD = agsdefault_plp:INFLATION_GUARD

        if agqpersonal:group = 4 and
           agqpersonal:company_id = "FLEMINGTON" then
            begin
            agqpersonal:other_companion_auto_credit = 0
            agqpersonal:other_companion_policy_no  = ""
            agqpersonal:other_companion_eff_date   = 0
            agqpersonal:other_companion_co_name    = ""
            agqpersonal:other_companion_5_credit   = 0
            end

        if function one of "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "06webhelp_agtmt1000_dbx_construction.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        End
        agqpersonal:CONSTRUCTION/default/tabstop
        hide if agqproperty:construction_type <> "" and
                agqpersonal:construction <> 0 and
                sfsemail:agent_no <> 0

        If agqpersonal:CONSTRUCTION <> SFSCONSTRUCTION:CONSTRUCTION Or
           agqpersonal:CONSTRUCTION = 0 Then
            Error 1203

        Activehelp SFSCONSTRUCTION_ALIAS:CONSTRUCTION,
                   SFSCONSTRUCTION_ALIAS:DESCRIPTION ;
101     agqpersonal:construction/displayonly ;
102     SFSCONSTRUCTION:DESCRIPTION[1,10];

}

Panel at 7, 1 to 7,90 tagged year_construction_fn
    Properties
        {
        LayoutType = screen
        }
    {
    Components
        guidetext at 1,1 to 1,18
            properties
                {
                text = "Year of Construction:"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
        }

Panel at 7,20 to 7,95 tagged year_construction_fn
{
%%
____

%%

components

fields
101     agqpersonal:year_construction
        if agqpersonal:year_construction < agsdefault_plp:year_construction then
            error "Year of construction must be " + str(agsdefault_plp:year_construction) + " or greater, refer to underwriting"

        if agqpersonal:year_construction > year(agqpersonal:eff_date) + 1 then
            error "Invalid year of construction entered" ;

101     agqpersonal:year_construction/displayonly ;

}

Panel at 8, 1 to 9,90
    Properties
        {
        LayoutType = screen
        }
    {
    Components
        guidetext at 1,1 to 1,18
            properties
                {
                text = "Seasonal (Y/N):"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
    }

Panel at 8, 20 to 9,90
{
%%
_
_

%%

components

fields
101     agqpersonal:seasonal/uppercase/tabstop
        if agqpersonal:seasonal not one of "Y", "N" then
            error "Must enter a Y or N" ;

}

Panel at 11, 1 to 11,90 tagged protection_fn
    Properties
        {
        LayoutType = screen
        }
    {
    Components
        guidetext at 1,1 to 1,18
            properties
                {
                text = "Protection:"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
    }

Panel at 11, 20 to 11,90 tagged protection_fn
{
%%
__  ____________________

%%

components

fields
101     begin
        l_eff_date   = agqpersonal:eff_date
        l_protection = agqpersonal:protection

        if function one of "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "07webhelp_agtmt1000_dbx_protection.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        End
        agqpersonal:PROTECTION/default/tabstop
        If agqpersonal:PROTECTION <> SFSPROTECTION:PROTECTION Or
           agqpersonal:PROTECTION = 0 Then
            Error "Invalid Protection Entered"

        if agqpersonal:protection = 4 and
           agqpersonal:eff_date < sfsprotection:eff_date then
            error "The Suburban Rating Plan is not available until August 1, 2009"

        if agqpersonal:protection <> l_protection and
           agqpersonal:protection = 4 then
            begin
            g_company_id = agqpersonal:company_id
            g_state = agqpersonal:state
            g_line_of_business = agqpersonal:line_of_business
            g_protection = agqpersonal:protection
            display modal screen "agtmt1000f"
            l_continue_1 = dialog("Warning","question.bmp","Has all criteria been met for the Suburban Rating Plan?","Yes","No")
            if l_continue_1 = "No" then
                error "Please change the protection entered"
            end

        if agqpersonal:protection = 4 and
           agqpersonal:seasonal = "Y" then
            agqpersonal:seasonal = "N"

        Activehelp if l_eff_date >= sfsprotection_alias:eff_date or
                      sfsprotection_alias:eff_date = 0 then
                       SFSPROTECTION_ALIAS:PROTECTION
                   else
                       null/width=10,
                   if l_eff_date >= sfsprotection_alias:eff_date or
                      sfsprotection_alias:eff_date = 0 then
                       SFSPROTECTION_ALIAS:DESCRIPTION
                   else
                       null/width=50 ;
102     sfsprotection:description[1,20] ;

}

Panel at 5,50 to 7,85   tagged farmers_fn
        Properties {
                LayoutType = screen
        }
        {
         Components
           guidetext at 1,1 to 1,21
             properties
               {
                 text = "Deductible:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 2,1 to 2,21
             properties
               {
                 text = "Hurricane Deductible:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 3,1 to 3,21
             properties
               {
                 text = "Wind Deductible:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
         }

Panel at 5,72 to 7,85 Tagged farmers_fn
Properties
        {
        Scrollbarpolicy    = asneeded
        }
{
%%
_____
_____
_____
%%

components

Fields
101     Begin
        if function one of "CHG","CHANGE" then
            {
            disable(nextscreen_fn)
            disable(previousscreen_fn)
            disable(quotesummary_fn)
            enable(accept_fn)
            disable(back_fn)
            }
        else
            {
            if g_ok_to_continue = "N" then
                begin
                disable(nextscreen_fn)
                disable(quotesummary_fn)
                end
            else
                begin
                enable(nextscreen_fn)
                enable(previousscreen_fn)
                enable(quotesummary_fn)
                disable(accept_fn)
                enable(back_fn)
                end
            }

        access sfsdeductible_alias, set sfsdeductible_alias:company_id       = agqpersonal:company_id,
                                        sfsdeductible_alias:state            = agqpersonal:state,
                                        sfsdeductible_alias:line_of_business = agqpersonal:line_of_business, generic

        End

        agqpersonal:DEDUCTIBLE/default/tabstop
        access sfsdeductible, set sfsdeductible:company_id       = agqpersonal:company_id,
                                  sfsdeductible:state            = agqpersonal:state,
                                  sfsdeductible:line_of_business = agqpersonal:line_of_business,
                                  sfsdeductible:deductible       = agqpersonal:deductible, generic

        if agqpersonal:deductible <> sfsdeductible:deductible or
           sfsdeductible:show_in_activehelp = 0 or
           agqpersonal:deductible = 0 then
            error 1207

        activehelp if sfsdeductible_alias:show_in_activehelp = 1 then
                       sfsdeductible_alias:deductible
                   else
                       null ;
201     begin
            l_hurricane = agqpersonal:hurricane_deductible
        end
        agqPERSONAL:hurricane_deductible/default/tabstop
        if agqpersonal:hurricane_deductible = 0 and
           agqpersonal:tier not one of 0, 3 then
            error "Hurricane Deductible is mandatory"

        hide if agqpersonal:eff_date < agsdefault_plp:hurricane_deductible_eff or
                agsdefault_plp:hurricane_deductible_eff = 0

        If agqPERSONAL:hurricane_deductible <> sfshurricane:hurricane_deductible then
            Error "Invalid Deductible Entered"

        if agqpersonal:hurricane_deductible <> 0 then
            agqpersonal:wind_deductible = 0

        if agqpersonal:hurricane_deductible <> l_hurricane then
            agqpersonal:hurricane_changed = 1

        Activehelp sfshurricane_alias:hurricane_deductible ;
301     begin
        if sfssecurity_rating:auto_activehelp = 1 and
           function one of "ADD", "NEW" then
            activehelp()
        end
        agqPERSONAL:WIND_DEDUCTIBLE/default/tabstop/mask="ZZZZ9"
        hide if agqpersonal:hurricane_deductible <> 0
        If agqPERSONAL:WIND_DEDUCTIBLE <> SFSWINDDEDUCT:WIND_DEDUCTIBLE Then
            Error "Invalid Wind Deductible Entered"

        Activehelp SFSWINDDEDUCT_ALIAS:WIND_DEDUCTIBLE ;

}

Panel at 8, 50 to 9,72
    Properties
        {
        LayoutType = screen
        }
    {
    Components
        guidetext at 1,1 to 1,21
            properties
                {
                text = "Book Roll (Y/N):"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
        guidetext at 2,1 to 2,21
            properties
                {
                text = "Loyalty Discount (Y/N):"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
--                tooltip = "Prior homeowners policy must have been insured with Farmers, with no more than a 2 month gap between the prior and new policy and the location address must be different"
                }
        }

Panel at 8,72 to 8,100
{
%%
_  __________

%%

components

fields
101     begin
        do read_agqpersonal2
        if agqpersonal:book_roll = "" then
            agqpersonal:book_roll = "N"
        end
        agqPERSONAL:book_roll/uppercase/tabstop/displayonly ;
101     agqpersonal:book_roll/uppercase/tabstop/default
        if agqpersonal:book_roll not one of "Y", "N" then
            error "Must enter a Y or N"

        if agqpersonal:book_roll = "N" then
            l_book_roll_premium = 0

        hide if agsdefault_plp:book_roll = 0 ;
102     l_book_roll_premium/default
        hide if agsdefault_plp:book_roll = 0
        hide if agqpersonal:book_roll = "N";
102     l_book_roll_premium/displayonly ;
}

Panel at 9, 75 to 9,100
    Properties
        {
        LayoutType = screen
        }
    {
    Components
        guidetext at 1,1 to 1,20
            properties
                {
                text = ""
                fontsize = 12
                Iconname = "questionmark.bmp"
--                contentalignment = right
                fontname = "arial"
                tooltip = "Prior homeowners policy must have been insured with Farmers, with no more than a 2 month gap between the prior and new policy and the location address must be different"
                }
    }


Panel at 9,72 to 9,74
{
%%
_

%%

components

fields
101     begin
            switch(l_loyalty)
              case 1  : l_loyalty_str = "Y"
              default : l_loyalty_str = "N"
              end
        end
        l_loyalty_str/default/tabstop/uppercase
        if l_loyalty_str not one of "Y", "N" then
            error "Must enter a Y or N"
        switch(l_loyalty_str)
          case "Y" : l_loyalty = 1
          default  : l_loyalty = 0
          end
        do update_agqpersonal2;

}

Panel at 10, 50 to 10,85 tagged owner_fn
    Properties
        {
        LayoutType = screen
        }
    {
    Components
           guidetext at 1,1 to 1,21
             properties
               {
                 text = "Owner Occupied (Y/N):"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
    }

Panel at 10,72 to 10,85 Tagged owner_fn
Properties
        {
        Scrollbarpolicy    = asneeded
        }
{
%%
_
%%

components

Fields
101     Begin
        If FUNCTION one of "ADD", "NEW" and
           agqpersonal:seasonal = "" Then
            begin
            agqpersonal:owner_occupied = "Y"
            agqPERSONAL:SEASONAL = "N"
            end
        End
        agqPERSONAL:OWNER_OCCUPIED/tabstop/default/uppercase tagged owner_fn
        if agqpersonal:owner_occupied = "N" and
           agqpersonal:form = 3 then
            l_continue_4 = dialog("Warning","warning.bmp","Risk is ineligible","OK")

        If FUNCTION one of "CHANGE", "CHG" Then
            Begin
            If agqPERSONAL:OWNER_OCCUPIED = "Y" Then
                agqPERSONAL:LIABILITY_FORM = 2
            Else
                agqPERSONAL:LIABILITY_FORM = 1
            End    ;
101     Begin
        If FUNCTION one of "ADD", "NEW", "CHANGE", "CHG" Then
            Begin
            access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                     sfsterritory:state            = agqpersonal:state,
                                     sfsterritory:line_of_business = agqpersonal:line_of_business,
                                     sfsterritory:county           = agqpersonal:county, generic

            while sfsterritory:company_id       = agqpersonal:company_id and
                  sfsterritory:state            = agqpersonal:state and
                  sfsterritory:line_of_business = agqpersonal:line_of_business and
                  sfsterritory:county           = agqpersonal:county
                begin
                if (agqpersonal:eff_date >= sfsterritory:eff_date and
                   (agqpersonal:eff_date <= sfsterritory:exp_date or
                   sfsterritory:exp_date = 0)) then
                    begin
                    Switch(agqPERSONAL:STATE)
                      Case 19 : agqPERSONAL:TABLE = SFSTERRITORY:TERRITORY_GROUP[1]
                      Default : Do GET_DWELLING_TABLE
                      End
                    end

                next sfsterritory
                end

            End
        End
        agqPERSONAL:OWNER_OCCUPIED/displayonly/checkbox/values="N,Y" tagged owner_fn
        Hide If SFSLINE:LOB_CODE <> "DWELLING" ;

}

Panel at 13, 25 to 13,90 tagged losses_fn
    Properties
        {
        LayoutType = screen
        }
    {
    Components
        guidetext at 1,1 to 1,30
            properties
                {
                text = "Any Losses in the last 3 years (Y/N):"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
            events
                {
                mouseclicked {
                             g_sub_code = 99
                             display modal screen "agtmt9000d"
                             }
                }

    }

Panel at 13, 57 to 13,90
{
%%
_

%%

components

fields
101     begin
        if agqpersonal:losses = "Y" then
            begin
            do check_popup(99)
            if l_popup_complete = 1 then
                setproperty(losses_fn,foregroundcolor,"blue")
            else
                setproperty(losses_fn,foregroundcolor,"red")
            end
        else
            begin
            setproperty(losses_fn,foregroundcolor,"black")
            do clear_popup_information
            end
        l_prior_losses = agqpersonal:losses
        end
        agqpersonal:losses/default/tabstop/uppercase
        if agqpersonal:losses not one of "Y", "N" then
            error "Must enter a Y or N" ;


}

Panel at 15,25 to 15,90 tagged companion_discount_fn
    Properties
        {
        LayoutType = screen
        }
    {
    Components
        guidetext at 1,1 to 1,30
            properties
                {
                text = "Companion Discount (Y/N):"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
            events
                {
                mouseclicked {
                             display modal screen "agtmt9003e"
                             }
                }

    }

Panel at 15, 57 to 15,90
{
%%
_

%%

components

fields
101     begin
        if agqpersonal:other_companion_auto_credit = 1 then
            begin
            l_companion_auto_credit = "Y"
            setproperty(companion_discount_fn,foregroundcolor,"blue")
            end
        else
            begin
            setproperty(companion_discount_fn,foregroundcolor,"black")
            l_companion_auto_credit = "N"
            end
        l_prior_companion_discount = agqpersonal:other_companion_auto_credit
        end
        l_companion_auto_credit/default/tabstop/uppercase
        hide if agqpersonal:tier = 1
        if l_companion_auto_credit not one of "Y", "N" then
            error "Must enter a Y or N"
        if l_companion_auto_credit = "Y" then
            agqpersonal:other_companion_auto_credit = 1
        else
            agqpersonal:other_companion_auto_credit = 0 ;
101     begin
        setproperty(companion_discount_fn,foregroundcolor,"black")
        l_companion_auto_credit = "N"
        end
        l_companion_auto_credit/default/tabstop/uppercase
        hide if agqpersonal:tier <> 1
        if agqpersonal:tier = 1 and
           l_companion_auto_credit = "Y" then
            error "Not Available on Coastal Rating Tier 1" ;
101     l_companion_auto_credit/displayonly
        do read_agqclaim
        do read_agqcreditscore
        do read_agqpersonal2 ;

}

/*Panel at 17, 1 to 18,90
    Properties
        {
        LayoutType = screen
        }
    {
    Components
           guidetext at 1,1 to 1,18
             properties
               {
                 text = "Company Name:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 2,1 to 2,18
             properties
               {
                 text = "Policy No:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
    }

Panel at 17,20 to 18,90
Properties
        {
        Scrollbarpolicy    = asneeded
        }
{
%%
_____________________________________________
_________________  Effective Date: __________

%%

components

Fields
101     begin
        access plscompanionco_alias, set plscompanionco_alias:company_id = agqpersonal:company_id,
                                         plscompanionco_alias:state = agqpersonal:state,
                                         plscompanionco_alias:line_of_business = agqpersonal:line_of_business, generic
        end
        agqpersonal:other_companion_co_name/default
        access plscompanionco, set plscompanionco:company_id = agqpersonal:company_id,
                                   plscompanionco:state = agqpersonal:state,
                                   plscompanionco:line_of_business = agqpersonal:line_of_business,
                                   plscompanionco:company_name = agqpersonal:other_companion_co_name, generic

        if agqpersonal:other_companion_co_name <> plscompanionco:company_name then
            error "Invalid Name Entered"

        hide if agqpersonal:other_companion_auto_credit = 0
        hide if agqpersonal:company_id = "FARMERS" and
                agqpersonal:tier = 1
        hide if agqpersonal:company_id = "FLEMINGTON" and
                agqpersonal:group = 4 and
                agqpersonal:county not one of 23, 24, 25, 28, 29, 33

        agqpersonal:other_companion_percent = plscompanionco:percent

        activehelp if (agqpersonal:eff_date >= plscompanionco_alias:company_efF_date and
                      (agqpersonal:eff_date <= plscompanionco_alias:exp_date or
                      plscompanionco_alias:exp_date = 0)) then
                       plscompanionco_alias:company_name
                   else
                       null/width=50 ;
101     begin
        if agqpersonal:other_companion_auto_credit = 0 then
            begin
            agqpersonal:other_companion_policy_no = ""
            agqpersonal:other_companion_eff_date  = 0
            agqpersonal:other_companion_co_name   = ""
            agqpersonal:other_companion_5_credit  = 0
            end
        end
        agqpersonal:other_companion_co_name/displayonly;
201     agqpersonal:other_companion_policy_no/default
        hide if agqpersonal:other_companion_auto_credit = 0
        hide if agqpersonal:company_id = "FARMERS" and
                agqpersonal:tier = 1
        hide if agqpersonal:company_id = "FLEMINGTON" and
                agqpersonal:group = 4 and
                agqpersonal:county not one of 23, 24, 25, 28, 29, 33 ;

202     agqpersonal:other_companion_eff_date/default
        hide if agqpersonal:other_companion_auto_credit = 0
        hide if agqpersonal:company_id = "FARMERS" and
                agqpersonal:tier = 1
        hide if agqpersonal:company_id = "FLEMINGTON" and
                agqpersonal:group = 4 and
                agqpersonal:county not one of 23, 24, 25, 28, 29, 33 ;

} */

}

Panel tagged nj_policy--at 8,2 to 24,95 tagged nj_policy
    Properties
        {
        text = "Rating Information Continued"
        transparent = False
        backgroundcolor = "#ADD8E6"
        }
{
%%

Swimming Pool No Fence:~~~~_     Roof Type:            __
Swimming Pool Fenced:~~~~~~_     No Bathrooms:         ____
Trampoline No Safety Net:~~_     No Stories:           _
Oil Heat:~~~~~~~~~~~~~~~~~~_     No of Minor Losses:   __ __
Wood Burning Stove:~~~~~~~~_     No of Major Losses:   __ __
Rented Condo (MHO45):~~~~~~_     Fire Safe Score:      ___
    No Units:             __
Loyalty Discount:~~~~~~~~~~_     Insurance Score Tier: __
Original Owner:~~~~~~~~~~~~_     Insurance Score:      ____
LEED Certified:~~~~~~~~~~~~_     Reason Codes:         ___  ___  ___  ___
Remove New Customer Disc:  _     Hardship:             _

%%

components

fields
201     begin
        do read_agqclaim
        do read_agqcreditscore
        do read_agqpersonal2
        end
        l_swimming_pool/checkbox/values="0,1"/displayonly ;
201     l_swimming_pool/checkbox/values="0,1"/default/tabstop
        hide if agqpersonal:state <> 29
        hide if agqpersonal:form <> 3 ;
301     l_swimming_pool_fenced/checkbox/values="0,1"/default/tabstop
        hide if agqpersonal:state <> 29
        hide if agqpersonal:form <> 3 ;
401     l_trampoline/checkbox/values="0,1"/default/tabstop
        hide if agqpersonal:state <> 29
        hide if agqpersonal:form <> 3 ;
501     l_oil_heat/checkbox/values="0,1"/default/tabstop
        hide if agqpersonal:state <> 29
        hide if agqpersonal:form <> 3 ;
601     l_wood_stove/checkbox/values="0,1"/default
        hide if agqpersonal:state <> 29
        hide if agqpersonal:form <> 3 ;
701     l_rented_condo/checkbox/values="0,1"/default
        hide if agqpersonal:state <> 29
        hide if agqpersonal:form <> 6 ;
801     l_no_units/default
        hide if agqpersonal:state <> 29
        hide if agqpersonal:form = 3 ;
901     l_loyalty/checkbox/values="0,1"/default
        hide if agqpersonal:state <> 29;
1001    l_original_owner/checkbox/values="0,1"/default
        hide if agqpersonal:state <> 29
        hide if agqpersonal:form = 4 ;
1101    l_leed_certified/checkbox/values="0,1"/default/tabstop
        hide if agqpersonal:state <> 29
        hide if agqpersonal:form <> 3 ;
1201    l_remove_new_cust_dis/checkbox/values="0,1"/default/tabstop
        hide if agqpersonal:state <> 29 ;

202     begin
        access hrarooftype_alias, set hrarooftype_alias:company_id       = agqname:company_id,
                                      hrarooftype_alias:state            = agqpersonal:state,
                                      hrarooftype_alias:line_of_business = agqname:line_of_business, generic
        end
        l_roof_type/default/tabstop
        access hrarooftype, set hrarooftype:company_id       = agqname:company_id,
                                hrarooftype:state            = agqpersonal:state,
                                hrarooftype:line_of_business = agqname:line_of_business,
                                hrarooftype:roof_type        = l_roof_type, generic

        if l_roof_type <> hrarooftype:roof_type then
            error "Invalid Type Entered"

        hide if agqpersonal:state <> 29
        hide if agqpersonal:form <> 3

        activehelp hrarooftype_alias:roof_type,
                   hrarooftype_alias:description ;
302     l_no_bathrooms/default
        hide if agqpersonal:state <> 29
        hide if agqpersonal:form <> 3 ;
402     l_no_stories/default
        hide if agqpersonal:state <> 29
        hide if agqpersonal:form <> 3 ;
502     l_no_minor_losses/default
        hide if agqpersonal:state <> 29;
503     l_no_minor_losses_found/displayonly
        hide if agqpersonal:state <> 29;
602     l_no_major_losses/default
        hide if agqpersonal:state <> 29;
603     l_no_major_losses_found/displayonly
        hide if agqpersonal:state <> 29;
702     l_fire_safe_score/default
        hide if agqpersonal:state <> 29
        if l_fire_safe_score <> l_prior_fire_safe_score then
            l_changed_fire_safe = 1;
902     begin
            do read_hracreditscore
        end
        l_credit_score_tier/default
        hide if agqpersonal:state <> 29;
1002    l_credit_score/default
        if l_credit_score <> l_prior_credit_score then
            begin
            l_changed_credit_score = 1
            do read_hracreditscore
            end
        hide if agqpersonal:state <> 29;
1102    l_reason_code_1/default/tabstop/uppercase ;
1103    l_reason_code_2/default/tabstop/uppercase ;
1104    l_reason_code_3/default/tabstop/uppercase ;
1105    l_reason_code_4/default/tabstop/uppercase ;
1202    l_hardship/checkbox/values="0,1"/default ;
902     l_credit_score_tier/displayonly
        hide if agqpersonal:state <> 29;
1002    begin
            do update_agqpersonal2
        end
        l_credit_score/displayonly
        hide if agqpersonal:state <> 29;


}

}

panel at 27,1 to 27,100 tagged line_panel_1
    {
    Components
        line at 1,1 to 1,100
            Properties
                {
                Linestyle = embossed
                Linewidth = 5
                foregroundcolor = "black"
                }
    }

Panel at 28,1 to 28,100 Tagged icon_line2_tg
    Properties
        {
        LayoutType = screen
        }
    {
    Components
        Button at 1,5   tagged previousscreen_fn
        Properties {
                Iconname = "previous_screen.bmp"
                }
        Events  {
                Action {
                       function = "previousscreen"
                       abort()
                       }
                }

        Button at 1,40   tagged quotesummary_fn
        Properties {
                Iconname = "quote_summary.bmp"
                }
        Events  {
                Action {
                       function = "quotesummary"
                       abort()
                       }
                }

        Button at 1,75   tagged nextscreen_fn
            Properties
                {
                Iconname = "next_screen.bmp"
                }
            Events
                {
                Action
                    {
                    function = "nextscreen"
                    abort()
                    }
                }

}

panel at 29,1 to 29,100 tagged line_panel_1
    {
    Components
        line at 1,1 to 1,100
            Properties
                {
                Linestyle = embossed
                Linewidth = 5
                foregroundcolor = "black"
                }
    }

panel at 30,1 to 32,100  tagged ficof_fn

Properties
        {
          LayoutType = screen
--          Transparent = False
          backgroundcolor = "white"
        }
{
      Components
         browser at 1,1 to 7,100  tagged helper_tg
             properties {
                          url = ""
                        }
}

}

Update
if UPDATEOK = "NO" Then
    {
    if g_ok_to_continue = "N" then
        begin
        disable(nextscreen_fn)
        disable(quotesummary_fn)
        end
    else
        begin
        disable(accept_fn)
        enable(nextscreen_fn)
        enable(quotesummary_fn)
        enable(previousscreen_fn)
        enable(back_fn)
        end
    }

If UPDATEOK = "YES" And
   Abort = "NO" Then
    Begin
    if g_ok_to_continue = "N" then
        begin
        disable(nextscreen_fn)
        disable(quotesummary_fn)
        end
    else
        begin
        disable(accept_fn)
        enable(nextscreen_fn)
        enable(previousscreen_fn)
        enable(quotesummary_fn)
        enable(back_fn)
        end

    If FUNCTION one of "CHANGE", "CHG" Then
        Begin
        if agqpersonal:other_companion_auto_credit = 1 and
           l_prior_companion_discount = 0 then
            display modal screen "agtmt9003e"
        else
        if agqpersonal:other_companion_auto_credit = 0 and
           l_prior_companion_discount = 1 then
            begin
            access agqpersonal_alias, set agqpersonal_alias:app_no = g_app_no, generic

            if agqpersonal_alias:app_no = g_app_no then
                begin
                change agqpersonal_alias
                    begin
                    agqpersonal_alias:other_companion_co_name   = ""
                    agqpersonal_alias:other_companion_policy_no = ""
                    agqpersonal_alias:other_companion_eff_date  = 0
                    end
                end
            end

        if agqpersonal:losses = "Y" and
           l_prior_losses <> "Y" then
            begin
            g_sub_code = 99
            display modal screen "agtmt9000d"
            end
        else
        if agqpersonal:losses = "N" and
           l_prior_losses = "Y" then
            begin
            access agqpersonal2_alias, set agqpersonal2_alias:app_no = g_app_no, generic

            if agqpersonal2_alias:app_no = g_app_no then
                begin
                change agqpersonal2_alias
                    begin
                    agqpersonal2_alias:minor_loss = 0
                    agqpersonal2_alias:major_loss = 0
                    end
                end
            end

        Access SFSLINE, Set SFSLINE:COMPANY_ID       = agqpersonal:company_id,
                            SFSLINE:LINE_OF_BUSINESS = agqpersonal:line_of_business,
                            SFSLINE:LOB_SUBLINE      = "00", Generic

        do UPDATE_ENDORSEMENTS
        if agqpersonal:company_id = "FLEMINGTON" then
            do update_agqpersonal_alias
        end

    do read_agqcreditscore_d11_code
    function = "redisplay"
    abort()
    end

Screen Exit
if agqpersonal:app_no <> 0 then
    do update_territory

Procedure Definition

procedure read_agqcreditscore_d11_code
begin
access agqcreditscore,
     set agqcreditscore:app_no = g_app_no, generic

g_ok_to_continue = "Y"
if agqcreditscore:risk_scoring_code[1] one of "D11" or
   agqcreditscore:risk_scoring_code[2] one of "D11" or
   agqcreditscore:risk_scoring_code[3] one of "D11" or
   agqcreditscore:risk_scoring_code[4] one of "D11" then
    begin
    l_continue_1 = dialog("Warning","warning.bmp","Risk Is Ineligible Due To Bankruptcy, Contact Your Underwriter.","OK")
    g_ok_to_continue = "N"
    end

end

procedure check_agqend
begin
access agqend, set agqend:app_no   = g_app_no,
                   agqend:prem_no  = agqpersonal:prem_no,
                   agqend:build_no = agqpersonal:build_no, generic

l_mho45 = "N"
while agqend:app_no   = g_app_no and
      agqend:prem_no  = agqpersonal:prem_no and
      agqend:build_no = agqpersonal:build_no
        begin
        if agqend:code = "MHO45" then
            l_mho45 = "Y"

        next agqend
        end
end

procedure read_agqclaim
begin
access agqclaim, set agqclaim:app_no = g_app_no, generic

l_major_loss_found = 0
l_minor_loss_found = 0
while agqclaim:app_no = g_app_no
    begin
    l_claim_year = year(agqname:eff_date) - year(agqclaim:loss_date)
    if ((l_claim_year < 3 or
       (l_claim_year = 3 and
       month(agqclaim:loss_date) >= month(agqname:eff_date))) and
       agqclaim:name <> "INSURED NAME DIFFERENT" and
       agqclaim:policy_type one of "HO", "H" and
       agqclaim:loss_amount not one of "", "0", "$0") then
        begin
        l_continue = "N"
        if l_claim_year = 3 and
           month(agqclaim:loss_date) = month(agqname:eff_date) and
           day(agqclaim:loss_date) >= day(agqname:eff_date) then
            l_continue = "Y"

        if l_claim_year = 3 and
           month(agqclaim:loss_date) > month(agqname:eff_date) then
            l_continue = "Y"

        if l_claim_year < 3 then
            l_continue = "Y"

        if l_continue = "Y" then
            begin
            l_claim_type = agqclaim:claim_type
            l_state = agqpersonal:state
            access sfsclaimtypes, set sfsclaimtypes:company_id       = agqname:company_id,
                                      sfsclaimtypes:state            = l_state,
                                      sfsclaimtypes:line_of_business = agqname:line_of_business,
                                      sfsclaimtypes:claim_type       = l_claim_type, generic

            l_no_major_losses_found = 0
            l_no_minor_losses_found = 0
            while sfsclaimtypes:company_id       = agqname:company_id and
                  sfsclaimtypes:state            = agqpersonal:state and
                  sfsclaimtypes:line_of_business = agqname:line_of_business and
                  sfsclaimtypes:claim_type       = l_claim_type
                begin
                if (agqname:eff_date >= sfsclaimtypes:eff_date and
                   (agqname:exp_date <= sfsclaimtypes:exp_date or
                   sfsclaimtypes:exp_date = 0)) then
                    begin
                    if sfsclaimtypes:major_loss = 1 then
                        l_no_major_losses_found = l_no_major_losses_found + 1
                    else
                        l_no_minor_losses_found = l_no_minor_losses_found + 1
                    end

                next sfsclaimtypes
                end
            end

        end

    next agqclaim
    end

end

procedure update_agqpersonal2
begin
access agqcreditscore, set agqcreditscore:app_no = agqpersonal:app_no, generic

if l_credit_score = 0 then
    l_credit_score = 999
if agqcreditscore:app_no = agqpersonal:app_no then
    begin
    change agqcreditscore
        begin
        if l_reason_code_1 <> "" then
            agqcreditscore:risk_scoring_code[1] = l_reason_code_1
        if l_reason_code_2 <> "" then
            agqcreditscore:risk_scoring_code[2] = l_reason_code_2
        if l_reason_code_3 <> "" then
            agqcreditscore:risk_scoring_code[3] = l_reason_code_3
        if l_reason_code_4 <> "" then
            agqcreditscore:risk_scoring_code[4] = l_reason_code_4
        if l_changed_fire_safe = 1 then
            begin
            agqcreditscore:fire_safe_score_changed = l_fire_safe_score
            agqcreditscore:changed_fire_risk_score = 1
            end
        if l_changed_credit_score = 1 then
            begin
            agqcreditscore:original_credit_score = agqcreditscore:credit_score
            agqcreditscore:credit_score          = l_credit_score
            agqcreditscore:changed_credit_score  = "Y"
            end
        agqcreditscore:hardship                  = l_hardship
        end
    end
else
    begin
    add agqcreditscore
        begin
        agqcreditscore:app_no                = g_app_no
        if l_reason_code_1 <> "" then
            agqcreditscore:risk_scoring_code[1] = l_reason_code_1
        if l_reason_code_2 <> "" then
            agqcreditscore:risk_scoring_code[2] = l_reason_code_2
        if l_reason_code_3 <> "" then
            agqcreditscore:risk_scoring_code[3] = l_reason_code_3
        if l_reason_code_4 <> "" then
            agqcreditscore:risk_scoring_code[4] = l_reason_code_4
        if l_changed_fire_safe = 1 then
            begin
            agqcreditscore:fire_safe_score_changed = l_fire_safe_score
            agqcreditscore:changed_fire_risk_score = 1
            end
        if l_changed_credit_score = 1 then
            begin
            agqcreditscore:original_credit_score = agqcreditscore:credit_score
            agqcreditscore:credit_score          = l_credit_score
            agqcreditscore:changed_credit_score  = "Y"
            end
        agqcreditscore:hardship                  = l_hardship
        end
    end

if l_no_stories = 0 then
    l_no_stories = 1
access agqpersonal2, set agqpersonal2:app_no = agqpersonal:app_no,
                         agqpersonal2:prem_no  = agqpersonal:prem_no,
                         agqpersonal2:build_no = agqpersonal:build_no, generic

if agqpersonal2:app_no = agqpersonal:app_no and
   agqpersonal2:prem_no  = agqpersonal:prem_no and
   agqpersonal2:build_no = agqpersonal:build_no then
    begin
    change agqpersonal2
        begin
        agqpersonal2:trampoline           = l_trampoline
        agqpersonal2:swimming_pool        = l_swimming_pool
        agqpersonal2:swimming_pool_fenced = l_swimming_pool_fenced
        agqpersonal2:oil_heat             = l_oil_heat
        agqpersonal2:fire_resistive       = l_fire_resistive
        agqpersonal2:wood_stove           = l_wood_stove
        agqpersonal2:leed_certified       = l_leed_certified
        agqpersonal2:remove_new_cust_dis  = l_remove_new_cust_dis
        agqpersonal2:no_bathrooms         = l_no_bathrooms
        agqpersonal2:no_stories           = l_no_stories
        agqpersonal2:roof_type            = l_roof_type
        agqpersonal2:original_owner       = l_original_owner
        agqpersonal2:years_with_co        = l_years_with_co
        agqpersonal2:credit_score         = l_credit_score
        agqpersonal2:credit_score_tier    = l_credit_score_tier
        if l_changed_fire_safe = 1 then
            agqpersonal2:fire_safe_score  = l_fire_safe_score
        if l_no_minor_losses <> 0 then
            agqpersonal2:minor_loss       = l_no_minor_losses
        if l_no_major_losses <> 0 then
            agqpersonal2:major_loss       = l_no_major_losses
        if l_no_minor_losses_found <> 0 then
            agqpersonal2:minor_loss_found = l_no_minor_losses_found
        if l_no_major_losses_Found <> 0 then
            agqpersonal2:major_loss_found = l_no_major_losses_found
        agqpersonal2:tenure               = l_tenure
        agqpersonal2:rented_condo         = l_rented_condo
        agqpersonal2:no_units             = l_no_units
        agqpersonal2:loyalty              = l_loyalty
        agqpersonal2:credit_score_tier_initial = l_initial_credit_score
        agqpersonal2:book_roll_premium    = l_book_roll_premium
        end
    end
else
    begin
    add agqpersonal2
        begin
        agqpersonal2:app_no             = agqpersonal:app_no
        agqpersonal2:prem_no              = agqpersonal:prem_no
        agqpersonal2:build_no             = agqpersonal:build_no
        agqpersonal2:trampoline           = l_trampoline
        agqpersonal2:swimming_pool        = l_swimming_pool
        agqpersonal2:swimming_pool_fenced = l_swimming_pool_fenced
        agqpersonal2:oil_heat             = l_oil_heat
        agqpersonal2:fire_resistive       = l_fire_resistive
        agqpersonal2:wood_stove           = l_wood_stove
        agqpersonal2:leed_certified       = l_leed_certified
        agqpersonal2:remove_new_cust_dis  = l_remove_new_cust_dis
        agqpersonal2:no_bathrooms         = l_no_bathrooms
        agqpersonal2:no_stories           = l_no_stories
        agqpersonal2:roof_type            = l_roof_type
        agqpersonal2:original_owner       = l_original_owner
        agqpersonal2:years_with_co        = l_years_with_co
        agqpersonal2:credit_score         = l_credit_score
        agqpersonal2:credit_score_tier    = l_credit_score_tier
        if l_changed_fire_safe = 1 then
            agqpersonal2:fire_safe_score  = l_fire_safe_score
        if l_no_minor_losses <> 0 then
            agqpersonal2:minor_loss       = l_no_minor_losses
        if l_no_major_losses <> 0 then
            agqpersonal2:major_loss       = l_no_major_losses
        if l_no_minor_losses_found <> 0 then
            agqpersonal2:minor_loss_found = l_no_minor_losses_found
        if l_no_major_losses_found <> 0 then
            agqpersonal2:major_loss_found = l_no_major_losses_found
        agqpersonal2:tenure               = l_tenure
        agqpersonal2:rented_condo         = l_rented_condo
        agqpersonal2:no_units             = l_no_units
        agqpersonal2:loyalty              = l_loyalty
        agqpersonal2:credit_score_tier_initial = l_initial_credit_score
        agqpersonal2:book_roll_premium    = l_book_roll_premium
        end
    end

agqpersonal:protection = l_fire_safe_score
end

procedure read_agqpersonal2
begin
access agqpersonal2, set agqpersonal2:app_no = agqpersonal:app_no,
                         agqpersonal2:prem_no  = agqpersonal:prem_no,
                         agqpersonal2:build_no = agqpersonal:build_no, generic

if agqpersonal2:app_no = agqpersonal:app_no and
   agqpersonal2:prem_no  = agqpersonal:prem_no and
   agqpersonal2:build_no = agqpersonal:build_no then
    begin
    l_trampoline           = agqpersonal2:trampoline
    l_swimming_pool        = agqpersonal2:swimming_pool
    l_swimming_pool_fenced = agqpersonal2:swimming_pool_fenced
    l_oil_heat             = agqpersonal2:oil_heat
    l_fire_resistive       = agqpersonal2:fire_resistive
    l_wood_stove           = agqpersonal2:wood_stove
    l_leed_certified       = agqpersonal2:leed_certified
    l_remove_new_cust_dis  = agqpersonal2:remove_new_cust_dis
    l_no_bathrooms         = agqpersonal2:no_bathrooms
    l_no_stories           = agqpersonal2:no_stories
    l_roof_type            = agqpersonal2:roof_type
    l_original_owner       = agqpersonal2:original_owner
    l_years_with_co        = agqpersonal2:years_with_co
    l_loyalty              = agqpersonal2:loyalty
    l_credit_score_tier    = agqpersonal2:credit_score_tier
    l_no_minor_losses      = agqpersonal2:minor_loss
    l_no_major_losses      = agqpersonal2:major_loss
    l_tenure               = agqpersonal2:tenure
    l_no_units             = agqpersonal2:no_units
    l_rented_condo         = agqpersonal2:rented_condo
    l_book_roll_premium    = agqpersonal2:book_roll_premium
    end

end

procedure read_agqcreditscore
begin
access agqcreditscore, set agqcreditscore:app_no = g_app_no, generic

if agqcreditscore:app_no = g_app_no then
    begin
    l_credit_score         = agqcreditscore:credit_score
    l_refused_credit_score = agqcreditscore:refused_credit_score
    l_hardship             = agqcreditscore:hardship
    l_reason_code_1        = agqcreditscore:risk_scoring_code[1]
    l_reason_code_2        = agqcreditscore:risk_scoring_code[2]
    l_reason_code_3        = agqcreditscore:risk_scoring_code[3]
    l_reason_code_4        = agqcreditscore:risk_scoring_code[4]
    l_hardship             = agqcreditscore:hardship
    if agqcreditscore:fire_safe_score > 0 and
       agqcreditscore:changed_fire_risk_score = 0 then
        begin
        if agqcreditscore:fire_safe_score <= 4 then
            l_fire_safe_score = 1
        else
        if agqcreditscore:fire_safe_score <= 8 then
            l_fire_safe_score = 2
        else
        if agqcreditscore:fire_safe_score <= 11 then
            l_fire_safe_score = 3
        else
        if agqcreditscore:fire_safe_score <= 15 then
            l_fire_safe_score = 4
        else
        if agqcreditscore:fire_safe_score <= 16 then
            l_fire_safe_score = 5
        else
        if agqcreditscore:fire_safe_score <= 19 then
            l_fire_safe_score = 6
        else
        if agqcreditscore:fire_safe_score <= 21 then
            l_fire_safe_score = 7
        else
        if agqcreditscore:fire_safe_score <= 24 then
            l_fire_safe_score = 8
        else
        if agqcreditscore:fire_safe_score <= 27 then
            l_fire_safe_score = 9
        else
        if agqcreditscore:fire_safe_score <= 29 then
            l_fire_safe_score = 10
        end
    else
    if agqcreditscore:changed_fire_risk_score = 0 then
         begin
         l_fire_safe_score = 11
         end
    else
    if agqcreditscore:changed_fire_risk_score = 1 then
        l_fire_safe_score = agqcreditscore:fire_safe_score_changed
    end

access agqpersonal2, set agqpersonal2:app_no = agqpersonal:app_no,
                         agqpersonal2:prem_no  = agqpersonal:prem_no,
                         agqpersonal2:build_no = agqpersonal:build_no, generic

if agqpersonal2:app_no = agqpersonal:app_no and
   agqpersonal2:prem_no  = agqpersonal:prem_no and
   agqpersonal2:build_no = agqpersonal:build_no then
    begin
    if l_fire_safe_score = 0 and
       agqpersonal2:fire_safe_score <> 0 then
        l_fire_safe_score = agqpersonal2:fire_safe_score
    else
    if l_fire_safe_score <> 0 then
        begin
        change agqpersonal2
            begin
            agqpersonal2:fire_safe_score = l_fire_safe_score
            end
        end
    end

l_prior_credit_score    = l_credit_score
l_prior_fire_safe_score = l_fire_safe_score
end

procedure read_hracreditscore
begin
access hracreditscore, set hracreditscore:company_id       = agqpersonal:company_id,
                           hracreditscore:state            = agqpersonal:state,
                           hracreditscore:line_of_business = agqpersonal:line_of_business,
                           hracreditscore:credit_score     = l_credit_score, approximate

l_credit_score_tier = 0
l_credit_score_1 = hracreditscore:credit_score
while hracreditscore:company_id       = agqpersonal:company_id and
      hracreditscore:state            = agqpersonal:state and
      hracreditscore:line_of_business = agqpersonal:line_of_business and
      hracreditscore:credit_score     = l_credit_score_1
        begin
        if (agqpersonal:eff_date >= hracreditscore:eff_date and
           (agqpersonal:eff_date <= hracreditscore:exp_date or
           hracreditscore:exp_date = 0)) then
            begin
            if l_credit_score <> 0 then
                l_credit_score_tier = hracreditscore:tier
            end

        next hracreditscore
        end

l_initial_credit_score = l_credit_score_tier
access hratierassign, set hratierassign:company_id       = agqpersonal:company_id,
                          hratierassign:state            = agqpersonal:state,
                          hratierassign:line_of_business = agqpersonal:line_of_business, generic

while hratierassign:company_id = agqpersonal:company_id and
      hratierassign:state      = agqpersonal:state and
      hratierassign:line_of_business = agqpersonal:line_of_business
        begin
        if (agqpersonal:eff_date >= hratierassign:eff_date and
           (agqpersonal:eff_date <= hratierassign:exp_date or
           hratierassign:exp_date = 0)) then
            begin
            if l_credit_score = 0 or
               l_credit_score = 999 then
                begin
                l_credit_score_tier = hratierassign:no_hits
                l_initial_credit_score = l_credit_score_tier
                end

            if l_credit_score = 125 then
                begin
                l_credit_score_tier = hratierassign:no_connection
                l_initial_credit_score = l_credit_score_tier
                end

            if l_hardship = 1 then
                begin
                l_credit_score_tier = hratierassign:hardship
                l_initial_credit_score = l_credit_score_tier
                end
            if l_credit_score = 0 then
                begin
                l_credit_score_tier = hratierassign:no_hits
                l_initial_credit_score = l_credit_score_tier
                end
            else
            if l_refused_credit_score = 1 then
                begin
                l_credit_score_tier = hratierassign:refusals
                l_initial_credit_score = l_credit_score_tier
                end

            if l_trampoline = 1 and
               agqpersonal:form not one of 4, 6 then
                l_credit_score_tier = l_credit_score_tier +
                                      hratierassign:trampoline
            if l_swimming_pool = 1 and
               agqpersonal:form not one of 4, 6 then
                l_credit_score_tier = l_credit_score_tier +
                                      hratierassign:non_fenced_swimming_pool
            else
            if l_swimming_pool_fenced = 1 and
               agqpersonal:form not one of 4, 6 then
                l_credit_score_tier = l_credit_score_tier +
                                      hratierassign:fenced_swimming_pool
            if l_oil_heat = 1 and
               agqpersonal:form not one of 4, 6 then
                l_credit_score_tier = l_credit_score_tier +
                                      hratierassign:oil_heat

            if l_credit_score_tier > hratierassign:maximum_tier then
                l_credit_score_tier = hratierassign:maximum_tier
            end

        next hratierassign
        end

end

procedure update_agqpersonal_alias
begin
access agqlocation, set agqlocation:app_no = g_app_no, generic

l_val_zipcode = agqlocation:zipcode
l_str_zipcode = agqlocation:str_zipcode[1,5] + "0000"
access sfszipcode, set sfszipcode:company_id       = agqpersonal:company_id,
                       sfszipcode:state            = agqpersonal:state,
                       sfszipcode:line_of_business = agqpersonal:line_of_business,
                       sfszipcode:str_zipcode      = l_str_zipcode, generic

l_tier = 0
while sfszipcode:company_Id       = agqpersonal:company_id and
      sfszipcode:state            = agqpersonal:state and
      sfszipcode:line_of_business = agqpersonal:line_of_business and
      sfszipcode:str_zipcode      = l_str_zipcode
        begin
        if (agqpersonal:eff_date >= sfszipcode:eff_date and
           (agqpersonal:eff_date <= sfszipcode:exp_date or
           sfszipcode:exp_date = 0)) then
            begin
            l_tier            = sfszipcode:tier
            end

        next sfszipcode
        end

l_tier_1 = l_tier
if l_tier_1 = 0 then
    l_tier_1 = 3
if agsdefault_plp:dont_use_tier_rating = 1 then
    l_tier_1 = 3
access sfstier, set sfstier:company_id       = agqpersonal:company_id,
                    sfstier:state            = agqpersonal:state,
                    sfstier:line_of_business = agqpersonal:line_of_business,
                    sfstier:tier             = l_tier_1, generic

l_wind_deductible      = 0
l_hurricane_deductible = 0
while sfstier:company_Id       = agqpersonal:company_id and
      sfstier:state            = agqpersonal:state and
      sfstier:line_of_business = agqpersonal:line_of_business and
      sfstier:tier             = l_tier_1
        begin
        if (agqpersonal:eff_date >= sfstier:eff_date and
           (agqpersonal:eff_date <= sfstier:exp_date or
           sfstier:exp_date = 0)) then
            begin
            l_wind_deductible      = sfstier:wind_deductible
            l_hurricane_deductible = sfstier:hurricane_deductible
            l_hurricane_code       = sfstier:hurricane_code
            end

        next sfstier
        end

if l_hurricane_code <> "" then
    begin
    l_code = l_hurricane_code
    do access_agqend
    if l_add_endorsement = "Y" and
       agqpersonal:hurricane_deductible <> 0 then
        do add_agqend
    if l_add_endorsement = "N" and
       agqpersonal:hurricane_deductible = 0 then
        do delete_agqend
    end
else
if l_hurricane_code = "" then
    do access_agqend

access agqpersonal_alias, set agqpersonal_alias:app_no   = agqpersonal:app_no, generic

if agqpersonal_alias:app_no = agqpersonal:app_no then
    begin
    change agqpersonal_alias
        begin
        if l_wind_deductible <> 0 then
            agqpersonal_alias:wind_deductible      = l_wind_deductible
        agqpersonal_alias:tier                     = l_tier_1
        if l_tier_1 = 1 then
            begin
            agqpersonal_alias:companion_discount   = 0
            end
        if (l_hurricane_deductible <> 0 and
           (agqpersonal_alias:hurricane_changed = 0 or
           g_zipcode_change = "Y" or
           agqpersonal_alias:tier one of 1, 2)) then
            begin
            g_zipcode_change = "N"
            agqpersonal_alias:hurricane_deductible = l_hurricane_deductible
            if agqpersonal_alias:company_id <> "FLEMINGTON" then
                agqpersonal_alias:wind_deductible      = 0
            end
        else
        if l_hurricane_deductible = 0 then
            agqpersonal_alias:hurricane_deductible = l_hurricane_deductible
        end
    end
end

procedure change_current_browser (string p_server_name, string p_current_web_page)
BEGIN
l_web_site_address = trun(p_server_name) + trun(p_current_web_page)
setproperty(helper_tg,url,trun(l_web_site_address))

END

procedure update_territory
begin
access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                         sfsterritory:state            = agqpersonal:state,
                         sfsterritory:line_of_business = agqpersonal:line_of_business,
                         sfsterritory:county           = agqpersonal:county, generic

while sfsterritory:company_id       = agqpersonal:company_id and
      sfsterritory:state            = agqpersonal:state and
      sfsterritory:line_of_business = agqpersonal:line_of_business and
      sfsterritory:county           = agqpersonal:county
    begin
    if (agqpersonal:eff_date >= sfsterritory:eff_date and
       (agqpersonal:eff_date <= sfsterritory:exp_date or
       sfsterritory:exp_date = 0)) then
        begin
        access agqpersonal_alias, set agqpersonal_alias:app_no = agqpersonal:app_no, generic

        if agqpersonal_alias:app_no = agqpersonal:app_no then
            begin
            change agqpersonal_alias
                begin
                agqPERSONAL_alias:TERRITORY = SFSTERRITORY:TERRITORY
                end
            end

        Switch(agqpersonal:state)
          Case 37 : Begin
                    Switch(agqPERSONAL:FORM)
                      Case 2  : L_GROUP = SFSTERRITORY:TERRITORY_GROUP[1]
                      Case 4  : L_GROUP = SFSTERRITORY:TERRITORY_GROUP[3]
                      Case 6  : L_GROUP = SFSTERRITORY:TERRITORY_GROUP[4]
                      Default : L_GROUP = SFSTERRITORY:TERRITORY_GROUP[2]
                      End
                    End
          Default : Begin
                    L_GROUP = SFSTERRITORY:TERRITORY_GROUP[1]
                    if sfsterritory:territory_group[2] <> 0 and
                       agqpersonal:form one of 4, 6 then
                        begin
                        l_group = sfsterritory:territory_group[2]
                        access agqpersonal_alias, set agqpersonal_alias:app_no   = agqpersonal:app_no, generic

                        if agqpersonal_alias:app_no   = agqpersonal:app_no then
                            begin
                            change agqpersonal_alias
                                begin
                                agqpersonal_alias:territory = sfsterritory:territory_ho4_ho6
                                end
                            end
                        End
                    end
          End

        If SFSLINE:LOB_CODE <> "DWELLING" Then
            begin
            L_TABLE   = SFSTERRITORY:TERRITORY_GROUP[1]
            l_table_1 = sfsterritory:territory_group[1]
            if sfsterritory:territory_group[2] <> 0 and
               agqpersonal:form one of 4, 6 then
                begin
                L_TABLE   = SFSTERRITORY:TERRITORY_GROUP[2]
                l_table_1 = sfsterritory:territory_group[2]
                end
            end
        end

    next sfsterritory
    end

Access agqPERSONAL_ALIAS, Set agqPERSONAL_ALIAS:app_no   = agqpersonal:app_no, generic

if agqpersonal_alias:app_no   = agqpersonal:app_no then
    begin
    change agqpersonal_alias
        begin
        agqpersonal_alias:group   = l_group
        agqpersonal_alias:table   = l_table
        agqpersonal_alias:table_1 = l_table_1
        end
    end

end

procedure minimum_maximum_limits
begin
access sfsminmax, set sfsminmax:company_id       = agqpersonal:company_id,
                      sfsminmax:state            = agqpersonal:state,
                      sfsminmax:line_of_business = agqpersonal:line_of_business,
                      sfsminmax:form             = g_form, generic

while sfsminmax:company_id        = agqpersonal:company_id and
      sfsminmax:state             = agqpersonal:state and
      sfsminmax:line_of_business  = agqpersonal:line_of_business and
      sfsminmax:form              = g_form
        begin
        if (agqpersonal:eff_date >= sfsminmax:eff_date and
           (agqpersonal:eff_date <= sfsminmax:exp_date or
           sfsminmax:exp_date = 0)) then
            begin
            l_minimum_limit   = sfsminmax:minimum_limit
            l_maximum_limit   = sfsminmax:maximum_limit
            l_binding_limit   = sfsminmax:binding_maximum
            l_min_error       = sfsminmax:give_error[1]
            l_binding_error   = sfsminmax:give_error[2]
            l_max_error       = sfsminmax:give_error[3]
            l_minimum_message = sfsminmax:minimum_message
            l_binding_message = sfsminmax:binding_message
            l_maximum_message = sfsminmax:maximum_message
            l_contact_message = sfsminmax:contact_message
            l_filed_limit     = sfsminmax:minimum_filed_rate
            l_filed_message   = sfsminmax:minimum_rate_message
            end

        next sfsminmax
        end

end

Procedure UPDATE_ENDORSEMENTS
Begin
If agqPERSONAL:app_no = G_app_no Then
    Begin
    Access PLSPREPRINTED, Set PLSPREPRINTED:COMPANY_ID       = agqpersonal:COMPANY_ID,
                              PLSPREPRINTED:STATE            = agqpersonal:state,
                              PLSPREPRINTED:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS, Generic

    l_code_1  = ""
    l_code_2  = ""
    l_code_3  = ""
    l_code_4  = ""
    l_code_5  = ""
    l_code_6  = ""
    l_code_7  = ""
    l_code_8  = ""
    l_code_9  = ""
    l_code_10 = ""
    l_code_11 = ""
    l_code_12 = ""
    l_code_13 = ""
    l_code_14 = ""
    l_code_20 = ""
    l_code_21 = ""
    l_code_22 = ""
    l_code_23 = ""
    l_code_24 = ""
    l_code_25 = ""
    l_code_26 = ""
    l_code_27 = ""
    l_code_28 = ""
    l_code_29 = ""
    l_code_30 = ""
    l_code_31 = ""
    l_code_32 = ""
    while plspreprinted:record_key       = "PF" and
          PLSPREPRINTED:COMPANY_ID       = agqpersonal:COMPANY_ID and
          PLSPREPRINTED:STATE            = agqpersonal:STATE and
          PLSPREPRINTED:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS
        begin
        If agqpersonal:eff_date >= PLSPREPRINTED:rEFF_DATE Then
            Begin
            L_CODE_1  = PLSPREPRINTED:CODE[7] -- wind deductible
            L_CODE_2  = PLSPREPRINTED:CODE[6] -- new home discount
            L_CODE_3  = PLSPREPRINTED:CODE[2] -- seasonal
            L_CODE_4  = PLSPREPRINTED:CODE[20] -- workers comp
            L_CODE_5  = PLSPREPRINTED:CODE[22] -- sal01, fpl01
            L_CODE_6  = PLSPREPRINTED:CODE[23] -- mpl47
            L_CODE_7  = PLSPREPRINTED:CODE[5] -- mpl70
            L_CODE_8  = PLSPREPRINTED:TRIGGER_ENDORSEMENTS[14]
            L_CODE_9  = PLSPREPRINTED:CODE[21] -- mdl1
            L_CODE_10 = PLSPREPRINTED:CODE[24] -- mdl62
            L_CODE_11 = PLSPREPRINTED:TRIGGER_ENDORSEMENTS[15] -- mdl2
            L_CODE_12 = PLSPREPRINTED:TRIGGER_ENDORSEMENTS[16] -- mdl63
            L_CODE_13 = PLSPREPRINTED:TRIGGER_ENDORSEMENTS[17] -- mdw30
            l_code_14 = plspreprinted:code[25] -- MPL96
            l_code_20 = plspreprinted:trigger_endorsements[18] -- mpl61
            l_code_21 = plspreprinted:trigger_endorsements[20] -- mpl24
            l_code_22 = plspreprinted:code_1[1] -- mpl126
            l_code_23 = plspreprinted:code_1[2] -- fpl02 boiler
            l_fpl01_form = plspreprinted:fpl01_form
            l_code_24 = plspreprinted:code[8] -- mpl67
            l_code_25 = plspreprinted:code[9] -- mpl68
            l_code_26 = plspreprinted:code[10] -- mpl69
            l_code_27 = plspreprinted:code[26] -- mpl97
            l_code_28 = plspreprinted:code[27] -- mpl46
            l_code_29 = plspreprinted:code[28] -- sal04
            l_code_30 = plspreprinted:agent_system_increase -- standard mpl47 for agent system
            l_code_31 = plspreprinted:code_1[4] -- mpl12
            l_code_32 = "MHO45"
            End

        Next PLSPREPRINTED
        End

    Access SFSLINE, Set SFSLINE:COMPANY_ID       = agqpersonal:COMPANY_ID,
                        SFSLINE:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS,
                        SFSLINE:LOB_SUBLINE      = "00", Generic

    If L_CODE_1 <> "" Then
        Begin
        L_CODE = L_CODE_1
        Do ACCESS_AGQEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqPERSONAL:WIND_DEDUCTIBLE <> 0 and
           agqpersonal:hurricane_deductible = 0 Then
            Do ADD_agqEND
        If ((L_ADD_ENDORSEMENT = "N" And
           agqPERSONAL:WIND_DEDUCTIBLE = 0) or
           (l_add_endorsement = "N" and
           agqpersonal:hurricane_deductible <> 0)) Then
            Do DELETE_agqEND
        End

/*    If L_CODE_2 <> "" Then
        Begin
        L_CODE = L_CODE_2
        If agqPERSONAL:YEAR_CONSTRUCTION <> 0 Then
            Begin
            Do CHECK_FOR_UNDER_CONSTRUCTION
            L_NEW_HOME_YEAR = Year(agqpersonal:eff_date) -
                              agqPERSONAL:YEAR_CONSTRUCTION

            If L_NEW_HOME_YEAR > 99 Then
                L_NEW_HOME_YEAR = 99
            If Year(agqpersonal:eff_date) = agqPERSONAL:YEAR_CONSTRUCTION Then
                L_NEW_HOME_YEAR = 1
            L_NEW_YEAR_2 = L_NEW_HOME_YEAR
            L_RECORD_KEY = "NH"
            Access PLSNEWHOMEDISC, Set PLSNEWHOMEDISC:COMPANY_ID = agqpersonal:COMPANY_ID,
                                       PLSNEWHOMEDISC:STATE = agqpersonal:STATE,
                                       PLSNEWHOMEDISC:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS,
                                       PLSNEWHOMEDISC:YEAR = L_NEW_YEAR_2, Generic

            L_NEW_HOME_DISCOUNT = "N"
            Repeat Begin
                Exit If PLSNEWHOMEDISC:RECORD_KEY <> L_RECORD_KEY Or
                        PLSNEWHOMEDISC:COMPANY_ID <> agqpersonal:COMPANY_ID Or
                        PLSNEWHOMEDISC:STATE <> agqpersonal:STATE Or
                        PLSNEWHOMEDISC:LINE_OF_BUSINESS <> agqpersonal:LINE_OF_BUSINESS Or
                        PLSNEWHOMEDISC:YEAR <> L_NEW_YEAR_2

                If agqpersonal:eff_date >= PLSNEWHOMEDISC:rEFF_DATE Then
                    Begin
                    L_NEW_HOME_DISCOUNT = "Y"
                    L_NEW_HOME_DISCOUNT_FACTOR = PLSNEWHOMEDISC:FACTOR
                    End
                Else
                    Begin
                    L_NEW_HOME_DISCOUNT = "N"
                    L_NEW_HOME_DISCOUNT_FACTOR = 0
                    End

                Next PLSNEWHOMEDISC
                End
            End
        Else
            L_NEW_HOME_DISCOUNT = "N"

        Do ACCESS_agqEND
        If (L_ADD_ENDORSEMENT = "Y" And
           L_NEW_HOME_DISCOUNT = "Y" And
           L_NEW_HOME_DISCOUNT_FACTOR < 1.00 And
           L_NEW_HOME_DISCOUNT_FACTOR <> 0 And
           agqpersonal:FORM <> 4 And
           agqpersonal:FORM <> 6 And
           (L_MPL13 = "N" Or
           (L_MPL13 = "Y" And
           agsdefault_plp:MPL13_AND_NEW_HOME_DISCOUNT = 1))) Then
            begin
            Do ADD_agqEND
            end
        If (L_ADD_ENDORSEMENT = "N" And
           (L_NEW_HOME_DISCOUNT = "N" Or
           L_NEW_HOME_DISCOUNT_FACTOR = 0 Or
           L_NEW_HOME_DISCOUNT_FACTOR > 1.00 Or
           (L_MPL13 = "Y" And
           agsdefault_plp:MPL13_AND_NEW_HOME_DISCOUNT = 0) Or
           agqpersonal:FORM = 4 Or
           agqpersonal:FORM = 6)) Then
            Do DELETE_agqEND
        End*/

    If L_CODE_3 <> "" Then
        Begin
        L_CODE = L_CODE_3
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:SEASONAL = "Y" and
           agqpersonal:form not one of 4, 6 Then
            Do ADD_agqEND
        If ((L_ADD_ENDORSEMENT = "N" And
           agqpersonal:SEASONAL = "N") or
           (l_add_endorsement = "N" and
           agqpersonal:form one of 4, 6)) Then
            Do DELETE_agqEND
        End

    If L_CODE_4 <> "" And
       SFSLINE:LOB_CODE = "HOME" Then
        Begin
        L_CODE = L_CODE_4
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:LIABILITY_LIMIT <> 0 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal:LIABILITY_LIMIT = 0 Then
            Do DELETE_agqEND
        End

    If L_CODE_5 <> "" And
       SFSLINE:LOB_CODE = "HOME" and
       l_fpl01_Form = 0 and
       agqpersonal:company_id <> "FLEMINGTON" Then
        Begin
        L_CODE = L_CODE_5
        Do ACCESS_agqEND
        If (L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:WAIVE_SAL01 <> "Y" And
           agqpersonal:eff_date >= L_SAL_EFF_DATE And
           (agqpersonal:FORM one of 3, 5 Or
           agqpersonal:FORM = 4 Or
           agqpersonal:FORM = 6)) Then
            Begin
            access agqpersonal_alias, set agqpersonal_alias:app_no = g_app_no, generic

            if agqpersonal_alias:app_no = g_app_no then
                begin
                Change agqpersonal_alias
                    Begin
                    agqpersonal_alias:WAIVE_SAL01 = "N"
                    end
                End

            Do ADD_agqEND
            do add_agqendorse1
            End
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal:eff_date < L_SAL_EFF_DATE Then
            begin
            Do DELETE_agqEND
            do delete_agqendorse1
            end
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal:FORM <> 3 And
           agqpersonal:form <> 5 and
           agqpersonal:FORM <> 4 And
           agqpersonal:FORM <> 6 Then
            begin
            Do DELETE_agqEND
            do delete_agqendorse1
            end
        End

/*    If L_CODE_5 <> "" And
       SFSLINE:LOB_CODE = "HOME" and
       l_fpl01_Form = 1 Then
        Begin
        L_CODE = L_CODE_5
        Do ACCESS_agqEND
        If (L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:WAIVE_SAL01 <> "Y" And
           agqpersonal:eff_date >= L_SAL_EFF_DATE And
           (agqpersonal:FORM one of 3, 5 Or
           agqpersonal:FORM = 6)) Then
            Begin
            Change agqpersonal
                Begin
                agqpersonal:WAIVE_SAL01 = "N"
                End
            Do ADD_agqEND
            End
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal:eff_date < L_SAL_EFF_DATE Then
            Do DELETE_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal:FORM <> 3 And
           agqpersonal:form <> 5 and
           agqpersonal:FORM <> 6 Then
            Do DELETE_agqEND
        End*/

    If L_CODE_6 <> "" Then
        Begin
        L_MPL49 = "N"
        L_CODE = L_CODE_6
        Do ACCESS_agqEND
        If L_MPL47 = "N" And
           L_MPL49 = "N" and
           agqpersonal:remove_mpl47 = 0 Then
            Begin
            Do ADD_agqEND
            End
        Do CHANGE_CONTENTS
        End

    if l_code_6 <> "" and
       l_code_6 = "MPL49" and
       sfsline:option one of "P", "R" then
        begin
        l_code = l_code_6
        do access_agqend
        if agqpersonal:form one of 5 and
           l_add_endorsement = "N" then
            do delete_agqend
        end

    If L_CODE_7 <> "" Then
        Begin
        if agqpersonal:form one of 3, 4 then
            L_CODE = L_CODE_7
        else
            l_code = "MPL70X"
        Do ACCESS_agqEND
        If ((SFSLINE:OPTION one of "P", "R" and
           L_PLSPREPRINTED_ALARM_FACTOR <> 1.00) or
           (sfsline:option one of "P", "R" and
           agqpersonal:state = 19 and
           sfscompany:boiler_rating = 1)) Then
            Begin
            If L_ADD_ENDORSEMENT = "Y" Then
                Begin
                Do ADD_agqEND
                if l_plspreprinted_alarm_factor <> 1.00 and
                   agqpersonal:company_id <> "FLEMINGTON" then
                    do update_agqpersonal
                End
            End
        If (L_ADD_ENDORSEMENT = "Y" And
           ((sfsline:option one of "S" and
           sfsline:lob_code one of "HOME") or
           sfsline:lob_code one of "DWELLING") and
           (agqpersonal:ALARM_OPTION[1] = 1 Or
           agqpersonal:ALARM_OPTION[2] = 1 Or
           agqpersonal:ALARM_OPTION[3] = 1 Or
           agqpersonal:ALARM_OPTION[4] = 1 Or
           agqpersonal:ALARM_OPTION[5] = 1 Or
           agqpersonal:ALARM_OPTION[6] = 1)) Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" and
           agqpersonal:ALARM_OPTION[1] = 0 And
           agqpersonal:ALARM_OPTION[2] = 0 And
           agqpersonal:ALARM_OPTION[3] = 0 And
           agqpersonal:ALARM_OPTION[4] = 0 And
           agqpersonal:ALARM_OPTION[5] = 0 And
           agqpersonal:ALARM_OPTION[6] = 0 Then
            Do DELETE_agqEND
        End

    If L_CODE_9 <> "" And
       SFSLINE:LOB_CODE = "DWELLING" Then
        Begin
        L_CODE = L_CODE_9
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:LIABILITY_LIMIT <> 0 And
           agqpersonal:LIABILITY_FORM = 1 Then
            Do ADD_agqEND
        If (L_ADD_ENDORSEMENT = "N" And
           (agqpersonal:LIABILITY_LIMIT = 0 Or
           agqpersonal:LIABILITY_FORM <> 1)) Then
            Begin
            Do DELETE_agqEND
            If agqpersonal:LIABILITY_LIMIT = 0 Then
                Begin
                Access agqpersonal_alias, Set agqpersonal_alias:app_no = g_app_no, generic

                If agqpersonal_alias:app_no = g_app_no then
                    begin
                    Change agqpersonal_alias
                       Begin
                       agqpersonal_alias:LIABILITY_FORM = 0
                       End
                    end
                End
            End
        End

    If L_CODE_10 <> "" And
       SFSLINE:LOB_CODE = "DWELLING" Then
        Begin
        L_CODE = L_CODE_10
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" Then
            Begin
            If (agqpersonal:LIABILITY_LIMIT <> 0 And
               agqpersonal:OWNER_OCCUPIED <> "Y" and
               agqpersonal:remove_mdl62 = 0 Or
               (agqpersonal:LIABILITY_LIMIT <> 0 And
               agqpersonal:OWNER_OCCUPIED = "Y" And
               agqpersonal:NO_FAMILIES  > 1 and
               agqpersonal:remove_mdl62 = 0)) Then
                Do ADD_agqEND
            End
        If L_ADD_ENDORSEMENT = "N" Then
            Begin
            If (agqpersonal:LIABILITY_LIMIT = 0 Or
               (agqpersonal:OWNER_OCCUPIED = "Y" And
               agqpersonal:NO_FAMILIES = 1)) Then
                Do DELETE_agqEND
            End
        End

    If L_CODE_11 <> "" And
       SFSLINE:LOB_CODE = "DWELLING" Then
        Begin
        L_CODE = L_CODE_11
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:LIABILITY_LIMIT <> 0 And
           agqpersonal:LIABILITY_FORM = 2 Then
            Do ADD_agqEND
        If (L_ADD_ENDORSEMENT = "N" And
           (agqpersonal:LIABILITY_LIMIT = 0 Or
           agqpersonal:LIABILITY_FORM <> 2)) Then
            Begin
            Do DELETE_agqEND
            If agqpersonal:LIABILITY_LIMIT = 0 Then
                Begin
                Access agqpersonal_alias, Set agqpersonal_alias:app_no = g_app_no, generic

                If agqpersonal_alias:app_no = g_app_no then
                    begin
                    Change agqpersonal_alias
                        Begin
                        agqpersonal_alias:LIABILITY_FORM = 0
                        End
                    end
                End
            End
        End

    If L_CODE_12 <> "" And
       SFSLINE:LOB_CODE = "DWELLING" Then
        Begin
        L_CODE = L_CODE_12
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" Then
            Begin
            If (agqpersonal:LIABILITY_LIMIT <> 0 And
               agqpersonal:OWNER_OCCUPIED  <> "Y" and
               agqpersonal:remove_mdl63 = 0 Or
               (agqpersonal:LIABILITY_LIMIT <> 0 And
               agqpersonal:OWNER_OCCUPIED  = "Y" And
               agqpersonal:NO_FAMILIES  > 1 and
               agqpersonal:remove_mdl63 = 0)) Then
                Do ADD_agqEND
            End
        If L_ADD_ENDORSEMENT = "N" Then
            Begin
            If (agqpersonal:LIABILITY_LIMIT = 0 Or
               (agqpersonal:OWNER_OCCUPIED  = "Y" And
               agqpersonal:NO_FAMILIES = 1)) Then
                Do DELETE_agqEND
            End
        End

    If L_CODE_13 <> "" And
       SFSLINE:LOB_CODE = "DWELLING" Then
        Begin
        L_CODE = L_CODE_13
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:THEFT = 1 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal:THEFT = 0 Then
            Do DELETE_agqEND
        End

    If L_CODE_14 <> "" Then
        Begin
        L_CODE = L_CODE_14
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:LIABILITY_LIMIT <> 0 Then
            begin
            Do ADD_agqEND
            do add_agqendorse1
            end
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal:LIABILITY_LIMIT = 0 Then
            begin
            Do DELETE_agqEND
            do delete_agqendorse1
            end
        End

    If L_CODE_27 <> "" Then
        Begin
        L_CODE = L_CODE_27
        Do ACCESS_agqEND
        If ((L_ADD_ENDORSEMENT = "Y" and
           agqpersonal:dwelling_limit <> 0) or
           (l_add_endorsement = "Y" and
           agqpersonal:contents_limit <> 0)) Then
            begin
            Do ADD_agqEND
            do add_agqendorse1
            end
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal:dwelling_LIMIT = 0 and
           agqpersonal:contents_limit = 0 Then
            begin
            Do DELETE_agqEND
            do delete_agqendorse1
            end
        End

    If L_CODE_28 <> "" Then
        Begin
        L_CODE = L_CODE_28
        Do ACCESS_agqEND
        If ((L_ADD_ENDORSEMENT = "Y" and
           sfsline:lob_code one of "HOME" and
           agqpersonal:seasonal = "N" and
           l_mho45 = "N") or
           (l_add_endorsement = "Y" and
           sfsline:lob_code one of "DWELLING" and
           agqpersonal:owner_occupied = "Y" and
           agqpersonal:seasonal = "N" and
           l_mho45 = "N" and
           agqpersonal:no_families > 2 and
           agqpersonal:contents_limit <> 0 and
           agqpersonal:liability_limit <> 0 and
           agqpersonal:liability_form <> 1)) then
            begin
            Do ADD_agqEND
            do add_agqendorse1
            end
        If ((l_add_endorsement = "N" and
           sfsline:lob_code one of "HOME", "DWELLING" and
           agqpersonal:seasonal = "Y") or
           (l_add_endorsement = "N" and
           sfsline:lob_code one of "HOME", "DWELLING" and
           l_mho45 = "Y") or
           (L_ADD_ENDORSEMENT = "N" And
           sfsline:lob_code one of "DWELLING" and
           agqpersonal:contents_LIMIT = 0) or
           (l_add_endorsement = "N" and
           sfsline:lob_code one of "DWELLING" and
           agqpersonal:liability_limit = 0) or
           (l_add_endorsement = "N" and
           sfsline:lob_code one of "DWELLING" and
           agqpersonal:liability_form = 1) or
           (l_add_endorsement = "N" and
           sfsline:lob_code one of "DWELLING" and
           agqpersonal:no_families < 3) or
           (l_add_endorsement = "N" and
           sfsline:lob_code one of "DWELLING" and
           agqpersonal:owner_occupied not one of "Y")) Then
            begin
            Do DELETE_agqEND
            do delete_agqendorse1
            end
        End

    If L_CODE_20 <> "" And
       SFSLINE:LOB_CODE = "HOME" and
       agqpersonal:state not one of 19 Then
        Begin
        L_CODE = L_CODE_20
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:LIABILITY_LIMIT <> 0 Then
            begin
            Do ADD_agqEND
            end
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal:LIABILITY_LIMIT = 0 Then
            begin
            Do DELETE_agqEND
            end
        End

    If L_CODE_21 <> "" And
       SFSLINE:LOB_CODE = "HOME" Then
        Begin
        L_CODE = L_CODE_21
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:LIABILITY_LIMIT <> 0 and
           agqpersonal:lead_paint_exclusion = 0 Then
            begin
            Do ADD_agqEND
            end
        If ((L_ADD_ENDORSEMENT = "N" And
           agqpersonal:LIABILITY_LIMIT = 0) or
           (l_add_endorsement = "N" and
           agqpersonal:lead_paint_exclusion = 1)) Then
            begin
            Do DELETE_agqEND
            end
        End

    If L_CODE_22 <> "" And
       SFSLINE:LOB_CODE = "HOME" Then
        Begin
        L_CODE = L_CODE_22
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:LIABILITY_LIMIT <> 0 and
           agqpersonal:fungi_mold_exclusion = 0 Then
            begin
            Do ADD_agqEND
            end
        If ((L_ADD_ENDORSEMENT = "N" And
           agqpersonal:LIABILITY_LIMIT = 0) or
           (l_add_endorsement = "N" and
           agqpersonal:fungi_mold_exclusion = 1)) Then
            begin
            Do DELETE_agqEND
            end
        End

    if l_code_23 <> "" and
       agqpersonal:company_id <> "FLEMINGTON" then
        begin
        l_code = l_code_23
        do access_agqend
        if l_add_endorsement = "Y" and
           agsdefault_plp:boiler = 1 and
           agqpersonal:delete_boiler = 0 then
            begin
            do add_agqend
            end
        if ((l_add_endorsement = "N" and
           agsdefault_plp:boiler = 0) or
           (l_add_endorsement = "N" and
           agqpersonal:delete_boiler = 1)) then
            begin
            do delete_agqend
            end
        end

    If L_CODE_24 <> "" Then
        Begin
        L_CODE = L_CODE_24
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:townhouse_units one of 3, 4 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal:townhouse_units not one of 3, 4 Then
            Do DELETE_agqEND
        End

    If L_CODE_25 <> "" Then
        Begin
        L_CODE = L_CODE_25
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:townhouse_units one of 5, 6, 7, 8 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal:townhouse_units not one of 5, 6, 7, 8 Then
            Do DELETE_agqEND
        End

    If L_CODE_26 <> "" Then
        Begin
        L_CODE = L_CODE_26
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:townhouse_units > 8 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal:townhouse_units <= 8 Then
            begin
            Do DELETE_agqEND
            do delete_agqendorse1
            end
        End

    If L_CODE_29 <> "" And
       SFSLINE:LOB_CODE = "HOME" Then
        Begin
        L_CODE = L_CODE_29
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:REMOVE_SAL04 = 0 then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" and
           agqpersonal:remove_sal04 = 1 Then
            Do DELETE_agqEND
        End

    If L_CODE_30 <> "" Then
        Begin
        L_MPL49 = "N"
        L_CODE = L_CODE_30
        Do ACCESS_agqEND
        If L_MPL47 = "N" And
           L_MPL49 = "N" and
           agqpersonal:remove_mpl47 = 0 Then
            Begin
            Do ADD_agqEND
            End
        Do CHANGE_CONTENTS
        End

    If L_CODE_31 <> "" And
       SFSLINE:LOB_CODE = "HOME" Then
        Begin
        L_CODE = L_CODE_31
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:REMOVE_MPL12 = 0 and
           agqpersonal:form not one of 4, 6 then
            Do ADD_agqEND
        If ((L_ADD_ENDORSEMENT = "N" and
           agqpersonal:remove_mpl12 = 1) or
           (l_add_endorsement = "N" and
           agqpersonal:form one of 4, 6)) Then
            Do DELETE_agqEND
        End

    If L_CODE_32 <> "" And
       SFSLINE:LOB_CODE = "HOME" Then
        Begin
        L_CODE = L_CODE_32
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal:owner_occupied <> "Y" and
           agqpersonal:form = 6 then
            begin
            Do ADD_agqEND
            access agqpersonal2_alias, set agqpersonal2_alias:app_no = g_app_no, generic

            if agqpersonal2_alias:app_no = g_app_no then
                begin
                change agqpersonal2_alias
                    begin
                    agqpersonal2_alias:rented_condo = 1
                    end
                end
            end
        If ((L_ADD_ENDORSEMENT = "N" and
           agqpersonal:owner_occupied = "Y") or
           (l_add_endorsement = "N" and
           agqpersonal:form not one of 6)) Then
            begin
            Do DELETE_agqEND
            access agqpersonal2_alias, set agqpersonal2_alias:app_no = g_app_no, generic

            if agqpersonal2_alias:app_no = g_app_no then
                begin
                change agqpersonal2_alias
                    begin
                    agqpersonal2_alias:rented_condo = 0
                    end
                end
            end
        End

    End

--if sfssecurity_rating:auto_screen_jump not one of 1 then
--    FUNCTION = "redisplay"

End

procedure update_agqpersonal
begin
access agqpersonal_alias, set agqpersonal_alias:app_no   = g_app_no, generic

if agqpersonal_alias:app_no = g_app_no then
    begin
    change agqpersonal_alias
        begin
        agqpersonal_alias:alarm_option[5] = 1
        agqpersonal_alias:alarm_factor[5] = 1.00
        agqpersonal_alias:alarm_included  = 1
        end
    end

end

procedure get_sfszipcode
begin
access agqlocation, set agqlocation:app_no = g_app_no, generic

l_val_zipcode = agqlocation:zipcode
l_str_zipcode = agqlocation:str_zipcode[1,5] + "0000"
access sfszipcode, set sfszipcode:company_id       = agqpersonal:company_id,
                       sfszipcode:state            = agqpersonal:state,
                       sfszipcode:line_of_business = agqpersonal:line_of_business,
                       sfszipcode:str_zipcode      = l_str_zipcode, generic

l_tier = 0
while sfszipcode:company_Id       = agqpersonal:company_id and
      sfszipcode:state            = agqpersonal:state and
      sfszipcode:line_of_business = agqpersonal:line_of_business and
      sfszipcode:str_zipcode      = l_str_zipcode
        begin
        if (agqpersonal:eff_date >= sfszipcode:eff_date and
           (agqpersonal:eff_date <= sfszipcode:exp_date or
           sfszipcode:exp_date = 0)) then
            begin
            l_restricted = sfszipcode:restricted
            l_restricted_distance = sfszipcode:restricted_distance
            end

        next sfszipcode
        end

end

procedure update_limits
begin
Access agsdefault_plp, Set agsdefault_plp:COMPANY_ID       = agqpersonal:company_id,
                           agsdefault_plp:state            = agqpersonal:state,
                           agsdefault_plp:agent_no         = agqpersonal:agent_no,
                           agsdefault_plp:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS,
                           agsdefault_plp:form             = agqpersonal:form, generic

if agqpersonal:dwelling_limit <> 0 then
    begin
    agqpersonal:STRUCTURES_LIMIT[1] = (agqpersonal:DWELLING_LIMIT *
                                      (AGSDEFAULT_PLP:COVERAGE_B_PERCENT
                                      Divide 100))
    end
else
    begin
    agqpersonal:structures_limit[1] = 0
    end

if agqpersonal:dwelling_limit <> 0 then
    begin
    L_UPDATED = "N"
    L_CODE = "MPL47"
    Do ACCESS_agqend
    If L_ADD_ENDORSEMENT = "N" Then
        Begin
        Do ACCESS_SFSOPTEND
        L_DEFAULT_CONTENTS_LIMIT = (AGQPERSONAL:DWELLING_LIMIT *
                                   (L_INCREASE_COV_C Divide 100))
        L_UPDATED = "Y"
        End

    L_CODE = "MPL49"
    Do ACCESS_agqend
    If L_ADD_ENDORSEMENT = "N" Then
        Begin
        Do ACCESS_SFSOPTEND
        L_DEFAULT_CONTENTS_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                                   (L_INCREASE_COV_C Divide 100))
        L_UPDATED = "Y"
        End

    If L_ADD_ENDORSEMENT = "Y" And
       L_UPDATED = "N" Then
        Begin
        L_DEFAULT_CONTENTS_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                                   (agsdefault_plp:COVERAGE_C_PERCENT
                                   Divide 100))
        End

    agqpersonal:contents_limit = l_default_contents_limit
    end

If agqPERSONAL:DWELLING_LIMIT <> 0 Then
    agqPERSONAL:LOSS_RENTS_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                                   (agsdefault_plp:COVERAGE_D_PERCENT
                                   Divide 100))
else
    agqPERSONAL:LOSS_RENTS_LIMIT = (agqPERSONAL:CONTENTS_LIMIT *
                                   (agsdefault_plp:COVERAGE_D_PERCENT
                                   Divide 100))
end

Procedure CHECK_FOR_UNDER_CONSTRUCTION
Begin
Access agqend, Set agqend:app_no = agqpersonal:app_no , generic

L_MPL13 = "N"
while agqend:app_no = agqpersonal:app_no
    begin
    If agqend:CODE = "MPL13" Then
        L_MPL13 = "Y"

    Next agqend
    End

End

procedure add_agqendorse1
begin
Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqpersonal:company_id,
                      SFSOPTEND:STATE            = agqpersonal:state,
                      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business,
                      SFSOPTEND:CODE             = L_CODE, Generic

while SFSOPTEND:COMPANY_ID       = agqpersonal:company_id and
      SFSOPTEND:STATE            = agqpersonal:state and
      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business and
      SFSOPTEND:CODE             = L_CODE
    begin
    If (agqpersonal:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqpersonal:eff_date <= sfsoptend:Exp_date or
       sfsoptend:Exp_date = 0)) Then
        Begin
        L_limit = sfsoptend:limit[1]
        End

    Next SFSOPTEND
    End

access agqendorse1, set agqendorse1:app_no   = agqpersonal:app_no,
                        agqendorse1:prem_no  = agqpersonal:prem_no,
                        agqendorse1:build_no = agqpersonal:build_no,
                        agqendorse1:code     = l_code, generic

if agqendorse1:app_no   <> agqpersonal:app_no or
   agqendorse1:prem_no  <> agqpersonal:prem_no or
   agqendorse1:build_no <> agqpersonal:prem_no or
   agqendorse1:code     <> l_code then
    begin
    add agqendorse1
        begin
        agqendorse1:app_no   = agqpersonal:app_no
        agqendorse1:prem_no  = agqpersonal:prem_no
        agqendorse1:build_no = agqpersonal:build_no
        agqendorse1:code     = l_code
        agqendorse1:sub_code = 10
        agqendorse1:limit[1] = l_limit
        end
    end

end

procedure delete_agqendorse1
begin
access agqendorse1, set agqendorse1:app_no   = agqpersonal:app_no,
                        agqendorse1:prem_no  = agqpersonal:prem_no,
                        agqendorse1:build_no = agqpersonal:build_no,
                        agqendorse1:code     = l_code, generic

if agqendorse1:app_no   = agqpersonal:app_no and
   agqendorse1:prem_no  = agqpersonal:prem_no and
   agqendorse1:build_no = agqpersonal:build_no and
   agqendorse1:code     = l_code then
    delete agqendorse1

end

Procedure CHANGE_CONTENTS
Begin
access agqpersonal_alias, set agqpersonal_alias:app_no = g_app_no, generic

if agqpersonal_alias:app_no = g_app_no then
    begin
    L_UPDATED = "N"
    L_CODE = "MPL47"
    Do ACCESS_agqend
    If L_ADD_ENDORSEMENT = "N" Then
        Begin
        Do ACCESS_SFSOPTEND
        Change agqPERSONAL_alias
            Begin
            L_LIMIT = (agqPERSONAL_alias:DWELLING_LIMIT *
                      (L_INCREASE_COV_C Divide 100))
            If agqPERSONAL_alias:CONTENTS_LIMIT < L_LIMIT Then
                agqPERSONAL_alias:CONTENTS_LIMIT = L_LIMIT
            End
        L_UPDATED = "Y"
        End

    L_CODE = "MPL49"
    Do ACCESS_agqend
    If L_ADD_ENDORSEMENT = "N" Then
        Begin
        Do ACCESS_SFSOPTEND
        Change agqPERSONAL_alias
            Begin
            L_LIMIT = (agqPERSONAL_alias:DWELLING_LIMIT *
                      (L_INCREASE_COV_C Divide 100))
            If agqPERSONAL_alias:CONTENTS_LIMIT < L_LIMIT Then
                agqPERSONAL_alias:CONTENTS_LIMIT = L_LIMIT
            End
        L_DEFAULT_CONTENTS_LIMIT = (agqPERSONAL_alias:DWELLING_LIMIT *
                                   (L_INCREASE_COV_C Divide 100))
        L_UPDATED = "Y"
        End

    end

End

Procedure CHANGE_ALARM_FACTOR
Begin
L_CODE = "MPL70"
Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqpersonal:company_id,
                      SFSOPTEND:STATE            = agqpersonal:state,
                      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business,
                      SFSOPTEND:CODE             = L_CODE, Generic

while SFSOPTEND:COMPANY_ID       = agqpersonal:company_id and
      SFSOPTEND:STATE            = agqpersonal:state and
      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business and
      SFSOPTEND:CODE             = L_CODE
    begin
    If (agqpersonal:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqpersonal:eff_date <= sfsoptend:Exp_date or
       sfsoptend:Exp_date = 0)) Then
        Begin
        L_PREMIUM_1 = SFSOPTEND:PREMIUM_1[5]
        End

    Next SFSOPTEND
    End

Access agqPERSONAL_ALIAS, Set agqPERSONAL_ALIAS:app_no = g_app_no, generic

if agqpersonal_alias:app_no = g_app_no then
    begin
    Change agqPERSONAL_ALIAS
        Begin
        agqPERSONAL_ALIAS:ALARM_OPTION[5] = 1
        agqPERSONAL_ALIAS:ALARM_FACTOR[5] = L_PREMIUM_1
        agqPERSONAL_ALIAS:ALARM_INCLUDED  = 0
        end
    End

End

Procedure ACCESS_agqend
Begin
Access agqend, Set agqend:app_no = agqpersonal:app_no, generic

L_ADD_ENDORSEMENT = "Y"
L_MPL47           = "N"
l_mho45           = "N"
while agqend:app_no = agqpersonal:app_no
    begin
    if l_code = "MPL70" and
       agqend:code = "MPL70X" then
        begin
        delete agqend
        l_add_endorsement = "Y"
        end
    else
    if l_code = "MPL70X" and
       agqend:code = "MPL70" then
        begin
        delete agqend
        l_add_endorsement = "Y"
        end
    else
    begin
    If agqend:CODE = L_CODE Then
        L_ADD_ENDORSEMENT = "N"
    If agqend:CODE = "MPL47" Then
        L_MPL47 = "Y"
    If agqend:CODE = "MPL49" Then
        L_MPL49 = "Y"
    if agqend:code = "MHO45" then
        l_MHO45 = "Y"
    end

    Next agqend
    End

Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqpersonal:company_id,
                      SFSOPTEND:STATE            = agqpersonal:state,
                      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business,
                      SFSOPTEND:CODE             = L_CODE, Generic

L_SAL_EFF_DATE = 0
while SFSOPTEND:COMPANY_ID       = agqpersonal:company_id and
      SFSOPTEND:STATE            = agqpersonal:state and
      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business and
      SFSOPTEND:CODE             = L_CODE
    begin
    If (agqpersonal:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqpersonal:eff_date <= sfsoptend:Exp_date or
       sfsoptend:Exp_date = 0)) Then
        Begin
        If SFSOPTEND:CODE one of "SAL01", "FPL01" Then
            L_SAL_EFF_DATE = SFSOPTEND:EFF_DATE
        end

    Next SFSOPTEND
    End

End

Procedure ACCESS_SFSOPTEND
Begin
Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqpersonal:company_id,
                      SFSOPTEND:STATE            = agqpersonal:state,
                      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business,
                      SFSOPTEND:CODE             = L_CODE, Generic

while SFSOPTEND:COMPANY_ID       = agqpersonal:company_id and
      SFSOPTEND:STATE            = agqpersonal:state and
      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business and
      SFSOPTEND:CODE             = L_CODE
    begin
    If (agqpersonal:eff_date >= SFSOPTEND:EFF_DATE and
       (agqpersonal:eff_date <= sfsoptend:exp_date or
       sfsoptend:Exp_date = 0)) Then
        L_INCREASE_COV_C = SFSOPTEND:PREMIUM_1[5]

    Next SFSOPTEND
    End

End

Procedure ADD_agqend
Begin
Access agqend, Set agqend:app_no   = agqpersonal:app_no ,
                   agqend:PREM_NO  = agqPERSONAL:PREM_NO,
                   agqend:BUILD_NO = agqPERSONAL:BUILD_NO, Generic

L_SUB_CODE = 0
while agqend:app_no   = agqpersonal:app_no and
      agqend:PREM_NO  = agqPERSONAL:PREM_NO and
      agqend:BUILD_NO = agqPERSONAL:BUILD_NO
    begin
    L_SUB_CODE = agqend:SUB_CODE

    Next agqend
    End

L_SUB_CODE = L_SUB_CODE + 10
Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqpersonal:company_id,
                      SFSOPTEND:STATE            = agqpersonal:state,
                      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business,
                      SFSOPTEND:CODE             = L_CODE, Generic

l_description  = ""
l_form_edition = ""
while SFSOPTEND:COMPANY_ID       = agqpersonal:company_id and
      SFSOPTEND:STATE            = agqpersonal:state and
      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business and
      SFSOPTEND:CODE             = L_CODE
    begin
    If (agqpersonal:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqpersonal:eff_date <= sfsoptend:exp_date or
       sfsoptend:exp_date = 0)) Then
        Begin
        L_FORM_EDITION = SFSOPTEND:FORM_EDITION
        L_DESCRIPTION  = SFSOPTEND:DESCRIPTION
        End

    Next SFSOPTEND
    End

if l_description <> "" then
    begin
    Add agqend
        Begin
        agqend:app_no               =       agqpersonal:app_no
        agqend:PREM_NO              =       agqPERSONAL:PREM_NO
        agqend:BUILD_NO             =       agqPERSONAL:BUILD_NO
        agqend:SUB_CODE             =       L_SUB_CODE
        agqend:CODE                 =       L_CODE
        agqend:FORM_EDITION         =       L_FORM_EDITION
        agqend:DESCRIPTION          =       L_DESCRIPTION
        end
    End
end


Procedure DELETE_agqend
Begin
Access agqend, Set agqend:app_no = agqpersonal:app_no, generic

while agqend:app_no = agqpersonal:app_no
    begin
    If agqend:CODE = L_CODE Then
        Delete agqend

    Next agqend
    End

End

Procedure GET_DWELLING_TABLE
Begin
L_RECORD_KEY = "TB"
L_COMPANY_ID = agqpersonal:company_id
L_LINE_OF_BUSINESS = agqpersonal:line_of_business
agqpersonal:state = agqpersonal:state
L_OWNER_OCCUPIED = agqPERSONAL:OWNER_OCCUPIED
L_NO_FAMILIES = agqPERSONAL:NO_FAMILIES
L_EFF_DATE = agqpersonal:eff_date

Include "plsdftable.pro"

access agqpersonal_alias, set agqpersonal_alias:app_no = g_app_no, generic

if agqpersonal_alias:app_no = g_app_no then
    begin
    change agqpersonal_alias
        begin
        agqPERSONAL_alias:TABLE   = L_TABLE
        agqpersonal_alias:table_1 = l_table
        end
    end
End

Procedure ACCESS_SFSOPTEND_1
Begin
L_CODE = "MPL70"
Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID = agqpersonal:company_id,
                      SFSOPTEND:STATE = agqpersonal:state,
                      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business,
                      SFSOPTEND:CODE =  L_CODE, Generic

Repeat Begin
    Exit If SFSOPTEND:COMPANY_ID <> agqpersonal:company_id Or
            SFSOPTEND:STATE <> agqpersonal:state Or
            SFSOPTEND:LINE_OF_BUSINESS <> agqpersonal:line_of_business Or
            SFSOPTEND:CODE <> L_CODE

    If agqpersonal:eff_date >= SFSOPTEND:EFF_DATE Then
        Begin
        L_PREMIUM_1 = SFSOPTEND:PREMIUM_1[1]
        L_PREMIUM_2 = SFSOPTEND:PREMIUM_1[2]
        L_PREMIUM_3 = SFSOPTEND:PREMIUM_1[3]
        L_PREMIUM_4 = SFSOPTEND:PREMIUM_1[4]
        L_PREMIUM_5 = SFSOPTEND:PREMIUM_1[5]
        L_PREMIUM_6 = SFSOPTEND:PREMIUM_1[6]
        End

    Next SFSOPTEND
    End

End

procedure back_a_screen
begin
    postevent("agtmt010","REMOVE_SCREEN")

end

Procedure ACCESS_agqend_1
Begin
Access agqend, Set agqend:app_no = G_app_no ,
                   agqend:PREM_NO = 0,
                   agqend:BUILD_NO = 0, Generic

L_ADD_ENDORSEMENT = "Y"
while agqend:app_no = G_app_no and
      agqend:PREM_NO  = 0 and
      agqend:BUILD_NO = 0
    begin
    If agqend:CODE = L_CODE Then
        L_ADD_ENDORSEMENT = "N"

    Next agqend
    End

End

Procedure ADD_agqend_1
Begin
Access agqend, Set agqend:app_no = G_app_no ,
                   agqend:PREM_NO  = 0,
                   agqend:BUILD_NO = 0, Generic

L_SUB_CODE = 0
while agqend:app_no = G_app_no and
      agqend:PREM_NO  = 0 and
      agqend:BUILD_NO = 0
    begin
    L_SUB_CODE = agqend:SUB_CODE

    Next agqend
    End

L_SUB_CODE = L_SUB_CODE + 10

Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqpersonal:company_id,
                      SFSOPTEND:STATE            = agqpersonal:state,
                      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business,
                      SFSOPTEND:CODE             = L_CODE, Generic

while SFSOPTEND:COMPANY_ID       = agqpersonal:company_id and
      SFSOPTEND:STATE            = agqpersonal:state and
      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business and
      SFSOPTEND:CODE             = L_CODE
    begin
    If (agqpersonal:eff_date >= SFSOPTEND:EFF_DATE and
       (agqpersonal:eff_date <= sfsoptend:exp_date or
       sfsoptend:exp_date = 0)) Then
        Begin
        L_FORM_EDITION = SFSOPTEND:FORM_EDITION
        L_DESCRIPTION  = SFSOPTEND:DESCRIPTION
        l_mcp140_limit = sfsoptend:limit[1]
        End

    Next SFSOPTEND
    End

Add agqend
    Begin
    agqend:app_no               =       G_app_no
    agqend:PREM_NO              =       0
    agqend:BUILD_NO             =       0
    agqend:SUB_CODE             =       L_SUB_CODE
    agqend:CODE                 =       L_CODE
    agqend:FORM_EDITION         =       L_FORM_EDITION
    agqend:DESCRIPTION          =       L_DESCRIPTION
    agqend:PREMIUM              =       0
    agqend:lob_end_code         =       "X"
    End

End

Procedure DELETE_agqend_1
Begin
Access agqend, Set agqend:app_no = G_app_no ,
                   agqend:PREM_NO  = 0,
                   agqend:BUILD_NO = 0, Generic

while agqend:app_no = G_app_no and
      agqend:PREM_NO  = 0 and
      agqend:BUILD_NO = 0
    begin
    If agqend:CODE = L_CODE Then
        Delete agqend

    Next agqend
    End

End

procedure check_warning(number l_sub_code_1)
begin
if l_fuel_oil_warning[l_sub_code_1] = 1 and
   agqpersonal:company_id = "FARMERS" then
    l_continue_1 = dialog("WARNING","warning.bmp","Reminder, you cannot bind coverage for an underground oil tank or an abandoned underground oil tank.","OK")

end

procedure check_popup(number l_sub_code_1)
begin
l_popup_complete = 0
access agqapplication, set agqapplication:app_no   = g_app_no,
                           agqapplication:sub_code = l_sub_code_1, generic

if (agqapplication:sub_code = 99 and
   agqapplication:date_of_loss[1] <> 0 and
   agqapplication:loss_description[1] <> "" and
   (agqapplication:reserve_amount[1] <> 0 or
   agqapplication:paid_amount[1] <> 0)) then
    l_popup_complete = 1

end

procedure display_blue(tag l_tag, string l_color, string l_position, string l_display_screen)
begin
if l_position = "Y" and
   l_display_screen <> "" then
    begin
    setproperty(l_tag,foregroundcolor,l_color)
    end
end

procedure display_white(tag l_tag, string l_color, string l_position, string l_display_screen)
begin
setproperty(l_tag,foregroundcolor,l_color)

end

procedure display_red(tag l_tag, string l_color, string l_position, string l_display_screen)
begin
if l_position = "Y" and
   l_display_screen <> "" then
    begin
    if agqpersonal:company_id = "FLEMINGTON" then
        setproperty(l_tag,foregroundcolor,"yellow")
    else
        setproperty(l_tag,foregroundcolor,l_color)
    end
end

procedure display_background_red(tag l_tag, string l_color, string l_position, string l_display_screen)
begin
if l_position = "Y" then
    begin
    setproperty(l_tag,backgroundcolor,l_color)
    end
end

procedure remove_blue(tag l_tag, string l_color, string l_position, string l_display_screen)
begin
if l_position = "N" or
   l_display_screen = "" then
    begin
    setproperty(l_tag,foregroundcolor,l_color)
    end
end

procedure remove_red(tag l_tag, string l_color, string l_position, string l_display_screen)
begin
if l_position = "N" or
   l_display_screen = "" then
    begin
    setproperty(l_tag,foregroundcolor,l_color)
    end
end

procedure clear_popup_information
begin
access agqapplication_alias, set agqapplication_alias:app_no = g_app_no, generic

while agqapplication_alias:app_no = g_app_no
    begin
    if agqapplication_alias:sub_code = 99 then
        begin
        delete agqapplication_alias
        end

    next agqapplication_alias
    end

end

procedure access_agsapplication2
begin
access agsapplication2, set agsapplication2:company_id       = agqpersonal:company_id,
                            agsapplication2:line_of_business = agqpersonal:line_of_business, generic

while agsapplication2:company_id       = agqpersonal:company_id and
      agsapplication2:line_of_business = agqpersonal:line_of_business
        begin
        if agsapplication2:sub_code >= 8 and
           agsapplication2:sub_code <= 10 then
            begin
            l_sub_code_1                     = agsapplication2:sub_code
            l_screen_name[l_sub_code_1]      = agsapplication2:screen_name[1]
            l_screen_name_2[l_sub_code_1]    = agsapplication2:screen_name[2]
            l_literal[l_sub_code_1]          = agsapplication2:literal
            l_the_tag[l_sub_code_1]          = tag(trun(agsapplication2:tag_name))
            l_fuel_oil_warning[l_sub_code_1] = agsapplication2:fuel_oil_warning
            do printguidetext(l_the_tag[l_sub_code_1],trun(l_literal[l_sub_code_1]))
            end

        next agsapplication2
        end

end

procedure printguidetext(tag current_tag, string display_string)
begin
    setproperty(current_tag, text, display_string)
end

procedure access_agsapplication_screen
begin
access agsapplication, set agsapplication2:company_id       = l_company_id,
                           agsapplication2:line_of_business = g_line_of_business,
                           agsapplication2:sub_code         = l_sub_code_1, generic

while agsapplication2:company_id       = l_company_id and
      agsapplication2:line_of_business = g_line_of_business and
      agsapplication2:sub_code         = l_sub_code_1
        begin
        l_screen_name[l_sub_code_1]   = agsapplication2:screen_name[1]
        l_screen_name_2[l_sub_code_1] = agsapplication2:screen_name[2]

        next agsapplication2
        end

end

procedure access_agqapplication
begin
access agqapplication_alias, set agqapplication_alias:app_no = g_app_no, generic

while agqapplication_alias:app_no = g_app_no
    begin
    if agqapplication_alias:answer = "Y" then
        l_answer[agqapplication_alias:sub_code]         = "Y"
    else
    if agqapplication_alias:answer = "N" then
        l_answer[agqapplication_alias:sub_code]         = "N"
    else
        l_answer[agqapplication_alias:sub_code]         = ""
    l_highlight[agqapplication_alias:sub_code]          = agqapplication_alias:highlight_if_yes
    l_print_special_edit[agqapplication_alias:sub_code] = agqapplication_alias:print_special_edit

    next agqapplication_alias
    end

end

procedure update_agqapplication
begin
access agsapplication2, set agsapplication2:company_id       = l_company_id,
                            agsapplication2:line_of_business = g_line_of_business, generic

while agsapplication2:company_id       = l_company_id and
      agsapplication2:line_of_business = g_line_of_business
        begin
        access agqapplication_alias, set agqapplication_alias:app_no   = g_app_no,
                                         agqapplication_alias:sub_code = agsapplication2:sub_code, generic

        if agsapplication2:literal <> "" and
           agsapplication2:sub_code >= 8 and
           agsapplication2:sub_code <= 10 then
            begin
            if agqapplication_alias:app_no   <> g_app_no or
               agqapplication_alias:sub_code <> agsapplication2:sub_code then
                begin
                add agqapplication_alias
                    begin
                    agqapplication_alias:app_no                        = g_app_no
                    agqapplication_alias:sub_code                      = agsapplication2:sub_code
                    agqapplication_alias:literal                       = agsapplication2:literal
                    agqapplication_alias:screen_name_1                 = agsapplication2:screen_name[1]
                    agqapplication_alias:highlight_if_yes              = agsapplication2:highlight_if_yes
                    agqapplication_alias:print_special_edit            = agsapplication2:print_special_edit
                    agqapplication_alias:dont_print_with_app_questions = agsapplication2:dont_print_with_app_questions
                    end
                end
            else
                begin
                change agqapplication_alias
                    begin
                    agqapplication_alias:literal                       = agsapplication2:literal
                    agqapplication_alias:screen_name_1                 = agsapplication2:screen_name[1]
                    agqapplication_alias:highlight_if_yes              = agsapplication2:highlight_if_yes
                    agqapplication_alias:print_special_edit            = agsapplication2:print_special_edit
                    agqapplication_alias:dont_print_with_app_questions = agsapplication2:dont_print_with_app_questions
                    end
                end
            end

        next agsapplication2
        end

end

procedure update_answer
begin
access agqapplication_alias, set agqapplication_alias:app_no   = g_app_no,
                                 agqapplication_alias:sub_code = l_sub_code_1, generic

if agqapplication_alias:app_no   = g_app_no and
   agqapplication_alias:sub_code = l_sub_code_1 then
    begin
    change agqapplication_alias
        begin
        if l_answer[l_sub_code_1] = "Y" then
            agqapplication_alias:answer  = "Y"
        else
        if l_answer[l_sub_code_1] = "N" then
            agqapplication_alias:answer  = "N"
        end

    if l_answer[l_sub_code_1] = "Y" then
        begin
        if l_screen_name[l_sub_code_1] <> "" then
            begin
            g_sub_code = l_sub_code_1
            l_screen = trun(l_screen_name[l_sub_code_1])
            g_literal = trun(l_literal[l_sub_code_1])
            display modal screen trun(l_screen)
            if l_answer[9]  <> "" and
               l_answer[10] <> "" then
                begin
                function = "redisplay"
                abort()
                end
            end
        end
    end

if l_answer[l_sub_code_1] = "N" then
    begin
    do remove_blue(l_the_tag[l_sub_code_1],"black",l_answer[l_sub_code_1],l_screen_name[l_sub_code_1])
    do remove_red(l_the_tag[l_sub_code_1],"black",l_answer[l_sub_code_1],l_screen_name[l_sub_code_1])
    do clear_popup_information
    end

end

procedure display_popup
begin
do update_answer
if l_old_answer[l_sub_code_1] one of "N", "" and
   l_answer[l_sub_code_1] one of "Y" and
   function = "CHANGE" then
    begin
    g_sub_code = l_sub_code_1
    if l_screen_name[l_sub_code_1] <> "" then
        begin
        g_literal = l_literal[l_sub_code_1]
        display modal screen trun(l_screen_name[l_sub_code_1])
--        with initial function "CHANGE|BACK"
        function = "redisplay"
        abort()
        end
    end

end

procedure display_view (number l_sub)
begin
if l_screen_name[l_sub] <> "" and
   l_answer[l_sub] = "Y" then
    begin
    l_screen = l_screen_name[l_sub]
    g_sub_code = l_sub
    g_literal  = trun(l_literal[l_sub])
    display modal screen trun(l_screen)
    function = "redisplay"
    abort()
    end

end

End
