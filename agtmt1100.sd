%%                      
Screen
        Name = "AGTMT1100";
        Type = "Detail" ;
        Highlight=Underscore ;
        Padcharacter=Space ;
        Screensize="dynamic";
        Windowtitle="%a     %s Rating Information - Ver. 7.00     %m";
        Domain="agqpersonal" ;
        resizeable = yes ;
        iconline = 0 ;

        Global Unsigned Ascii Number G_APP_NO[11] ;
        Global Unsigned Ascii Number G_LINE_OF_BUSINESS[4] ;
        Global Unsigned Ascii Number G_OPT[2] ;
        global unsigned ascii number g_add_prem_no[1] ;
        global unsigned ascii number g_add_build_no[1] ;
        global unsigned ascii number g_add_new_quote[1] ;
        global unsigned ascii number g_prem_no[4] ;
        global unsigned ascii number g_build_no[4];
        global unsigned ascii number g_from_search_screen[1] ;
        global unsigned ascii number g_form[1] ;
        global unsigned ascii number g_state[2] ;
        global unsigned ascii number g_protection[2] ;

        global string g_company_id[10] ,
                      g_zipcode_change[1] ,
                      g_initial_screen[50],
                      g_inquiry[1] ;

        rwdate l_sfqname_eff_date;
        wdate  l_rich_date;

        Local Unsigned Ascii Number L_SUB_CODE[4] ,
                                    L_STATE[2],
                                    l_restricted[1]=0,
                                    l_protection[2],
                                    l_new_home_discount_factor[4]=0/dec=3,
                                    l_restricted_distance[5]=0/dec=2,
                                    l_val_zipcode[5],
                                    l_zipcode_5[5],
                                    l_agent_no[4],
                                    l_default_contents_limit[8],
                                    l_county[3],
                                    l_app_no[11],
                                    l_wind_deductible[5],
                                    l_hurricane_deductible[5],
                                    l_tier_1[2],
                                    l_no_units[1],
                                    l_rating_territory[3],
                                    l_loop[4],
                                    l_exclude_terrorism[1]=0,
                                    l_prem_no[4]=0,
                                    l_group[2],
                                    l_table_1[2],
                                    l_binding_limit[8]=0,
                                    l_filed_limit[8]=0,
                                    l_dwelling_limit[8]=0,
                                    l_contents_limit[8]=0,
                                    l_no_years[4]=0,
                                    l_premium_1[8]=0/dec=4,
                                    l_premium_2[8]=0/dec=4,
                                    l_premium_3[8]=0/dec=4,
                                    l_premium_4[8]=0/dec=4,
                                    l_premium_5[8]=0/dec=4,
                                    l_premium_6[8]=0/dec=4,
                                    l_new_home_year[4]=0,
                                    l_new_year_2[2]=0,
                                    l_build_no[4]=0,
                                    l_off_premises_limit[8]=0,
                                    l_mcp140_limit[8],
                                    l_mm[2],
                                    l_yyyy[4],
                                    l_dd[2],
                                    l_territory[3],
                                    l_increase_cov_c[8]=0/dec=4,
                                    l_limit[8],
                                    l_minimum_limit[8],
                                    l_maximum_limit[8],
                                    l_zipcode[9],
                                    l_table[1],
                                    l_nonowned_factor[5]=0/dec=3,
                                    l_no_families[1],
                                    l_building_minimum_limit[8],
                                    l_contents_minimum_limit[8],
                                    l_combined_minimum_limit[8],
                                    l_building_maximum_limit[8],
                                    l_contents_maximum_limit[8],
                                    l_combined_maximum_limit[8],
                                    l_building_binding_limit[8],
                                    l_contents_binding_limit[8],
                                    l_combined_binding_limit[8],
                                    l_plspreprinted_alarm_factor[4]=0/dec=3,
                                    l_fpl01_form[1],
                                    l_min_error[1],
                                    l_max_error[1],
                                    l_binding_error[1],
                                    l_combined_limit[8]=0,
                                    l_rating_territory_group_1[1],
                                    l_rating_territory_group_2[1],
                                    l_rating_territory_group_3[1],
                                    l_group_1[5]=0/dec=3,
                                    l_group_2[5]=0/dec=3,
                                    L_CLASS_CODE[5],
                                    l_restaurant[1],
                                    l_year[4],
                                    l_end_sequence[4],
                                    L_PROPERTY_LIMIT[8]=0,
                                    l_property_limit_1[8]=0,
                                    L_LINE_OF_BUSINESS[2] ,
                                    L_AR_LIMIT[8],
                                    L_COMPUTER_LIMIT[8],
                                    l_csexec_number[12],
                                    i_csexec_number[12],
                                    l_abort_program[1],
                                    L_UTILITY_LIMIT[8],
                                    L_MECHANICAL_LIMIT[8],
                                    L_EXTERIOR_SIGNS_LIMIT[8],
                                    L_EMPLOYEE_LIMIT[8],
                                    L_GLASS_LIMIT[8],
                                    L_SEWER_LIMIT[8],
                                    L_VALUABLE_LIMIT[8],
                                    L_FORM[1] ,
                                    l_tier[2]=0,
                                    l_Form_1[1] ;

        Local String L_DESC[50] ,
                     L_REINSURANCE[1] ,
                     l_filed_message[100],
                     l_sub_line[2],
                     l_record_key[2],
                     l_current_web_page[55],
                     l_web_site_address[150],
                     l_server_name[100],
                     l_owner_occupied[1],
                     l_updated[1],
                     l_hurricane_code[7],
                     l_zip_code_5[5],
                     l_continue_4[2],
                     i_csexec_application[25] ,
                     l_mpl47[1],
                     l_agent_wording[9]="Agent No:",
                     l_mpl49[1],
                     l_printers_credit_wording[23]="Printers Credit:",
                     l_total_printers_wording[23]="Total Printers:",
                     l_mho45[1],
                     l_mpl13[1],
                     l_first[1],
                     l_new_home_discount[1],
                     l_str_zipcode[9]="",
                     l_buyback_option_wording[23]="Buyback Option Charge:",
                     l_fungi_mold_wording[23]="Fungi/Mold Limitations:",
                     l_lob_code[10],
                     l_irpm_wording[12]="IRPM:",
                     l_enter[1],
                     l_minimum_message[200],
                     l_combined_minimum_message[200],
                     l_maximum_message[200],
                     l_combined_maximum_message[200],
                     l_binding_message[200],
                     l_combined_binding_message[200],
                     l_contact_message[200],
                     l_mp_wording[4]="M.P.",
                     l_continue_1[3]="",
                     l_continue_2[3]="",
                     l_continue_3[3]="",
                     l_dec[15]="",
                     l_app[3]="agq",
                     L_CODE[7],
                     L_CODE_1[7],
                     L_CODE_2[7],
                     L_CODE_3[7],
                     L_CODE_4[7],
                     L_CODE_5[7],
                     L_CODE_6[7],
                     L_CODE_7[7],
                     L_CODE_8[7],
                     l_code_9[7],
                     l_code_10[7],
                     l_code_11[7],
                     l_code_12[7],
                     l_code_13[7],
                     l_code_14[7],
                     l_code_15[7],
                     l_code_16[7],
                     l_code_17[7],
                     l_code_18[7],
                     l_code_19[7],
                     l_code_20[7],
                     l_code_21[7],
                     l_code_22[7],
                     l_code_23[7],
                     l_code_24[7],
                     l_code_25[7],
                     l_code_26[7],
                     l_code_27[7],
                     l_code_28[7],
                     l_code_29[7],
                     l_code_30[7],
                     l_csexec_application[25],
                     l_processing_system[30],
                     l_rating_system[40],
                     l_territory_wording[10]="Territory:",
                     l_system_id[15],
                     L_SCREEN[15] ,
                     l_screen_1[9],
                     L_FORM_EDITION[18],
                     L_DESCRIPTION[55],
                     L_COMPUTER_DESC[50] ,
                     L_DELETE_NONOWNED_HIRED[1]="N",
                     L_ADD_ENDORSEMENT[1]="Y",
                     L_PROPERTY_LIMIT_CHANGE[1]="N",
                     l_sfqname_str[10],
                     L_COMPANY_ID[10] ;

        local wdate l_eff_date ,
                    l_sal_eff_date ;

        include "print.var"

        include "virtualdecs.var"

        Access agqpersonal,
           Set agqpersonal:app_no = G_app_no, generic

        Include "stdkeys7.inc"

Style Definition
        Include "styles.inc"
        Displayonly Field Style {
                                  backgroundcolor="#CCCCCC"
                                }


Functions

--        "redisplay" display/noreturn "agtmt010" ;

        "add" sequence "new"      tagged add_fn ;
        "new" add/hidden/autoupdate ;

        "change" sequence "chg"   tagged change_fn ;
        "chg" change/hidden/autoupdate ;

        "func1" display "agtmt1200"   tagged calc_fn ;

        "back" display/noreturn "agtmt001" tagged back_fn ;
         reaccess ;

        include "stdfunc7b.inc"

EVENT DEFINITION
        default eventhandler {
                             "REMOVE_SCREEN" { function = "exit" abort () }
                             "reload" { function = "reaccess" abort () }
                             "display_message" { warning "" + event.value }
                             "current_line_of_business" {
                                                          g_line_of_business = val(event.value)
                                                        }
                             }
Menu Definition

Toolbar Definition

Screen Entry
access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

disable(accept_fn)
g_initial_screen = ""
l_username = username
l_company_id = sfsdefault:company_id
access sfsemail, set sfsemail:company_id = l_company_id,
                     sfsemail:user_id    = l_username, generic

access sfsline, set sfsline:company_id = l_company_id,
                    sfsline:line_of_business = g_line_of_business,
                    sfsline:lob_subline      = "00", generic

switch(g_line_of_business)
  case 1, 31  : switch(g_form)
                  case 1  : setproperty(t_mdw1,iconname,"title_cd_basic_mdw1.bmp")
                  case 2  : setproperty(t_mdw2,iconname,"title_cd_broad_mdw2.bmp")
                  case 3  : setproperty(t_mdw3,iconname,"title_cd_special_mdw3.bmp")
                  case 6  : setproperty(t_mdw6,iconname,"title_cd_condo_mdw6.bmp")
                  default : begin
                            setproperty(t_mdw1,iconname,"")
                            setproperty(t_mdw2,iconname,"")
                            setproperty(t_mdw3,iconname,"")
                            setproperty(t_mdw6,iconname,"")
                            end
                  end
  case 4, 34  : switch(g_form)
                  case 3  : setproperty(t_mho3,iconname,"title_ho_std_mho3.bmp")
                  case 4  : setproperty(t_mho4,iconname,"title_rent_pers_prop_mho4.bmp")
                  case 6  : setproperty(t_mho6,iconname,"title_ho_condo_mho6.bmp")
                  default : begin
                            setproperty(t_mho3,iconname,"")
                            setproperty(t_mho4,iconname,"")
                            setproperty(t_mho6,iconname,"")
                            end
                  end
  case 14, 44 : switch(g_form)
                  case 3  : setproperty(t_pref_mho3,iconname,"title_ho_preferred_mho3.bmp")
                  case 5  : setproperty(t_pref_mho5,iconname,"title_ho_preferred_mho5.bmp")
                  default : begin
                            setproperty(t_pref_mho3,iconname,"")
                            setproperty(t_pref_mho5,iconname,"")
                            end
                  end
  case 24, 54 : switch(g_form)
                  case 3  : setproperty(t_prem_mho3,iconname,"title_ho_premier_mho3.bmp")
                  default : setproperty(t_prem_mho3,iconname,"")
                  end
  end

access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

if sfsdefault:company_id one of "FLEMINGTON" then
    hide(farmers_fn)
else
if sfsdefault:company_id one of "FARMERS" then
    hide(ficof_fn)

if g_inquiry <> "Y" then
    g_inquiry = "N"

if g_inquiry = "N" and
   function <> "redisplay" then
    do update_endorsements

if l_company_id <> "FARMERS" then
    hide(farmers_fn)

if g_form = 6 then
    hide(dwelling_fn)

l_username = username
access sfsprofile,
   set sfsprofile:user_id  = l_username, exact

If SFSPROFILE:USER_ID <> L_USERNAME Then
  Begin
    L_USERNAME = "default"
    Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact
  End

l_server_name = sfsprofile:UNIX_SERVER

if l_company_id = "FLEMINGTON" then
    begin
    if agqpersonal:app_no = 0 then
        begin
        l_current_web_page = "01webhelp_agtmt1100_scr_rating_info_no_app_num.htm"
        do change_current_browser(l_server_name,l_current_web_page)
        end
    else
        begin
        l_current_web_page = "10webhelp_agtmt1100_scr_rating_info_yes_app_num.htm"
        do change_current_browser(l_server_name,l_current_web_page)
        end
    end

access agqname, set agqname:app_no = g_app_no, generic

if agqname:quote_no <> 0 then
    begin
    disable(add_fn)
    disable(change_fn)
    disable(delete_fn)
    disable(accept_fn)
    end

if agqpersonal:app_no = g_app_no and
   g_app_no <> 0 then
    disable(add_fn)

screen at 1,1 to 30,100
    Properties
          {
          Layouttype = screen
          transparent = False
          backgroundcolor = "#ADD8E6"
          scrollbarpolicy = asneeded
          }
    {

    Panel at 1,1 to 2,100
        Properties
            {
            layouttype = screen
            }
        {
        components
            guidetext at 1,1 to 2,40
                properties
                    {
                    iconname = "qp_logo.gif"
                    }
            guidetext at 1,83 to 2,100 tagged ficof_fn
                properties
                    {
                    iconname = "ficof_logo.gif"
                    }
            guidetext at 1,80 to 2,100 tagged farmers_fn
                properties
                    {
                    iconname = "salem_logo.gif"
                    }
            guidetext at 1.30,32 tagged t_mdw1
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_mdw2
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_mdw3
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_mdw6
                Properties
                   {
                   iconname = ""
                   }

            guidetext at 1.30,35 tagged t_mho3
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,28 tagged t_mho4
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_mho6
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_pref_mho3
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_pref_mho5
                Properties
                   {
                   iconname = ""
                   }
            guidetext at 1.30,32 tagged t_prem_mho3
                Properties
                   {
                   iconname = ""
                   }
        }

panel at 3,1 to 4,100
    Properties
        {
        LayoutType = screen
        backgroundcolor = "Grey"
        transparent = False
        }
    {
    components
        guidetext at 1.45,1 to 1.45,40     tagged display_information_box
            properties
                {
                text = "Rating Information..."
                fontsize = 18
                fontstyle = BOLD
                fontname = "arial"
                transparent = False
                backgroundcolor = "Grey"
                }

    }

Panel at 3.45,75 to 4.45, 100
    Properties
        {
        LayoutType = screen
        }
{
%%
App No: ___________

%%

fields
101     begin
        if g_form = 0 then
            g_form = agqpersonal:form

        l_username = username
        l_company_id = sfsdefault:company_id
        access sfsemail, set sfsemail:company_id = l_company_id,
                             sfsemail:user_id    = l_username, generic

        l_agent_no = sfsemail:agent_no
        if l_agent_no = 0 then
            begin
            l_agent_no = 9999
            end

        l_company_id = sfsdefault:company_id
        access sfsagent, set sfsagent:company_id = l_company_id,
                             sfsagent:agent_no   = l_agent_no, generic

        l_state      = sfsagent:state
        Access agsdefault_plp, Set agsdefault_plp:COMPANY_ID       = L_COMPANY_ID,
                                   agsdefault_plp:state            = l_state,
                                   agsdefault_plp:agent_no         = l_agent_no,
                                   agsdefault_plp:LINE_OF_BUSINESS = G_LINE_OF_BUSINESS,
                                   agsdefault_plp:form             = g_form, generic

        if function one of "ADD", "NEW" then
            begin
            do access_sfscsexec
            agqpersonal:app_no           = i_csexec_number
            g_app_no                     = i_csexec_number
            l_app_no                     = i_csexec_number
            agqpersonal:prem_no          = 1
            agqpersonal:build_no         = 1
            g_prem_no                    = agqpersonal:prem_no
            g_build_no                   = agqpersonal:build_no
            agqpersonal:COUNTY           = agsdefault_plp:COUNTY
            agqpersonal:entry_date       = todaysdate
            agqpersonal:state            = l_state
            agqpersonal:company_id       = sfsdefault:company_id
            agqpersonal:deductible       = agsdefault_plp:deductible
            agqpersonal:no_families      = 1
            if agqpersonal:company_id = "FLEMINGTON" then
                agqpersonal:owner_occupied = "Y"
            else
                agqpersonal:owner_occupied = "N"
            agqpersonal:seasonal         = "N"
            agqpersonal:line_of_business = g_line_of_business
            agqpersonal:agent_no         = l_agent_no
            agqpersonal:form             = g_form
            agqpersonal:liability_limit  = agsdefault_plp:coverage_e
            agqpersonal:medical_limit    = agsdefault_plp:coverage_f
            end
        end
        agqpersonal:APP_NO/displayonly ;

}

Panel at 5,1 to 6,100 Tagged icon_line2_tg
Properties
        {
          LayoutType = screen
--          Transparent = False
--          backgroundcolor = "#ADD8E6"
        }
{
Components

        Button at 1.5,20   tagged add_fn
        Properties {
                Iconname = "btn_start_proposal.bmp"
                }
        Events  {
                Action = add_fn
                }

        Button at 1.5,60    tagged change_fn
        Properties {
                Iconname = "btn_edit_entries.bmp"
                }
        Events  {
                Action = change_fn
                }

    }

    Panel at 5,94 to 6,96 tagged button_panel
        Properties
            {
            layouttype = column
            }
        {
        Components
            Button to 1,1
                properties
                    {
                    Iconname = "btn_print_screen.bmp"
                    }
                events
                    {
                    action
                        {
                        function = "print"
                        abort()
                        }
                    }
        }

   Panel at 6.45,91
        Properties
            {
            layouttype = column
            }
      {
        Components
            guidetext to 1,1
                properties
                    {
                      text = "agtmt1100.sd"
                      fontsize = 9
                    }
      }

/*Panel at 5,1 to 7,100 Tagged location
    Properties
        {
        LayoutType = screen
        }
    {
    Components
        guidetext at 1.5,24 to 2.5,36
            properties
                {
                text = "Location No:"
                fontsize = 12
                fontname = "arial"
                }
        guidetext at 1.5,44 to 2.5,56
            properties
               {
               text = "Building No:"
               fontsize = 12
               fontname = "arial"
               }
    }

Panel at 7.5,33 to 9,60 Tagged rating_pl
{
%%
____                ____

%%

components

fields
101   agqpersonal:prem_no/displayonly ;
102   agqpersonal:build_no/displayonly ;

} */

Panel at 8,70 to 8,100
      Properties
         {
           layouttype = row
--           layoutconstraints = "Center"
         }
    {
      Components
        Button at 1,55 tagged accept_fn
          properties
            {
              Iconname = "btn_accept_edits.bmp"
            }
          Events  {
                    mouseclicked = accept
                  }

    }

Panel at 9,1 to 24,100
    Properties
        {
        LayoutType = screen
        }
    {
    Components
        guidetext at 2,1 to 2,22
            properties
                {
                text = "Insured's Name:"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
        guidetext at 3,1 to 3,22
            properties
                {
                text = "Eff Date:"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
        guidetext at 4,1 to 4,22
            properties
                {
                text = "Location Zip Code:"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
        guidetext at 6,1 to 6,22
            properties
                {
                text = "Rating Territory:"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
        guidetext at 7,1 to 7,22
            properties
                {
                text = "Construction:"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
        guidetext at 8,1 to 8,22
            properties
                {
                text = "Protection:"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
        guidetext at 9,1 to 9,22
            properties
                {
                text = "Year Of Construction:"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
        guidetext at 10,1 to 10,22
            properties
                {
                text = "Owner Occupied:"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
        guidetext at 12,1 to 12,22 tagged dwelling_fn
            properties
                {
                text = "Dwelling Limit:"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
        guidetext at 13,1 to 13,22
            properties
                {
                text = "Personal Property:"
                fontsize = 12
                contentalignment = right
                fontname = "arial"
                }
        }

Panel at 9,24 to 24, 100
{
%%

___________________________________________________
____________              _________  ____
____________

___  ________________________________________________
___  ________________________________________________
___  ________________________________________________
____
~~_  Townhouse/Row House:~~_  Units Between Firewalls: __

__________                  Actual Cash Value (MPL53):~~_
__________
%%

components

fields
201     begin
        if agqpersonal:app_no = g_app_no and
           g_app_no <> 0 then
            disable(add_fn)

        if function one of "ADD", "NEW", "CHG", "CHANGE" then
            begin
            enable(accept_fn)
            disable(calc_fn)
            end
        else
            begin
            disable(accept_fn)
            enable(calc_fn)
            end

        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "02webhelp_agtmt1100_tbx_insured_name.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end

        end
        agqpersonal:business_name[1]/tabstop/uppercase/default ;
301     begin
        if function one of "ADD", "NEW" then
            agqpersonal:eff_date = todaysdate
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "03webhelp_agtmt1100_tbx_eff_date.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        end
        agqpersonal:eff_date/tabstop/default mandatory
        if agqpersonal:eff_date < todaysdate - 30 then
            error "The effective date can not be more than 30 days from todaysdate"

        if month(agqpersonal:eff_date) = 02 and
           day(agqpersonal:eff_date) = 29 and
           sfsemail:agent_no <> 0 then
            error "Please change your effective date to 2-28"

        agqpersonal:exp_date = dateadd(agqpersonal:eff_date,0,1) ;
302     l_agent_wording/displayonly/showasguidetext tagged ficof_fn
        hide if sfsemail:agent_No <> 0 ;
303     begin
        access sfsagent_alias, set sfsagent_alias:company_id = agqpersonal:company_id, generic

        end
        agqpersonal:agent_no/showasguidetext/default  tagged ficof_fn
        hide if sfsemail:agent_no <> 0
        access sfsagent, set sfsagent:company_id = agqpersonal:company_id,
                             sfsagent:agent_no = agqpersonal:agent_no, generic

        if agqpersonal:agent_no <> sfsagent:agent_No then
            error "Invalid Agent No"

        activehelp sfsagent_alias:agent_no,
                   sfsagent_alias:name[1] ;

401     begin
            l_zip_code_5 = agqpersonal:str_zipcode[1,5]
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "04webhelp_agtmt1100_tbx_zip_code.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        end
        agqpersonal:str_zipcode/tabstop mandatory
        if agqpersonal:str_zipcode[1,5] one of "0", "00000" then
            error "You must enter a valid zip code"

        if ((agqpersonal:state = 29 and
           agqpersonal:str_zipcode[1] <> "0") or
           (agqpersonal:state = 19 and
           agqpersonal:str_zipcode[1] <> "2") or
           (agqpersonal:state = 37 and
           agqpersonal:str_zipcode[1] <> "1")) then
            error "Invalid zip code entered"

        if agqpersonal:str_zipcode[1] not one of "0","1","2","3","4","5","6","7","8","9" then
            error "Invalid zip code entered"

        if agqpersonal:str_zipcode[2] not one of "0","1","2","3","4","5","6","7","8","9" then
            error "Invalid zip code entered"

        if agqpersonal:str_zipcode[3] not one of "0","1","2","3","4","5","6","7","8","9" then
            error "Invalid zip code entered"

        if agqpersonal:str_zipcode[4] not one of "0","1","2","3","4","5","6","7","8","9" then
            error "Invalid zip code entered"

        if agqpersonal:str_zipcode[5] not one of "0","1","2","3","4","5","6","7","8","9" then
            error "Invalid zip code entered"

        access sfscompany, set sfscompany:company_id = agqpersonal:company_id, exact

        access sfsline, set sfsline:company_id       = agqpersonal:company_id,
                            sfsline:line_of_business = agqpersonal:line_of_business,
                            sfsline:lob_subline      = l_sub_line, exact

        if sfscompany:TERRITORY_ZIPCODE  = 1 and
           sfsline:lob_code one of "HOME" then
            begin
            l_val_zipcode = val(agqpersonal:str_zipcode[1,5])
            l_sub_line = "00"
            L_LOB_CODE         = SFSLINE:LOB_CODE
            l_company_id       = agqpersonal:company_id
            l_line_of_business = agqpersonal:line_of_business
            access sfsterritory1, set sfsterritory1:company_id       = agqpersonal:company_id,
                                      sfsterritory1:state            = agqpersonal:state,
                                      sfsterritory1:line_of_business = agqpersonal:line_of_business,
                                      sfsterritory1:zipcode          = l_val_zipcode,generic

            if agqpersonal:str_zipcode[1,5] <> sfsterritory1:str_zipcode[1,5] then
                error "MUST enter a valid zipcode"
            end

        if agqpersonal:company_id = "FARMERS" then
            begin
            do get_sfszipcode
            if l_restricted = 1 then
                begin
                l_continue_1 = dialog("Warning","warning.bmp","This risk is located in a coastal restrictive zip code and cannot be bound or quoted","OK")
                abort()
                end
            else
            if l_restricted_distance <> 0 then
                begin
                l_continue_1 = dialog("Warning","warning.bmp","You have entered a Zip Code which includes distance to coast eligibility. Please verify distance meets our coastal eligibility before continuing with quote.","OK")
                end
            end

        if agqpersonal:zipcode[1,5] <> l_zipcode_5 then
            g_zipcode_change = "Y" ;
401     Begin
        If agqpersonal:STR_ZIPCODE[6,9] = "" Then
             agqpersonal:STR_ZIPCODE[6,9] = "0000"
        End
        agqpersonal:STR_ZIPCODE/displayonly/mask="XXXXX-XXXX";

/*601     begin
        if function one of "ADD", "NEW" then
            begin
            agqpersonal:county = agsdefault_plp:county
            end
        end
        agqpersonal:COUNTY/default/tabstop
        if agqpersonal:county <> sfsstate_alias:county or
           agqpersonal:county = 0 then
            error 1222

        activehelp sfsstate_alias:county,
                   sfsstate_alias:description ;
602     sfsstate_alias:description ;*/
601     Begin
        l_eff_date = agqpersonal:eff_date
        g_state    = agqpersonal:state
        If FUNCTION one of "ADD", "NEW" and
           agqpersonal:county = 0 Then
            begin
            agqPERSONAL:COUNTY = agsdefault_plp:COUNTY
            end
        access sfsterritory_alias, set sfsterritory_alias:company_id       = agqpersonal:company_id,
                                       sfsterritory_alias:state            = agqpersonal:state,
                                       sfsterritory_alias:line_of_business = agqpersonal:line_of_business, generic

        if sfssecurity_rating:auto_activehelp = 1 and
           function one of "ADD", "NEW" then
            activehelp()
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "05webhelp_agtmt1100_dbx_rating_terr.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        End
        agqPERSONAL:COUNTY/default/tabstop
        access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                 sfsterritory:state            = agqpersonal:state,
                                 sfsterritory:line_of_business = agqpersonal:line_of_business,
                                 sfsterritory:county           = agqpersonal:county, generic

        If agqPERSONAL:COUNTY <> SFSTERRITORY:COUNTY or
           agqpersonal:county = 0 Then
            Error 1222

        Activehelp if ((l_eff_date >= sfsterritory_alias:eff_date and
                      l_eff_date <= sfsterritory_alias:exp_date and
                      sfsterritory_alias:hide_description = 0) or
                      (l_eff_date >= sfsterritory_alias:eff_date and
                      sfsterritory_alias:exp_date = 0 and
                      sfsterritory_alias:hide_description = 0)) then
                       SFSTERRITORY_ALIAS:COUNTY
                   else
                       null,
                   if ((l_eff_date >= sfsterritory_alias:eff_date and
                      l_eff_date <= sfsterritory_alias:exp_date and
                      sfsterritory_alias:hide_description = 0) or
                      (l_eff_date >= sfsterritory_alias:eff_date and
                      sfsterritory_alias:exp_date = 0 and
                      sfsterritory_alias:hide_description = 0)) then
                       SFSTERRITORY_ALIAS:DESCRIPTION
                   else
                       null ;
601     begin
        access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                 sfsterritory:state            = agqpersonal:state,
                                 sfsterritory:line_of_business = agqpersonal:line_of_business,
                                 sfsterritory:county           = agqpersonal:county, generic

        if sfsterritory:county_have_city = 1 then
            begin
--            l_continue_1 = dialog("warning","question.bmp","The county you have selected also has cities listed in the activehelp please review the list to make sure you have the correct county/city selected","OK")
            activehelp()
            end
        end
        agqpersonal:county/default/tabstop
        hide if sfsterritory:county_have_city = 0
        access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                 sfsterritory:state            = agqpersonal:state,
                                 sfsterritory:line_of_business = agqpersonal:line_of_business,
                                 sfsterritory:county           = agqpersonal:county, generic

        If agqPERSONAL:COUNTY <> SFSTERRITORY:COUNTY or
           agqpersonal:county = 0 Then
            Error 1222

        Activehelp if ((l_eff_date >= sfsterritory_alias:eff_date and
                      l_eff_date <= sfsterritory_alias:exp_date and
                      (sfsterritory_alias:city_county = agqpersonal:county or
                      sfsterritory_alias:county = agqpersonal:county)) or

                      (l_eff_date >= sfsterritory_alias:eff_date and
                      sfsterritory_alias:exp_date = 0 and
                      (sfsterritory_alias:city_county = agqpersonal:county or
                      sfsterritory_alias:county = agqpersonal:county))) then
                       SFSTERRITORY_ALIAS:COUNTY
                   else
                        null/width=6,

                   if ((l_eff_date >= sfsterritory_alias:eff_date and
                      l_eff_date <= sfsterritory_alias:exp_date and
                      (sfsterritory_alias:city_county = agqpersonal:county or
                      sfsterritory_alias:county = agqpersonal:county)) or

                      (l_eff_date >= sfsterritory_alias:eff_date and
                      sfsterritory_alias:exp_date = 0 and
                      (sfsterritory_alias:city_county = agqpersonal:county or
                      sfsterritory_alias:county = agqpersonal:county))) then
                       SFSTERRITORY_ALIAS:DESCRIPTION
                   else
                       null/width=60 ;

602     begin
        access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                 sfsterritory:state            = agqpersonal:state,
                                 sfsterritory:line_of_business = agqpersonal:line_of_business,
                                 sfsterritory:county           = agqpersonal:county, generic
        end
        SFSTERRITORY:DESCRIPTION;

701     Begin
        If FUNCTION one of "ADD", "NEW" Then
            Begin
            access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                     sfsterritory:state            = agqpersonal:state,
                                     sfsterritory:line_of_business = agqpersonal:line_of_business,
                                     sfsterritory:county           = agqpersonal:county, generic

            while sfsterritory:company_id       = agqpersonal:company_id and
                  sfsterritory:state            = agqpersonal:state and
                  sfsterritory:line_of_business = agqpersonal:line_of_business and
                  sfsterritory:county           = agqpersonal:county
                begin
                if (agqpersonal:eff_date >= sfsterritory:eff_date and
                   (agqpersonal:eff_date <= sfsterritory:exp_date or
                   sfsterritory:exp_date = 0)) then
                    begin
                    agqPERSONAL:TERRITORY = SFSTERRITORY:TERRITORY
                    Switch(agqPERSONAL:STATE)
                      Case 37 : Begin
                                Switch(agqPERSONAL:FORM)
                                  Case 2  : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[1]
                                  Case 4  : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[3]
                                  Case 6  : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[4]
                                  Default : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[2]
                                  End
                                End
                      Default : Begin
                                agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[1]
                                End
                      End
                    If SFSLINE:LOB_CODE <> "DWELLING" Then
                        begin
                        agqPERSONAL:TABLE   = SFSTERRITORY:TERRITORY_GROUP[1]
                        agqpersonal:table_1 = sfsterritory:territory_group[1]
                        end
                    end

                next sfsterritory
                end
            end

        If FUNCTION one of "CHANGE", "CHG" Then
            Begin
            access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                     sfsterritory:state            = agqpersonal:state,
                                     sfsterritory:line_of_business = agqpersonal:line_of_business,
                                     sfsterritory:county           = agqpersonal:county, generic

            while sfsterritory:company_id       = agqpersonal:company_id and
                  sfsterritory:state            = agqpersonal:state and
                  sfsterritory:line_of_business = agqpersonal:line_of_business and
                  sfsterritory:county           = agqpersonal:county
                begin
                if (agqpersonal:eff_date >= sfsterritory:eff_date and
                   (agqpersonal:eff_date <= sfsterritory:exp_date or
                   sfsterritory:exp_date = 0)) then
                    begin
                    agqPERSONAL:TERRITORY = SFSTERRITORY:TERRITORY
                    Switch(agqPERSONAL:STATE)
                      Case 37 : Begin
                                Switch(agqPERSONAL:FORM)
                                  Case 2  : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[1]
                                  Case 4  : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[3]
                                  Case 6  : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[4]
                                  Default : agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[2]
                                  End
                                End
                      Default : Begin
                                agqPERSONAL:GROUP = SFSTERRITORY:TERRITORY_GROUP[1]
                                End
                      End
                    If SFSLINE:LOB_CODE <> "DWELLING" Then
                        begin
                        agqPERSONAL:TABLE   = SFSTERRITORY:TERRITORY_GROUP[1]
                        agqPERSONAL:TABLE_1 = SFSTERRITORY:TERRITORY_GROUP[1]
                        end
                    end

                next sfsterritory
                end
            end

        agqPERSONAL:INFLATION_GUARD = agsdefault_plp:INFLATION_GUARD

        If FUNCTION one of "ADD", "NEW" Then
            agqpersonal:CONSTRUCTION = agsdefault_plp:CONSTRUCTION
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "06webhelp_agtmt1100_dbx_construction.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        End
        agqpersonal:CONSTRUCTION/default/tabstop
        If agqpersonal:CONSTRUCTION <> SFSCONSTRUCTION:CONSTRUCTION Or
           agqpersonal:CONSTRUCTION = 0 Then
            Error 1203

        Activehelp SFSCONSTRUCTION_ALIAS:CONSTRUCTION,
                   SFSCONSTRUCTION_ALIAS:DESCRIPTION ;
702    SFSCONSTRUCTION:DESCRIPTION;

801     Begin
        l_eff_date = agqpersonal:eff_date
        If FUNCTION one of "ADD", "NEW" Then
            agqpersonal:PROTECTION = agsdefault_plp:PROTECTION
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "07webhelp_agtmt1100_dbx_protection.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        End
        agqpersonal:PROTECTION/default/tabstop
        If agqpersonal:PROTECTION <> SFSPROTECTION:PROTECTION Or
           agqpersonal:PROTECTION = 0 Then
            Error 1204

        if agqpersonal:protection = 4 and
           agqpersonal:eff_date < sfsprotection:eff_date then
            error "The Suburban Rating Plan is not available until August 1, 2009"

        if agqpersonal:protection <> l_protection and
           agqpersonal:protection = 4 then
            begin
            g_company_id = agqpersonal:company_id
            g_state = agqpersonal:state
            g_line_of_business = agqpersonal:line_of_business
            g_protection = agqpersonal:protection
            display modal screen "agtmt1000f"
            l_continue_1 = dialog("Warning","question.bmp","Has all criteria been met for the Suburban Rating Plan?","Yes","No")
            if l_continue_1 = "No" then
                error "Please change the protection entered"
            end

        if agqpersonal:protection = 4 and
           agqpersonal:seasonal = "Y" then
            agqpersonal:seasonal = "N"

        Activehelp if l_eff_date >= sfsprotection_alias:eff_date or
                      sfsprotection_alias:eff_date = 0 then
                       SFSPROTECTION_ALIAS:PROTECTION
                   else
                       null/width=10,
                   if l_eff_date >= sfsprotection_alias:eff_date or
                      sfsprotection_alias:eff_date = 0 then
                       SFSPROTECTION_ALIAS:DESCRIPTION
                   else
                       null/width=50 ;
802     sfsprotection:description ;

901     begin
        if g_inquiry = "N" then
            begin
            Do ACCESS_SFSOPTEND_1

            if function one of "ADD", "NEW", "CHANGE", "CHG" then
                begin
                access plspreprinted, set plspreprinted:company_id       = agqpersonal:company_id,
                                          plspreprinted:state            = agqpersonal:state,
                                          plspreprinted:line_of_business = agqpersonal:line_of_business, generic

                while plspreprinted:record_key       = "PF" and
                      plspreprinted:company_id       = agqpersonal:company_id and
                      plspreprinted:state            = agqpersonal:state and
                      plspreprinted:line_of_business = agqpersonal:line_of_business
                        begin
                        if agqpersonal:eff_date >= plspreprinted:reff_date then
                            l_plspreprinted_alarm_factor = plspreprinted:alarm_factor

                        next plspreprinted
                        end

                access sfscompany, set sfscompany:company_id = agqpersonal:company_id, generic

                access sfsline, set sfsline:company_id = agqpersonal:company_id,
                                    sfsline:line_of_business = agqpersonal:line_of_business,
                                    sfsline:lob_subline = "00", generic

                If SFSLINE:OPTION one of "P", "R" and
                   L_PLSPREPRINTED_ALARM_FACTOR <> 1.00 Then
                    Begin
                    agqPERSONAL:ALARM_OPTION[5] = 1
                    agqPERSONAL:ALARM_FACTOR[5] = 1.00
                    agqPERSONAL:ALARM_INCLUDED  = 1
                    agqpersonal:alarm_code      = 5
                    end
                else
                if sfsline:option one of "P", "R" and
                   sfscompany:boiler_rating = 1 and
                   agqpersonal:state = 19 then
                    begin
                    agqPERSONAL:ALARM_OPTION[5] = 1
                    agqPERSONAL:ALARM_FACTOR[5] = l_premium_5
                    agqPERSONAL:ALARM_INCLUDED  = 0
                    agqpersonal:alarm_code      = 5
                    end
                else
                if sfscompany:special_territory_rating = 1 and
                   function one of "ADD", "NEW" then
                    begin
                    agqPERSONAL:ALARM_OPTION[5] = 1
                    agqPERSONAL:ALARM_FACTOR[5] = l_premium_5
                    agqpersonal:alarm_included  = 0
                    agqpersonal:alarm_code      = 5
                    end
                else
                if sfscompany:boiler_rating = 1 and
                   function one of "ADD", "NEW" then
                    begin
                    agqPERSONAL:ALARM_OPTION[5] = 1
                    agqPERSONAL:ALARM_FACTOR[5] = l_premium_5
                    agqpersonal:alarm_included  = 0
                    agqpersonal:alarm_code      = 5
                    end
                else
                if sfscompany:special_territory_rating <> 1 then
                    begin
                    agqpersonal:alarm_included  = 0
                    end
                end
            end
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "08webhelp_agtmt1100_tbx_construction_yr.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        end
        agqpersonal:year_construction/tabstop
        if agqpersonal:year_construction > year(agqpersonal:eff_date) + 1 then
            error "Invalid year of construction entered"

        if agqpersonal:year_construction < agsdefault_plp:year_construction and
           agsdefault_plp:year_construction <> 0 then
            error "Year of construction must be 1920 or greater, refer to underwriting"
        if agqpersonal:year_construction < 1920 and
           agqpersonal:company_id = "FARMERS" then
            error "Year of construction must be 1920 or greater, refer to underwriting"
        l_no_years = year(agqpersonal:eff_date) - agqpersonal:year_construction
        if agsdefault_plp:preferred_years <> 0 and
           l_no_years > agsdefault_plp:preferred_years and
           agqpersonal:form not one of 5 then
            error "Home to old to be this line of business"
        if agsdefault_plp:preferred_years <> 0 and
           l_no_years => agsdefault_plp:preferred_years and
           agqpersonal:form one of 5 then
            error "Home to old to be this line of business" ;
1001    agqPERSONAL:OWNER_OCCUPIED/checkbox/values="N,Y"/tabstop
        if agqpersonal:protection = 4 and
           agqpersonal:owner_occupied = "N" then
            error "The dwelling must be owner occupied for the Suburban Rating Plan"
        If FUNCTION one of "CHANGE", "CHG" Then
            Begin
            If agqPERSONAL:OWNER_OCCUPIED = "Y" and
               agqpersonal:no_families < 2 and
               agqpersonal:company_id <> "FLEMINGTON" Then
                agqPERSONAL:LIABILITY_FORM = 2
            Else
                agqPERSONAL:LIABILITY_FORM = 1
            End    ;
1001    Begin
        If FUNCTION one of "ADD", "NEW", "CHANGE", "CHG" Then
            Begin
            access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                                     sfsterritory:state            = agqpersonal:state,
                                     sfsterritory:line_of_business = agqpersonal:line_of_business,
                                     sfsterritory:county           = agqpersonal:county, generic

            while sfsterritory:company_id       = agqpersonal:company_id and
                  sfsterritory:state            = agqpersonal:state and
                  sfsterritory:line_of_business = agqpersonal:line_of_business and
                  sfsterritory:county           = agqpersonal:county
                begin
                if (agqpersonal:eff_date >= sfsterritory:eff_date and
                   (agqpersonal:eff_date <= sfsterritory:exp_date or
                   sfsterritory:exp_date = 0)) then
                    begin
                    Switch(agqPERSONAL:STATE)
                      Case 19 : agqPERSONAL:TABLE = SFSTERRITORY:TERRITORY_GROUP[1]
                      Default : Do GET_DWELLING_TABLE
                      End
                    end

                next sfsterritory
                end

            End
        End
        agqPERSONAL:OWNER_OCCUPIED/displayonly/checkbox/values="N,Y"
        Hide If SFSLINE:LOB_CODE <> "DWELLING" ;

1002    agqpersonal:townhouse/checkbox/values="0,1"/tabstop
        hide if ((agqpersonal:form not one of 3 and
                sfsline:lob_code one of "HOME") or
                (agqpersonal:form not one of 1, 2, 3 and
                sfsline:lob_code one of "DWELLING")) ;
1003    begin
            l_no_units = agqpersonal:townhouse_units
        end
        agqpersonal:townhouse_units/tabstop
        hide if agqpersonal:townhouse = 0
        if agqpersonal:townhouse_units = 0 and
           agqpersonal:townhouse = 1 then
            error "Must enter number of units"
        if agqpersonal:townhouse_units > 8 then
--           agqpersonal:state = 19 then
            begin
            l_continue_4 = dialog("CONTACT UNDERWRITER","warning.bmp","Refer to Underwriter","OK")
            agqpersonal:townhouse = 0
            agqpersonal:townhouse_units = 0
            end  ;
/*        if (agqpersonal:state one of 19 and
           (agqpersonal:townhouse_units > 8 and
           function one of "ADD", "NEW") or
           (agqpersonal:townhouse_units > 8 and
           function one of "CHANGE", "CHG" and
           l_no_units <= 8)) then
            begin
            g_code     = "MPL69"
            g_prem_no  = agqpersonal:prem_no
            g_build_no = agqpersonal:build_no
            display modal screen "agtmt3032"
            with initial function "ADD|BACK"
            end;*/
1002    agqpersonal:townhouse/checkbox/values="0,1"/displayonly ;
1003    agqpersonal:townhouse_units/displayonly ;


1201    begin
        if agqpersonal:townhouse = 0 then
            agqpersonal:townhouse_units = 0
        L_DWELLING_LIMIT = agqPERSONAL:DWELLING_LIMIT
        do minimum_maximum_limits
        If FUNCTION one of "ADD", "NEW" and
           agqpersonal:dwelling_limit = 0 Then
            begin
            if l_minimum_limit <> 0 then
                agqPERSONAL:DWELLING_LIMIT = l_minimum_limit
            else
                agqpersonal:dwelling_limit = agsdefault_plp:coverage_a
            end
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "09webhelp_agtmt1100_tbx_dwelling_limit.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        end
        agqpersonal:dwelling_limit/tabstop/default tagged dwelling_fn
        hide if agqpersonal:form = 6
--        Hide If agsdefault_plp:COVERAGE_A = 0

        If agqPERSONAL:DWELLING_LIMIT < l_minimum_limit and
           agqpersonal:dwelling_limit => l_filed_limit and
           l_minimum_limit <> 0 and
           sfsemail:agent_no <> 0 Then
            Begin
            if l_min_error = 0 then
                begin
                l_continue_2 = dialog("MINIMUM LIMITS","warning.bmp",trun(l_minimum_message),"Yes","No")
                if l_continue_2 = "No" then
                    begin
                    l_continue_3 = dialog("CONTACT UNDERWRITER","warning.bmp",trun(l_contact_message),"OK")
                    end
                if l_continue_2 = "Yes" then
                    begin
                    error "Please change the limit entered"
                    end
                end
            else
                error trun(l_minimum_message)
            end
        else
        if agqpersonal:dwelling_limit < agsdefault_plp:coverage_a and
           l_minimum_limit = 0 and
           sfsemail:agent_no <> 0 then
            begin
            error "Minimum Limits Required"
            end

        If agqPERSONAL:DWELLING_LIMIT < l_filed_limit and
           l_filed_limit <> 0 and
           sfsemail:agent_no <> 0 Then
            Begin
            error l_filed_message
            end

        if (sfsemail:agent_no <> 0 and
           agqpersonal:dwelling_limit > l_binding_limit and
           (agqpersonal:dwelling_limit <= l_maximum_limit or
           l_maximum_limit = 0) and
           l_binding_limit <> 0) then
            begin
            if l_binding_error = 0 then
                begin
                l_continue_2 = dialog("BINDING LIMITS","warning.bmp",trun(l_binding_message),"Yes","No")
                if l_continue_2 = "No" then
                    begin
                    l_continue_3 = dialog("CONTACT UNDERWRITER","warning.bmp",trun(l_contact_message),"OK")
                    end
                if l_continue_2 = "Yes" then
                    begin
                    error "Please change the limit entered"
                    end
                end
            else
                error l_binding_message
            end

        if agqpersonal:dwelling_limit > l_maximum_limit and
           l_maximum_limit <> 0 and
           sfsemail:agent_no <> 0 then
            begin
            if l_max_error = 0 then
                begin
                l_continue_2 = dialog("MAXIMUM LIMITS","warning.bmp",trun(l_maximum_message),"Yes","No")
                if l_continue_2 = "No" then
                    begin
                    l_continue_3 = dialog("CONTACT UNDERWRITER","warning.bmp",trun(l_contact_message),"OK")
                    end
                if l_continue_2 = "Yes" then
                    begin
                    error "Please change the limit entered"
                    end
                end
            else
                error l_maximum_message
            end ;

1202    agqpersonal:replacement_acv/checkbox/values="R,A" tagged farmers_fn
        hide if agqpersonal:company_id <> "FARMERS" ;

1301    Begin
            L_CONTENTS_LIMIT = agqPERSONAL:CONTENTS_LIMIT
            do minimum_maximum_limits

        If FUNCTION one of "ADD", "NEW" and
           agqpersonal:contents_limit = 0 and
           agqpersonal:company_id = "FLEMINGTON" and
           agqpersonal:form = 6 Then
            begin
            if l_minimum_limit <> 0 then
                agqPERSONAL:contents_LIMIT = l_minimum_limit
            else
                agqpersonal:contents_limit = agsdefault_plp:coverage_c
            end

        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "11webhelp_agtmt1100_tbx_personal_prop_limit.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        End
        agqPERSONAL:CONTENTS_LIMIT/default/tabstop
        if agqpersonal:form = 6 and
           agqpersonal:contents_limit = 0 then
            error "You must enter a limit"

        If agqPERSONAL:CONTENTS_LIMIT < agsdefault_plp:coverage_c and
           agsdefault_plp:coverage_c <> 0 and
           agqpersonal:contents_limit <> 0 and
           sfsemail:agent_no <> 0 and
           agqpersonal:company_id = "FARMERS" Then
            Begin
            if l_min_error = 0 then
                begin
                l_continue_2 = dialog("MINIMUM LIMITS","warning.bmp",trun(l_minimum_message),"Yes","No")
                if l_continue_2 = "No" then
                    begin
                    l_continue_3 = dialog("CONTACT UNDERWRITER","warning.bmp",trun(l_contact_message),"OK")
                    end
                if l_continue_2 = "Yes" then
                    begin
                    error "Please change the limit entered"
                    end
                end
            else
                error l_minimum_message
            end
        else
        If agqPERSONAL:CONTENTS_LIMIT < l_minimum_limit and
           agqpersonal:form = 6 and
           agqpersonal:contents_limit <> 0 and
           l_minimum_limit <> 0 and
           sfsemail:agent_no <> 0 and
           agqpersonal:company_id <> "FARMERS" Then
            Begin
            if l_min_error = 0 then
                begin
                l_continue_2 = dialog("MINIMUM LIMITS","warning.bmp",trun(l_minimum_message),"Yes","No")
                if l_continue_2 = "No" then
                    begin
                    l_continue_3 = dialog("CONTACT UNDERWRITER","warning.bmp",trun(l_contact_message),"OK")
                    end
                if l_continue_2 = "Yes" then
                    begin
                    error "Please change the limit entered"
                    end
                end
            else
                error l_minimum_message
            end ;

1301    begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "10webhelp_agtmt1100_scr_rating_info_yes_app_num.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            end
        end
        agqpersonal:contents_limit/displayonly
        if agqpersonal:dwelling_limit <> 0 then
            agqpersonal:limit = agqpersonal:dwelling_limit
        else
            agqpersonal:limit = agqpersonal:contents_limit
        if function one of "ADD", "NEW" or
           agqpersonal:contents_limit <> l_contents_limit or
           agqpersonal:dwelling_limit <> l_dwelling_limit then
            do update_limits
        If FUNCTION one of "ADD", "NEW", "CHANGE", "CHG" Then
            Begin
            If agqPERSONAL:OWNER_OCCUPIED = "Y" and
               agqpersonal:company_Id <> "FLEMINGTON" Then
                agqPERSONAL:LIABILITY_FORM = 2
            Else
                agqPERSONAL:LIABILITY_FORM = 1
            End
        If FUNCTION one of "ADD", "NEW", "CHANGE", "CHG" And
           agqPERSONAL:CONTENTS_LIMIT <> 0 and
           agsdefault_plp:theft_coverage_cd = 1 and
           agqpersonal:form <> 1 Then
            agqPERSONAL:THEFT = 1
        else
            agqpersonal:theft = 0
        if agqpersonal:contents_limit = 0 then
            do remove_mpl47 ;


}

Panel at 23,1 to 23.5,100 Tagged icon_line2_tg
    Properties
        {
        LayoutType = screen
        }
{

}

Panel at 23.5,1 to 24.5,100 Tagged icon_line2_tg
    Properties
        {
        LayoutType = screen
        }
    {
    Components
        Button at 1,1   tagged back_fn
        Properties {
                Iconname = "btn_back_to_main_screen.bmp"
                }
        Events  {
                Action {
                          l_continue_2 = dialog("EXITING","warning.bmp","You are about to leave the application, Do you wish to continue","Yes","No")
                          if l_continue_2 = "Yes" then
                              begin
                              function = "back"
                              abort()
                              end
                       }
                }

        Button at 1,70   tagged calc_fn
            Properties
                {
                Iconname = "btn_view_summary_totals.bmp"
                }
            Events
                {
                Action
                    {
                    function = "func1"
                    abort()
                    }
                }

}

Panel at 24.5,1 to 25,100 Tagged icon_line2_tg
    Properties
        {
        LayoutType = screen
        }
{

}

panel at 24.5,1 to 25,100 tagged line_panel_1
    {
    Components
        line at 1,1 to 1,100
            Properties
                {
                Linestyle = embossed
                Linewidth = 5
                foregroundcolor = "black"
                }
    }

panel at 25,1 to 32,100  tagged ficof_fn

Properties
        {
          LayoutType = screen
--          Transparent = False
          backgroundcolor = "white"
        }
{
      Components
         browser at 1,1 to 7,100  tagged helper_tg
             properties {
                          url = ""
                        }
}

}

Update
if updateok = "NO" then
    begin
    disable(accept_fn)
    enable(calc_fn)
    end

if abort = "YES" then
    begin
    disable(accept_fn)
    enable(calc_fn)
    end

If UPDATEOK = "YES" And
   Abort = "NO" Then
    Begin
    disable(accept_fn)
    enable(calc_fn)
    If FUNCTION one of "ADD", "NEW", "CHANGE", "CHG" Then
        Begin
        access agqname, set agqname:app_no = agqpersonal:app_no, generic

        if agqname:app_no <> agqpersonal:app_no then
            begin
            add agqname
                begin
                agqname:app_no            = agqpersonal:app_no
                agqname:name[1]           = agqpersonal:business_name[1]
                agqname:line_of_business  = agqpersonal:line_of_business
                agqname:trans_date        = agqpersonal:entry_date
                agqname:eff_date          = agqpersonal:eff_date
                agqname:exp_date          = agqpersonal:exp_date
                agqname:company_id        = agqpersonal:company_id
                agqname:original_eff_date = agqpersonal:eff_date
                agqname:agent_no          = agqpersonal:agent_no
                end
            end
        else
            begin
            change agqname
                begin
                agqname:name[1]           = agqpersonal:business_name[1]
                agqname:line_of_business  = agqpersonal:line_of_business
                agqname:trans_date        = agqpersonal:entry_date
                agqname:eff_date          = agqpersonal:eff_date
                agqname:exp_date          = agqpersonal:exp_date
                agqname:company_id        = agqpersonal:company_id
                agqname:original_eff_date = agqpersonal:eff_date
                agqname:agent_no          = agqpersonal:agent_no
                end
            end

        Access SFSLINE, Set SFSLINE:COMPANY_ID       = agqpersonal:COMPANY_ID,
                            SFSLINE:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS,
                            SFSLINE:LOB_SUBLINE      = "00", Generic

        if sfsline:lob_code = "DWELLING" then
            begin
            Access PLSPREPRINTED, Set PLSPREPRINTED:COMPANY_ID       = agqpersonal:COMPANY_ID,
                                      PLSPREPRINTED:STATE            = agqpersonal:STATE,
                                      PLSPREPRINTED:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS, Generic

            l_code_1  = ""
            l_code_2  = ""
            l_code_3  = ""
            l_code_4  = ""
            l_code_5  = ""
            l_code_6  = ""
            l_code_7  = ""
            l_code_8  = ""
            l_code_9  = ""
            l_code_11 = ""
            while PLSPREPRINTED:COMPANY_ID       = agqpersonal:COMPANY_ID and
                  PLSPREPRINTED:STATE            = agqpersonal:STATE and
                  PLSPREPRINTED:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS
                begin
                If agqpersonal:EFF_DATE >= PLSPREPRINTED:REFF_DATE Then
                    Begin
                    L_CODE_1  = PLSPREPRINTED:CODE[18] -- MDW74
                    L_CODE_2  = PLSPREPRINTED:CODE[19] -- MDW75
                    L_CODE_3  = PLSPREPRINTED:CODE[20] -- workers comp
                    L_CODE_4  = PLSPREPRINTED:CODE[21] -- MDL1
                    L_CODE_5  = PLSPREPRINTED:TRIGGER_ENDORSEMENTS[15] -- mdl2
                    L_CODE_6  = PLSPREPRINTED:TRIGGER_ENDORSEMENTS[17] -- mdw30
                    l_code_7  = plspreprinted:trigger_endorsements[20] -- mpl24
                    l_code_8  = plspreprinted:code_1[1] -- mpl126
                    l_code_9  = plspreprinted:code[28] -- sal04
                    l_code_11 = plspreprinted:code_1[6] -- mpl53
                    End

                Next PLSPREPRINTED
                End


            If L_CODE_11 <> "" then
                Begin
                L_CODE = L_CODE_11
                Do ACCESS_agqEND
                If L_ADD_ENDORSEMENT = "Y" And
                   agqPERSONAL:replacement_acv = "A" Then
                    Do ADD_agqEND
                If L_ADD_ENDORSEMENT = "N" And
                   agqPERSONAL:replacement_acv <> "A" then
                    Do DELETE_agqEND
                End

            If L_CODE_1 <> "" Then
                Begin
                L_CODE = L_CODE_1
                Do ACCESS_agqEND
                If L_ADD_ENDORSEMENT = "Y" And
                   agqPERSONAL:EC = "Y" Then
                    Do ADD_agqEND
                If L_ADD_ENDORSEMENT = "N" And
                   agqPERSONAL:EC = "N" Then
                    Do DELETE_agqEND
                End

            If L_CODE_2 <> "" Then
                Begin
                L_CODE = L_CODE_2
                Do ACCESS_agqEND
                If L_ADD_ENDORSEMENT = "Y" And
                   agqPERSONAL:VMM = "Y" Then
                    Do ADD_agqEND
                If L_ADD_ENDORSEMENT = "N" And
                   agqPERSONAL:VMM = "N" Then
                    Do DELETE_agqEND
                End

            -- workers comp
            If L_CODE_3 <> "" Then
                Begin
                L_CODE = L_CODE_3
                Do ACCESS_agqEND
                If ((l_add_endorsement = "Y" and
                   agqpersonal:owner_occupied = "Y" and
                   agqpersonal:company_id = "FARMERS") or
                   (l_add_endorsement = "Y" and
                   agqpersonal:liability_form =2 and
                   agqpersonal:company_id not one of "FARMERS", "FLEMINGTON")) Then
                    Do ADD_agqEND
                If ((l_add_endorsement = "N" and
                   agqpersonal:owner_occupied = "N" and
                   agqpersonal:company_id = "FARMERS") or
                   (l_add_endorsement = "N" and
                   agqpersonal:liability_form <> 2)) Then
                    Do DELETE_agqEND
                End

            -- MDL1
            If L_CODE_4 <> "" Then
                Begin
                L_CODE = L_CODE_4
                Do ACCESS_agqEND
                If L_ADD_ENDORSEMENT = "Y" And
                   agqPERSONAL:LIABILITY_FORM = 1 and
                   agqpersonal:liability_limit <> 0 Then
                    Do ADD_agqEND
                If ((L_ADD_ENDORSEMENT = "N" And
                   agqPERSONAL:LIABILITY_FORM <> 1) or
                   (l_add_endorsement = "N" and
                   agqpersonal:liability_limit = 0)) Then
                    Do DELETE_agqEND
                End

            -- MDL2
            If L_CODE_5 <> "" Then
                Begin
                L_CODE = L_CODE_5
                Do ACCESS_agqEND
                If L_ADD_ENDORSEMENT = "Y" And
                   agqPERSONAL:LIABILITY_FORM = 2 and
                   agqpersonal:liability_limit <> 0 Then
                    Do ADD_agqEND
                If ((L_ADD_ENDORSEMENT = "N" And
                   agqPERSONAL:LIABILITY_FORM <> 2) or
                   (l_add_endorsement = "N" and
                   agqpersonal:liability_limit = 0)) Then
                    Do DELETE_agqEND
                End

                -- mdw30
            If L_CODE_6 <> "" Then
                Begin
                L_CODE = L_CODE_6
                Do ACCESS_agqEND
                If L_ADD_ENDORSEMENT = "Y" And
                   agqPERSONAL:THEFT = 1 Then
                    Do ADD_agqEND
                If L_ADD_ENDORSEMENT = "N" And
                   agqPERSONAL:THEFT = 0 Then
                    Do DELETE_agqEND
                End

            If L_CODE_7 <> "" Then
                Begin
                L_CODE = L_CODE_7
                Do ACCESS_agqEND
                If L_ADD_ENDORSEMENT = "Y" And
                   agqPERSONAL:liability_limit <> 0 and
                   agqpersonal:lead_paint_exclusion = 0 Then
                    Do ADD_agqEND
                If ((L_ADD_ENDORSEMENT = "N" And
                   agqPERSONAL:liability_limit = 0) or
                   (l_add_endorsement = "N" and
                   agqpersonal:lead_paint_exclusion = 1)) Then
                    Do DELETE_agqEND
                End

            If L_CODE_8 <> "" Then
                Begin
                L_CODE = L_CODE_8
                Do ACCESS_agqEND
                If L_ADD_ENDORSEMENT = "Y" And
                   agqPERSONAL:liability_limit <> 0 and
                   agqpersonal:fungi_mold_exclusion = 0 Then
                    Do ADD_agqEND
                If ((L_ADD_ENDORSEMENT = "N" And
                   agqPERSONAL:liability_limit = 0) or
                   (l_add_endorsement = "N" and
                   agqpersonal:fungi_mold_exclusion = 1)) Then
                    Do DELETE_agqEND
                End

            end  -- end of sfsline:lob_code = "DWELLING"

        do UPDATE_ENDORSEMENTS
        if agqpersonal:company_id = "FLEMINGTON" then
            do update_agqpersonal_alias
        end

    end

Screen Exit
if agqpersonal:app_no <> 0 then
    do update_territory
g_from_search_screen = 0

Procedure Definition

procedure remove_mpl47
begin
access agqend, set agqend:app_no = agqpersonal:app_no, generic

while agqend:app_no = agqpersonal:app_no
    begin
    if agqend:code one of "MPL47", "MPL49" and
       agqpersonal:contents_limit = 0 then
        delete agqend

    next agqend
    end

end

procedure update_agqpersonal_alias
begin
l_val_zipcode = agqpersonal:zipcode
l_str_zipcode = agqpersonal:str_zipcode[1,5] + "0000"
access sfszipcode, set sfszipcode:company_id       = agqpersonal:company_id,
                       sfszipcode:state            = agqpersonal:state,
                       sfszipcode:line_of_business = agqpersonal:line_of_business,
                       sfszipcode:str_zipcode      = l_str_zipcode, generic

l_tier = 0
while sfszipcode:company_Id       = agqpersonal:company_id and
      sfszipcode:state            = agqpersonal:state and
      sfszipcode:line_of_business = agqpersonal:line_of_business and
      sfszipcode:str_zipcode      = l_str_zipcode
        begin
        if (agqpersonal:eff_date >= sfszipcode:eff_date and
           (agqpersonal:eff_date <= sfszipcode:exp_date or
           sfszipcode:exp_date = 0)) then
            begin
            l_tier            = sfszipcode:tier
            end

        next sfszipcode
        end

l_tier_1 = l_tier
if l_tier_1 = 0 then
    l_tier_1 = 3
if agsdefault_plp:dont_use_tier_rating = 1 then
    l_tier_1 = 3
access sfstier, set sfstier:company_id       = agqpersonal:company_id,
                    sfstier:state            = agqpersonal:state,
                    sfstier:line_of_business = agqpersonal:line_of_business,
                    sfstier:tier             = l_tier_1, generic

l_wind_deductible      = 0
l_hurricane_deductible = 0
while sfstier:company_Id       = agqpersonal:company_id and
      sfstier:state            = agqpersonal:state and
      sfstier:line_of_business = agqpersonal:line_of_business and
      sfstier:tier             = l_tier_1
        begin
        if (agqpersonal:eff_date >= sfstier:eff_date and
           (agqpersonal:eff_date <= sfstier:exp_date or
           sfstier:exp_date = 0)) then
            begin
            l_wind_deductible      = sfstier:wind_deductible
            l_hurricane_deductible = sfstier:hurricane_deductible
            l_hurricane_code       = sfstier:hurricane_code
            end

        next sfstier
        end

if l_hurricane_code <> "" then
    begin
    l_code = l_hurricane_code
    do access_agqend
    if l_add_endorsement = "Y" and
       agqpersonal:hurricane_deductible <> 0 then
        do add_agqend
    if l_add_endorsement = "N" and
       agqpersonal:hurricane_deductible = 0 then
        do delete_agqend
    end
else
if l_hurricane_code = "" then
    do access_agqend

access agqpersonal_alias, set agqpersonal_alias:app_no = agqpersonal:app_no,
                              agqpersonal_alias:prem_no  = agqpersonal:prem_no,
                              agqpersonal_alias:build_no = agqpersonal:build_no, generic

if agqpersonal_alias:app_no = agqpersonal:app_no and
   agqpersonal_alias:prem_no  = agqpersonal:prem_no and
   agqpersonal_alias:build_no = agqpersonal:build_no then
    begin
    change agqpersonal_alias
        begin
        if l_wind_deductible <> 0 then
            agqpersonal_alias:wind_deductible      = l_wind_deductible
        agqpersonal_alias:tier                     = l_tier_1
        if l_tier_1 = 1 then
            begin
            agqpersonal_alias:companion_discount   = 0
            end
        if (l_hurricane_deductible <> 0 and
           (agqpersonal_alias:hurricane_changed = 0 or
           g_zipcode_change = "Y" or
           agqpersonal_alias:tier one of 1, 2)) then
            begin
            g_zipcode_change = "N"
            agqpersonal_alias:hurricane_deductible = l_hurricane_deductible
            if agqpersonal_alias:company_id <> "FLEMINGTON" then
                agqpersonal_alias:wind_deductible      = 0
            end
        else
        if l_hurricane_deductible = 0 then
            agqpersonal_alias:hurricane_deductible = l_hurricane_deductible
        end
    end

end

procedure change_current_browser (string p_server_name, string p_current_web_page)
BEGIN
l_web_site_address = trun(p_server_name) + trun(p_current_web_page)
setproperty(helper_tg,url,trun(l_web_site_address))

END

procedure update_territory
begin
access sfsterritory, set sfsterritory:company_id       = agqpersonal:company_id,
                         sfsterritory:state            = agqpersonal:state,
                         sfsterritory:line_of_business = agqpersonal:line_of_business,
                         sfsterritory:county           = agqpersonal:county, generic

while sfsterritory:company_id       = agqpersonal:company_id and
      sfsterritory:state            = agqpersonal:state and
      sfsterritory:line_of_business = agqpersonal:line_of_business and
      sfsterritory:county           = agqpersonal:county
    begin
    if (agqpersonal:eff_date >= sfsterritory:eff_date and
       (agqpersonal:eff_date <= sfsterritory:exp_date or
       sfsterritory:exp_date = 0)) then
        begin
        access agqpersonal_alias, set agqpersonal_alias:app_no   = agqpersonal:app_no,
                                      agqpersonal_alias:prem_no  = agqpersonal:prem_no,
                                      agqpersonal_alias:build_no = agqpersonal:build_no, generic

        if agqpersonal_alias:app_no   = agqpersonal:app_no and
           agqpersonal_alias:prem_no  = agqpersonal:prem_no and
           agqpersonal_alias:build_no = agqpersonal:build_no then
            begin
            change agqpersonal_alias
                begin
                agqPERSONAL_alias:TERRITORY = SFSTERRITORY:TERRITORY
                end
            end

        Switch(agqPERSONAL:STATE)
          Case 37 : Begin
                    Switch(agqPERSONAL:FORM)
                      Case 2  : L_GROUP = SFSTERRITORY:TERRITORY_GROUP[1]
                      Case 4  : L_GROUP = SFSTERRITORY:TERRITORY_GROUP[3]
                      Case 6  : L_GROUP = SFSTERRITORY:TERRITORY_GROUP[4]
                      Default : L_GROUP = SFSTERRITORY:TERRITORY_GROUP[2]
                      End
                    End
          Default : Begin
                    L_GROUP = SFSTERRITORY:TERRITORY_GROUP[1]
                    End
          End
        If SFSLINE:LOB_CODE <> "DWELLING" Then
            begin
            L_TABLE   = SFSTERRITORY:TERRITORY_GROUP[1]
            l_table_1 = sfsterritory:territory_group[1]
            end
        end

    next sfsterritory
    end

Access agqPERSONAL_ALIAS, Set agqPERSONAL_ALIAS:app_no   = agqpersonal:app_no,
                              agqpersonal_alias:prem_no  = agqpersonal:prem_no,
                              agqpersonal_alias:build_no = agqpersonal:build_no, generic

if agqpersonal_alias:app_no   = agqpersonal:app_no and
   agqpersonal_alias:prem_no  = agqpersonal:prem_no and
   agqpersonal_alias:build_no = agqpersonal:build_no then
    begin
    change agqpersonal_alias
        begin
        agqpersonal_alias:group   = l_group
        agqpersonal_alias:table   = l_table
        agqpersonal_alias:table_1 = l_table_1
        end
    end

end

procedure minimum_maximum_limits
begin
access sfsminmax, set sfsminmax:company_id       = agqpersonal:company_id,
                      sfsminmax:state            = agqpersonal:state,
                      sfsminmax:line_of_business = agqpersonal:line_of_business,
                      sfsminmax:form             = agqpersonal:form, generic

while sfsminmax:company_id        = agqpersonal:company_id and
      sfsminmax:state             = agqpersonal:state and
      sfsminmax:line_of_business  = agqpersonal:line_of_business and
      sfsminmax:form              = agqpersonal:form
        begin
        if (agqpersonal:eff_date >= sfsminmax:eff_date and
           (agqpersonal:eff_date <= sfsminmax:exp_date or
           sfsminmax:exp_date = 0)) then
            begin
            l_minimum_limit   = sfsminmax:minimum_limit
            l_maximum_limit   = sfsminmax:maximum_limit
            l_binding_limit   = sfsminmax:binding_maximum
            l_min_error       = sfsminmax:give_error[1]
            l_binding_error   = sfsminmax:give_error[2]
            l_max_error       = sfsminmax:give_error[3]
            l_minimum_message = sfsminmax:minimum_message
            l_binding_message = sfsminmax:binding_message
            l_maximum_message = sfsminmax:maximum_message
            l_contact_message = sfsminmax:contact_message
            l_filed_limit     = sfsminmax:minimum_filed_rate
            l_filed_message   = sfsminmax:minimum_rate_message
            end

        next sfsminmax
        end

end

Procedure UPDATE_ENDORSEMENTS
Begin
Access agqPERSONAL_ALIAS, Set agqPERSONAL_alias:app_no = G_app_no, Generic

If agqPERSONAL_ALIAS:app_no = G_app_no Then
    Begin
    Access PLSPREPRINTED, Set PLSPREPRINTED:COMPANY_ID       = agqpersonal_alias:COMPANY_ID,
                              PLSPREPRINTED:STATE            = agqpersonal_alias:state,
                              PLSPREPRINTED:LINE_OF_BUSINESS = agqpersonal_alias:LINE_OF_BUSINESS, Generic

    l_code_1  = ""
    l_code_2  = ""
    l_code_3  = ""
    l_code_4  = ""
    l_code_5  = ""
    l_code_6  = ""
    l_code_7  = ""
    l_code_8  = ""
    l_code_9  = ""
    l_code_10 = ""
    l_code_11 = ""
    l_code_12 = ""
    l_code_13 = ""
    l_code_14 = ""
    l_code_20 = ""
    l_code_21 = ""
    l_code_22 = ""
    l_code_23 = ""
    l_code_24 = ""
    l_code_25 = ""
    l_code_26 = ""
    l_code_27 = ""
    l_code_28 = ""
    l_code_29 = ""
    l_code_30 = ""
    while plspreprinted:record_key       = "PF" and
          PLSPREPRINTED:COMPANY_ID       = agqpersonal_alias:COMPANY_ID and
          PLSPREPRINTED:STATE            = agqpersonal_alias:STATE and
          PLSPREPRINTED:LINE_OF_BUSINESS = agqpersonal_alias:LINE_OF_BUSINESS
        begin
        If agqpersonal:EFF_DATE >= PLSPREPRINTED:rEFF_DATE Then
            Begin
            L_CODE_1  = PLSPREPRINTED:CODE[7] -- wind deductible
            L_CODE_2  = PLSPREPRINTED:CODE[6] -- new home discount
            L_CODE_3  = PLSPREPRINTED:CODE[2] -- seasonal
            L_CODE_4  = PLSPREPRINTED:CODE[20] -- workers comp
            L_CODE_5  = PLSPREPRINTED:CODE[22] -- sal01, fpl01
            L_CODE_6  = PLSPREPRINTED:CODE[23] -- mpl47
            L_CODE_7  = PLSPREPRINTED:CODE[5] -- mpl70
            L_CODE_8  = PLSPREPRINTED:TRIGGER_ENDORSEMENTS[14]
            L_CODE_9  = PLSPREPRINTED:CODE[21] -- mdl1
            L_CODE_10 = PLSPREPRINTED:CODE[24] -- mdl62
            L_CODE_11 = PLSPREPRINTED:TRIGGER_ENDORSEMENTS[15] -- mdl2
            L_CODE_12 = PLSPREPRINTED:TRIGGER_ENDORSEMENTS[16] -- mdl63
            L_CODE_13 = PLSPREPRINTED:TRIGGER_ENDORSEMENTS[17] -- mdw30
            l_code_14 = plspreprinted:code[25] -- MPL96
            l_code_20 = plspreprinted:trigger_endorsements[18] -- mpl61
            l_code_21 = plspreprinted:trigger_endorsements[20] -- mpl24
            l_code_22 = plspreprinted:code_1[1] -- mpl126
            l_code_23 = plspreprinted:code_1[2] -- fpl02 boiler
            l_fpl01_form = plspreprinted:fpl01_form
            l_code_24 = plspreprinted:code[8] -- mpl67
            l_code_25 = plspreprinted:code[9] -- mpl68
            l_code_26 = plspreprinted:code[10] -- mpl69
            l_code_27 = plspreprinted:code[26] -- mpl97
            l_code_28 = plspreprinted:code[27] -- mpl46
            l_code_29 = plspreprinted:code[28] -- sal04
            l_code_30 = plspreprinted:agent_system_increase -- standard mpl47 for agent system
            End

        Next PLSPREPRINTED
        End

    Access SFSLINE, Set SFSLINE:COMPANY_ID       = agqpersonal_alias:COMPANY_ID,
                        SFSLINE:LINE_OF_BUSINESS = agqpersonal_alias:LINE_OF_BUSINESS,
                        SFSLINE:LOB_SUBLINE      = "00", Generic

    If L_CODE_1 <> "" Then
        Begin
        L_CODE = L_CODE_1
        Do ACCESS_AGQEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqPERSONAL_ALIAS:WIND_DEDUCTIBLE <> 0 and
           agqpersonal_alias:hurricane_deductible = 0 Then
            Do ADD_agqEND
        If ((L_ADD_ENDORSEMENT = "N" And
           agqPERSONAL_ALIAS:WIND_DEDUCTIBLE = 0) or
           (l_add_endorsement = "N" and
           agqpersonal_alias:hurricane_deductible <> 0)) Then
            Do DELETE_agqEND
        End

    If L_CODE_2 <> "" Then
        Begin
        L_CODE = L_CODE_2
        If agqPERSONAL_ALIAS:YEAR_CONSTRUCTION <> 0 Then
            Begin
            Do CHECK_FOR_UNDER_CONSTRUCTION
            L_NEW_HOME_YEAR = Year(agqpersonal_alias:EFF_DATE) -
                              agqPERSONAL_ALIAS:YEAR_CONSTRUCTION

            If L_NEW_HOME_YEAR > 99 Then
                L_NEW_HOME_YEAR = 99
            If Year(agqpersonal_alias:EFF_DATE) = agqPERSONAL_ALIAS:YEAR_CONSTRUCTION Then
                L_NEW_HOME_YEAR = 1
            L_NEW_YEAR_2 = L_NEW_HOME_YEAR
            L_RECORD_KEY = "NH"
            Access PLSNEWHOMEDISC, Set PLSNEWHOMEDISC:COMPANY_ID = agqpersonal_alias:COMPANY_ID,
                                       PLSNEWHOMEDISC:STATE = agqpersonal_alias:STATE,
                                       PLSNEWHOMEDISC:LINE_OF_BUSINESS = agqpersonal_alias:LINE_OF_BUSINESS,
                                       PLSNEWHOMEDISC:YEAR = L_NEW_YEAR_2, Generic

            L_NEW_HOME_DISCOUNT = "N"
            Repeat Begin
                Exit If PLSNEWHOMEDISC:RECORD_KEY <> L_RECORD_KEY Or
                        PLSNEWHOMEDISC:COMPANY_ID <> agqpersonal_alias:COMPANY_ID Or
                        PLSNEWHOMEDISC:STATE <> agqpersonal_alias:STATE Or
                        PLSNEWHOMEDISC:LINE_OF_BUSINESS <> agqpersonal_alias:LINE_OF_BUSINESS Or
                        PLSNEWHOMEDISC:YEAR <> L_NEW_YEAR_2

                If agqpersonal_alias:EFF_DATE >= PLSNEWHOMEDISC:rEFF_DATE Then
                    Begin
                    L_NEW_HOME_DISCOUNT = "Y"
                    L_NEW_HOME_DISCOUNT_FACTOR = PLSNEWHOMEDISC:FACTOR
                    End
                Else
                    Begin
                    L_NEW_HOME_DISCOUNT = "N"
                    L_NEW_HOME_DISCOUNT_FACTOR = 0
                    End

                Next PLSNEWHOMEDISC
                End
            End
        Else
            L_NEW_HOME_DISCOUNT = "N"

        Do ACCESS_agqEND
        If (L_ADD_ENDORSEMENT = "Y" And
           L_NEW_HOME_DISCOUNT = "Y" And
           L_NEW_HOME_DISCOUNT_FACTOR < 1.00 And
           L_NEW_HOME_DISCOUNT_FACTOR <> 0 And
           agqPERSONAL_ALIAS:FORM <> 4 And
           agqPERSONAL_ALIAS:FORM <> 6 And
           (L_MPL13 = "N" Or
           (L_MPL13 = "Y" And
           agsdefault_plp:MPL13_AND_NEW_HOME_DISCOUNT = 1))) Then
            begin
            Do ADD_agqEND
            end
        If (L_ADD_ENDORSEMENT = "N" And
           (L_NEW_HOME_DISCOUNT = "N" Or
           L_NEW_HOME_DISCOUNT_FACTOR = 0 Or
           L_NEW_HOME_DISCOUNT_FACTOR > 1.00 Or
           (L_MPL13 = "Y" And
           agsdefault_plp:MPL13_AND_NEW_HOME_DISCOUNT = 0) Or
           agqPERSONAL_ALIAS:FORM = 4 Or
           agqPERSONAL_ALIAS:FORM = 6)) Then
            Do DELETE_agqEND
        End

    if l_code_3 <> "" and
       agqpersonal:company_id = "FLEMINGTON" then
        begin
        if agqpersonal:eff_date >= 07.15.2012 then
            begin
            if ((agqpersonal:owner_occupied = "Y" or
               agqpersonal:seasonal = "Y") and
               agqpersonal:override_seasonal_surcharge = 0) then
                begin
                l_code = l_code_3
                do access_agqend
                if l_add_endorsement = "Y" then
                    do add_agqend
                end
            else
            if agqpersonal:owner_occupied = "N" or
               agqpersonal:seasonal = "N" or
               agqpersonal:override_seasonal_surcharge = 1 then
                begin
                l_code = l_code_3
                do access_agqend
                if l_add_endorsement = "Y" and
                   agqpersonal:agent_no = 614 and
                   agqpersonal:override_seasonal_surcharge = 0 then
                    begin
                    do add_agqend
                    end
                else
                if ((l_add_endorsement = "N" and
                   agqpersonal:agent_No <> 614) or
                   (l_add_endorsement = "N" and
                   agqpersonal:agent_no = 614 and
                   agqpersonal:override_seasonal_surcharge = 1)) then
                    do delete_agqend
                end
            end
        end

    If ((L_CODE_3 <> "" and
       agqpersonal:company_id <> "FLEMINGTON") or
       (l_code_3 <> "" and
       agqpersonal:company_id = "FLEMINGTON" and
       agqpersonal:eff_date <= 06.30.2012)) then
        Begin
        L_CODE = L_CODE_3
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqPERSONAL_ALIAS:SEASONAL = "Y" Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqPERSONAL_ALIAS:SEASONAL = "N" Then
            Do DELETE_agqEND
        End

    If L_CODE_4 <> "" And
       SFSLINE:LOB_CODE = "HOME" Then
        Begin
        L_CODE = L_CODE_4
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqPERSONAL_ALIAS:LIABILITY_LIMIT <> 0 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqPERSONAL_ALIAS:LIABILITY_LIMIT = 0 Then
            Do DELETE_agqEND
        End

    If L_CODE_5 <> "" And
       SFSLINE:LOB_CODE = "HOME" and
       l_fpl01_Form = 0 Then
        Begin
        L_CODE = L_CODE_5
        Do ACCESS_agqEND
        If (L_ADD_ENDORSEMENT = "Y" And
           agqPERSONAL_ALIAS:WAIVE_SAL01 <> "Y" And
           agqpersonal_alias:EFF_DATE >= L_SAL_EFF_DATE And
           (agqPERSONAL_ALIAS:FORM one of 3, 5 Or
           agqPERSONAL_ALIAS:FORM = 4 Or
           agqPERSONAL_ALIAS:FORM = 6)) Then
            Begin
            Change agqPERSONAL_ALIAS
                Begin
                agqPERSONAL_ALIAS:WAIVE_SAL01 = "N"
                End
            Do ADD_agqEND
            End
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal_alias:EFF_DATE < L_SAL_EFF_DATE Then
            Do DELETE_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqPERSONAL_ALIAS:FORM <> 3 And
           agqpersonal_alias:form <> 5 and
           agqPERSONAL_ALIAS:FORM <> 4 And
           agqPERSONAL_ALIAS:FORM <> 6 Then
            Do DELETE_agqEND
        End

    If L_CODE_5 <> "" And
       SFSLINE:LOB_CODE = "HOME" and
       l_fpl01_Form = 1 Then
        Begin
        L_CODE = L_CODE_5
        Do ACCESS_agqEND
        If (L_ADD_ENDORSEMENT = "Y" And
           agqPERSONAL_ALIAS:WAIVE_SAL01 <> "Y" And
           agqpersonal_alias:EFF_DATE >= L_SAL_EFF_DATE And
           (agqPERSONAL_ALIAS:FORM one of 3, 5 Or
           agqPERSONAL_ALIAS:FORM = 6)) Then
            Begin
            Change agqPERSONAL_ALIAS
                Begin
                agqPERSONAL_ALIAS:WAIVE_SAL01 = "N"
                End
            Do ADD_agqEND
            End
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal_alias:EFF_DATE < L_SAL_EFF_DATE Then
            Do DELETE_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqPERSONAL_ALIAS:FORM <> 3 And
           agqpersonal_alias:form <> 5 and
           agqPERSONAL_ALIAS:FORM <> 6 Then
            Do DELETE_agqEND
        End

    If L_CODE_6 <> "" Then
        Begin
        L_MPL49 = "N"
        L_CODE = L_CODE_6
        Do ACCESS_agqEND
        If L_MPL47 = "N" And
           L_MPL49 = "N" and
           agqpersonal_alias:remove_mpl47 = 0 Then
            Begin
            Do ADD_agqEND
            End
        Do CHANGE_CONTENTS
        End

    if l_code_6 <> "" and
       l_code_6 = "MPL49" and
       sfsline:option one of "P", "R" then
        begin
        l_code = l_code_6
        do access_agqend
        if agqpersonal_alias:form one of 5 and
           l_add_endorsement = "N" then
            do delete_agqend
        end

    If L_CODE_7 <> "" Then
        Begin
        L_CODE = L_CODE_7
        Do ACCESS_agqEND
        If (L_ADD_ENDORSEMENT = "Y" And
           (agqpersonal_alias:ALARM_OPTION[1] = 1 Or
           agqpersonal_alias:ALARM_OPTION[2] = 1 Or
           agqpersonal_alias:ALARM_OPTION[3] = 1 Or
           agqpersonal_alias:ALARM_OPTION[4] = 1 Or
           agqpersonal_alias:ALARM_OPTION[5] = 1 Or
           agqpersonal_alias:ALARM_OPTION[6] = 1)) Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" and
           agqpersonal_alias:ALARM_OPTION[1] = 0 And
           agqpersonal_alias:ALARM_OPTION[2] = 0 And
           agqpersonal_alias:ALARM_OPTION[3] = 0 And
           agqpersonal_alias:ALARM_OPTION[4] = 0 And
           agqpersonal_alias:ALARM_OPTION[5] = 0 And
           agqpersonal_alias:ALARM_OPTION[6] = 0 Then
            Do DELETE_agqEND
        End

    If L_CODE_9 <> "" And
       SFSLINE:LOB_CODE = "DWELLING" Then
        Begin
        L_CODE = L_CODE_9
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqPERSONAL_ALIAS:LIABILITY_LIMIT <> 0 And
           agqPERSONAL_ALIAS:LIABILITY_FORM = 1 Then
            Do ADD_agqEND
        If (L_ADD_ENDORSEMENT = "N" And
           (agqPERSONAL_ALIAS:LIABILITY_LIMIT = 0 Or
           agqPERSONAL_ALIAS:LIABILITY_FORM <> 1)) Then
            Begin
            Do DELETE_agqEND
            If agqPERSONAL_ALIAS:LIABILITY_LIMIT = 0 Then
                Begin
                Access agqPERSONAL_ALIAS, Set agqPERSONAL_ALIAS:app_no = agqpersonal:app_no,
                                              agqPERSONAL_ALIAS:PREM_NO = agqpersonal:PREM_NO,
                                              agqPERSONAL_ALIAS:BUILD_NO = agqpersonal:BUILD_NO, Generic

                If agqPERSONAL_ALIAS:app_no = agqpersonal:app_no And
                   agqPERSONAL_ALIAS:PREM_NO = agqpersonal:PREM_NO And
                   agqPERSONAL_ALIAS:BUILD_NO = agqpersonal:BUILD_NO Then
                    Change agqPERSONAL_ALIAS
                       Begin
                       agqPERSONAL_ALIAS:LIABILITY_FORM = 0
                       End
                End
            End
        End

    If L_CODE_10 <> "" And
       SFSLINE:LOB_CODE = "DWELLING" Then
        Begin
        L_CODE = L_CODE_10
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" Then
            Begin
            If (agqpersonal_alias:LIABILITY_LIMIT <> 0 And
               agqpersonal_alias:OWNER_OCCUPIED <> "Y" and
               agqpersonal_alias:remove_mdl62 = 0 Or
               (agqpersonal_alias:LIABILITY_LIMIT <> 0 And
               agqpersonal_alias:OWNER_OCCUPIED = "Y" And
               agqpersonal_alias:NO_FAMILIES  > 1 and
               agqpersonal_alias:remove_mdl62 = 0)) Then
                Do ADD_agqEND
            End
        If L_ADD_ENDORSEMENT = "N" Then
            Begin
            If (agqpersonal_alias:LIABILITY_LIMIT = 0 Or
               (agqpersonal_alias:OWNER_OCCUPIED = "Y" And
               agqpersonal_alias:NO_FAMILIES = 1)) Then
                Do DELETE_agqEND
            End
        End

    If L_CODE_11 <> "" And
       SFSLINE:LOB_CODE = "DWELLING" Then
        Begin
        L_CODE = L_CODE_11
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqPERSONAL_ALIAS:LIABILITY_LIMIT <> 0 And
           agqPERSONAL_ALIAS:LIABILITY_FORM = 2 Then
            Do ADD_agqEND
        If (L_ADD_ENDORSEMENT = "N" And
           (agqPERSONAL_ALIAS:LIABILITY_LIMIT = 0 Or
           agqPERSONAL_ALIAS:LIABILITY_FORM <> 2)) Then
            Begin
            Do DELETE_agqEND
            If agqPERSONAL_ALIAS:LIABILITY_LIMIT = 0 Then
                Begin
                Access agqPERSONAL_ALIAS, Set agqPERSONAL_ALIAS:app_no = agqpersonal:app_no,
                                              agqPERSONAL_ALIAS:PREM_NO = agqpersonal:PREM_NO,
                                              agqPERSONAL_ALIAS:BUILD_NO = agqpersonal:BUILD_NO, Generic

                If agqPERSONAL_ALIAS:app_no = agqpersonal:app_no And
                   agqPERSONAL_ALIAS:PREM_NO = agqpersonal:PREM_NO And
                   agqPERSONAL_ALIAS:BUILD_NO = agqpersonal:BUILD_NO Then
                    Change agqPERSONAL_ALIAS
                        Begin
                        agqPERSONAL_ALIAS:LIABILITY_FORM = 0
                        End
                End
            End
        End

    If L_CODE_12 <> "" And
       SFSLINE:LOB_CODE = "DWELLING" Then
        Begin
        L_CODE = L_CODE_12
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" Then
            Begin
            If (agqPERSONAL_ALIAS:LIABILITY_LIMIT <> 0 And
               agqPERSONAL_ALIAS:OWNER_OCCUPIED  <> "Y" and
               agqpersonal_alias:remove_mdl63 = 0 Or
               (agqPERSONAL_ALIAS:LIABILITY_LIMIT <> 0 And
               agqPERSONAL_ALIAS:OWNER_OCCUPIED  = "Y" And
               agqPERSONAL_ALIAS:NO_FAMILIES  > 1 and
               agqpersonal_alias:remove_mdl63 = 0)) Then
                Do ADD_agqEND
            End
        If L_ADD_ENDORSEMENT = "N" Then
            Begin
            If (agqPERSONAL_ALIAS:LIABILITY_LIMIT = 0 Or
               (agqPERSONAL_ALIAS:OWNER_OCCUPIED  = "Y" And
               agqPERSONAL_ALIAS:NO_FAMILIES = 1)) Then
                Do DELETE_agqEND
            End
        End

    If L_CODE_13 <> "" And
       SFSLINE:LOB_CODE = "DWELLING" Then
        Begin
        L_CODE = L_CODE_13
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqPERSONAL_ALIAS:THEFT = 1 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqPERSONAL_ALIAS:THEFT = 0 Then
            Do DELETE_agqEND
        End

    If L_CODE_14 <> "" Then
        Begin
        L_CODE = L_CODE_14
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqPERSONAL_ALIAS:LIABILITY_LIMIT <> 0 Then
            begin
            Do ADD_agqEND
            do add_agqendorse1
            end
        If L_ADD_ENDORSEMENT = "N" And
           agqPERSONAL_ALIAS:LIABILITY_LIMIT = 0 Then
            begin
            Do DELETE_agqEND
            do delete_agqendorse1
            end
        End

    If L_CODE_27 <> "" Then
        Begin
        L_CODE = L_CODE_27
        Do ACCESS_agqEND
        If ((L_ADD_ENDORSEMENT = "Y" and
           agqpersonal_alias:dwelling_limit <> 0) or
           (l_add_endorsement = "Y" and
           agqpersonal_alias:contents_limit <> 0)) Then
            begin
            Do ADD_agqEND
            do add_agqendorse1
            end
        If L_ADD_ENDORSEMENT = "N" And
           agqPERSONAL_ALIAS:dwelling_LIMIT = 0 and
           agqpersonal_alias:contents_limit = 0 Then
            begin
            Do DELETE_agqEND
            do delete_agqendorse1
            end
        End

    If L_CODE_28 <> "" Then
        Begin
        L_CODE = L_CODE_28
        Do ACCESS_agqEND
        If ((L_ADD_ENDORSEMENT = "Y" and
           sfsline:lob_code one of "HOME" and
           agqpersonal_alias:seasonal = "N" and
           l_mho45 = "N") or
           (l_add_endorsement = "Y" and
           sfsline:lob_code one of "DWELLING" and
           agqpersonal_alias:owner_occupied = "Y" and
           agqpersonal_alias:seasonal = "N" and
           l_mho45 = "N" and
           agqpersonal_alias:no_families > 2 and
           agqpersonal_alias:contents_limit <> 0 and
           agqpersonal_alias:liability_limit <> 0 and
           agqpersonal_alias:liability_form <> 1)) then
            begin
            Do ADD_agqEND
            do add_agqendorse1
            end
        If ((l_add_endorsement = "N" and
           sfsline:lob_code one of "HOME", "DWELLING" and
           agqpersonal_alias:seasonal = "Y") or
           (l_add_endorsement = "N" and
           sfsline:lob_code one of "HOME", "DWELLING" and
           l_mho45 = "Y") or
           (L_ADD_ENDORSEMENT = "N" And
           sfsline:lob_code one of "DWELLING" and
           agqPERSONAL_ALIAS:contents_LIMIT = 0) or
           (l_add_endorsement = "N" and
           sfsline:lob_code one of "DWELLING" and
           agqpersonal_alias:liability_limit = 0) or
           (l_add_endorsement = "N" and
           sfsline:lob_code one of "DWELLING" and
           agqpersonal_alias:liability_form = 1) or
           (l_add_endorsement = "N" and
           sfsline:lob_code one of "DWELLING" and
           agqpersonal_alias:no_families < 3) or
           (l_add_endorsement = "N" and
           sfsline:lob_code one of "DWELLING" and
           agqpersonal_alias:owner_occupied not one of "Y")) Then
            begin
            Do DELETE_agqEND
            do delete_agqendorse1
            end
        End

    If L_CODE_20 <> "" And
       SFSLINE:LOB_CODE = "HOME" and
       agqpersonal_alias:state not one of 19 Then
        Begin
        L_CODE = L_CODE_20
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqPERSONAL_ALIAS:LIABILITY_LIMIT <> 0 Then
            begin
            Do ADD_agqEND
            end
        If L_ADD_ENDORSEMENT = "N" And
           agqPERSONAL_ALIAS:LIABILITY_LIMIT = 0 Then
            begin
            Do DELETE_agqEND
            end
        End

    If L_CODE_21 <> "" And
       SFSLINE:LOB_CODE = "HOME" Then
        Begin
        L_CODE = L_CODE_21
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqPERSONAL_ALIAS:LIABILITY_LIMIT <> 0 and
           agqpersonal_alias:lead_paint_exclusion = 0 Then
            begin
            Do ADD_agqEND
            end
        If ((L_ADD_ENDORSEMENT = "N" And
           agqPERSONAL_ALIAS:LIABILITY_LIMIT = 0) or
           (l_add_endorsement = "N" and
           agqpersonal_alias:lead_paint_exclusion = 1)) Then
            begin
            Do DELETE_agqEND
            end
        End

    If L_CODE_22 <> "" And
       SFSLINE:LOB_CODE = "HOME" Then
        Begin
        L_CODE = L_CODE_22
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqPERSONAL_ALIAS:LIABILITY_LIMIT <> 0 and
           agqpersonal_alias:fungi_mold_exclusion = 0 Then
            begin
            Do ADD_agqEND
            end
        If ((L_ADD_ENDORSEMENT = "N" And
           agqPERSONAL_ALIAS:LIABILITY_LIMIT = 0) or
           (l_add_endorsement = "N" and
           agqpersonal_alias:fungi_mold_exclusion = 1)) Then
            begin
            Do DELETE_agqEND
            end
        End

    if l_code_23 <> "" then
        begin
        l_code = l_code_23
        do access_agqend
        if l_add_endorsement = "Y" and
           agsdefault_plp:boiler = 1 and
           agqpersonal_alias:delete_boiler = 0 then
            begin
            do add_agqend
            end
        if ((l_add_endorsement = "N" and
           agsdefault_plp:boiler = 0) or
           (l_add_endorsement = "N" and
           agqpersonal_alias:delete_boiler = 1)) then
            begin
            do delete_agqend
            end
        end

    If L_CODE_24 <> "" Then
        Begin
        L_CODE = L_CODE_24
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal_alias:townhouse_units one of 3, 4 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal_alias:townhouse_units not one of 3, 4 Then
            Do DELETE_agqEND
        End

    If L_CODE_25 <> "" Then
        Begin
        L_CODE = L_CODE_25
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal_alias:townhouse_units one of 5, 6, 7, 8 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal_alias:townhouse_units not one of 5, 6, 7, 8 Then
            Do DELETE_agqEND
        End

    If L_CODE_26 <> "" Then
        Begin
        L_CODE = L_CODE_26
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqpersonal_alias:townhouse_units > 8 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqpersonal_alias:townhouse_units <= 8 Then
            begin
            Do DELETE_agqEND
            do delete_agqendorse1
            end
        End

    If L_CODE_29 <> "" And
       SFSLINE:LOB_CODE = "HOME" Then
        Begin
        L_CODE = L_CODE_29
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqPERSONAL_ALIAS:REMOVE_SAL04 = 0 then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" and
           agqpersonal_alias:remove_sal04 = 1 Then
            Do DELETE_agqEND
        End

    If L_CODE_30 <> "" Then
        Begin
        L_MPL49 = "N"
        L_CODE = L_CODE_30
        Do ACCESS_agqEND
        If L_MPL47 = "N" And
           L_MPL49 = "N" and
           agqpersonal_alias:remove_mpl47 = 0 Then
            Begin
            Do ADD_agqEND
            End
        Do CHANGE_CONTENTS
        End

    End

--if sfssecurity_rating:auto_screen_jump not one of 1 then
--    FUNCTION = "redisplay"

End

procedure update_agqpersonal
begin
access agqpersonal_alias, set agqpersonal_alias:app_no   = agqpersonal:app_no,
                              agqpersonal_alias:prem_no  = agqpersonal:prem_no,
                              agqpersonal_alias:build_no = agqpersonal:build_no, generic

change agqpersonal_alias
    begin
    agqpersonal_alias:alarm_option[5] = 1
    agqpersonal_alias:alarm_factor[5] = 1.00
    agqpersonal_alias:alarm_included  = 1
    end

end

procedure get_sfszipcode
begin
l_val_zipcode = agqpersonal:zipcode
l_str_zipcode = agqpersonal:str_zipcode[1,5] + "0000"
access sfszipcode, set sfszipcode:company_id       = agqpersonal:company_id,
                       sfszipcode:state            = agqpersonal:state,
                       sfszipcode:line_of_business = agqpersonal:line_of_business,
                       sfszipcode:str_zipcode      = l_str_zipcode, generic

l_tier = 0
while sfszipcode:company_Id       = agqpersonal:company_id and
      sfszipcode:state            = agqpersonal:state and
      sfszipcode:line_of_business = agqpersonal:line_of_business and
      sfszipcode:str_zipcode      = l_str_zipcode
        begin
        if (agqpersonal:eff_date >= sfszipcode:eff_date and
           (agqpersonal:eff_date <= sfszipcode:exp_date or
           sfszipcode:exp_date = 0)) then
            begin
            l_restricted = sfszipcode:restricted
            l_restricted_distance = sfszipcode:restricted_distance
            end

        next sfszipcode
        end

end

procedure update_limits
begin
Access agsdefault_plp, Set agsdefault_plp:COMPANY_ID       = agqpersonal:COMPANY_ID,
                           agsdefault_plp:state            = agqpersonal:state,
                           agsdefault_plp:agent_no         = agqpersonal:agent_no,
                           agsdefault_plp:LINE_OF_BUSINESS = G_LINE_OF_BUSINESS,
                           agsdefault_plp:form             = g_form, generic

if agqpersonal:dwelling_limit <> 0 then
    begin
    agqpersonal:STRUCTURES_LIMIT[1] = (agqpersonal:DWELLING_LIMIT *
                                      (AGSDEFAULT_PLP:COVERAGE_B_PERCENT
                                      Divide 100))
    end
else
    begin
    agqpersonal:structures_limit[1] = 0
    end

if agqpersonal:dwelling_limit <> 0 and
   sfsline:lob_code one of "HOME" then
    begin
    L_UPDATED = "N"
    L_CODE = "MPL47"
    Do ACCESS_agqend
    If L_ADD_ENDORSEMENT = "N" Then
        Begin
        Do ACCESS_SFSOPTEND
        L_DEFAULT_CONTENTS_LIMIT = (AGQPERSONAL:DWELLING_LIMIT *
                                   (L_INCREASE_COV_C Divide 100))
        L_UPDATED = "Y"
        End

    L_CODE = "MPL49"
    Do ACCESS_agqend
    If L_ADD_ENDORSEMENT = "N" Then
        Begin
        Do ACCESS_SFSOPTEND
        L_DEFAULT_CONTENTS_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                                   (L_INCREASE_COV_C Divide 100))
        L_UPDATED = "Y"
        End

    If L_ADD_ENDORSEMENT = "Y" And
       L_UPDATED = "N" Then
        Begin
        L_DEFAULT_CONTENTS_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                                   (agsdefault_plp:COVERAGE_C_PERCENT
                                   Divide 100))
        End

    agqpersonal:contents_limit = l_default_contents_limit
    end

If agqPERSONAL:DWELLING_LIMIT <> 0 Then
    Begin
    agqPERSONAL:LOSS_RENTS_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                                   (agsdefault_plp:COVERAGE_D_PERCENT
                                   Divide 100))
    End
else
    Begin
    agqPERSONAL:LOSS_RENTS_LIMIT = (agqPERSONAL:CONTENTS_LIMIT *
                                   (agsdefault_plp:COVERAGE_D_PERCENT
                                   Divide 100))
    End

end

Procedure CHECK_FOR_UNDER_CONSTRUCTION
Begin
Access agqend, Set agqend:app_no   = agqPERSONAL:app_no ,
                   agqend:PREM_NO  = agqPERSONAL:PREM_NO,
                   agqend:BUILD_NO = agqPERSONAL:BUILD_NO, Generic

L_MPL13 = "N"
Repeat Begin
    Exit If agqend:app_no <> agqPERSONAL:app_no Or
            agqend:PREM_NO <> agqPERSONAL:PREM_NO Or
            agqend:BUILD_NO <> agqPERSONAL:BUILD_NO

    If agqend:CODE = "MPL13" Then
        L_MPL13 = "Y"

    Next agqend
    End

End

procedure add_agqendorse1
begin
Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqpersonal:COMPANY_ID,
                      SFSOPTEND:STATE            = agqPERSONAL:STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS,
                      SFSOPTEND:CODE             = L_CODE, Generic

while SFSOPTEND:COMPANY_ID       = agqpersonal:COMPANY_ID and
      SFSOPTEND:STATE            = agqPERSONAL:STATE and
      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS and
      SFSOPTEND:CODE             = L_CODE
    begin
    If (agqpersonal:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqpersonal:eff_date <= sfsoptend:Exp_date or
       sfsoptend:Exp_date = 0)) Then
        Begin
        L_limit = sfsoptend:limit[1]
        End

    Next SFSOPTEND
    End

access agqendorse1, set agqendorse1:app_no   = agqpersonal:app_no,
                        agqendorse1:prem_no  = agqpersonal:prem_no,
                        agqendorse1:build_no = agqpersonal:build_no,
                        agqendorse1:code     = l_code, generic

add agqendorse1
    begin
    agqendorse1:app_no   = agqpersonal:app_no
    agqendorse1:prem_no  = agqpersonal:prem_no
    agqendorse1:build_no = agqpersonal:build_no
    agqendorse1:code     = l_code
    agqendorse1:sub_code = 10
    agqendorse1:limit[1] = l_limit
    end

end

procedure delete_agqendorse1
begin
access agqendorse1, set agqendorse1:app_no   = agqpersonal:app_no,
                       agqendorse1:prem_no  = agqpersonal:prem_no,
                       agqendorse1:build_no = agqpersonal:build_no,
                       agqendorse1:code     = l_code, generic

if agqendorse1:app_no = agqpersonal:app_no and
   agqendorse1:prem_no  = agqpersonal:prem_no and
   agqendorse1:build_no = agqpersonal:build_no and
   agqendorse1:code     = l_code then
    delete agqendorse1

end

Procedure CHANGE_CONTENTS
Begin
L_UPDATED = "N"
L_CODE = "MPL47"
Do ACCESS_agqend
If L_ADD_ENDORSEMENT = "N" Then
    Begin
    Do ACCESS_SFSOPTEND
    Change agqPERSONAL_ALIAS
        Begin
        L_LIMIT = (agqPERSONAL_ALIAS:DWELLING_LIMIT *
                  (L_INCREASE_COV_C Divide 100))
        If agqPERSONAL_ALIAS:CONTENTS_LIMIT < L_LIMIT Then
            agqPERSONAL_ALIAS:CONTENTS_LIMIT = L_LIMIT
        End
    L_UPDATED = "Y"
    End

L_CODE = "MPL49"
Do ACCESS_agqend
If L_ADD_ENDORSEMENT = "N" Then
    Begin
    Do ACCESS_SFSOPTEND
    Change agqPERSONAL_ALIAS
        Begin
        L_LIMIT = (agqPERSONAL_ALIAS:DWELLING_LIMIT *
                  (L_INCREASE_COV_C Divide 100))
        If agqPERSONAL_ALIAS:CONTENTS_LIMIT < L_LIMIT Then
            agqPERSONAL_ALIAS:CONTENTS_LIMIT = L_LIMIT
        End
    L_DEFAULT_CONTENTS_LIMIT = (agqPERSONAL:DWELLING_LIMIT *
                               (L_INCREASE_COV_C Divide 100))
    L_UPDATED = "Y"
    End
End

Procedure CHANGE_ALARM_FACTOR
Begin
L_CODE = "MPL70"
Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqpersonal:COMPANY_ID,
                      SFSOPTEND:STATE            = agqPERSONAL:STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS,
                      SFSOPTEND:CODE             =  L_CODE, Generic

Repeat Begin
    Exit If SFSOPTEND:COMPANY_ID <> agqpersonal:COMPANY_ID Or
            SFSOPTEND:STATE <> agqPERSONAL:STATE Or
            SFSOPTEND:LINE_OF_BUSINESS <> agqpersonal:LINE_OF_BUSINESS Or
            SFSOPTEND:CODE <> L_CODE

    If (agqpersonal:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqpersonal:eff_date <= sfsoptend:Exp_date or
       sfsoptend:Exp_date = 0)) Then
        Begin
        L_PREMIUM_1 = SFSOPTEND:PREMIUM_1[5]
        End

    Next SFSOPTEND
    End

Access agqPERSONAL_ALIAS, Set agqPERSONAL_ALIAS:app_no   = agqPERSONAL:app_no,
                              agqPERSONAL_ALIAS:PREM_NO  = agqPERSONAL:PREM_NO,
                              agqPERSONAL_ALIAS:BUILD_NO = agqPERSONAL:BUILD_NO, Generic

Change agqPERSONAL_ALIAS
    Begin
    agqPERSONAL_ALIAS:ALARM_OPTION[5] = 1
    agqPERSONAL_ALIAS:ALARM_FACTOR[5] = L_PREMIUM_1
    agqPERSONAL_ALIAS:ALARM_INCLUDED  = 0
    End

End

Procedure ACCESS_agqend
Begin
Access agqend, Set agqend:app_no   = agqPERSONAL:app_no ,
                   agqend:PREM_NO  = agqPERSONAL:PREM_NO,
                   agqend:BUILD_NO = agqPERSONAL:BUILD_NO, Generic

L_ADD_ENDORSEMENT = "Y"
L_MPL47 = "N"
l_mho45 = "N"
Repeat Begin
    Exit If agqend:app_no <> agqPERSONAL:app_no Or
            agqend:PREM_NO <> agqPERSONAL:PREM_NO Or
            agqend:BUILD_NO <> agqPERSONAL:BUILD_NO

    If agqend:CODE = L_CODE Then
        L_ADD_ENDORSEMENT = "N"
    If agqend:CODE = "MPL47" Then
        L_MPL47 = "Y"
    If agqend:CODE = "MPL49" Then
        L_MPL49 = "Y"
    if agqend:code = "MHO45" then
        l_MHO45 = "Y"

    Next agqend
    End

Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqpersonal:COMPANY_ID,
                      SFSOPTEND:STATE            = agqPERSONAL:STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS,
                      SFSOPTEND:CODE             = L_CODE, Generic

L_SAL_EFF_DATE = 0
Repeat Begin
    Exit If SFSOPTEND:COMPANY_ID <> agqpersonal:COMPANY_ID Or
            SFSOPTEND:STATE <> agqPERSONAL:STATE Or
            SFSOPTEND:LINE_OF_BUSINESS <> agqpersonal:LINE_OF_BUSINESS Or
            SFSOPTEND:CODE <> L_CODE

    If (agqpersonal:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqpersonal:eff_date <= sfsoptend:Exp_date or
       sfsoptend:Exp_date = 0)) Then
        Begin
        If SFSOPTEND:CODE one of "SAL01", "FPL01" Then
            L_SAL_EFF_DATE = SFSOPTEND:EFF_DATE
        end

    Next SFSOPTEND
    End

End

Procedure ACCESS_SFSOPTEND
Begin
Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqpersonal:COMPANY_ID,
                      SFSOPTEND:STATE            = agqPERSONAL:STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS,
                      SFSOPTEND:CODE             = L_CODE, Generic

Repeat Begin
    Exit If SFSOPTEND:COMPANY_ID <> agqpersonal:COMPANY_ID Or
            SFSOPTEND:STATE <> agqPERSONAL:STATE Or
            SFSOPTEND:LINE_OF_BUSINESS <> agqpersonal:LINE_OF_BUSINESS Or
            SFSOPTEND:CODE <> L_CODE

    If (agqpersonal:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqpersonal:eff_date <= sfsoptend:exp_date or
       sfsoptend:Exp_date = 0)) Then
        L_INCREASE_COV_C = SFSOPTEND:PREMIUM_1[5]

    Next SFSOPTEND
    End

End

Procedure ADD_agqend
Begin
Access agqend, Set agqend:app_no   = agqPERSONAL:app_no ,
                   agqend:PREM_NO  = agqPERSONAL:PREM_NO,
                   agqend:BUILD_NO = agqPERSONAL:BUILD_NO, Generic

L_SUB_CODE = 0
Repeat Begin
    Exit If agqend:app_no <> agqPERSONAL:app_no Or
            agqend:PREM_NO <> agqPERSONAL:PREM_NO Or
            agqend:BUILD_NO <> agqPERSONAL:BUILD_NO

    L_SUB_CODE = agqend:SUB_CODE

    Next agqend
    End

L_SUB_CODE = L_SUB_CODE + 10

Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqpersonal:COMPANY_ID,
                      SFSOPTEND:STATE            = agqPERSONAL:STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS,
                      SFSOPTEND:CODE             = L_CODE, Generic

l_description = ""
l_form_edition = ""
Repeat Begin
    Exit If SFSOPTEND:COMPANY_ID <> agqpersonal:COMPANY_ID Or
            SFSOPTEND:STATE <> agqPERSONAL:STATE Or
            SFSOPTEND:LINE_OF_BUSINESS <> agqpersonal:LINE_OF_BUSINESS Or
            SFSOPTEND:CODE <> L_CODE

    If (agqpersonal:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqpersonal:eff_date <= sfsoptend:exp_date or
       sfsoptend:exp_date = 0)) Then
        Begin
        L_FORM_EDITION = SFSOPTEND:FORM_EDITION
        L_DESCRIPTION = SFSOPTEND:DESCRIPTION
        End

    Next SFSOPTEND
    End

if l_description <> "" then
begin
Add agqend
    Begin
    agqend:app_no               =       agqPERSONAL:app_no
    agqend:PREM_NO              =       agqPERSONAL:PREM_NO
    agqend:BUILD_NO             =       agqPERSONAL:BUILD_NO
    agqend:SUB_CODE             =       L_SUB_CODE
    agqend:CODE                 =       L_CODE
    agqend:FORM_EDITION         =       L_FORM_EDITION
    agqend:DESCRIPTION          =       L_DESCRIPTION
    End
end

End

Procedure DELETE_agqend
Begin
Access agqend, Set agqend:app_no   = agqPERSONAL:app_no ,
                   agqend:PREM_NO  = agqPERSONAL:PREM_NO,
                   agqend:BUILD_NO = agqPERSONAL:BUILD_NO, Generic

Repeat Begin
    Exit If agqend:app_no <> agqPERSONAL:app_no Or
            agqend:PREM_NO <> agqPERSONAL:PREM_NO Or
            agqend:BUILD_NO <> agqPERSONAL:BUILD_NO

    If agqend:CODE = L_CODE Then
        Delete agqend

    Next agqend
    End

End

Procedure GET_DWELLING_TABLE
Begin
L_RECORD_KEY = "TB"
L_COMPANY_ID = agqpersonal:COMPANY_ID
L_LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS
L_STATE = agqPERSONAL:STATE
L_OWNER_OCCUPIED = agqPERSONAL:OWNER_OCCUPIED
L_NO_FAMILIES = agqPERSONAL:NO_FAMILIES
L_EFF_DATE = agqpersonal:EFF_DATE

Include "plsdftable.pro"

agqPERSONAL:TABLE   = L_TABLE
agqpersonal:table_1 = l_table
End

Procedure ACCESS_SFSOPTEND_1
Begin
L_CODE = "MPL70"
Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID = agqpersonal:COMPANY_ID,
                      SFSOPTEND:STATE = agqPERSONAL:STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:LINE_OF_BUSINESS,
                      SFSOPTEND:CODE =  L_CODE, Generic

Repeat Begin
    Exit If SFSOPTEND:COMPANY_ID <> agqpersonal:COMPANY_ID Or
            SFSOPTEND:STATE <> agqPERSONAL:STATE Or
            SFSOPTEND:LINE_OF_BUSINESS <> agqpersonal:LINE_OF_BUSINESS Or
            SFSOPTEND:CODE <> L_CODE

    If agqpersonal:EFF_DATE >= SFSOPTEND:EFF_DATE Then
        Begin
        L_PREMIUM_1 = SFSOPTEND:PREMIUM_1[1]
        L_PREMIUM_2 = SFSOPTEND:PREMIUM_1[2]
        L_PREMIUM_3 = SFSOPTEND:PREMIUM_1[3]
        L_PREMIUM_4 = SFSOPTEND:PREMIUM_1[4]
        L_PREMIUM_5 = SFSOPTEND:PREMIUM_1[5]
        L_PREMIUM_6 = SFSOPTEND:PREMIUM_1[6]
        End

    Next SFSOPTEND
    End

End

procedure back_a_screen
begin
    postevent("agtmt010","REMOVE_SCREEN")

end

procedure access_sfscsexec
begin
I_CSEXEC_APPLICATION = "APQQUOTE                 "

Access SFSCSEXEC,
   Set SFSCSEXEC:APPLICATION = I_CSEXEC_APPLICATION, Generic

Change SFSCSEXEC
    Begin
    I_CSEXEC_NUMBER = SFSCSEXEC:APPLICATION_NUMBER + 1
    SFSCSEXEC:APPLICATION_NUMBER = I_CSEXEC_NUMBER
    End

End

Procedure ACCESS_agqend_1
Begin
Access agqend, Set agqend:app_no = G_app_no ,
                   agqend:PREM_NO = 0,
                   agqend:BUILD_NO = 0, Generic

L_ADD_ENDORSEMENT = "Y"
while agqend:app_no = G_app_no and
      agqend:PREM_NO  = 0 and
      agqend:BUILD_NO = 0
    begin
    If agqend:CODE = L_CODE Then
        L_ADD_ENDORSEMENT = "N"

    Next agqend
    End

End

Procedure ADD_agqend_1
Begin
Access agqend, Set agqend:app_no = G_app_no ,
                   agqend:PREM_NO  = 0,
                   agqend:BUILD_NO = 0, Generic

L_SUB_CODE = 0
while agqend:app_no = G_app_no and
      agqend:PREM_NO  = 0 and
      agqend:BUILD_NO = 0
    begin
    L_SUB_CODE = agqend:SUB_CODE

    Next agqend
    End

L_SUB_CODE = L_SUB_CODE + 10

Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqpersonal:company_id,
                      SFSOPTEND:STATE            = agqpersonal:STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business,
                      SFSOPTEND:CODE             = L_CODE, Generic

while SFSOPTEND:COMPANY_ID       = agqpersonal:company_id and
      SFSOPTEND:STATE            = agqpersonal:STATE and
      SFSOPTEND:LINE_OF_BUSINESS = agqpersonal:line_of_business and
      SFSOPTEND:CODE             = L_CODE
    begin
    If (agqpersonal:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqpersonal:eff_date <= sfsoptend:exp_date or
       sfsoptend:exp_date = 0)) Then
        Begin
        L_FORM_EDITION = SFSOPTEND:FORM_EDITION
        L_DESCRIPTION  = SFSOPTEND:DESCRIPTION
        l_mcp140_limit = sfsoptend:limit[1]
        End

    Next SFSOPTEND
    End

Add agqend
    Begin
    agqend:app_no             =       G_app_no
    agqend:PREM_NO              =       0
    agqend:BUILD_NO             =       0
    agqend:SUB_CODE             =       L_SUB_CODE
    agqend:CODE                 =       L_CODE
    agqend:FORM_EDITION         =       L_FORM_EDITION
    agqend:DESCRIPTION          =       L_DESCRIPTION
    agqend:PREMIUM              =       0
    agqend:lob_end_code         =       "X"
    End

End

Procedure DELETE_agqend_1
Begin
Access agqend, Set agqend:app_no = G_app_no ,
                   agqend:PREM_NO  = 0,
                   agqend:BUILD_NO = 0, Generic

while agqend:app_no = G_app_no and
      agqend:PREM_NO  = 0 and
      agqend:BUILD_NO = 0
    begin
    If agqend:CODE = L_CODE Then
        Delete agqend

    Next agqend
    End

End

End
