%%                      
Screen
        Name = "agtmt401";
        Type = "Detail" ;
        Highlight=Underscore ;
        highlightfield="Yes";
        Padcharacter=Space ;
        Screensize="dynamic";
        Windowtitle="%a     %s Rating Information - Ver. 7.00     %m";
        Domain="agqvehicle" ;
        resizeable = yes ;
        iconline = 0 ;

        Global Unsigned Ascii Number G_APP_NO[11] ;
        Global Unsigned Ascii Number G_LINE_OF_BUSINESS[4] ;
        Global Unsigned Ascii Number G_OPT[2] ;
        global unsigned ascii number g_add_prem_no[1] ;
        global unsigned ascii number g_add_build_no[1] ;
        global unsigned ascii number g_add_new_quote[1] ;
        global unsigned ascii number g_vehicle_no[4] ;
        global unsigned ascii number g_from_search_screen[1] ;
        global unsigned ascii number g_type[1] ;

        global string g_company_id[10] ,
                      g_initial_screen[50] ,
                      g_ok_to_add[1] ,
                      g_display_modal[1] ,
                      g_type_str[1] ,
                      g_portfolio[1] ;

        rwdate l_agqvehicle_eff_date;
        wdate  l_rich_date;

        local tag l_tag[10] ;

        array[10] of string l_view_desc[85] ;
        array[10] of tag l_the_tag[15] ;

        Local Unsigned Ascii Number L_SUB_CODE[4] ,
                                    L_STATE[2],
                                    l_basic_limit_1[8],
                                    l_zip_code_5[5],
                                    l_basic_limit_2[8],
                                    l_extended_limit[8],
                                    l_extended_addl_limit[8],
                                    l_first_prem_no[4],
                                    l_count[2],
                                    l_possible_counties[2],
                                    l_length[75],
                                    l_first_build_no[4],
                                    l_last_prem_no[4],
                                    l_last_build_no[4],
                                    l_limit[8],
                                    l_ca2001[1],
                                    l_ca9937[1],
                                    l_ca9923[1],
                                    l_ca2001_prior[1],
                                    l_ca9937_prior[1],
                                    l_ca9923_prior[1],
                                    l_remove_form[1],
                                    l_agent_no[4],
                                    l_no_years[3]=0,
                                    l_county[3],
                                    l_acv_factor[5]=0/dec=3,
                                    l_app_no[11],
                                    l_rating_territory[3],
                                    l_loop[4],
                                    l_exclude_terrorism[1]=0,
                                    l_prem_no[4]=0,
                                    l_first_bold_one[1]=0,
                                    l_second_bold_one[1]=0,
                                    l_no_vehicles[2]=0,
                                    l_vehicle_no[4]=0,
                                    l_build_no[4]=0,
                                    l_off_premises_limit[8]=0,
                                    l_mcp140_limit[8],
                                    l_mm[2],
                                    l_signs_limit[5],
                                    l_valuable_papers_limit[5],
                                    l_water_limit[5],
                                    l_credit_card_limit[5],
                                    l_yyyy[4],
                                    l_dd[2],
                                    l_territory[3],
                                    l_minimum_limit[8],
                                    l_maximum_limit[8],
                                    l_zipcode[9],
                                    l_building_minimum_limit[8],
                                    l_contents_minimum_limit[8],
                                    l_combined_minimum_limit[8],
                                    l_building_maximum_limit[8],
                                    l_contents_maximum_limit[8],
                                    l_combined_maximum_limit[8],
                                    l_building_binding_limit[8],
                                    l_contents_binding_limit[8],
                                    l_combined_binding_limit[8],
                                    l_min_error[1],
                                    l_sub[2],
                                    l_sub_1[5],
                                    l_field_no[4]=0,
                                    l_tag_position[2]=0,
                                    l_len_string[5]=0,
                                    l_max_error[1],
                                    l_binding_error[1],
                                    l_combined_limit[8]=0,
                                    l_rating_territory_group_1[1],
                                    l_rating_territory_group_2[1],
                                    l_rating_territory_group_3[1],
                                    l_group_1[5]=0/dec=3,
                                    l_group_2[5]=0/dec=3,
                                    L_CLASS_CODE[5],
                                    l_restaurant[1],
                                    l_year[4],
                                    l_end_sequence[4],
                                    L_PROPERTY_LIMIT[8]=0,
                                    l_property_limit_1[8]=0,
                                    L_LINE_OF_BUSINESS[4] ,
                                    L_AR_LIMIT[8],
                                    L_COMPUTER_LIMIT[8],
                                    l_computer_limit_1[8],
                                    l_computer_limit_2[8],
                                    l_csexec_number[12],
                                    i_csexec_number[12],
                                    l_abort_program[1],
                                    L_UTILITY_LIMIT[8],
                                    L_MECHANICAL_LIMIT[8],
                                    L_EXTERIOR_SIGNS_LIMIT[8],
                                    L_EMPLOYEE_LIMIT[8],
                                    L_GLASS_LIMIT[8],
                                    L_SEWER_LIMIT[8],
                                    L_VALUABLE_LIMIT[8],
                                    L_FORM[1] ,
                                    l_Form_1[1] ;

        Local String L_DESC[50] ,
                     L_REINSURANCE[1] ,
                     l_record_key[2],
                     l_county_description[75],
                     l_add_med_exp_code[1],
                     l_agent_wording[10]="Agent No:",
                     l_class_code_1[5],
                     l_screen_name[15],
                     l_territory_desc[50],
                     l_fob[1],
                     l_fob_desc[50],
                     l_fob_description[50],
                     l_fob_description1[75],
                     l_form_of_business[1],
                     l_text_1[85],
                     l_um_uim[3],
                     l_text_2[85],
                     l_server_name[100],
                     l_current_web_page[100],
                     l_web_site_address[150],
                     l_first_bold[1]="Y",
                     l_last_bold[1]="N",
                     l_first_str_vehicle[8],
                     l_last_str_vehicle[8],
                     l_str_vehicle[8],
                     i_csexec_application[25] ,
                     l_first_vehicle[1]="Y",
                     l_string_view[15],
                     l_printers_credit_wording[23]="Printers Credit:",
                     l_total_printers_wording[23]="Total Printers:",
                     l_first[1],
                     l_str_zipcode[9]="",
                     l_buyback_option_wording[23]="Buyback Option Charge:",
                     l_fungi_mold_wording[23]="Fungi/Mold Limitations:",
                     l_irpm_wording[12]="IRPM:",
                     l_enter[1],
                     l_minimum_message[200],
                     l_combined_minimum_message[200],
                     l_maximum_message[200],
                     l_combined_maximum_message[200],
                     l_binding_message[200],
                     l_combined_binding_message[200],
                     l_contact_message[200],
                     l_mp_wording[4]="M.P.",
                     l_continue_1[3]="",
                     l_continue_2[3]="",
                     l_continue_3[3]="",
                     l_dec[15]="",
                     l_app[3]="agq",
                     L_CODE[7],
                     L_CODE_1[7],
                     L_CODE_2[7],
                     L_CODE_3[7],
                     L_CODE_4[7],
                     L_CODE_5[7],
                     L_CODE_6[7],
                     L_CODE_7[7],
                     L_CODE_8[7],
                     l_code_9[7],
                     l_code_10[7],
                     l_code_11[7],
                     l_code_12[7],
                     l_code_13[7],
                     l_code_14[7],
                     L_ACV_CODE[7],
                     L_BUSES_CODE[7],
                     L_PLATES_CODE[7],
                     L_MOTOR_HOME_CODE[7],
                     L_MEDICAL_EXP_MOTOR_BUS_CODE[7],
                     l_auto_term_code[7],
                     l_csexec_application[25],
                     l_processing_system[30],
                     l_rating_system[40],
                     l_territory_wording[10]="Territory:",
                     l_system_id[15],
                     L_SCREEN[15] ,
                     l_screen_1[9],
                     L_FORM_EDITION[18],
                     L_DESCRIPTION[55],
                     L_COMPUTER_DESC[50] ,
                     l_computer_desc_1[50],
                     L_DELETE_NONOWNED_HIRED[1]="N",
                     L_ADD_ENDORSEMENT[1]="Y",
                     L_PROPERTY_LIMIT_CHANGE[1]="N",
                     l_agqvehicle_str[10],
                     L_COMPANY_ID[10] ;

        local wdate l_eff_date ,
                    l_bpssupplemental_eff_date ,
                    l_prior_eff_date,
                    l_new_eff_date ;

        include "print.var"

        include "virtualdecs.var"

        Access agqvehicle,
           Set agqvehicle:app_no = G_app_no, generic

        Include "stdkeys7.inc"

Style Definition
        Include "styles.inc"
        Displayonly Field Style {
                                  backgroundcolor="#CCCCCC"
                                }


Functions

        "redisplay" display/noreturn "agtmt401" ;

        "add" sequence "new"      tagged add_fn ;
        "new" add/hidden ;

        "change" sequence "chg"   tagged change_fn ;
        "chg" change/hidden ;

        "func1" display/noreturn "agtmt402"   tagged calc_fn ;
        "func2" display/noreturn "agtmt400"   tagged vehicle_type_fn ;
        "option" display/noreturn "agtmt377" ;
        "hired" display/noreturn "agtmt401b" ;

        "back" sequence "goto" tagged back_fn ;
        "goto" continue begin
                        if g_portfolio not one of "Y" then
                            l_screen_1 = "agtmt001"
                        else
                            l_screen_1 = "agtmt9999"
                        function = "popup"
                        end ;
        "popup" display/noreturn l_screen_1 ;

        reaccess ;

        include "stdfunc7b.inc"

EVENT DEFINITION
        default eventhandler {
                             "REMOVE_SCREEN" { function = "exit" abort () }
                             "reload" { function = "reaccess" abort () }
                             "display_message" { warning "" + event.value }
                             "current_line_of_business" {
                                                          g_line_of_business = val(event.value)
                                                        }
                             }
Menu Definition

Toolbar Definition

Screen Entry
if g_vehicle_no = 0 then
    g_vehicle_no = 1
access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

g_initial_screen = ""
l_username = username
l_company_id = sfsdefault:company_id

l_username = username
access sfsemail, set sfsemail:company_id = l_company_id,
                     sfsemail:user_id    = l_username, generic

l_agent_no = sfsemail:agent_no
access sfsagent, set sfsagent:company_id = l_company_id,
                     sfsagent:agent_no   = l_agent_no, generic

access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

switch(g_line_of_business)
  case 15 : setproperty(t_line_of_business,iconname,"title_com_auto_std.bmp")
  case 16 : setproperty(t_line_of_business,iconname,"title_com_auto_pref.bmp")
  default : setproperty(t_line_of_business,iconname,"")
  end

if sfsdefault:company_id one of "FLEMINGTON" then
    begin
    hide(lebins_fn)
    hide(farmers_fn)
    end
else
if sfsdefault:company_id one of "FARMERS" then
    begin
    hide(lebins_fn)
    hide(ficof_fn)
    end
else
if sfsdefault:company_id one of "LEBINS" then
    begin
    hide(ficof_fn)
    hide(farmers_fn)
    end

l_state = sfsagent:state
if l_state = 0 then
    l_state = sfsdefault:state
Access SFSLINE_ALIAS, Set SFSLINE_alias:COMPANY_ID       = l_company_id,
                          SFSLINE_alias:LINE_OF_BUSINESS = g_line_of_business,
                          SFSLINE_alias:LOB_SUBLINE      = "00", Generic

access agqname, set agqname:app_no = g_app_no, generic

if g_line_of_business = 99 or
   agqname:line_of_business = 99 then
    l_line_of_business = 15
else
    l_line_of_business = g_line_of_business

access agqvehicle,
   set agqvehicle:app_no = g_app_no, generic

if l_state one of 29 then
    {
    do check_for_mca825
    }

access sfsprofile,
   set sfsprofile:user_id  = l_username, exact

If SFSPROFILE:USER_ID <> L_USERNAME Then
  Begin
    L_USERNAME = "default"
    Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact
  End

l_server_name = sfsprofile:UNIX_SERVER                            --"http://192.168.1.197/"

if l_company_id = "FLEMINGTON" then
    begin
    if agqvehicle:app_no = 0 then
        {
        l_current_web_page = "webhelp_scr_bop_rating_no_proposal_num.htm"
        do change_current_browser(l_server_name,l_current_web_page)
        }
    else
        {
        l_current_web_page = "019webhelp_agtmt401_scr_rating_info_with_name.htm"
        do change_current_browser(l_server_name,l_current_web_page)
        }
    end

access agqname, set agqname:app_no = g_app_no,generic

if agqname:quote_no <> 0 then
    begin
    disable(add_fn)
    disable(change_fn)
    disable(delete_fn)
    disable(accept_fn)
    end

if agqvehicle:app_no = 0 then
    begin
    disable(previous_fn)
    disable(next_fn)
    end

l_screen_name = "agtmt401"
if g_app_no = 0 then
    l_field_no = 9997
else
    l_field_no = 9999

if g_ok_to_add = "Y" then
    begin
    function = "ADD"
    end

if function one of "ADD", "NEW" then
    begin
    if g_type_str = "1" then
        begin
        show(truck_fn)
        hide(hired_fn)
        hide(other_fn)
        hide(garage_fn)
        end
    else
    if g_Type_str not one of "G", "H" then
        begin
        hide(truck_fn)
        hide(hired_fn)
        hide(garage_fn)
        show(other_fn)
        end
    else
    if g_type_str one of "H" then
        begin
        hide(truck_fn)
        hide(other_fn)
        hide(garage_fn)
        show(hired_fn)
        end
    else
    if g_type_str one of "G" then
        begin
        hide(truck_fn)
        hide(other_fn)
        show(garage_fn)
        hide(hired_fn)
        end
    end

if function one of "REDISPLAY", "DISPLAYIT", "DISPLAY_RATING_INFO", "FUNC5", "POPUP", "60FUNC" then
    begin
    g_type_str = agqvehicle:str_type
    if agqvehicle:str_type = "1" then
        begin
        show(truck_fn)
        hide(other_fn)
        hide(hired_fn)
        hide(garage_fn)
        end
    else
    if g_type_str not one of "H", "G" then
        begin
        hide(truck_fn)
        show(other_fn)
        hide(garage_fn)
        hide(hired_fn)
        end
    else
    if g_type_str one of "H" then
        begin
        hide(truck_fn)
        hide(other_fn)
        hide(garage_fn)
        show(hired_fn)
        end
    else
    if g_type_str one of "G" then
        begin
        hide(truck_fn)
        hide(other_fn)
        show(garage_fn)
        hide(hired_fn)
        end
    end

access validation
if agqvehicle:app_no <> g_app_no then
    error 1000

if function one of "NEXT", "PREVIOUS" then
    begin
    g_type_str = agqvehicle:str_type
    if agqvehicle:str_type = "1" then
        begin
        hide(other_fn)
        show(truck_fn)
        hide(garage_fn)
        hide(hired_fn)
        end
    else
    if g_type_str not one of "H", "G" then
        begin
        hide(truck_fn)
        hide(garage_fn)
        hide(hired_fn)
        show(other_fn)
        end
    else
    if g_type_str one of "H" then
        begin
        hide(truck_fn)
        hide(other_fn)
        hide(garage_fn)
        show(hired_fn)
        end
    else
    if g_type_str one of "G" then
        begin
        hide(truck_fn)
        hide(other_fn)
        show(garage_fn)
        hide(hired_fn)
        end
    end

access agqvehicle_alias, set agqvehicle_alias:app_no = agqvehicle:app_no, generic

l_first_str_vehicle = ""
l_first_vehicle = "Y"
l_last_str_vehicle = ""
l_no_vehicles = 0
while agqvehicle_alias:app_no = agqvehicle:app_no
    begin
    if l_first_vehicle = "Y" then
        begin
        l_first_str_vehicle  = str(agqvehicle_alias:vehicle_no)
        l_first_vehicle = "N"
        end
    l_last_str_vehicle  = str(agqvehicle_alias:vehicle_no)
    l_no_vehicles  = l_no_vehicles + 1

    next agqvehicle_alias
    end

l_str_vehicle = str(agqvehicle:vehicle_no)

if l_no_vehicles one of 0, 1 then
    begin
    disable(next_fn)
    disable(previous_fn)
    end
else
if l_str_vehicle = l_first_str_vehicle and
   l_no_vehicles > 1 then
    begin
    disable(previous_fn)
    enable(next_fn)
    end
else
if l_str_vehicle <> l_first_str_vehicle and
   l_str_vehicle <> l_last_str_vehicle and
   l_no_vehicles > 1 then
    begin
    enable(next_fn)
    enable(previous_fn)
    end
else
if l_str_vehicle = l_last_str_vehicle and
   l_no_vehicles > 1 then
    begin
    disable(next_fn)
    enable(previous_fn)
    end

screen at 1,1 to 30,100
Properties
        {
          Layouttype = screen
          transparent = False
          backgroundcolor = "#ADD8E6"
          scrollbarpolicy=always
        }
{

    Panel at 1,1 to 2,100
        Properties
            {
            layouttype = screen
            }
        {
        components
            guidetext at 1,1 to 2,40
                properties
                    {
                    iconname = "qp_logo.gif"
                    }
            guidetext at 1,83 to 2,100 tagged ficof_fn
                properties
                    {
                    iconname = "ficof_logo.gif"
                    }
            guidetext at 1,83 to 2,100 tagged lebins_fn
                properties
                    {
                    iconname = ""
                    }
            guidetext at 1,83 to 2,100 tagged farmers_fn
                properties
                    {
                    iconname = "salem_logo.gif"
                    }
            guidetext at 1,35 to 2,100 tagged t_line_of_business
                Properties
                   {
                   iconname = "title_bop.gif"
                   }

        }

panel at 3,1 to 4,100
Properties
        {
        LayoutType = screen
        backgroundcolor = "Grey"
        transparent = False
        }
{
components
          guidetext at 1.45,1 to 1.45,40     tagged display_information_box
                properties
                  {
                    text = "Rating Information..."
                    fontsize = 18
                    fontstyle = BOLD
                    fontname = "arial"
                    transparent = False
                    backgroundcolor = "Grey"
                  }

}

Panel at 3.45,75 to 4.45, 100
Properties
        {
          LayoutType = screen
        }
{
%%
App No: ___________

%%
fields
101     begin
        l_company_id = sfsdefault:company_id
        l_username = username
        access sfsemail, set sfsemail:company_id = l_company_id,
                             sfsemail:user_id    = l_username, generic

        if l_agent_no = 0 then
            {
            l_agent_no = 9999
            }
        l_company_id = sfsdefault:company_id
        if l_state = 0 then
            l_state = sfsdefault:state
        Access agsdefault_cap,
           Set agsdefault_cap:COMPANY_ID       = L_COMPANY_ID,
               agsdefault_cap:state            = l_state,
               agsdefault_cap:agent_no         = l_agent_no,
               agsdefault_cap:LINE_OF_BUSINESS = l_LINE_OF_BUSINESS, generic

        if function one of "ADD", "NEW" and
           g_ok_to_add = "N" then
            begin
            g_display_modal = "Y"
            display modal screen "agtmt400"
            with initial function "ADD|BACK"
            if g_type_str = "1" then
                begin
                show(truck_fn)
                hide(other_fn)
                hide(hired_fn)
                hide(garage_fn)
                end
            else
            if g_type_str not one of "G", "H" then
                begin
                hide(truck_fn)
                show(other_fn)
                hide(hired_fn)
                hide(garage_fn)
                end
            else
            if g_type_str one of "H" then
                begin
                hide(truck_fn)
                hide(other_fn)
                hide(garage_fn)
                show(hired_fn)
                end
            else
            if g_type_str one of "G" then
                begin
                hide(truck_fn)
                hide(other_fn)
                show(garage_fn)
                hide(hired_fn)
                end
            g_display_modal = "N"
            agqvehicle:str_type = g_type_str
            if g_type_str not one of "H", "G" then
                agqvehicle:type = val(g_type_str)

            agqvehicle:app_no = g_app_no
            end
        else
        if function one of "ADD", "NEW" then
            begin
            agqvehicle:app_no = g_app_no
            end

        access sfsline, set sfsline:company_id       = agqname:company_id,
                            sfsline:line_of_business = agqname:line_of_business,
                            sfsline:lob_subline      = "00", generic

        if function one of "ADD", "NEW" then
            begin
            if sfsline:lob_code = "CPORTFOLIO" then
                begin
                access agqmastsupp, set agqmastsupp:app_no = g_app_no,
                                        agqmastsupp:line_of_business = l_line_of_business, generic

                if agqmastsupp:app_no <> g_app_no or
                   agqmastsupp:line_of_business <> l_line_of_business then
                    begin
                    add agqmastsupp
                        begin
                        agqmastsupp:app_no           = g_app_no
                        agqmastsupp:line_of_business = l_line_of_business
                        agqmastsupp:liability        = agsdefault_cap:liability
                        if g_type_str not one of "G", "H" then
                            begin
                            agqmastsupp:um_uim_limit[1] = agsdefault_cap:liability
                            agqmastsupp:um_uim_limit[2] = agsdefault_cap:liability
                            end
                        agqmastsupp:vehicle_symbol   = "7"
                        agqmastsupp:non_stacked      = "N"
                        agqmastsupp:non_fleet        = "N"
                        agqmastsupp:covered_by_workers_comp = "N"
                        end
                    end
                else
                if agqmastsupp:app_no = g_app_no and
                   agqmastsupp:line_of_business = agqvehicle:line_of_business then
                    begin
                    change agqmastsupp
                        begin
                        agqmastsupp:liability       = agsdefault_cap:liability
                        if g_type_str not one of "G", "H" then
                            begin
                            agqmastsupp:um_uim_limit[1] = agsdefault_cap:liability
                            agqmastsupp:um_uim_limit[2] = agsdefault_cap:liability
                            end
                        agqmastsupp:vehicle_symbol  = "7"
                        agqmastsupp:non_stacked     = "N"
                        agqmastsupp:non_fleet       = "N"
                        agqmastsupp:covered_by_workers_comp = "N"
                        end
                    end
                end
            else
            begin
            access agqmaster, set agqmaster:app_no = g_app_no, generic

            if agqmaster:app_no <> g_app_no then
                begin
                add agqmaster
                    begin
                    agqmaster:app_no          = g_app_no
                    agqmaster:liability       = agsdefault_cap:liability
                    if g_type_str not one of "G", "H" then
                        begin
                        agqmaster:um_uim_limit[1] = agsdefault_cap:liability
                        agqmaster:um_uim_limit[2] = agsdefault_cap:liability
                        end
                    agqmaster:vehicle_symbol  = "7"
                    agqmaster:non_stacked     = "N"
                    agqmaster:non_fleet       = "N"
                    agqmaster:covered_by_workers_comp = "N"
                   end
                end
            end
            end
        end
        agqvehicle:APP_NO/displayonly ;

}
-- top button bar
Panel at 5,1 to 6,100 Tagged icon_line2_tg
Properties
        {
          LayoutType = screen
        }
{
Components

        Button at 1.5,1   tagged add_fn
        Properties {
                Iconname = "btn_add_vehicle.bmp"
                }
        Events  {
                Action = add_fn
                }

        Button at 1.5,38    tagged change_fn
        Properties {
                Iconname = "btn_edit_vehicle.bmp"
                }
        Events  {
                Action = change_fn
                }

        Button at 1.5, 70 tagged delete_fn
        Properties {
                Iconname = "btn_delete_vehicle.bmp"
                }
        Events  {
                Action = delete_fn
                }
    }

    Panel at 5,94 to 6,96 tagged button_panel
        Properties
            {
            layouttype = column
            }
        {
        Components
            Button to 1,1
                properties
                    {
                    Iconname = "btn_print_screen.bmp"
                    }
                events
                    {
                    action
                        {
                        function = "print"
                        abort()
                        }
                    }
        }

   Panel at 6.45,92
        Properties
            {
            layouttype = column
            }
      {
        Components
            guidetext to 1,1
                properties
                    {
                      text = "agtmt401.sd"
                      fontsize = 9
                    }
      }

Panel at 7,60 to 7,100
      Properties
         {
           layouttype = row
         }
    {
      Components
        Button at 1,55 tagged accept_fn
          properties
            {
              Iconname = "btn_accept_edits.bmp"
            }
          Events  {
                    mouseclicked = accept
                  }

    }

Panel at 8,1 to 9,100 Tagged location
        Properties {
                LayoutType = screen
--                transparent = False
--                backgroundcolor = "White"
        }
        {
         Components
           guidetext at 1.5,5 to 2.5,17
             properties
               {
                 text = "Vehicle No:"
                 fontsize = 12
                 fontname = "arial"
               }
           guidetext at 1.5,22 to 2.5,40
             properties
               {
                 text = "Number of Vehicles:"
                 fontsize = 12
                 fontname = "arial"
               }
           guidetext at 1.5,45 to 2.5,60
             properties
               {
                 text = "Vehicle Type:"
                 fontsize = 12
                 fontname = "arial"
               }
        }

Panel at 8.5,1 to 9,100 Tagged rating_pl
Properties
        {
--          transparent = False
--          backgroundcolor = "White"
        }
{
%%
             ____                   ____              _________________________
%%

components

fields
101     begin
        if function one of "ADD", "NEW" then
            begin
            do read_agqvehicle
            l_vehicle_no = l_vehicle_no + 1
            agqvehicle:vehicle_no = l_vehicle_no
            if l_no_vehicles = 0 then
                l_no_vehicles = 1
            g_vehicle_no = l_vehicle_no

            if l_vehicle_no = 1 then
                begin
                agqvehicle:app_no           = g_app_no
                agqvehicle:vehicle_no       = l_vehicle_no
                agqvehicle:company_id       = l_company_id
                agqvehicle:line_of_business = l_line_of_business
                agqvehicle:state            = l_state
                agqvehicle:agent_no         = l_agent_no
                agqvehicle:str_type         = g_type_str
                if g_type_str not one of "H", "G" then
                    agqvehicle:type = val(g_type_str)
                agqvehicle:loss_payee       = "N"
--                agqvehicle:county           = agsdefault_cap:county
                agqvehicle:territory        = agsdefault_cap:territory
                if g_type_str not one of "G", "H" then
                    begin
                    agqvehicle:comp_deductible  = agsdefault_cap:comp_deductible
                    agqvehicle:coll_deductible  = agsdefault_cap:coll_deductible
                    end
                if g_type_str = "1" then
                  begin
                    agqvehicle:size_class       = agsdefault_cap:size_class
                    agqvehicle:business_class   = agsdefault_cap:business_class
                    agqvehicle:radius           = agsdefault_cap:radius
                    agqvehicle:secondary_class  = agsdefault_cap:secondary_class
                    agqvehicle:non_employee     = "Y"
                    agqvehicle:no_fault         = "N"
                    agqvehicle:dump             = "N"
                  end
                else
                if g_Type_str not one of "G", "H" then
                    begin
                    agqvehicle:class_code       = agsdefault_cap:class_code
                    if g_type_str one of "4", "5" then
                        agqvehicle:class_code   = casclass_alias:class_code
                    agqvehicle:non_employee = "Y"
                    if g_type_str one of "9" then
                        agqvehicle:non_employee = "N"
                    agqvehicle:no_fault     = "N"
                    end

                access agqamt, set agqamt:app_no = g_app_no, generic

                if agqamt:app_no = g_app_no then
                    begin
                    agqvehicle:business_name[1] = agqamt:name
                    agqvehicle:eff_date         = agqamt:eff_date
                    end

                access agqmaster, set agqmaster:app_no = g_app_no, generic

                access sfsfob, set sfsfob:company_id       = agqvehicle:company_id,
                                   sfsfob:form_of_business = agqmaster:form_of_business, generic

                l_fob_description  = sfsfob:description
                l_fob_description1 = agqmaster:fob_description
                end
            else
                begin
                access agqvehicle_alias, set agqvehicle_alias:app_no = g_app_no, generic

                agqvehicle:app_no                = g_app_no
                agqvehicle:vehicle_no            = l_vehicle_no
                agqvehicle:str_type              = g_type_str
                if g_type_str not one of "H", "G" then
                    agqvehicle:type = val(g_type_str)
                agqvehicle:company_id            = agqvehicle_alias:company_id
                agqvehicle:line_of_business      = agqvehicle_alias:line_of_business
                agqvehicle:state                 = agqvehicle_alias:state
                agqvehicle:agent_no              = agqvehicle_alias:agent_no
                if g_type_str not one of "G", "H" then
                    begin
                    agqvehicle:loss_payee            = "N"
                    end
                agqvehicle:business_Name[1]      = agqvehicle_alias:business_name[1]
                agqvehicle:eff_date              = agqvehicle_alias:eff_date
                agqvehicle:exp_date              = agqvehicle_alias:exp_date
                agqvehicle:county                = agqvehicle_alias:county
                agqvehicle:str_zipcode           = agqvehicle_alias:str_zipcode
                agqvehicle:territory             = agqvehicle_alias:territory
                agqvehicle:territory_description = agqvehicle_alias:territory_description
                agqvehicle:territory_sub_code    = agqvehicle_alias:territory_sub_code
                if g_type_str not one of "G", "H" then
                    begin
                    agqvehicle:comp_deductible       = agqvehicle_alias:comp_deductible
                    agqvehicle:coll_deductible       = agqvehicle_alias:coll_deductible
                    agqvehicle:non_employee          = agqvehicle_alias:non_employee
                    end
                if g_type_str = "1" then
                    begin
                    agqvehicle:no_fault         = "N"
                    agqvehicle:dump             = "N"
                    end
                else
                if g_type_str not one of "G", "H" then
                    begin
                    agqvehicle:no_fault     = "N"
                    end
                if g_type_str = "1" then
                    begin
                    agqvehicle:size_class       = agsdefault_cap:size_class
                    agqvehicle:business_class   = agsdefault_cap:business_class
                    agqvehicle:radius           = agsdefault_cap:radius
                    agqvehicle:secondary_class  = agqvehicle_alias:secondary_class
                    agqvehicle:secondary_class_iso = agqvehicle_alias:secondary_class_iso
                    end
                else
                if g_type_str not one of "G", "H" then
                    begin
                    if agqvehicle:company_id = "FARMERS" then
                        begin
                        agqvehicle:class_code       = agsdefault_cap:class_code
                        if g_type_str one of "4", "5" then
                            agqvehicle:class_code   = casclass_alias:class_code
                        end
                    end
                end

            access agqsymbol, set agqsymbol:app_no     = g_app_no,
                                  agqsymbol:vehicle_no = agqvehicle:vehicle_no, generic

            if agqsymbol:app_no     <> g_app_no or
               agqsymbol:vehicle_no <> agqvehicle:vehicle_no then
                begin
                add agqsymbol
                    begin
                    agqsymbol:app_no             = g_app_no
                    agqsymbol:vehicle_no         = agqvehicle:vehicle_no
                    agqsymbol:vehicle_symbol[1]  = "7"
                    agqsymbol:vehicle_symbol[2]  = "8"
                    agqsymbol:vehicle_symbol[3]  = "9"
                    agqsymbol:vehicle_symbol[4]  = "7"
                    agqsymbol:vehicle_symbol[5]  = "7"
                    agqsymbol:vehicle_symbol[6]  = "7"
                    agqsymbol:vehicle_symbol[7]  = "7"
                    agqsymbol:vehicle_symbol[8]  = "7"
                    agqsymbol:vehicle_symbol[9]  = "7"
                    agqsymbol:vehicle_symbol[10] = "7"
                    agqsymbol:vehicle_symbol[11] = "7"
                    agqsymbol:vehicle_symbol[12] = "8"
                    agqsymbol:vehicle_symbol[13] = "7"
                    agqsymbol:vehicle_symbol[14] = "7"
                    agqsymbol:vehicle_symbol[15] = "7"
                    agqsymbol:expansion          = ""
                    end
                end
            else
                begin
                change agqsymbol
                    begin
                    agqsymbol:vehicle_symbol[1]  = "7"
                    agqsymbol:vehicle_symbol[2]  = "8"
                    agqsymbol:vehicle_symbol[3]  = "9"
                    agqsymbol:vehicle_symbol[4]  = "7"
                    agqsymbol:vehicle_symbol[5]  = "7"
                    agqsymbol:vehicle_symbol[6]  = "7"
                    agqsymbol:vehicle_symbol[7]  = "7"
                    agqsymbol:vehicle_symbol[8]  = "7"
                    agqsymbol:vehicle_symbol[9]  = "7"
                    agqsymbol:vehicle_symbol[10] = "7"
                    agqsymbol:vehicle_symbol[11] = "7"
                    agqsymbol:vehicle_symbol[12] = "8"
                    agqsymbol:vehicle_symbol[13] = "7"
                    agqsymbol:vehicle_symbol[14] = "7"
                    agqsymbol:vehicle_symbol[15] = "7"
                    agqsymbol:expansion          = ""
                    end
                end
            end
        end
        agqvehicle:vehicle_no/displayonly ;
102     l_no_vehicles/displayonly ;
103     begin
        access castype_agent, set castype_agent:company_id       = l_company_id,
                                  castype_agent:state            = l_state,
                                  castype_agent:line_of_business = l_line_of_business,
                                  castype_agent:type             = g_type_str, generic

        end
        castype_agent:description/displayonly ;

}

Panel at 9,1 to 24,100  tagged truck_fn
        Properties {
                LayoutType = screen
        }
        {
         Components
           guidetext at 2,1 to 2,22
             properties
               {
                 text = "Insured's Name:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }

           guidetext at 3,1 to 3,22
             properties
               {
                 text = "Eff Date:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 4,1 to 4,22
             properties
               {
                 text = "Form Of Business:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
            guidetext at 5,1 to 5,22
             properties
               {
                 text = "Vehicle Year:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
              }
           guidetext at 6,1 to 6,22
             properties
               {
                 text = "Vehicle Make:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 7,1 to 7,22
             properties
               {
                 text = "Classification:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 8,1 to 8,22
             properties
               {
                 text = "Secondary Class:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 9,1 to 9,22
             properties
               {
                 text = "Garage Location:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 11,1 to 11,22
             properties
               {
                 text = "Physical Damage:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 12,1 to 12,22
             properties
               {
                 text = "Cost New:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 13,1 to 13,22  tagged ca2001_fn
             properties
               {
                 text = "Additional Insured-Lessor:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
             events
               {
               mouseclicked
                   {
                   l_screen_1 = "agtmt401h"
                   do display_popup
                   }
                }
           guidetext at 14,1 to 14,22
             properties
               {
                 text = "Rental Reimbursement:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }

           guidetext at 15,1 to 15,22
             properties
               {
                 text = "Dump Operations:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }

         }

Panel at 9,24 to 24, 100 Tagged truck_fn
{
%%

___________________________________________________
__________                    __________  ____
____________________________  _________________________________________
____
____________________   Model: ______________________________
_____  ______________________________________________________________________
__     ______________________________________________________________________
County: ___  _____________________________________________ Zip: __________
  City: _________________________________________________  ___
  Comp: _____                       Collision: _____
____________
~~_
~~_     # of Days:~~___ Amount Per Day:~~______
~~_

%%

components

fields
201     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            disable(calc_fn)
            enable(accept_fn)
            }
        else
            {
            disable(accept_fn)
            enable(calc_fn)
            }
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "003webhelp_agtmt401_scr_rating_info_tbx_insured_name.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:business_name[1]/tabstop/uppercase/default ;
301     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "004webhelp_agtmt401_scr_rating_info_tbx_eff_date.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        access agqvehicle_alt, set agqvehicle_alt:app_no = g_app_no, generic

        if function one of "ADD", "NEW" then
            begin
            if agqvehicle:eff_date = 0 then
                agqvehicle:eff_date = todaysdate
            else
            if agqvehicle_alt:eff_date <> 0 then
                agqvehicle:eff_date = agqvehicle_alt:eff_date
            end
        l_prior_eff_date = agqvehicle:eff_date
        end
        agqvehicle:eff_date/tabstop/default mandatory
        if agqvehicle:eff_date <> l_prior_eff_date and
           l_prior_eff_date <> 0 then
            l_new_eff_date = agqvehicle:eff_date

        if function one of "CHANGE", "CHG" and
           l_prior_eff_date <> l_new_eff_date and
           l_new_eff_date <> 0 then
            begin
            access agqvehicle_alias, set agqvehicle_alias:app_no = g_app_no, generic

            while agqvehicle_alias:app_no = g_app_no
                begin
                change agqvehicle_alias
                    begin
                    if agqvehicle_alias:eff_date <> l_new_eff_date then
                        agqvehicle_alias:eff_date = l_new_eff_date
                    end
                next agqvehicle_alias
                end

            end

        if agqvehicle:eff_date <> agqvehicle_alt:eff_date and
           agqvehicle_alt:eff_date <> 0 then
            begin
            error "Effective date must be the same for all vehicles"
            agqvehicle:eff_date = agqvehicle_alt:eff_date
            end

        if agqvehicle:eff_date < todaysdate - 30 then
            error "The effective date can not be more than 30 days from todaysdate"

        agqvehicle:exp_date = dateadd(agqvehicle:eff_date,0,1) ;
302     l_agent_wording/displayonly/showasguidetext tagged ficof_fn ;
303     begin
        access sfsagent_alias, set sfsagent_alias:company_id = agqvehicle:company_id, generic

        end
        agqvehicle:agent_no/showasguidetext/default  tagged ficof_fn
        hide if sfsemail:agent_no <> 0
        access sfsagent, set sfsagent:company_id = agqvehicle:company_id,
                             sfsagent:agent_no = agqvehicle:agent_no, generic

        if agqvehicle:agent_no <> sfsagent:agent_No then
            error "Invalid Agent No"

        activehelp sfsagent_alias:agent_no,
                   sfsagent_alias:name[1] ;

303     agqvehicle:agent_no/showasguidetext/displayonly  tagged ficof_fn
        hide if sfsemail:agent_no = 0 ;
401     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "005webhelp_agtmt401_scr_rating_info_dbx_fob.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        l_fob = agqmaster:form_of_business
        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id,
                           sfsfob:form_of_business = agqmaster:form_of_business, generic

        l_fob_desc = sfsfob:description

        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id, approximate

        access agqmaster, set agqmaster:app_no = g_app_no, generic

        if agqvehicle:business_name[1] <> "" and
           agqmaster:form_of_business <> "" then
            begin
            access sfsfob, set sfsfob:company_id       = agqvehicle:company_id,
                               sfsfob:form_of_business = agqmaster:form_of_business, generic

            l_form_of_business = agqmaster:form_of_business
            l_fob_description  = sfsfob:description
            l_fob_description1 = agqmaster:fob_description
            end

        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id, approximate

        if l_fob_description = "" then
            activehelp()
        end
        l_fob_description/default/tabstop/uppercase
        if l_fob <> agqmaster:form_of_business or
           l_fob = "" or
           l_fob_desc <> l_fob_description then
            begin
            l_form_of_business = sfsfob:form_of_business
            if l_form_of_business <> "T" then
                l_fob_description1 = ""
            end

        activehelp sfsfob:description;
402     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "006webhelp_agtmt401_scr_rating_info_tbx_fob_other.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        l_fob_description1/default/tabstop/uppercase
        hide if trun(l_fob_description) not one of "OTHER", "Other" ;

501     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if sfsline:lob_code = "CPORTFOLIO" then
                do update_agqmastsupp
            else
                do update_agqmaster
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "007webhelp_agtmt401_scr_rating_info_tbx_veh_year.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:year/tabstop mandatory ;

601     begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "008webhelp_agtmt401_scr_rating_info_tbx_veh_make.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:make/tabstop ;
602     agqvehicle:model/tabstop ;
701     begin
        if function one of "ADD", "NEW" then
            agqvehicle:class_code = 11

        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "009webhelp_agtmt401_scr_rating_info_dbx_class.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:class_code/tabstop/default mandatory
        access casclass, set casclass:company_id       = agqvehicle:company_id,
                             casclass:state            = agqvehicle:state,
                             casclass:line_of_business = agqvehicle:line_of_business,
                             casclass:type             = agqvehicle:type,
                             casclass:table            = 1,
                             casclass:class_code       = agqvehicle:class_code, generic

        if agqvehicle:class_code <> casclass:class_code or
           agqvehicle:class_code = 0 then
            error "Invalid Classification Entered"

        agqvehicle:increase_limit_option = casclass:increase_limit_option

        activehelp casclass_alias:class_code,
                   casclass_alias:description;
702     casclass:description ;


801     begin
        If FUNCTION one of "ADD", "NEW" and
           agqvehicle:secondary_class_iso = 0 Then
            AGQVEHICLE:SECONDARY_CLASS_ISO = 99
        End
        AGQVEHICLE:SECONDARY_CLASS_ISO/default/tabstop mandatory
        If AGQVEHICLE:SECONDARY_CLASS_ISO <> cassecondaryclass_alt:secondary_class Then
            Error 4003

        agqvehicle:secondary_class = cassecondaryclass_alt:rating_code

        Activehelp cassecondaryclass_alt1:secondary_class,
                   CASsecondaryclass_alt1:DESCRIPTION ;

802     casclass_alt:description ;
901     Begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "013webhelp_agtmt401_scr_rating_info_dbx_county.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        End
        agqvehicle:county/tabstop/default
        Error 1222 If SFSSTATE_ALIAS:DESCRIPTION = " "

        if sfsstate_alias:hide_for_auto = 1 then
            error "Invalid County Entered"

        Activehelp if sfsstate_alias:county <> 0 and
                      sfsstate_alias:hide_for_auto = 0 then
                       SFSSTATE_ALIAS:COUNTY
                   else
                       null/width=3/heading="County",
                   if sfsstate_alias:county <> 0 and
                      sfsstate_alias:hide_for_auto = 0 then
                       SFSSTATE_ALIAS:DESCRIPTION
                   else
                       null/width=30/heading="Description" ;
902     begin
        access sfscounty_lookup_alias, set sfscounty_lookup_alias:company_id  = agqvehicle:company_id,
                                           sfscounty_lookup_alias:state       = agqvehicle:state,
                                           sfscounty_lookup_alias:description = l_county_description, approximate

        end
        l_county_description/uppercase/tabstop
        hide if agqvehicle:county <> 0
        l_length = len(trun(l_county_description))
        access sfscounty_lookup, set sfscounty_lookup:company_id  = agqvehicle:company_id,
                                     sfscounty_lookup:state       = agqvehicle:state,
                                     sfscounty_lookup:description = l_county_description, approximate

        l_possible_counties = 0
        while sfscounty_lookup:company_id = agqvehicle:company_id and
              sfscounty_lookup:state      = agqvehicle:state
                begin
                if sfscounty_lookup:description[1,l_length] = l_county_description[1,l_length] then
                    l_possible_counties = l_possible_counties + 1

                next sfscounty_lookup
                end

        if l_possible_counties = 1 then
            begin
            access sfscounty_lookup, set sfscounty_lookup:company_id  = agqvehicle:company_id,
                                         sfscounty_lookup:state       = agqvehicle:state,
                                         sfscounty_lookup:description = l_county_description, approximate

            l_county_description = sfscounty_lookup:description
            agqvehicle:county = sfscounty_lookup:county
            end
        else
            begin
            activehelp()
            access sfscounty_lookup, set sfscounty_lookup:company_id  = agqvehicle:company_id,
                                         sfscounty_lookup:state       = agqvehicle:state,
                                         sfscounty_lookup:description = l_county_description, approximate

            agqvehicle:county = sfscounty_lookup:county
            end

        activehelp if sfscounty_lookup_alias:state = agqvehicle:state and
                      sfscounty_lookup_alias:county <> 0 and
                      sfscounty_lookup_alias:description[1,l_length] = l_county_description[1,l_length] then
                       sfscounty_lookup_alias:description
                   else
                       null/width=75 ;
901     agqvehicle:county/displayonly ;
902     sfsstate_alias:description ;
903     agqVEHICLE:STR_ZIPCODE/default/tabstop  mandatory
        if val(agqvehicle:str_zipcode) <> 0 then
            begin
            If agqvehicle:STR_ZIPCODE[6,9] = "" Then
                agqvehicle:STR_ZIPCODE[6,9] = "0000"
            end
        l_zip_code_5 = agqvehicle:zipcode[1,5]
        access sfsinflatzipcode, set sfsinflatzipcode:company_id       = agqvehicle:company_id,
                                     sfsinflatzipcode:state            = agqvehicle:state,
                                     sfsinflatzipcode:line_of_business = agqvehicle:line_of_business,
                                     sfsinflatzipcode:zip_code_5       = l_zip_code_5, generic

        if l_zip_code_5 <> sfsinflatzipcode:zip_code_5 then
            error "Must have a valid zip code to rate"
        if agqvehicle:zipcode = 0 then
            error "Must enter a zip code to rate";

903     Begin
        If agqVEHICLE:STR_ZIPCODE[6,9] = "" Then
            agqVEHICLE:STR_ZIPCODE[6,9] = "0000"
        End
        agqVEHICLE:STR_ZIPCODE/displayonly ;

1001    begin
        l_zip_code_5 = agqvehicle:zipcode[1,5]

        access sfsinflatzipcode, set sfsinflatzipcode:company_id       = agqvehicle:company_id,
                                     sfsinflatzipcode:state            = agqvehicle:state,
                                     sfsinflatzipcode:line_of_business = agqvehicle:line_of_business,
                                     sfsinflatzipcode:zip_code_5       = l_zip_code_5, generic

        while sfsinflatzipcode:company_id       = agqvehicle:company_id and
              sfsinflatzipcode:state            = agqvehicle:state and
              sfsinflatzipcode:line_of_business = agqvehicle:line_of_business and
              sfsinflatzipcode:zip_code_5       = l_zip_code_5
                begin
                if (agqvehicle:eff_date >= sfsinflatzipcode:eff_date and
                   (agqvehicle:eff_date <= sfsinflatzipcode:exp_date or
                   sfsinflatzipcode:exp_date = 0)) then
                    begin
                    agqvehicle:territory             = sfsinflatzipcode:territory
                    if sfsinflatzipcode:description <> "" then
                        agqvehicle:territory_description = sfsinflatzipcode:description
                    end

                next sfsinflatzipcode
                end

        end
        agqVEHICLE:TERRITORY_DESCRIPTION/displayonly ;
1002    agqVEHICLE:TERRITORY/displayonly ;

1101    begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "015webhelp_agtmt401_scr_rating_info_dbx_comp.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:comp_deductible/tabstop/default
        if agqvehicle:comp_deductible <> cascompdeduct:comp_deductible then
          error "Invalid Comp Deductible Entered"

        if agqvehicle:comp_deductible one of 1000,2000,3000 and
           agqvehicle:original_cost < 8000 and
           l_company_id one of "FARMERS" then
          error "Invalid Comp Deductible Not Allow With Orignal Cost New < 8000"

        activehelp if cascompdeduct_alias:allow_agent_to_view = 1 then
                        cascompdeduct_alias:comp_deductible
                   else
                        null,
                   if cascompdeduct_alias:description <> "" and
                      cascompdeduct_alias:allow_agent_to_view = 1 then
                       cascompdeduct_alias:description
                   else
                       null;
1101    cascompdeduct:description
        hide if cascompdeduct:description = "";
1102    begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "016webhelp_agtmt401_scr_rating_info_dbx_collision.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:coll_deductible/tabstop/default
        if agqvehicle:coll_deductible <> cascolldeduct:coll_deductible then
            error "Invalid Collision Deductible Entered"

        if agqvehicle:coll_deductible one of 2000,3000 and
           agqvehicle:original_cost < 8000 and
           l_company_id one of "FARMERS" then
            error "Invalid Coll Deductible Not Allow With Orignal Cost New < 8000"

        if agqvehicle:coll_deductible = 0 and
           agqvehicle:comp_deductible = 0 then
            agqvehicle:original_cost = 0

        activehelp if cascolldeduct_alias:allow_agent_to_view = 1 then
                       cascolldeduct_alias:coll_deductible
                   else
                       null ;
1201    begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "017webhelp_agtmt401_scr_rating_info_tbx_cost_new.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:original_cost/tabstop mandatory
        if (agqvehicle:original_cost = 0 and
           (agqvehicle:comp_deductible <> 0 or
           agqvehicle:coll_deductible <> 0)) then
            error "You must enter an original cost"

        if agqvehicle:original_cost > 90000 then
            error "For limits higher than $90,000 refer to underwriting"

        if agqvehicle:original_cost = 0 then
            begin
            agqvehicle:comp_deductible = 0
            agqvehicle:coll_deductible = 0
            end

        hide if agqvehicle:comp_deductible = 0 and
                agqvehicle:coll_deductible = 0 ;
1301    begin
            L_no_years  = ((Year(agqvehicle:EFF_DATE) - (AGQVEHICLE:YEAR)) + 1)
            If Month(agqvehicle:EFF_DATE) >= 10 And
               Month(agqvehicle:EFF_DATE) <= 12 Then
                L_no_years = L_no_years + 1
            if l_no_years = 0 then
                l_no_years = 1
            If L_no_years > 10 Then
                L_no_Years = 10
            access casacv, set casacv:company_id       = agqvehicle:company_id,
                               casacv:state            = agqvehicle:state,
                               casacv:line_of_business = agqvehicle:line_of_business,
                               casacv:no_years         = l_no_years, generic

            l_acv_factor = 0
            while casacv:company_id       = agqvehicle:company_id and
                  casacv:state            = agqvehicle:state and
                  casacv:line_of_business = agqvehicle:line_of_business and
                  casacv:no_years         = l_no_years
                    begin
                    if agqvehicle:eff_date >= casacv:reff_date then
                        l_acv_factor = casacv:factor

                    next casacv
                    end

            if l_acv_factor <> 0 then
                agqvehicle:acv_limit = agqvehicle:original_cost * l_acv_factor

            if agqvehicle:original_cost = 0 then
                agqvehicle:acv_limit = 1

        do read_agqend1
        l_ca2001_prior = l_ca2001
        if l_ca2001 = 1 then
            begin
            l_tag = tag("ca2001_fn")
            setproperty(l_tag,foregroundcolor,"blue")
            end
        else
            begin
            l_tag = tag("ca2001_fn")
            setproperty(l_tag,foregroundcolor,"black")
            end
        end
        l_ca2001/checkbox/values="0,1"/tabstop
        if l_ca2001 = 1 and
           l_ca2001_prior = 0 then
            begin
            l_code = "CA2001"
            do add_agqend1
            agqvehicle:additional_insured = "Y"
            display modal screen "agtmt401h"
            end
        if l_ca2001 = 0 and
           l_ca2001_prior = 1 then
            begin
            l_code = "CA2001"
            agqvehicle:additional_insured = "N"
            do delete_agqend1
            do delete_agqaddin2
            end ;
1401    begin
        do read_agqend1
        l_ca9923_prior = l_ca9923
        end
        l_ca9923/checkbox/values="0,1"/tabstop
        Hide If agqvehicle:ORIGINAL_COST = 0
        if l_ca9923 = 0 then
            begin
            agqvehicle:rental_days   = 0
            agqvehicle:rental_amount = 0
            end
        if l_ca9923 = 1 and
           l_ca9923_prior = 0 then
            begin
            l_code = "CA9923"
            do add_agqend1
            end
        if l_ca9923 = 0 and
           l_ca9923_prior = 1 then
            begin
            l_code = "CA9923"
            do delete_agqend1
            end;
1402    begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_ca9923 = 1 then
                begin
                if agqvehicle:rental_days = 0 then
                    agqvehicle:rental_days   = 30
                if agqvehicle:rental_amount = 0 then
                    begin
                    if agqvehicle:company_id = "FARMERS" then
                        agqvehicle:rental_amount = 30
                    else
                        agqvehicle:rental_amount = 15
                    end
                end
            end
        end
        agqvehicle:RENTAL_DAYS/default/tabstop
        Hide If agqvehicle:ORIGINAL_COST = 0
        hide if l_ca9923 = 0
        if agqvehicle:rental_days = 0 then
            agqvehicle:rental_amount = 0

        if agqvehicle:rental_days > 30 and
           sfsemail:agent_no <> 0 then
            begin
            agqvehicle:rental_days = 30
            error "The value you entered exceeds maximum allowed limits. Contact your UW to obtain permission for higher value"
            end ;
1403    agqvehicle:RENTAL_AMOUNT/default/tabstop
        Hide If agqvehicle:RENTAL_DAYS = 0
        hide if l_ca9923 = 0
        If agqvehicle:RENTAL_AMOUNT = 0 Then
            Error "Invalid Amount Entered"
        if agqvehicle:rental_amount > 30 and
           sfsemail:agent_no <> 0 then
            begin
            agqvehicle:rental_amount = 30
            error "The value you entered exceeds maximum allowed limits. Contact your UW to obtain permission for higher value"
            end ;
1501     agqVEHICLE:DUMP/default/checkbox/values="N,Y" ;

}

Panel at 9,1 to 24,100  tagged other_fn
        Properties {
                LayoutType = screen
        }
        {
         Components
           guidetext at 2,1 to 2,22
             properties
               {
                 text = "Insured's Name:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }

           guidetext at 3,1 to 3,22
             properties
               {
                 text = "Eff Date:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 4,1 to 4,22
             properties
               {
                 text = "Form Of Business:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
            guidetext at 5,1 to 5,22
             properties
               {
                 text = "Vehicle Year:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
              }
           guidetext at 6,1 to 6,22
             properties
               {
                 text = "Vehicle Make:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 7,1 to 7,22
             properties
               {
                 text = "Classification:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 8,1 to 8,22
             properties
               {
                 text = "Garage Location:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 10,1 to 10,22
             properties
               {
                 text = "Physical Damage:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 11,1 to 11,22
             properties
               {
                 text = "Cost New:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 12,1 to 12,22  tagged ca2001_fn
             properties
               {
                 text = "Additional Insured-Lessor:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
             events
               {
               mouseclicked
                   {
                   l_screen_1 = "agtmt401h"
                   do display_popup
                   }
                }
           guidetext at 13,1 to 13,22
             properties
               {
                 text = "Rental Reimbursement:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 14,1 to 14,22
             properties
               {
                 text = "Towing:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 15,1 to 15,22
             properties
               {
                 text = "Non Employee:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
         }

Panel at 9,24 to 24, 100 Tagged other_fn
{
%%

___________________________________________________
__________                    __________  ____
____________________________  _________________________________________
____
____________________   Model: ______________________________
______  __________________________________________________
County: ___  _____________________________________________ Zip: __________
  City: __________________________________________________  ___
  Comp: _____                       Collision: _____
____________
~~_
~~_     # of Days:~~___ Amount Per Day:~~______
~~_
[R_      Employee:~~_  R]

%%

components

fields
201     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            disable(calc_fn)
            enable(accept_fn)
            }
        else
            {
            disable(accept_fn)
            enable(calc_fn)
            }
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "003webhelp_agtmt401_scr_rating_info_tbx_insured_name.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:business_name[1]/tabstop/uppercase/default ;
301     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "004webhelp_agtmt401_scr_rating_info_tbx_eff_date.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        access agqvehicle_alt, set agqvehicle_alt:app_no = g_app_no, generic

        if function one of "ADD", "NEW" then
            begin
            if agqvehicle:eff_date = 0 then
                agqvehicle:eff_date = todaysdate
            else
            if agqvehicle_alt:eff_date <> 0 then
                agqvehicle:eff_date = agqvehicle_alt:eff_date
            end
        l_prior_eff_date = agqvehicle:eff_date
        end
        agqvehicle:eff_date/tabstop/default mandatory
        if agqvehicle:eff_date <> l_prior_eff_date and
           l_prior_eff_date <> 0 then
            l_new_eff_date = agqvehicle:eff_date

        if function one of "CHANGE", "CHG" and
           l_prior_eff_date <> l_new_eff_date and
           l_new_eff_date <> 0 then
            begin
            access agqvehicle_alias, set agqvehicle_alias:app_no = g_app_no, generic

            while agqvehicle_alias:app_no = g_app_no
                begin
                change agqvehicle_alias
                    begin
                    if agqvehicle_alias:eff_date <> l_new_eff_date then
                        agqvehicle_alias:eff_date = l_new_eff_date
                    end
                next agqvehicle_alias
                end

            end

        if agqvehicle:eff_date <> agqvehicle_alt:eff_date and
           agqvehicle_alt:eff_date <> 0 then
            begin
            error "Effective date must be the same for all vehicles"
            agqvehicle:eff_date = agqvehicle_alt:eff_date
            end

        if agqvehicle:eff_date < todaysdate - 30 then
            error "The effective date can not be more than 30 days from todaysdate"

        agqvehicle:exp_date = dateadd(agqvehicle:eff_date,0,1) ;
302     l_agent_wording/displayonly/showasguidetext tagged ficof_fn ;
303     begin
        access sfsagent_alias, set sfsagent_alias:company_id = agqvehicle:company_id, generic

        end
        agqvehicle:agent_no/showasguidetext/default  tagged ficof_fn
        hide if sfsemail:agent_no <> 0
        access sfsagent, set sfsagent:company_id = agqvehicle:company_id,
                             sfsagent:agent_no = agqvehicle:agent_no, generic

        if agqvehicle:agent_no <> sfsagent:agent_No then
            error "Invalid Agent No"

        activehelp sfsagent_alias:agent_no,
                   sfsagent_alias:name[1] ;
303     agqvehicle:agent_no/showasguidetext/displayonly tagged ficof_fn
        hide if sfsemail:agent_no = 0 ;
401     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "005webhelp_agtmt401_scr_rating_info_dbx_fob.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        l_fob = agqmaster:form_of_business
        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id,
                           sfsfob:form_of_business = agqmaster:form_of_business, generic

        l_fob_desc = sfsfob:description

        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id, approximate

        access agqmaster, set agqmaster:app_no = g_app_no, generic

        if agqvehicle:business_name[1] <> "" and
           agqmaster:form_of_business <> "" then
            begin
            access sfsfob, set sfsfob:company_id       = agqvehicle:company_id,
                               sfsfob:form_of_business = agqmaster:form_of_business, generic

            l_form_of_business = agqmaster:form_of_business
            l_fob_description  = sfsfob:description
            l_fob_description1 = agqmaster:fob_description
            end

        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id, approximate

        if agqmaster:form_of_business = "" then
            activehelp()
        end
        l_fob_description/default/tabstop/uppercase
        if l_fob <> agqmaster:form_of_business or
           l_fob_desc <> l_fob_description then
            begin
            l_form_of_business = sfsfob:form_of_business
            if l_form_of_business <> "T" then
                l_fob_description1 = ""
            end

        activehelp sfsfob:description;
402     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "006webhelp_agtmt401_scr_rating_info_tbx_fob_other.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        l_fob_description1/default/tabstop/uppercase
        hide if trun(l_fob_description) not one of "OTHER", "Other" ;

501     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if sfsline:lob_code = "CPORTFOLIO" then
                do update_agqmastsupp
            else
                do update_agqmaster
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "007webhelp_agtmt401_scr_rating_info_tbx_veh_year.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:year/tabstop mandatory
        hide if g_type_str one of "H", "G";

601     begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "008webhelp_agtmt401_scr_rating_info_tbx_veh_make.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:make/tabstop
        hide if g_type_str one of "H", "G";
602     agqvehicle:model/tabstop
        hide if g_type_str one of "H", "G";
701     begin
        if function one of "ADD", "NEW" then
            begin
            if g_type_str one of "2" then
                agqvehicle:class_code = 7391
            else
            if g_type_str one of "4" then
                agqvehicle:class_code = 7922
            else
            if g_type_str one of "6" then
                agqvehicle:class_code = 7929
            else
                agqvehicle:class_code = 0
            end

          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "009webhelp_agtmt401_scr_rating_info_dbx_class.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:class_code/tabstop/default mandatory
        hide if g_type_str one of "H", "G"
        if agqvehicle:class_code <> casclass:class_code or
           agqvehicle:class_code = 0 then
            error "Invalid Classification Entered"

        activehelp casclass_alias:class_code,
                   casclass_alias:description;
702     casclass:description ;
801     Begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "013webhelp_agtmt401_scr_rating_info_dbx_county.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        End
        agqvehicle:county/tabstop/default
        Error 1222 If SFSSTATE_ALIAS:DESCRIPTION = " "

        if sfsstate_alias:hide_for_auto = 1 then
            error "Invalid County Entered"

        Activehelp if sfsstate_alias:county <> 0 and
                      sfsstate_alias:hide_for_auto = 0 then
                       SFSSTATE_ALIAS:COUNTY
                   else
                       null/width=3/heading="County",
                   if sfsstate_alias:county <> 0 and
                      sfsstate_alias:hide_for_auto = 0 then
                       SFSSTATE_ALIAS:DESCRIPTION
                   else
                       null/width=30/heading="Description" ;
802     begin
        access sfscounty_lookup_alias, set sfscounty_lookup_alias:company_id  = agqvehicle:company_id,
                                           sfscounty_lookup_alias:state       = agqvehicle:state,
                                           sfscounty_lookup_alias:description = l_county_description, approximate

        end
        l_county_description/uppercase/tabstop
        hide if agqvehicle:county <> 0
        l_length = len(trun(l_county_description))
        access sfscounty_lookup, set sfscounty_lookup:company_id  = agqvehicle:company_id,
                                     sfscounty_lookup:state       = agqvehicle:state,
                                     sfscounty_lookup:description = l_county_description, approximate

        l_possible_counties = 0
        while sfscounty_lookup:company_id = agqvehicle:company_id and
              sfscounty_lookup:state      = agqvehicle:state
                begin
                if sfscounty_lookup:description[1,l_length] = l_county_description[1,l_length] then
                    l_possible_counties = l_possible_counties + 1

                next sfscounty_lookup
                end

        if l_possible_counties = 1 then
            begin
            access sfscounty_lookup, set sfscounty_lookup:company_id  = agqvehicle:company_id,
                                         sfscounty_lookup:state       = agqvehicle:state,
                                         sfscounty_lookup:description = l_county_description, approximate

            l_county_description = sfscounty_lookup:description
            agqvehicle:county = sfscounty_lookup:county
            end
        else
            begin
            activehelp()
            access sfscounty_lookup, set sfscounty_lookup:company_id  = agqvehicle:company_id,
                                         sfscounty_lookup:state       = agqvehicle:state,
                                         sfscounty_lookup:description = l_county_description, approximate

            agqvehicle:county = sfscounty_lookup:county
            end

        activehelp if sfscounty_lookup_alias:state = agqvehicle:state and
                      sfscounty_lookup_alias:county <> 0 and
                      sfscounty_lookup_alias:description[1,l_length] = l_county_description[1,l_length] then
                       sfscounty_lookup_alias:description
                   else
                       null/width=75 ;
801     agqvehicle:county/displayonly ;
802     sfsstate_alias:description ;
803     agqVEHICLE:STR_ZIPCODE/default/tabstop  mandatory
        if val(agqvehicle:str_zipcode) <> 0 then
            begin
            If agqvehicle:STR_ZIPCODE[6,9] = "" Then
                agqvehicle:STR_ZIPCODE[6,9] = "0000"
            end
        l_zip_code_5 = agqvehicle:zipcode[1,5]
        access sfsinflatzipcode, set sfsinflatzipcode:company_id       = agqvehicle:company_id,
                                     sfsinflatzipcode:state            = agqvehicle:state,
                                     sfsinflatzipcode:line_of_business = agqvehicle:line_of_business,
                                     sfsinflatzipcode:zip_code_5       = l_zip_code_5, generic

        if l_zip_code_5 <> sfsinflatzipcode:zip_code_5 then
            error "Must have a valid zip code to rate"
        if agqvehicle:zipcode = 0 then
            error "Must enter a zip code to rate";

803     Begin
        If agqVEHICLE:STR_ZIPCODE[6,9] = "" Then
            agqVEHICLE:STR_ZIPCODE[6,9] = "0000"
        End
        agqVEHICLE:STR_ZIPCODE/displayonly ;

901     begin
        l_zip_code_5 = agqvehicle:zipcode[1,5]

        access sfsinflatzipcode, set sfsinflatzipcode:company_id       = agqvehicle:company_id,
                                     sfsinflatzipcode:state            = agqvehicle:state,
                                     sfsinflatzipcode:line_of_business = agqvehicle:line_of_business,
                                     sfsinflatzipcode:zip_code_5       = l_zip_code_5, generic

        while sfsinflatzipcode:company_id       = agqvehicle:company_id and
              sfsinflatzipcode:state            = agqvehicle:state and
              sfsinflatzipcode:line_of_business = agqvehicle:line_of_business and
              sfsinflatzipcode:zip_code_5       = l_zip_code_5
                begin
                if (agqvehicle:eff_date >= sfsinflatzipcode:eff_date and
                   (agqvehicle:eff_date <= sfsinflatzipcode:exp_date or
                   sfsinflatzipcode:exp_date = 0)) then
                    begin
                    agqvehicle:territory             = sfsinflatzipcode:territory
                    if sfsinflatzipcode:description <> "" then
                        agqvehicle:territory_description = sfsinflatzipcode:description
                    end

                next sfsinflatzipcode
                end

        end
        agqVEHICLE:TERRITORY_DESCRIPTION/displayonly ;
902     agqVEHICLE:TERRITORY/displayonly ;

1001    begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "015webhelp_agtmt401_scr_rating_info_dbx_comp.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:comp_deductible/tabstop/default
        hide if g_type_str one of "H", "G"
        if agqvehicle:comp_deductible <> cascompdeduct:comp_deductible then
            error "Invalid Comp Deductible Entered"

        activehelp if cascompdeduct_alias:allow_agent_to_view = 1 then
                       cascompdeduct_alias:comp_deductible
                   else
                       null ,
                   if cascompdeduct_alias:description <> "" and
                      cascompdeduct_alias:allow_agent_to_view = 1 then
                       cascompdeduct_alias:description
                   else
                       null ;
1001    cascompdeduct:description
        hide if cascompdeduct:description = "";
1002    begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "016webhelp_agtmt401_scr_rating_info_dbx_collision.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:coll_deductible/tabstop/default
        hide if g_type_str one of "H", "G"
        if agqvehicle:coll_deductible <> cascolldeduct:coll_deductible then
            error "Invalid Collision Deductible Entered"

        if agqvehicle:coll_deductible = 0 and
           agqvehicle:comp_deductible = 0 then
            agqvehicle:original_cost = 0

        activehelp if cascolldeduct_alias:allow_agent_to_view = 1 then
                       cascolldeduct_alias:coll_deductible
                   else
                       null ;

1101    begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "017webhelp_agtmt401_scr_rating_info_tbx_cost_new.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:original_cost/tabstop mandatory
        hide if g_type_str one of "H", "G"
        if (agqvehicle:original_cost = 0 and
           (agqvehicle:comp_deductible <> 0 or
           agqvehicle:coll_deductible <> 0)) then
            error "You must enter an original cost"

        if agqvehicle:original_cost > 90000 then
            error "For limits higher than $90,000 refer to underwriting"

        if agqvehicle:original_cost = 0 then
            begin
            agqvehicle:comp_deductible = 0
            agqvehicle:coll_deductible = 0
            end
        hide if agqvehicle:comp_deductible = 0 and
                agqvehicle:coll_deductible = 0 ;
1101    begin
            L_no_years  = ((Year(agqvehicle:EFF_DATE) - (AGQVEHICLE:YEAR)) + 1)
            If Month(agqvehicle:EFF_DATE) >= 10 And
               Month(agqvehicle:EFF_DATE) <= 12 Then
                L_no_years = L_no_years + 1
            if l_no_years = 0 then
                l_no_years = 1
            If L_no_years > 10 Then
                L_no_Years = 10
            access casacv, set casacv:company_id       = agqvehicle:company_id,
                               casacv:state            = agqvehicle:state,
                               casacv:line_of_business = agqvehicle:line_of_business,
                               casacv:no_years         = l_no_years, generic

            l_acv_factor = 0
            while casacv:company_id       = agqvehicle:company_id and
                  casacv:state            = agqvehicle:state and
                  casacv:line_of_business = agqvehicle:line_of_business and
                  casacv:no_years         = l_no_years
                    begin
                    if agqvehicle:eff_date >= casacv:reff_date then
                        l_acv_factor = casacv:factor

                    next casacv
                    end

            if l_acv_factor <> 0 then
                agqvehicle:acv_limit = agqvehicle:original_cost * l_acv_factor

            if agqvehicle:original_cost = 0 then
                agqvehicle:acv_limit = 1
        end
        agqvehicle:original_cost/displayonly
        hide if g_type_str one of "H", "G";
1201    begin
        do read_agqend1
        l_ca2001_prior = l_ca2001
        if l_ca2001 = 1 then
            begin
            l_tag = tag("ca2001_fn")
            setproperty(l_tag,foregroundcolor,"blue")
            end
        else
            begin
            l_tag = tag("ca2001_fn")
            setproperty(l_tag,foregroundcolor,"black")
            end
        end
        l_ca2001/checkbox/values="0,1"/tabstop
        hide if g_type_str one of "H", "G"
        if l_ca2001 = 1 and
           l_ca2001_prior = 0 then
            begin
            l_code = "CA2001"
            do add_agqend1
            agqvehicle:additional_insured = "Y"
            display modal screen "agtmt401h"
            end
        if l_ca2001 = 0 and
           l_ca2001_prior = 1 then
            begin
            l_code = "CA2001"
            agqvehicle:additional_insured = "N"
            do delete_agqend1
            do delete_agqaddin2
            end ;
1301    begin
        do read_agqend1
        l_ca9923_prior = l_ca9923
        end
        l_ca9923/checkbox/values="0,1"/tabstop
        Hide If agqvehicle:ORIGINAL_COST = 0
        hide if g_type_str one of "H", "G"
        if l_ca9923 = 0 then
            begin
            agqvehicle:rental_days   = 0
            agqvehicle:rental_amount = 0
            end
        if l_ca9923 = 1 and
           l_ca9923_prior = 0 then
            begin
            l_code = "CA9923"
            do add_agqend1
            end
        if l_ca9923 = 0 and
           l_ca9923_prior = 1 then
            begin
            l_code = "CA9923"
            do delete_agqend1
            end;
1302    begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            if l_ca9923 = 1 then
                begin
                if agqvehicle:rental_days = 0 then
                    agqvehicle:rental_days   = 30
                if agqvehicle:rental_amount = 0 then
                    begin
                    if agqvehicle:company_id = "FARMERS" then
                        agqvehicle:rental_amount = 30
                    else
                        agqvehicle:rental_amount = 15
                    end
                end
            end
        end
        agqvehicle:RENTAL_DAYS/default/tabstop
        Hide If agqvehicle:ORIGINAL_COST = 0
        hide if g_type_str one of "H", "G"
        hide if l_ca9923 = 0
        if agqvehicle:rental_days = 0 then
            agqvehicle:rental_amount = 0

        if agqvehicle:rental_days > 30 and
           sfsemail:agent_no <> 0 then
            begin
            agqvehicle:rental_days = 30
            error "The value you entered exceeds maximum allowed limits. Contact your UW to obtain permission for higher value"
            end ;
1303    agqvehicle:RENTAL_AMOUNT/default/tabstop
        Hide If agqvehicle:RENTAL_DAYS = 0
        hide if g_type_str one of "H", "G"
        hide if l_ca9923 = 0
        If agqvehicle:RENTAL_AMOUNT = 0 Then
            Error "Invalid Amount Entered"
        if agqvehicle:rental_amount > 30 and
           sfsemail:agent_No <> 0 then
            begin
            agqvehicle:rental_amount = 30
            error "The value you entered exceeds maximum allowed limits. Contact your UW to obtain permission for higher value"
            end ;
1401    agqvehicle:TOWING/checkbox/values="N,Y"/tabstop
        hide if g_type_str one of "H", "G"
        hide if agqvehicle:type not one of 2
        hide if agqvehicle:comp_deductible = 0 and
                agqvehicle:coll_deductible = 0 ;
1501    begin
        if agqvehicle:type = 7 and
           function one of "ADD", "NEW" then
            agqvehicle:non_employee = "N"
        end
        agqVEHICLE:NON_EMPLOYEE/values="Y,N"/default
        hide if g_type_str one of "H", "G"
        hide if agqvehicle:type not one of 2, 5, 7 ;


}

Panel at 9,1 to 24,100  tagged hired_fn
        Properties {
                LayoutType = screen
        }
        {
         Components
           guidetext at 2,1 to 2,22
             properties
               {
                 text = "Insured's Name:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }

           guidetext at 3,1 to 3,22
             properties
               {
                 text = "Eff Date:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 4,1 to 4,22
             properties
               {
                 text = "Form Of Business:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 5,1 to 5,22
             properties
               {
                 text = "Garage Location:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
         }

Panel at 9,24 to 24, 100 Tagged hired_fn
{
%%

___________________________________________________
__________                    __________  ____
____________________________  _________________________________________
County: ___  _____________________________________________ Zip: __________
  City: __________________________________________________  ___

%%

components

fields
201     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            disable(calc_fn)
            enable(accept_fn)
            }
        else
            {
            disable(accept_fn)
            enable(calc_fn)
            }
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "003webhelp_agtmt401_scr_rating_info_tbx_insured_name.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:business_name[1]/tabstop/uppercase/default ;
301     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "004webhelp_agtmt401_scr_rating_info_tbx_eff_date.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        access agqvehicle_alt, set agqvehicle_alt:app_no = g_app_no, generic

        if function one of "ADD", "NEW" then
            begin
            if agqvehicle:eff_date = 0 then
                agqvehicle:eff_date = todaysdate
            else
            if agqvehicle_alt:eff_date <> 0 then
                agqvehicle:eff_date = agqvehicle_alt:eff_date
            end
        l_prior_eff_date = agqvehicle:eff_date
        end
        agqvehicle:eff_date/tabstop/default mandatory
        if agqvehicle:eff_date <> l_prior_eff_date and
           l_prior_eff_date <> 0 then
            l_new_eff_date = agqvehicle:eff_date

        if function one of "CHANGE", "CHG" and
           l_prior_eff_date <> l_new_eff_date and
           l_new_eff_date <> 0 then
            begin
            access agqvehicle_alias, set agqvehicle_alias:app_no = g_app_no, generic

            while agqvehicle_alias:app_no = g_app_no
                begin
                change agqvehicle_alias
                    begin
                    if agqvehicle_alias:eff_date <> l_new_eff_date then
                        agqvehicle_alias:eff_date = l_new_eff_date
                    end
                next agqvehicle_alias
                end

            end

        if agqvehicle:eff_date <> agqvehicle_alt:eff_date and
           agqvehicle_alt:eff_date <> 0 then
            begin
            error "Effective date must be the same for all vehicles"
            agqvehicle:eff_date = agqvehicle_alt:eff_date
            end

        if agqvehicle:eff_date < todaysdate - 30 then
            error "The effective date can not be more than 30 days from todaysdate"

        agqvehicle:exp_date = dateadd(agqvehicle:eff_date,0,1) ;
302     l_agent_wording/displayonly/showasguidetext tagged ficof_fn ;
303     begin
        access sfsagent_alias, set sfsagent_alias:company_id = agqvehicle:company_id, generic

        end
        agqvehicle:agent_no/showasguidetext/default  tagged ficof_fn
        hide if sfsemail:agent_no <> 0
        access sfsagent, set sfsagent:company_id = agqvehicle:company_id,
                             sfsagent:agent_no = agqvehicle:agent_no, generic

        if agqvehicle:agent_no <> sfsagent:agent_No then
            error "Invalid Agent No"

        activehelp sfsagent_alias:agent_no,
                   sfsagent_alias:name[1] ;
303     agqvehicle:agent_no/showasguidetext/displayonly tagged ficof_fn
        hide if sfsemail:agent_no = 0 ;
401     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "005webhelp_agtmt401_scr_rating_info_dbx_fob.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        l_fob = agqmaster:form_of_business
        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id,
                           sfsfob:form_of_business = agqmaster:form_of_business, generic

        l_fob_desc = sfsfob:description

        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id, approximate

        access agqmaster, set agqmaster:app_no = g_app_no, generic

        if agqvehicle:business_name[1] <> "" and
           agqmaster:form_of_business <> "" then
            begin
            access sfsfob, set sfsfob:company_id       = agqvehicle:company_id,
                               sfsfob:form_of_business = agqmaster:form_of_business, generic

            l_form_of_business = agqmaster:form_of_business
            l_fob_description  = sfsfob:description
            l_fob_description1 = agqmaster:fob_description
            end

        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id, approximate

        if agqmaster:form_of_business = "" then
            activehelp()
        end
        l_fob_description/default/tabstop/uppercase
        if l_fob <> agqmaster:form_of_business or
           l_fob_desc <> l_fob_description then
            begin
            l_form_of_business = sfsfob:form_of_business
            if l_form_of_business <> "T" then
                l_fob_description1 = ""
            end

        activehelp sfsfob:description;
402     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "006webhelp_agtmt401_scr_rating_info_tbx_fob_other.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        l_fob_description1/default/tabstop/uppercase
        hide if trun(l_fob_description) not one of "OTHER", "Other" ;

501     Begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if sfsline:lob_code = "CPORTFOLIO" then
                do update_agqmastsupp
            else
                do update_agqmaster
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "013webhelp_agtmt401_scr_rating_info_dbx_county.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        End
        agqvehicle:county/tabstop/default
        Error 1222 If SFSSTATE_ALIAS:DESCRIPTION = " "

        if sfsstate_alias:hide_for_auto = 1 then
            error "Invalid County Entered"

        Activehelp if sfsstate_alias:county <> 0 and
                      sfsstate_alias:hide_for_auto = 0 then
                       SFSSTATE_ALIAS:COUNTY
                   else
                       null/width=3/heading="County",
                   if sfsstate_alias:county <> 0 and
                      sfsstate_alias:hide_for_auto = 0 then
                       SFSSTATE_ALIAS:DESCRIPTION
                   else
                       null/width=30/heading="Description" ;
502     begin
        access sfscounty_lookup_alias, set sfscounty_lookup_alias:company_id  = agqvehicle:company_id,
                                           sfscounty_lookup_alias:state       = agqvehicle:state,
                                           sfscounty_lookup_alias:description = l_county_description, approximate

        end
        l_county_description/uppercase/tabstop
        hide if agqvehicle:county <> 0
        l_length = len(trun(l_county_description))
        access sfscounty_lookup, set sfscounty_lookup:company_id  = agqvehicle:company_id,
                                     sfscounty_lookup:state       = agqvehicle:state,
                                     sfscounty_lookup:description = l_county_description, approximate

        l_possible_counties = 0
        while sfscounty_lookup:company_id = agqvehicle:company_id and
              sfscounty_lookup:state      = agqvehicle:state
                begin
                if sfscounty_lookup:description[1,l_length] = l_county_description[1,l_length] then
                    l_possible_counties = l_possible_counties + 1

                next sfscounty_lookup
                end

        if l_possible_counties = 1 then
            begin
            access sfscounty_lookup, set sfscounty_lookup:company_id  = agqvehicle:company_id,
                                         sfscounty_lookup:state       = agqvehicle:state,
                                         sfscounty_lookup:description = l_county_description, approximate

            l_county_description = sfscounty_lookup:description
            agqvehicle:county = sfscounty_lookup:county
            end
        else
            begin
            activehelp()
            access sfscounty_lookup, set sfscounty_lookup:company_id  = agqvehicle:company_id,
                                         sfscounty_lookup:state       = agqvehicle:state,
                                         sfscounty_lookup:description = l_county_description, approximate

            agqvehicle:county = sfscounty_lookup:county
            end

        activehelp if sfscounty_lookup_alias:state = agqvehicle:state and
                      sfscounty_lookup_alias:county <> 0 and
                      sfscounty_lookup_alias:description[1,l_length] = l_county_description[1,l_length] then
                       sfscounty_lookup_alias:description
                   else
                       null/width=75 ;
501     agqvehicle:county/displayonly ;
502     sfsstate_alias:description ;
503     agqVEHICLE:STR_ZIPCODE/default/tabstop  mandatory
        if val(agqvehicle:str_zipcode) <> 0 then
            begin
            If agqvehicle:STR_ZIPCODE[6,9] = "" Then
                agqvehicle:STR_ZIPCODE[6,9] = "0000"
            end
        l_zip_code_5 = agqvehicle:zipcode[1,5]
        access sfsinflatzipcode, set sfsinflatzipcode:company_id       = agqvehicle:company_id,
                                     sfsinflatzipcode:state            = agqvehicle:state,
                                     sfsinflatzipcode:line_of_business = agqvehicle:line_of_business,
                                     sfsinflatzipcode:zip_code_5       = l_zip_code_5, generic

        if l_zip_code_5 <> sfsinflatzipcode:zip_code_5 then
            error "Must have a valid zip code to rate"
        if agqvehicle:zipcode = 0 then
            error "Must enter a zip code to rate";

503     Begin
        If agqVEHICLE:STR_ZIPCODE[6,9] = "" Then
            agqVEHICLE:STR_ZIPCODE[6,9] = "0000"
        End
        agqVEHICLE:STR_ZIPCODE/displayonly ;

601     begin
        l_zip_code_5 = agqvehicle:zipcode[1,5]

        access sfsinflatzipcode, set sfsinflatzipcode:company_id       = agqvehicle:company_id,
                                     sfsinflatzipcode:state            = agqvehicle:state,
                                     sfsinflatzipcode:line_of_business = agqvehicle:line_of_business,
                                     sfsinflatzipcode:zip_code_5       = l_zip_code_5, generic

        while sfsinflatzipcode:company_id       = agqvehicle:company_id and
              sfsinflatzipcode:state            = agqvehicle:state and
              sfsinflatzipcode:line_of_business = agqvehicle:line_of_business and
              sfsinflatzipcode:zip_code_5       = l_zip_code_5
                begin
                if (agqvehicle:eff_date >= sfsinflatzipcode:eff_date and
                   (agqvehicle:eff_date <= sfsinflatzipcode:exp_date or
                   sfsinflatzipcode:exp_date = 0)) then
                    begin
                    agqvehicle:territory             = sfsinflatzipcode:territory
                    if sfsinflatzipcode:description <> "" then
                        agqvehicle:territory_description = sfsinflatzipcode:description
                    end

                next sfsinflatzipcode
                end

        end
        agqVEHICLE:TERRITORY_DESCRIPTION/displayonly ;
602     agqVEHICLE:TERRITORY/displayonly ;

}

Panel at 9,1 to 24,100  tagged garage_fn
        Properties {
                LayoutType = screen
        }
        {
         Components
           guidetext at 2,1 to 2,22
             properties
               {
                 text = "Insured's Name:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }

           guidetext at 3,1 to 3,22
             properties
               {
                 text = "Eff Date:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 4,1 to 4,22
             properties
               {
                 text = "Form Of Business:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 5,1 to 5,22
             properties
               {
                 text = "Garage Location:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
         }

Panel at 9,24 to 24, 100 Tagged garage_fn
{
%%

___________________________________________________
__________                    __________  ____
____________________________  _________________________________________
County: ___  _____________________________________________ Zip: __________
  City: __________________________________________________  ___

%%

components

fields
201     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            disable(calc_fn)
            enable(accept_fn)
            }
        else
            {
            disable(accept_fn)
            enable(calc_fn)
            }
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "003webhelp_agtmt401_scr_rating_info_tbx_insured_name.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        agqvehicle:business_name[1]/tabstop/uppercase/default ;
301     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "004webhelp_agtmt401_scr_rating_info_tbx_eff_date.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        access agqvehicle_alt, set agqvehicle_alt:app_no = g_app_no, generic

        if function one of "ADD", "NEW" then
            begin
            if agqvehicle:eff_date = 0 then
                agqvehicle:eff_date = todaysdate
            else
            if agqvehicle_alt:eff_date <> 0 then
                agqvehicle:eff_date = agqvehicle_alt:eff_date
            end
        l_prior_eff_date = agqvehicle:eff_date
        end
        agqvehicle:eff_date/tabstop/default mandatory
        if agqvehicle:eff_date <> l_prior_eff_date and
           l_prior_eff_date <> 0 then
            l_new_eff_date = agqvehicle:eff_date

        if function one of "CHANGE", "CHG" and
           l_prior_eff_date <> l_new_eff_date and
           l_new_eff_date <> 0 then
            begin
            access agqvehicle_alias, set agqvehicle_alias:app_no = g_app_no, generic

            while agqvehicle_alias:app_no = g_app_no
                begin
                change agqvehicle_alias
                    begin
                    if agqvehicle_alias:eff_date <> l_new_eff_date then
                        agqvehicle_alias:eff_date = l_new_eff_date
                    end
                next agqvehicle_alias
                end

            end

        if agqvehicle:eff_date <> agqvehicle_alt:eff_date and
           agqvehicle_alt:eff_date <> 0 then
            begin
            error "Effective date must be the same for all vehicles"
            agqvehicle:eff_date = agqvehicle_alt:eff_date
            end

        if agqvehicle:eff_date < todaysdate - 30 then
            error "The effective date can not be more than 30 days from todaysdate"

        agqvehicle:exp_date = dateadd(agqvehicle:eff_date,0,1) ;
302     l_agent_wording/displayonly/showasguidetext tagged ficof_fn ;
303     begin
        access sfsagent_alias, set sfsagent_alias:company_id = agqvehicle:company_id, generic

        end
        agqvehicle:agent_no/showasguidetext/default  tagged ficof_fn
        hide if sfsemail:agent_no <> 0
        access sfsagent, set sfsagent:company_id = agqvehicle:company_id,
                             sfsagent:agent_no = agqvehicle:agent_no, generic

        if agqvehicle:agent_no <> sfsagent:agent_No then
            error "Invalid Agent No"

        activehelp sfsagent_alias:agent_no,
                   sfsagent_alias:name[1] ;
303     agqvehicle:agent_no/showasguidetext/displayonly tagged ficof_fn
        hide if sfsemail:agent_no = 0 ;
401     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "005webhelp_agtmt401_scr_rating_info_dbx_fob.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        l_fob = agqmaster:form_of_business
        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id,
                           sfsfob:form_of_business = agqmaster:form_of_business, generic

        l_fob_desc = sfsfob:description

        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id, approximate

        access agqmaster, set agqmaster:app_no = g_app_no, generic

        if agqvehicle:business_name[1] <> "" and
           agqmaster:form_of_business <> "" then
            begin
            access sfsfob, set sfsfob:company_id       = agqvehicle:company_id,
                               sfsfob:form_of_business = agqmaster:form_of_business, generic

            l_form_of_business = agqmaster:form_of_business
            l_fob_description  = sfsfob:description
            l_fob_description1 = agqmaster:fob_description
            end

        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id, approximate

        if agqmaster:form_of_business = "" then
            activehelp()
        end
        l_fob_description/default/tabstop/uppercase
        if l_fob <> agqmaster:form_of_business or
           l_fob_desc <> l_fob_description then
            begin
            l_form_of_business = sfsfob:form_of_business
            if l_form_of_business <> "T" then
                l_fob_description1 = ""
            end

        activehelp sfsfob:description;
402     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "006webhelp_agtmt401_scr_rating_info_tbx_fob_other.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        l_fob_description1/default/tabstop/uppercase
        hide if trun(l_fob_description) not one of "OTHER", "Other" ;

501     Begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if sfsline:lob_code = "CPORTFOLIO" then
                do update_agqmastsupp
            else
                do update_agqmaster
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "013webhelp_agtmt401_scr_rating_info_dbx_county.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        End
        agqvehicle:county/tabstop/default
        Error 1222 If SFSSTATE_ALIAS:DESCRIPTION = " "

        if sfsstate_alias:hide_for_auto = 1 then
            error "Invalid County Entered"

        Activehelp if sfsstate_alias:county <> 0 and
                      sfsstate_alias:hide_for_auto = 0 then
                       SFSSTATE_ALIAS:COUNTY
                   else
                       null/width=3/heading="County",
                   if sfsstate_alias:county <> 0 and
                      sfsstate_alias:hide_for_auto = 0 then
                       SFSSTATE_ALIAS:DESCRIPTION
                   else
                       null/width=30/heading="Description" ;
502     begin
        access sfscounty_lookup_alias, set sfscounty_lookup_alias:company_id  = agqvehicle:company_id,
                                           sfscounty_lookup_alias:state       = agqvehicle:state,
                                           sfscounty_lookup_alias:description = l_county_description, approximate

        end
        l_county_description/uppercase/tabstop
        hide if agqvehicle:county <> 0
        l_length = len(trun(l_county_description))
        access sfscounty_lookup, set sfscounty_lookup:company_id  = agqvehicle:company_id,
                                     sfscounty_lookup:state       = agqvehicle:state,
                                     sfscounty_lookup:description = l_county_description, approximate

        l_possible_counties = 0
        while sfscounty_lookup:company_id = agqvehicle:company_id and
              sfscounty_lookup:state      = agqvehicle:state
                begin
                if sfscounty_lookup:description[1,l_length] = l_county_description[1,l_length] then
                    l_possible_counties = l_possible_counties + 1

                next sfscounty_lookup
                end

        if l_possible_counties = 1 then
            begin
            access sfscounty_lookup, set sfscounty_lookup:company_id  = agqvehicle:company_id,
                                         sfscounty_lookup:state       = agqvehicle:state,
                                         sfscounty_lookup:description = l_county_description, approximate

            l_county_description = sfscounty_lookup:description
            agqvehicle:county = sfscounty_lookup:county
            end
        else
            begin
            activehelp()
            access sfscounty_lookup, set sfscounty_lookup:company_id  = agqvehicle:company_id,
                                         sfscounty_lookup:state       = agqvehicle:state,
                                         sfscounty_lookup:description = l_county_description, approximate

            agqvehicle:county = sfscounty_lookup:county
            end

        activehelp if sfscounty_lookup_alias:state = agqvehicle:state and
                      sfscounty_lookup_alias:county <> 0 and
                      sfscounty_lookup_alias:description[1,l_length] = l_county_description[1,l_length] then
                       sfscounty_lookup_alias:description
                   else
                       null/width=75 ;
501     agqvehicle:county/displayonly ;
502     sfsstate_alias:description ;
503     agqVEHICLE:STR_ZIPCODE/default/tabstop  mandatory
        if val(agqvehicle:str_zipcode) <> 0 then
            begin
            If agqvehicle:STR_ZIPCODE[6,9] = "" Then
                agqvehicle:STR_ZIPCODE[6,9] = "0000"
            end
        l_zip_code_5 = agqvehicle:zipcode[1,5]
        access sfsinflatzipcode, set sfsinflatzipcode:company_id       = agqvehicle:company_id,
                                     sfsinflatzipcode:state            = agqvehicle:state,
                                     sfsinflatzipcode:line_of_business = agqvehicle:line_of_business,
                                     sfsinflatzipcode:zip_code_5       = l_zip_code_5, generic

        if l_zip_code_5 <> sfsinflatzipcode:zip_code_5 then
            error "Must have a valid zip code to rate"
        if agqvehicle:zipcode = 0 then
            error "Must enter a zip code to rate";

503     Begin
        If agqVEHICLE:STR_ZIPCODE[6,9] = "" Then
            agqVEHICLE:STR_ZIPCODE[6,9] = "0000"
        End
        agqVEHICLE:STR_ZIPCODE/displayonly ;

601     begin
        l_zip_code_5 = agqvehicle:zipcode[1,5]

        access sfsinflatzipcode, set sfsinflatzipcode:company_id       = agqvehicle:company_id,
                                     sfsinflatzipcode:state            = agqvehicle:state,
                                     sfsinflatzipcode:line_of_business = agqvehicle:line_of_business,
                                     sfsinflatzipcode:zip_code_5       = l_zip_code_5, generic

        while sfsinflatzipcode:company_id       = agqvehicle:company_id and
              sfsinflatzipcode:state            = agqvehicle:state and
              sfsinflatzipcode:line_of_business = agqvehicle:line_of_business and
              sfsinflatzipcode:zip_code_5       = l_zip_code_5
                begin
                if (agqvehicle:eff_date >= sfsinflatzipcode:eff_date and
                   (agqvehicle:eff_date <= sfsinflatzipcode:exp_date or
                   sfsinflatzipcode:exp_date = 0)) then
                    begin
                    agqvehicle:territory             = sfsinflatzipcode:territory
                    if sfsinflatzipcode:description <> "" then
                        agqvehicle:territory_description = sfsinflatzipcode:description
                    end

                next sfsinflatzipcode
                end

        end
        agqVEHICLE:TERRITORY_DESCRIPTION/displayonly ;
602     agqVEHICLE:TERRITORY/displayonly ;

}

Panel at 26,1 to 26,100 Tagged icon_line2_tg
Properties
        {
          LayoutType = screen
        }
{
Components

        Button at 1,5   tagged back_fn
        Properties {
                Iconname = "btn_back_to_main_screen.bmp"
                }
        Events  {
                Action {
                        if g_portfolio <> "Y" then
                          begin
                          l_continue_2 = dialog("EXITING","warning.bmp","You are about to leave the application, Do you wish to continue","Yes","No")
                          if l_continue_2 = "Yes" then
                              begin
                              function = "back"
                              abort()
                              end
                          end
                        else
                          begin
                          function = "back"
                          abort()
                          end
                       }
                }

        Button at 1,32    tagged previous_fn
        Properties {
                Iconname = "btn_prev_vehicle.bmp"
                }
        Events  {
                Action = previous_fn
                }

        Button at 1,50 tagged next_fn
        Properties {
                Iconname = "btn_next_vehicle.bmp"
                }
        Events  {
                Action = next_fn
                }


        Button at 1,75   tagged calc_fn
        Properties {
                Iconname = "btn_view_summary_totals.bmp"
                }
        Events  {
                Action {
                          function = "func1"
                          abort()
                       }
                }

}

panel at 27,1 to 32,100 tagged ficof_fn

Properties
        {
          LayoutType = screen
--          Transparent = False
          backgroundcolor = "white"
        }
{
      Components
         browser at 1,1 to 7,100  tagged helper_tg
             properties {
                          url = ""
                        }
}

/*
panel at 23,1 to 30,120

Properties
        {
          LayoutType = screen
--          Transparent = False
          backgroundcolor = "white"
        }
{
}

panel at 23,1 to 85,120
        Properties {
                   layouttype = screen
                   backgroundcolor = "white"
                   }
            {
            components
                guidetext at 1,1 tagged t_view1
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 2,5 tagged t_view2
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 3,5  tagged t_view3
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 4,5 tagged t_view4
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 5,5  tagged t_view5
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,6  tagged t_view6
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,7  tagged t_view7
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,8  tagged t_view8
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,9  tagged t_view9
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,10 tagged t_view10
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,11 tagged t_view11
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,12 tagged t_view12
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,13 tagged t_view13
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,14 tagged t_view14
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,15 tagged t_view15
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,16 tagged t_view16
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,17 tagged t_view17
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,18 tagged t_view18
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,19 tagged t_view19
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,20 tagged t_view20
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,21 tagged t_view21
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,22 tagged t_view22
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,23 tagged t_view23
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,24 tagged t_view24
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
                guidetext at 1,25 tagged t_view25
                        Properties
                                {
                                text = ""
                                fontsize = 12
                                fontname = "Arial"
                                }
            }
*/
}

Update
if UPDATEOK = "NO" then
    {
    enable (calc_fn)
    disable(accept_fn)
    }

if abort = "YES" then
    begin
    g_ok_to_add = "N"
    g_type_str  = ""
    g_type      = 0
    end

If UPDATEOK = "YES" And
   Abort = "NO" Then
    Begin
    g_ok_to_add = "N"
    enable(calc_fn)
    disable(accept_fn)

    if function one of "ADD", "NEW", "CHANGE", "CHG", "DELETE" then
        begin
        access agqvehicle_alias, set agqvehicle_alias:app_no = g_app_no, generic

        l_count = 0
        while agqvehicle_alias:app_no = g_app_no
            begin
            if agqvehicle_alias:class_code not one of 671, 672, 673, 674, 675, 676,
                                                      681, 682, 683, 684, 685, 686,
                                                      691, 692, 693, 694, 695, 696,
                                                      7040 then
                begin
                l_count = l_count + 1
                end

            next agqvehicle_alias
            end

        if l_count >= 5 then
            begin
            if sfsline:lob_code = "CPORTFOLIO" then
                begin
                access agqmastsupp, set agqmastsupp:app_no = g_app_no,
                                        agqmastsupp:line_of_business = l_line_of_business, generic

                if agqmastsupp:app_no = g_app_no and
                   agqmastsupp:line_of_business = l_line_of_business then
                    begin
                    change agqmastsupp
                        begin
                        agqmastsupp:non_fleet = "F"
                        end
                    end
                else
                    begin
                    add agqmastsupp
                        begin
                        agqmastsupp:app_no           = g_app_no
                        agqmastsupp:line_of_business = l_line_of_business
                        agqmastsupp:non_fleet        = "F"
                        end
                    end
                end
            else
                begin
                access agqmaster, set agqmaster:app_no = g_app_no, generic

                if agqmaster:app_no = g_app_no then
                    begin
                    change agqmaster
                        begin
                        agqmaster:non_fleet = "F"
                        end
                    end
                else
                    begin
                    add agqmaster
                        begin
                        agqmaster:app_no    = g_app_no
                        agqmaster:non_fleet = "F"
                        end
                    end
                end
            end
        else
            begin
            if sfsline:lob_code = "CPORTFOLIO" then
                begin
                access agqmastsupp, set agqmastsupp:app_no = g_app_no,
                                        agqmastsupp:line_of_business = l_line_of_business, generic

                if agqmastsupp:app_no = g_app_no and
                   agqmastsupp:line_of_business = l_line_of_business then
                    begin
                    change agqmastsupp
                        begin
                        agqmastsupp:non_fleet = "N"
                        end
                    end
                else
                    begin
                    add agqmastsupp
                        begin
                        agqmastsupp:app_no           = g_app_no
                        agqmastsupp:line_of_business = l_line_of_business
                        agqmastsupp:non_fleet        = "N"
                        end
                    end
                end
            else
                begin
                access agqmaster, set agqmaster:app_no = g_app_no, generic

                if agqmaster:app_no = g_app_no then
                    begin
                    change agqmaster
                        begin
                        agqmaster:non_fleet = "N"
                        end
                    end
                else
                    begin
                    add agqmaster
                        begin
                        agqmaster:app_no    = g_app_no
                        agqmaster:non_fleet = "N"
                        end
                    end
                end
            end
        end

    if function one of "ADD", "NEW", "CHANGE", "CHG" then
        begin
          if agqvehicle:state one of 29 then
            {
              do check_for_mca825
            }
        end

    if function one of "delete", "DELETE" then
        begin
        access agqend1, set agqend1:app_no = agqvehicle:app_no,
                            agqend1:vehicle_no = agqvehicle:vehicle_no, generic

        while agqend1:app_no = agqvehicle:app_no and
              agqend1:vehicle_no = agqvehicle:vehicle_no
                begin
                delete agqend1

                next agqend1
                end

        access sfsline, set sfsline:company_id       = agqname:company_id,
                            sfsline:line_of_business = agqname:line_of_business,
                            sfsline:lob_subline      = "00", generic

        access agqvehicle_alias, set agqvehicle_alias:app_no = g_app_no, generic

        if sfsline:lob_code = "CPORTFOLIO" then
            begin
            access agqmastsupp, set agqmastsupp:app_no           = g_app_no,
                                    agqmastsupp:line_of_business = agqvehicle:line_of_business, generic

            if agqmastsupp:app_no           = g_app_no and
               agqmastsupp:line_of_business = agqvehicle:line_of_business then
                begin
                if agqvehicle_alias:app_no <> g_app_no then
                    delete agqmastsupp
                end
            end

        access agqamt, set agqamt:app_no = g_app_no, generic

        if agqamt:app_no = g_app_no then
            begin
            if agqvehicle_alias:app_no <> g_app_no then
                begin
                change agqamt
                    begin
                    agqamt:lob_totals[1]    = 0
                    agqamt:lob_terrorism[1] = 0
                    agqamt:lob_surcharge[1] = 0
                    end
                end
            end


        g_vehicle_no = 1
        function     = "redisplay"
        end

    if function one of "ADD", "NEW", "CHG", "CHANGE" then
        begin
        L_RECORD_KEY = "DE"
        Access CASNOFAULTDE, Set CASNOFAULTDE:COMPANY_ID       = agqvehicle:COMPANY_ID,
                                 CASNOFAULTDE:STATE            = agqVEHICLE:STATE,
                                 CASNOFAULTDE:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS, Generic

        Repeat Begin
            Exit If CASNOFAULTDE:RECORD_KEY       <> L_RECORD_KEY Or
                    CASNOFAULTDE:COMPANY_ID       <> agqvehicle:COMPANY_ID Or
                    CASNOFAULTDE:STATE            <> agqVEHICLE:STATE Or
                    CASNOFAULTDE:LINE_OF_BUSINESS <> agqVEHICLE:LINE_OF_BUSINESS

            If agqvehicle:EFF_DATE >= CASNOFAULTDE:EFF_DATE Then
                Begin
                L_BASIC_LIMIT_1 = CASNOFAULTDE:BASIC_LIMITS[1]
                L_BASIC_LIMIT_2 = CASNOFAULTDE:BASIC_LIMITS[2]
                End

            Next CASNOFAULTDE
            End

        L_RECORD_KEY = "NF"
        Access CASNOFAULT, Set CASNOFAULT:COMPANY_ID       = agqvehicle:COMPANY_ID,
                               CASNOFAULT:STATE            = agqVEHICLE:STATE,
                               CASNOFAULT:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS, Generic

        Repeat Begin
            Exit If CASNOFAULT:RECORD_KEY       <> L_RECORD_KEY Or
                    CASNOFAULT:COMPANY_ID       <> agqvehicle:COMPANY_ID Or
                    CASNOFAULT:STATE            <> agqVEHICLE:STATE Or
                    CASNOFAULT:LINE_OF_BUSINESS <> agqVEHICLE:LINE_OF_BUSINESS

            If agqvehicle:EFF_DATE >= CASNOFAULT:EFF_DATE Then
                Begin
                L_EXTENDED_LIMIT      = CASNOFAULT:EXTENDED_LIMIT
                L_EXTENDED_ADDL_LIMIT = CASNOFAULT:EXTENDED_ADDL_LIMIT
                End

            Next CASNOFAULT
            End

        Access agqPANOFAULT, Set agqpanofault:app_no     = agqVEHICLE:app_no,
                                 agqpanofault:VEHICLE_NO = agqVEHICLE:VEHICLE_NO, Generic

        access agqpanofault_alias, set agqpanofault_alias:app_no = agqvehicle:app_no, generic

        if agqpanofault:app_no     <> agqvehicle:app_no or
           agqpanofault:vehicle_no <> agqvehicle:Vehicle_no then
            begin
            if agqvehicle:class_code not one of 691, 692, 693, 694, 695, 696 then
                begin
                add agqpanofault
                    begin
                    agqpanofault:app_no         = agqvehicle:app_no
                    agqpanofault:vehicle_no     = agqvehicle:vehicle_no
                    agqpanofault:record_rdf     = agqpanofault_alias:record_rdf/raw
                    end
                end
            end

        if agqpanofault:app_no     = agqvehicle:app_no and
           agqpanofault:vehicle_no = agqvehicle:Vehicle_no then
            begin
            if agqvehicle:class_code one of 691, 692, 693, 694, 695, 696 then
                begin
                delete agqpanofault
                end
            end

        Access agqpip, Set agqpip:app_no     = agqVEHICLE:app_no,
                           agqpip:VEHICLE_NO = agqVEHICLE:VEHICLE_NO, Generic

        access agqpip_alias, set agqpip_alias:app_no     = agqvehicle:app_no,
                                 agqpip_alias:vehicle_no = 1, generic

        If agqpip:app_no     <> agqVEHICLE:app_no Or
           agqpip:VEHICLE_NO <> agqVEHICLE:VEHICLE_NO Then
            begin
            Add agqpip
                Begin
                agqpip:app_no = agqVEHICLE:app_no
                agqpip:VEHICLE_NO = agqVEHICLE:VEHICLE_NO
                agqpip:state = agqvehicle:state
                agqpip:EXTEND_MEDICAL_EXPENSE = "N"
                agqpip:DELETION_OF_BENEFITS = "N"
                agqpip:SECONDARY_OPTION = "N"
                agqpip:no_fault = "Y"
                if agqvehicle:company_id one of "DELOS" then
                    begin
                    if agqmaster:form_of_business one of "C", "P", "L" then
                        agqpip:limitation = "Y"
                    else
                        agqpip:limitation = "N"
                    end
                else
                    agqpip:LIMITATION = "N"
                agqpip:RESIDENT_CHILDREN = "N"
                if agqpip_alias:app_no = agqvehicle:app_no and
                   agqvehicle:type one of 2 then
                    begin
                    agqpip:additional_pip = agqpip_alias:additional_pip
                    agqpip:additional_pip_option = agqpip_alias:additional_pip_option
                    end
                else
                    begin
                    agqpip:ADDITIONAL_PIP = "N"
                    agqpip:additional_pip_option = 0
                    end
                agqpip:NAMED_FAMILY_MEMBERS = "N"
                agqpip:ADDITIONAL_UNLIMITED = "N"
                agqpip:MEDICAL_EXP_MOTOR_BUS = "N"
                agqpip:BROADENED_PIP = "N"
                agqpip:COMBINED_OPTION = "N"
                agqpip:MEDICAL_EXPENSE_LIMIT = agsdefault_cap:MEDICAL_EXP_LIMIT
                agqpip:MED_EXP_DEDUCTIBLE = agsdefault_cap:MEDICAL_EXP_DEDUCTIBLE
                If agqVEHICLE:STATE = 29 Then
                    Begin
                    agqpip:EXTENDED_MEDICAL_EXPENSE = agsdefault_cap:PIP_EXTENDED_LIMIT
                    agqpip:OPTIONAL_MED_EXP_DEDUCTIBLE = agsdefault_cap:PIP_DEDUCTIBLE
                    If agqVEHICLE:TYPE = 2 Or
                       agqVEHICLE:TYPE = 5 Or
                       agqVEHICLE:TYPE = 6 Or
                       agqVEHICLE:TYPE = 7 Then
                        Begin
                        if agsdefault_cap:extend_medical_expense <> "" then
                            agqpip:extend_medical_expense = agsdefault_cap:extend_medical_expense
                        else
                            agqpip:EXTEND_MEDICAL_EXPENSE = "Y"
                        if agqpip:extend_medical_expense = "Y" then
                            agqpip:EXTENDED_MEDICAL_EXPENSE = L_EXTENDED_LIMIT +
                                                              L_EXTENDED_ADDL_LIMIT
                        else
                            agqpip:extended_medical_expense = l_extended_limit
                        agqpip:PEDESTRIAN = "N"
                        End
                    If agqVEHICLE:TYPE = 1 Or
                       agqVEHICLE:TYPE = 3 Or
                       agqVEHICLE:TYPE = 4 Then
                        Begin
                        agqpip:EXTEND_MEDICAL_EXPENSE = "N"
                        agqpip:EXTENDED_MEDICAL_EXPENSE = L_EXTENDED_LIMIT
                        If agqVEHICLE:CLASS_CODE = 681 Or
                           agqVEHICLE:CLASS_CODE = 682 Or
                           agqVEHICLE:CLASS_CODE = 683 Or
                           agqVEHICLE:CLASS_CODE = 691 Or
                           agqVEHICLE:CLASS_CODE = 692 Or
                           agqVEHICLE:CLASS_CODE = 693 Then
                            agqpip:PEDESTRIAN = "N"
                        Else
                            agqpip:PEDESTRIAN = "Y"
                        End
                    L_ADD_MED_EXP_CODE = "N"
                    If agqVEHICLE:TYPE = 3 Then
                        Begin
                        If agqVEHICLE:CLASS_CODE = 6381 Or
                           agqVEHICLE:CLASS_CODE = 6382 Or
                           agqVEHICLE:CLASS_CODE = 6383 or
                           agqvehicle:class_code = 6384 or
                           agqvehicle:class_code = 6385 Then
                            Begin
                            L_ADD_MED_EXP_CODE = "Y"
                            agqpip:MEDICAL_EXP_MOTOR_BUS = "Y"
                            End
                        Else
                            Begin
                            agqpip:MEDICAL_EXP_MOTOR_BUS = "N"
                            End
                        End
                    Else
                        Begin
                        agqpip:MEDICAL_EXP_MOTOR_BUS = "N"
                        End
                    agqpip:PIP_LIMIT[1] = 0
                    agqpip:PIP_LIMIT[2] = 0
                    agqpip:ADDL_LIMIT[1] = 0
                    agqpip:ADDL_LIMIT[2] = 0
                    agqpip:SINGLE_LIMIT = 0
                    End
                If agqVEHICLE:STATE = 07 Then
                    Begin
                    agqpip:MEDICAL_EXP_MOTOR_BUS = "N"
                    agqpip:EXTENDED_MEDICAL_EXPENSE = 0
                    agqpip:OPTIONAL_MED_EXP_DEDUCTIBLE = 0
                    agqpip:PIP_LIMIT[1] = L_BASIC_LIMIT_1
                    agqpip:PIP_LIMIT[2] = L_BASIC_LIMIT_2
                    agqpip:ADDL_LIMIT[1] = 0
                    agqpip:ADDL_LIMIT[2] = 0
                    agqpip:SINGLE_LIMIT = 0
                    agqpip:PEDESTRIAN = "N"
                    End
                If agqVEHICLE:STATE = 37 Then
                    Begin
                    agqpip:MEDICAL_EXP_MOTOR_BUS = "N"
                    agqpip:EXTENDED_MEDICAL_EXPENSE = 0
                    agqpip:OPTIONAL_MED_EXP_DEDUCTIBLE = 0
                    agqpip:PIP_LIMIT[1] = L_BASIC_LIMIT_1
                    agqpip:PIP_LIMIT[2] = L_BASIC_LIMIT_2
                    agqpip:ADDL_LIMIT[1] = 0
                    agqpip:ADDL_LIMIT[2] = 0
                    agqpip:SINGLE_LIMIT = 0
                    agqpip:PEDESTRIAN = "N"
                    End
                End
            End

    L_RECORD_KEY = "RA"
    Access CASRATE, Set CASRATE:COMPANY_ID       = agqvehicle:COMPANY_ID,
                        CASRATE:STATE            = agqVEHICLE:STATE,
                        CASRATE:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS, Generic

    while CASRATE:RECORD_KEY       = L_RECORD_KEY and
          CASRATE:COMPANY_ID       = agqvehicle:COMPANY_ID and
          CASRATE:STATE            = agqVEHICLE:STATE and
          CASRATE:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS
        begin
        If agqvehicle:EFF_DATE >= CASRATE:EFF_DATE Then
            Begin
            L_ACV_CODE                   = CASRATE:STATED_BASIS_CODE
            L_BUSES_CODE                 = CASRATE:BUSES_LIAB_CODE
            L_PLATES_CODE                = CASRATE:PLATES_CODE
            L_MOTOR_HOME_CODE            = CASRATE:MOTOR_HOME_CODE
            L_MEDICAL_EXP_MOTOR_BUS_CODE = CASRATE:MEDICAL_EXP_MOTOR_BUS_CODE
            l_auto_term_code             = casrate:auto_termination_code
            End

        Next CASRATE
        End

    if l_acv_code <> "" then
        begin
        L_CODE = L_ACV_CODE
        Do ACCESS_agqend1
        If L_ADD_ENDORSEMENT = "Y" And
           agqVEHICLE:ACV = "N" Then
            Do ADD_agqend1
        If L_ADD_ENDORSEMENT = "N" And
           agqVEHICLE:ACV = "Y" Then
            Do DELETE_agqend1
        end

    if l_buses_code <> "" and
       sfsline:lob_code <> "CPORTFOLIO" then
        begin
        L_CODE = L_BUSES_CODE
        Do ACCESS_agqend1
        If L_ADD_ENDORSEMENT = "Y" And
           agqVEHICLE:TYPE = 3 And
           agqmaster:LIABILITY <> 0 Then
            Do ADD_agqend1
        If (L_ADD_ENDORSEMENT = "N" And
           (agqVEHICLE:TYPE <> 3 Or
           agqmaster:LIABILITY = 0)) Then
            Do DELETE_agqend1
        end

    if l_buses_code <> "" and
       sfsline:lob_code = "CPORTFOLIO" then
        begin
        L_CODE = L_BUSES_CODE
        Do ACCESS_agqend1
        If L_ADD_ENDORSEMENT = "Y" And
           agqVEHICLE:TYPE = 3 And
           agqmastsupp:LIABILITY <> 0 Then
            Do ADD_agqend1
        If (L_ADD_ENDORSEMENT = "N" And
           (agqVEHICLE:TYPE <> 3 Or
           agqmastsupp:LIABILITY = 0)) Then
            Do DELETE_agqend1
        end

    if l_plates_code <> "" then
        begin
        L_CODE = L_PLATES_CODE
        Do ACCESS_agqend1
        If L_ADD_ENDORSEMENT = "Y" And
           agqVEHICLE:TYPE = 6 Then
            Do ADD_agqend1
        If L_ADD_ENDORSEMENT = "N" And
           agqVEHICLE:TYPE <> 6 Then
            Do DELETE_agqend1
        end

    if l_motor_home_code <> "" then
        begin
        L_CODE = L_MOTOR_HOME_CODE
        Do ACCESS_agqend1
        If L_ADD_ENDORSEMENT = "Y" And
           agqVEHICLE:TYPE = 7 Then
            Do ADD_agqend1
        If L_ADD_ENDORSEMENT = "N" And
           agqVEHICLE:TYPE <> 7 Then
            Do DELETE_agqend1
        end

    if l_medical_exp_motor_bus_code <> "" then
        begin
        L_CODE = L_MEDICAL_EXP_MOTOR_BUS_CODE
        Do ACCESS_agqend1
        If L_ADD_ENDORSEMENT = "Y" And
           L_ADD_MED_EXP_CODE = "Y" Then
            Do ADD_agqend1
        If L_ADD_ENDORSEMENT = "N" And
           L_ADD_MED_EXP_CODE = "N" Then
            Do DELETE_agqend1
        end

    if l_auto_term_code <> "" then
        begin
        L_CODE = l_auto_term_code
        Do ACCESS_agqend1_1
        If L_ADD_ENDORSEMENT = "Y" Then
            Do ADD_agqend1_1
        end

        access agqmaster, set agqmaster:app_no = g_app_no, generic

        L_RECORD_KEY = "PA"
        Access CASPANOFAULT, Set CASPANOFAULT:COMPANY_ID       = agqvehicle:COMPANY_ID,
                                 CASPANOFAULT:STATE            = agqVEHICLE:STATE,
                                 CASPANOFAULT:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS, Generic

        while CASPANOFAULT:RECORD_KEY       = L_RECORD_KEY and
              CASPANOFAULT:COMPANY_ID       = agqvehicle:COMPANY_ID and
              CASPANOFAULT:STATE            = agqVEHICLE:STATE and
              CASPANOFAULT:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS
        begin
        If agqvehicle:EFF_DATE >= CASNOFAULT:EFF_DATE Then
            Begin
            l_code_1 = caspanofault:basic_benefit_code
            end

        next caspanofault
        end

    if ((l_code_1 <> "" and
       agqvehicle:type <> 1) or
       (l_code_1 <> "" and
       agqvehicle:type = 1 and
       agqvehicle:class_code not one of 681, 682, 683, 691, 692, 693)) then
        begin
        l_code = l_code_1
        Do access_agqend1_1
        If L_ADD_ENDORSEMENT = "Y" then
            Do add_agqend1_1
        end

        L_RECORD_KEY = "NS"
        if sfsline:lob_code = "CPORTFOLIO" then
            l_limit  = agqmastsupp:um_uim_limit[1]
        else
            l_limit  = agqmaster:um_uim_limit[1]
        l_um_uim     = "UM"
        Access casnonstacked, Set casnonstacked:COMPANY_ID       = agqvehicle:COMPANY_ID,
                                  casnonstacked:STATE            = agqvehicle:state,
                                  casnonstacked:LINE_OF_BUSINESS = agqvehicle:line_of_business,
                                  casnonstacked:um_uim           = l_um_uim,
                                  casnonstacked:limit            = l_limit, Generic

        while casnonstacked:RECORD_KEY       = L_RECORD_KEY and
              casnonstacked:COMPANY_ID       = agqvehicle:COMPANY_ID and
              casnonstacked:STATE            = agqvehicle:state and
              casnonstacked:LINE_OF_BUSINESS = agqvehicle:line_of_business and
              casnonstacked:um_uim           = l_um_uim and
              casnonstacked:limit            = l_limit
        begin
        If agqvehicle:EFF_DATE >= casnonstacked:EFF_DATE Then
            Begin
            l_code_1 = casnonstacked:code
            End

        Next casnonstacked
        End

    if l_code_1 <> "" and
       sfsline:lob_code <> "CPORTFOLIO" then
        begin
        L_CODE = L_CODE_1
        Do ACCESS_AGQEND1_1
        If L_ADD_ENDORSEMENT = "Y" And
           agqmaster:um_uim_limit[1] <> 0 and
           agqmaster:non_stacked = "N" Then
            Do ADD_AGQEND1_1
        If ((L_ADD_ENDORSEMENT = "N" And
           agqmaster:um_uim_limit[1] = 0) or
           (l_add_endorsement = "N" and
           agqmaster:non_stacked <> "N")) Then
            Do DELETE_AGQEND1_1
        end

    if l_code_1 <> "" and
       sfsline:lob_code = "CPORTFOLIO" then
        begin
        L_CODE = L_CODE_1
        Do ACCESS_AGQEND1_1
        If L_ADD_ENDORSEMENT = "Y" And
           agqmastsupp:um_uim_limit[1] <> 0 and
           agqmastsupp:non_stacked = "N" Then
            Do ADD_AGQEND1_1
        If ((L_ADD_ENDORSEMENT = "N" And
           agqmastsupp:um_uim_limit[1] = 0) or
           (l_add_endorsement = "N" and
           agqmastsupp:non_stacked <> "N")) Then
            Do DELETE_AGQEND1_1
        end

    L_RECORD_KEY = "NS"
    if sfsline:lob_code = "CPORTFOLIO" then
        l_limit  = agqmastsupp:um_uim_limit[2]
    else
        l_limit  = agqmaster:um_uim_limit[2]
    l_um_uim     = "UIM"
    Access casnonstacked, Set casnonstacked:COMPANY_ID       = agqvehicle:COMPANY_ID,
                              casnonstacked:STATE            = agqvehicle:state,
                              casnonstacked:LINE_OF_BUSINESS = agqvehicle:line_of_business,
                              casnonstacked:um_uim           = l_um_uim,
                              casnonstacked:limit            = l_limit, Generic

    while casnonstacked:RECORD_KEY       = L_RECORD_KEY and
          casnonstacked:COMPANY_ID       = agqvehicle:COMPANY_ID and
          casnonstacked:STATE            = agqvehicle:state and
          casnonstacked:LINE_OF_BUSINESS = agqvehicle:line_of_business and
          casnonstacked:um_uim           = l_um_uim and
          casnonstacked:limit            = l_limit
        begin
        If agqvehicle:EFF_DATE >= casnonstacked:EFF_DATE Then
            Begin
            l_code_1 = casnonstacked:code
            End

        Next casnonstacked
        End

    if l_code_1 <> "" and
       sfsline:lob_code <> "CPORTFOLIO" then
        begin
        L_CODE = L_CODE_1
        Do ACCESS_AGQEND1_1
        If L_ADD_ENDORSEMENT = "Y" And
           agqmaster:um_uim_limit[2] <> 0 and
           agqmaster:non_stacked = "N" Then
            Do ADD_AGQEND1_1
        If ((L_ADD_ENDORSEMENT = "N" And
           agqmaster:um_uim_limit[2] = 0) or
           (l_add_endorsement = "N" and
           agqmaster:non_stacked <> "N")) Then
            Do DELETE_AGQEND1_1
        end

    if l_code_1 <> "" and
       sfsline:lob_code = "CPORTFOLIO" then
        begin
        L_CODE = L_CODE_1
        Do ACCESS_AGQEND1_1
        If L_ADD_ENDORSEMENT = "Y" And
           agqmastsupp:um_uim_limit[2] <> 0 and
           agqmastsupp:non_stacked = "N" Then
            Do ADD_AGQEND1_1
        If ((L_ADD_ENDORSEMENT = "N" And
           agqmastsupp:um_uim_limit[2] = 0) or
           (l_add_endorsement = "N" and
           agqmastsupp:non_stacked <> "N")) Then
            Do DELETE_AGQEND1_1
        end

    L_RECORD_KEY = "ST"
    if sfsline:lob_code = "CPORTFOLIO" then
        l_limit  = agqmastsupp:um_uim_limit[1]
    else
        l_limit  = agqmaster:um_uim_limit[1]
    l_um_uim     = "UM"
    Access casstacked, Set casstacked:COMPANY_ID       = agqvehicle:COMPANY_ID,
                           casstacked:STATE            = agqvehicle:state,
                           casstacked:LINE_OF_BUSINESS = agqvehicle:line_of_business,
                           casstacked:um_uim           = l_um_uim,
                           casstacked:limit            = l_limit, Generic

    while casstacked:RECORD_KEY       = L_RECORD_KEY and
          casstacked:COMPANY_ID       = agqvehicle:COMPANY_ID and
          casstacked:STATE            = agqvehicle:state and
          casstacked:LINE_OF_BUSINESS = agqvehicle:line_of_business and
          casstacked:um_uim           = l_um_uim and
          casstacked:limit            = l_limit
        begin
        If agqvehicle:EFF_DATE >= casstacked:EFF_DATE Then
            Begin
            l_code_1 = casstacked:code
            End

        Next casstacked
        End

    if l_code_1 <> "" and
       sfsline:lob_code <> "CPORTFOLIO" then
        begin
        L_CODE = L_CODE_1
        Do ACCESS_AGQEND1_1
        If L_ADD_ENDORSEMENT = "Y" And
           agqmaster:um_uim_limit[1] <> 0 and
           agqmaster:non_stacked = "S" Then
            Do ADD_AGQEND1_1
        If ((L_ADD_ENDORSEMENT = "N" And
           agqmaster:um_uim_limit[1] = 0) or
           (l_add_endorsement = "N" and
           agqmaster:non_stacked <> "S")) Then
            Do DELETE_AGQEND1_1
        end

    if l_code_1 <> "" and
       sfsline:lob_code = "CPORTFOLIO" then
        begin
        L_CODE = L_CODE_1
        Do ACCESS_AGQEND1_1
        If L_ADD_ENDORSEMENT = "Y" And
           agqmastsupp:um_uim_limit[1] <> 0 and
           agqmastsupp:non_stacked = "S" Then
            Do ADD_AGQEND1_1
        If ((L_ADD_ENDORSEMENT = "N" And
           agqmastsupp:um_uim_limit[1] = 0) or
           (l_add_endorsement = "N" and
           agqmastsupp:non_stacked <> "S")) Then
            Do DELETE_AGQEND1_1
        end

    L_RECORD_KEY = "ST"
    if sfsline:lob_code = "CPORTFOLIO" then
        l_limit  = agqmastsupp:um_uim_limit[2]
    else
        l_limit  = agqmaster:um_uim_limit[2]
    l_um_uim     = "UIM"
    Access casstacked, Set casstacked:COMPANY_ID       = agqvehicle:COMPANY_ID,
                           casstacked:STATE            = agqvehicle:state,
                           casstacked:LINE_OF_BUSINESS = agqvehicle:line_of_business,
                           casstacked:um_uim           = l_um_uim,
                           casstacked:limit            = l_limit, Generic

    while casstacked:RECORD_KEY       = L_RECORD_KEY and
          casstacked:COMPANY_ID       = agqvehicle:COMPANY_ID and
          casstacked:STATE            = agqvehicle:state and
          casstacked:LINE_OF_BUSINESS = agqvehicle:line_of_business and
          casstacked:um_uim           = l_um_uim and
          casstacked:limit            = l_limit
        begin
        If agqvehicle:EFF_DATE >= casstacked:EFF_DATE Then
            Begin
            l_code_1 = casstacked:code
            End

        Next casstacked
        End

    if l_code_1 <> "" and
       sfsline:lob_code <> "CPORTFOLIO" then
        begin
        L_CODE = L_CODE_1
        Do ACCESS_AGQEND1_1
        If L_ADD_ENDORSEMENT = "Y" And
           agqmaster:um_uim_limit[2] <> 0 and
           agqmaster:non_stacked = "S" Then
            Do ADD_AGQEND1_1
        If ((L_ADD_ENDORSEMENT = "N" And
           agqmaster:um_uim_limit[2] = 0) or
           (l_add_endorsement = "N" and
           agqmaster:non_stacked <> "S")) Then
            Do DELETE_AGQEND1_1

        end
    if l_code_1 <> "" and
       sfsline:lob_code = "CPORTFOLIO" then
        begin
        L_CODE = L_CODE_1
        Do ACCESS_AGQEND1_1
        If L_ADD_ENDORSEMENT = "Y" And
           agqmastsupp:um_uim_limit[2] <> 0 and
           agqmastsupp:non_stacked = "S" Then
            Do ADD_AGQEND1_1
        If ((L_ADD_ENDORSEMENT = "N" And
           agqmastsupp:um_uim_limit[2] = 0) or
           (l_add_endorsement = "N" and
           agqmastsupp:non_stacked <> "S")) Then
            Do DELETE_AGQEND1_1

        end
        end

    If FUNCTION one of "CHANGE", "CHG" Then
        Begin
        Access agqpip, Set agqpip:app_no = agqVEHICLE:app_no,
                           agqpip:VEHICLE_NO = agqVEHICLE:VEHICLE_NO, Generic

        If agqpip:app_no = agqVEHICLE:app_no And
           agqpip:VEHICLE_NO = agqVEHICLE:VEHICLE_NO Then
            begin
            L_RECORD_KEY = "NF"
            Access CASNOFAULT, Set CASNOFAULT:COMPANY_ID = agqvehicle:COMPANY_ID,
                                   CASNOFAULT:STATE = agqVEHICLE:STATE,
                                   CASNOFAULT:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS, Generic

            Repeat Begin
                Exit If CASNOFAULT:RECORD_KEY <> L_RECORD_KEY Or
                        CASNOFAULT:COMPANY_ID <> agqvehicle:COMPANY_ID Or
                        CASNOFAULT:STATE <> agqVEHICLE:STATE Or
                        CASNOFAULT:LINE_OF_BUSINESS <> agqVEHICLE:LINE_OF_BUSINESS

                If agqvehicle:EFF_DATE >= CASNOFAULT:EFF_DATE Then
                    Begin
                    L_EXTENDED_LIMIT = CASNOFAULT:EXTENDED_LIMIT
                    L_EXTENDED_ADDL_LIMIT = CASNOFAULT:EXTENDED_ADDL_LIMIT
                    End

                Next CASNOFAULT
                End

            Change agqpip
                Begin
                If agqVEHICLE:STATE = 29 Then
                    Begin
                    If agqVEHICLE:TYPE = 3 Then
                        Begin
                        If agqVEHICLE:CLASS_CODE = 6381 Or
                           agqVEHICLE:CLASS_CODE = 6382 Or
                           agqVEHICLE:CLASS_CODE = 6383 or
                           agqvehicle:class_code = 6384 or
                           agqvehicle:class_code = 6385 Then
                            Begin
                            L_ADD_MED_EXP_CODE = "Y"
                            agqpip:MEDICAL_EXP_MOTOR_BUS = "Y"
                            End
                        Else
                            Begin
                            agqpip:MEDICAL_EXP_MOTOR_BUS = "N"
                            End
                        End
                    Else
                        Begin
                        agqpip:MEDICAL_EXP_MOTOR_BUS = "N"
                        End

                    If agqVEHICLE:TYPE = 2 Or
                       agqVEHICLE:TYPE = 5 Or
                       agqVEHICLE:TYPE = 6 Or
                       agqVEHICLE:TYPE = 7 Then
                        Begin
                        if agsdefault_cap:extend_medical_expense <> "" then
                            agqpip:extend_medical_expense = agsdefault_cap:extend_medical_expense
                        else
                            agqpip:EXTEND_MEDICAL_EXPENSE = "Y"
                        if agqpip:extend_medical_expense = "Y" then
                            agqpip:EXTENDED_MEDICAL_EXPENSE = L_EXTENDED_LIMIT +
                                                              L_EXTENDED_ADDL_LIMIT
                        else
                            agqpip:extended_medical_expense = l_extended_limit
                        agqpip:PEDESTRIAN = "N"
                        End
                    If agqVEHICLE:TYPE = 1 Or
                       agqVEHICLE:TYPE = 3 Or
                       agqVEHICLE:TYPE = 4 Then
                        Begin
                        agqpip:EXTEND_MEDICAL_EXPENSE = "N"
                        agqpip:EXTENDED_MEDICAL_EXPENSE = L_EXTENDED_LIMIT
                        If agqVEHICLE:CLASS_CODE = 681 Or
                           agqVEHICLE:CLASS_CODE = 682 Or
                           agqVEHICLE:CLASS_CODE = 683 Or
                           agqVEHICLE:CLASS_CODE = 691 Or
                           agqVEHICLE:CLASS_CODE = 692 Or
                           agqVEHICLE:CLASS_CODE = 693 Then
                            agqpip:PEDESTRIAN = "N"
                        Else
                            agqpip:PEDESTRIAN = "Y"
                        End
                    End
                End
            end
        end

    if function one of "ADD", "NEW" then
        begin
        if g_type_str one of "G" then
            begin
            l_code = "CA9937"
            do access_agqend1
            if l_add_endorsement = "Y" then
                do add_agqend1
            function = "option"
            end
        if g_type_str one of "H" then
            begin
            function = "hired"
            end
        end

    End
    if g_type_str not one of "G", "H" then
        function = "redisplay"

Procedure Definition

procedure display_popup
begin
display modal screen l_screen_1

end

procedure read_agqend1
begin
access agqend1, set agqend1:app_no     = g_app_no,
                    agqend1:vehicle_no = agqvehicle:vehicle_no, generic

l_ca2001  = 0
l_ca9923  = 0
l_ca9937 = 0
while agqend1:app_no     = g_app_no and
      agqend1:vehicle_no = agqvehicle:vehicle_no
    begin
    if agqend1:code = "CA2001" then
        l_ca2001 = 1
    if agqend1:code = "CA9923" then
        l_ca9923 = 1
    if agqend1:code = "CA9937" then
        l_ca9937 = 1

    next agqend1
    end

end

Procedure delete_agqaddin2
Begin
Access agqaddin2, Set agqaddin2:app_no     = G_app_no,
                      agqaddin2:vehicle_no = agqvehicle:vehicle_no, generic

while agqaddin2:app_no     = G_app_no and
      agqaddin2:vehicle_no = agqvehicle:vehicle_no
    begin
    delete agqaddin2

    Next agqaddin2
    End

End

procedure check_for_mca825
BEGIN
Access agqvEHICLE_ALIAS,
   Set agqvEHICLE_ALIAS:app_no = g_app_no, generic

access casdefault, set casdefault:company_id       = agqvehicle:company_id,
                       casdefault:line_of_business = agqvehicle:line_of_business, generic

if casdefault:dont_check_for_mca825 = 0 then
  {
    if agqvehicle:eff_date >= casdefault:dont_check_for_mca825_eff_date or
       casdefault:dont_check_for_mca825_eff_date = 0 then
      {
        while agqvehicle_alias:app_no = g_app_no
          begin
            l_code = "MCA825"  --only valid when type 2 and class code 7391 is private passenger
            if agqvehicle_alias:type one of 2 and
               agqvehicle_alias:class_code one of 7391, 7399 then
              begin
                l_app_no   = agqvehicle_alias:app_no
                l_vehicle_no = agqvehicle_alias:vehicle_no
                do access_agqend1_1                   --check to see if it has been added.
                if L_ADD_ENDORSEMENT one of "Y" then
                    begin
                    do ADD_agqEND1_1
                    end
              end
            else  --not one of agqvehicle:type 2 and 7391 means it is not private passenger
              begin
                l_app_no   = agqvehicle_alias:app_no
                l_vehicle_no = agqvehicle_alias:vehicle_no
                do delete_agqend1_1
              end

            next agqvehicle_alias
          end
      }
  }

END

Procedure ADD_agqEND1_1
Begin
Access agqEND1, Set agqEND1:app_no = g_app_no,
                    agqend1:vehicle_no = 0, Generic

L_SUB_CODE = 0
while agqEND1:app_no = g_app_no and
      agqend1:vehicle_no = 0
    begin
    L_SUB_CODE = agqEND1:SUB_CODE

    Next agqEND1
    end

L_SUB_CODE = L_SUB_CODE + 10

Access SFSOPTEND,
     Set SFSOPTEND:COMPANY_ID       = agqVEHICLE:COMPANY_ID,
         SFSOPTEND:STATE            = agqVEHICLE:STATE,
         SFSOPTEND:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS,
         SFSOPTEND:CODE             = L_CODE, Generic

while SFSOPTEND:COMPANY_ID       = agqVEHICLE:COMPANY_ID and
      SFSOPTEND:STATE            = agqVEHICLE:STATE and
      SFSOPTEND:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS and
      SFSOPTEND:CODE             = L_CODE
    begin
    If (agqvehicle:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqvehicle:eff_date <= sfsoptend:exp_date or
       sfsoptend:exp_date = 0)) Then
        Begin
        L_FORM_EDITION = SFSOPTEND:FORM_EDITION
        L_DESCRIPTION  = SFSOPTEND:DESCRIPTION
        End

    Next SFSOPTEND
    end

if l_form_edition <> "" then
begin
Add agqEND1
    Begin
    agqEND1:app_no               =       g_app_no
    agqEND1:VEHICLE_NO           =       0
    agqEND1:SUB_CODE             =       L_SUB_CODE
    agqEND1:CODE                 =       L_CODE
    agqEND1:FORM_EDITION         =       L_FORM_EDITION
    agqEND1:DESCRIPTION          =       L_DESCRIPTION
    agqEND1:PREMIUM              =       0
    End
end

End

Procedure ACCESS_agqEND1_1
Begin
Access agqEND1, Set agqEND1:app_no     = g_app_no ,
                    agqEND1:VEHICLE_NO = 0, Generic

L_ADD_ENDORSEMENT = "Y"
while agqEND1:app_no   = g_app_no and
      agqEND1:VEHICLE_NO = 0
    begin
    If agqEND1:CODE = L_CODE Then
        begin
        L_ADD_ENDORSEMENT = "N"
        end

    Next agqEND1
    end

End

Procedure ACCESS_agqEND1
Begin
Access agqEND1, Set agqEND1:app_no     = g_app_no ,
                    agqEND1:VEHICLE_NO = agqvehicle:vehicle_no, Generic

L_ADD_ENDORSEMENT = "Y"
while agqEND1:app_no   = g_app_no and
      agqEND1:VEHICLE_NO = agqvehicle:vehicle_no
    begin
    If agqEND1:CODE = L_CODE Then
        begin
        L_ADD_ENDORSEMENT = "N"
        end

    Next agqEND1
    end

End

Procedure ADD_agqEND1
Begin
Access agqEND1, Set agqEND1:app_no = g_app_no,
                    agqend1:vehicle_no = agqvehicle:vehicle_no, Generic

L_SUB_CODE = 0
while agqEND1:app_no = g_app_no and
      agqend1:vehicle_no = agqvehicle:vehicle_no
    begin
    L_SUB_CODE = agqEND1:SUB_CODE

    Next agqEND1
    end

L_SUB_CODE = L_SUB_CODE + 10

Access SFSOPTEND,
     Set SFSOPTEND:COMPANY_ID       = agqVEHICLE:COMPANY_ID,
         SFSOPTEND:STATE            = agqVEHICLE:STATE,
         SFSOPTEND:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS,
         SFSOPTEND:CODE             = L_CODE, Generic

while SFSOPTEND:COMPANY_ID       = agqVEHICLE:COMPANY_ID and
      SFSOPTEND:STATE            = agqVEHICLE:STATE and
      SFSOPTEND:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS and
      SFSOPTEND:CODE             = L_CODE
    begin
    If (agqvehicle:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqvehicle:eff_date <= sfsoptend:exp_date or
       sfsoptend:exp_date = 0)) Then
        Begin
        L_FORM_EDITION = SFSOPTEND:FORM_EDITION
        L_DESCRIPTION  = SFSOPTEND:DESCRIPTION
        End

    Next SFSOPTEND
    end

if l_form_edition <> "" then
begin
Add agqEND1
    Begin
    agqEND1:app_no               =       g_app_no
    agqEND1:VEHICLE_NO           =       agqvehicle:vehicle_no
    agqEND1:SUB_CODE             =       L_SUB_CODE
    agqEND1:CODE                 =       L_CODE
    agqEND1:FORM_EDITION         =       L_FORM_EDITION
    agqEND1:DESCRIPTION          =       L_DESCRIPTION
    agqEND1:PREMIUM              =       0
    End
end

End

Procedure DELETE_agqEND1_1
Begin
Access agqEND1, Set agqEND1:app_no   = g_app_no ,
                    agqEND1:VEHICLE_NO = 0, Generic

while agqEND1:app_no   = g_app_no and
      agqEND1:VEHICLE_NO = 0
    begin
    If agqEND1:CODE = L_CODE Then
        begin
        Delete agqEND1
        end

    Next agqEND1
    end

End

Procedure DELETE_agqEND1
Begin
Access agqEND1, Set agqEND1:app_no   = g_app_no ,
                    agqEND1:VEHICLE_NO = agqvehicle:vehicle_no, Generic

while agqEND1:app_no   = g_app_no and
      agqEND1:VEHICLE_NO = agqvehicle:vehicle_no
    begin
    If agqEND1:CODE = L_CODE Then
        begin
        Delete agqEND1
        end

    Next agqEND1
    end

End

procedure read_agqvehicle
begin
access agqvehicle_alias, set agqvehicle_alias:app_no = g_app_no, generic

l_no_vehicles = 0
l_vehicle_no  = 0
while agqvehicle_alias:app_no = g_app_no
    begin
    l_no_vehicles = l_no_vehicles + 1
    l_vehicle_no  = agqvehicle_alias:vehicle_no

    next agqvehicle_alias
    end

end

procedure update_agqmaster
BEGIN
access agqmaster, set agqmaster:app_no = g_app_no, exact

if agqmaster:app_no = g_app_no then
    begin
    change agqmaster
        {
        if agqmaster:form_of_business <> l_form_of_business then
            agqmaster:form_of_business  = l_form_of_business
        if agqmaster:fob_description <> l_fob_description1 then
            agqmaster:FOB_DESCRIPTION   = l_fob_description1
        if g_type_str = "H" then
            agqmaster:extend_hired_nonowned = "Y"
        else
            agqmaster:extend_hired_nonowned = "N"
        if g_type_str = "G" then
            agqmaster:delete_hired_nonowned = "Y"
        else
            agqmaster:delete_hired_nonowned = "N"
        }
    end
else
    begin
    add agqmaster
        begin
        agqmaster:app_no           = g_app_no
        agqmaster:form_of_business = l_form_of_business
        agqmaster:fob_description  = l_fob_description1
        if g_type_str = "H" then
            agqmaster:extend_hired_nonowned = "Y"
        else
            agqmaster:extend_hired_nonowned = "N"
        if g_type_str = "G" then
            agqmaster:delete_hired_nonowned = "Y"
        else
            agqmaster:delete_hired_nonowned = "N"
        end
    end

END

procedure update_agqmastsupp
BEGIN
access agqmastsupp, set agqmastsupp:app_no = g_app_no,
                        agqmastsupp:line_of_business = l_line_of_business, exact

if agqmastsupp:app_no = g_app_no and
   agqmastsupp:line_of_business = l_line_of_business then
    begin
    change agqmastsupp
        {
        if g_type_str = "H" then
            agqmastsupp:extend_hired_nonowned = "Y"
        else
            agqmastsupp:extend_hired_nonowned = "N"
        if g_type_str = "G" then
            agqmastsupp:delete_hired_nonowned = "Y"
        else
            agqmastsupp:delete_hired_nonowned = "N"
        }
    end
else
    begin
    add agqmastsupp
        begin
        agqmastsupp:app_no           = g_app_no
        agqmastsupp:line_of_business = l_line_of_business
        if g_type_str = "H" then
            agqmastsupp:extend_hired_nonowned = "Y"
        else
            agqmastsupp:extend_hired_nonowned = "N"
        if g_type_str = "G" then
            agqmastsupp:delete_hired_nonowned = "Y"
        else
            agqmastsupp:delete_hired_nonowned = "N"
        end
    end

END

procedure change_current_browser (string p_server_name, string p_current_web_page)
BEGIN
l_web_site_address = trun(p_server_name) + trun(p_current_web_page)
setproperty(helper_tg,url,trun(l_web_site_address))

END

End
