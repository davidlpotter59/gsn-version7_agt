%%                      
Screen
        Name = "AGTMT601";
        Type = "Detail" ;
        Highlight=Underscore ;
        highlightfield="Yes";
        Padcharacter=Space ;
        Screensize="dynamic";
        Windowtitle="%a     %s Rating Information - Ver. 7.00     %m";
        Domain="agqvehicle" ;
        resizeable = yes ;
        iconline = 0 ;

        Global Unsigned Ascii Number G_APP_NO[11] ;
        Global Unsigned Ascii Number G_LINE_OF_BUSINESS[4] ;
        Global Unsigned Ascii Number G_OPT[2] ;
        global unsigned ascii number g_add_prem_no[1] ;
        global unsigned ascii number g_add_build_no[1] ;
        global unsigned ascii number g_add_new_quote[1] ;
        global unsigned ascii number g_vehicle_no[4] ;
        global unsigned ascii number g_from_search_screen[1] ;
        global unsigned ascii number g_type[1] ;

        global string g_company_id[10] ,
                      g_initial_screen[50] ,
                      g_ok_to_add[1] ,
                      g_display_modal[1] ;

        rwdate l_agqvehicle_eff_date;
        wdate  l_rich_date;

        array[10] of string l_view_desc[85] ;
        array[10] of tag l_the_tag[15] ;

        Local Unsigned Ascii Number L_SUB_CODE[4] ,
                                    L_STATE[2],
                                    l_basic_limit_1[8],
                                    l_basic_limit_2[8],
                                    l_extended_limit[8],
                                    l_extended_addl_limit[8],
                                    l_first_prem_no[4],
                                    l_first_build_no[4],
                                    l_last_prem_no[4],
                                    l_last_build_no[4],
                                    l_agent_no[4],
                                    l_no_years[3]=0,
                                    l_county[3],
                                    l_acv_factor[5]=0/dec=3,
                                    l_app_no[11],
                                    l_rating_territory[3],
                                    l_loop[4],
                                    l_exclude_terrorism[1]=0,
                                    l_prem_no[4]=0,
                                    l_first_bold_one[1]=0,
                                    l_second_bold_one[1]=0,
                                    l_no_vehicles[2]=0,
                                    l_vehicle_no[4]=0,
                                    l_build_no[4]=0,
                                    l_off_premises_limit[8]=0,
                                    l_mcp140_limit[8],
                                    l_mm[2],
                                    l_signs_limit[5],
                                    l_valuable_papers_limit[5],
                                    l_water_limit[5],
                                    l_credit_card_limit[5],
                                    l_yyyy[4],
                                    l_dd[2],
                                    l_territory[3],
                                    l_minimum_limit[8],
                                    l_maximum_limit[8],
                                    l_zipcode[9],
                                    l_building_minimum_limit[8],
                                    l_contents_minimum_limit[8],
                                    l_combined_minimum_limit[8],
                                    l_building_maximum_limit[8],
                                    l_contents_maximum_limit[8],
                                    l_combined_maximum_limit[8],
                                    l_building_binding_limit[8],
                                    l_contents_binding_limit[8],
                                    l_combined_binding_limit[8],
                                    l_min_error[1],
                                    l_sub[2],
                                    l_sub_1[5],
                                    l_field_no[4]=0,
                                    l_tag_position[2]=0,
                                    l_len_string[5]=0,
                                    l_max_error[1],
                                    l_binding_error[1],
                                    l_combined_limit[8]=0,
                                    l_rating_territory_group_1[1],
                                    l_rating_territory_group_2[1],
                                    l_rating_territory_group_3[1],
                                    l_group_1[5]=0/dec=3,
                                    l_group_2[5]=0/dec=3,
                                    L_CLASS_CODE[5],
                                    l_restaurant[1],
                                    l_year[4],
                                    l_end_sequence[4],
                                    L_PROPERTY_LIMIT[8]=0,
                                    l_property_limit_1[8]=0,
                                    L_LINE_OF_BUSINESS[2] ,
                                    L_AR_LIMIT[8],
                                    L_COMPUTER_LIMIT[8],
                                    l_computer_limit_1[8],
                                    l_computer_limit_2[8],
                                    l_csexec_number[12],
                                    i_csexec_number[12],
                                    l_abort_program[1],
                                    L_UTILITY_LIMIT[8],
                                    L_MECHANICAL_LIMIT[8],
                                    L_EXTERIOR_SIGNS_LIMIT[8],
                                    L_EMPLOYEE_LIMIT[8],
                                    L_GLASS_LIMIT[8],
                                    L_SEWER_LIMIT[8],
                                    L_VALUABLE_LIMIT[8],
                                    L_FORM[1] ,
                                    l_Form_1[1] ;

        Local String L_DESC[50] ,
                     L_REINSURANCE[1] ,
                     l_record_key[2],
                     l_add_med_exp_code[1],
                     l_agent_wording[10]="Agent No:",
                     l_class_code_1[5],
                     l_screen_name[15],
                     l_territory_desc[50],
                     l_fob[1],
                     l_fob_desc[50],
                     l_fob_description[50],
                     l_fob_description1[75],
                     l_form_of_business[1],
                     l_text_1[85],
                     l_text_2[85],
                     l_server_name[100],
                     l_current_web_page[100],
                     l_web_site_address[150],
                     l_first_bold[1]="Y",
                     l_waiver_code_1[7],
                     l_waiver_code_2[7],
                     l_last_bold[1]="N",
                     l_first_str_vehicle[8],
                     l_last_str_vehicle[8],
                     l_str_vehicle[8],
                     i_csexec_application[25] ,
                     l_first_vehicle[1]="Y",
                     l_string_view[15],
                     l_printers_credit_wording[23]="Printers Credit:",
                     l_total_printers_wording[23]="Total Printers:",
                     l_first[1],
                     l_str_zipcode[9]="",
                     l_buyback_option_wording[23]="Buyback Option Charge:",
                     l_fungi_mold_wording[23]="Fungi/Mold Limitations:",
                     l_irpm_wording[12]="IRPM:",
                     l_enter[1],
                     l_minimum_message[200],
                     l_combined_minimum_message[200],
                     l_maximum_message[200],
                     l_combined_maximum_message[200],
                     l_binding_message[200],
                     l_combined_binding_message[200],
                     l_contact_message[200],
                     l_mp_wording[4]="M.P.",
                     l_continue_1[3]="",
                     l_continue_2[3]="",
                     l_continue_3[3]="",
                     l_dec[15]="",
                     l_app[3]="agq",
                     L_CODE[7],
                     L_CODE_1[7],
                     L_CODE_2[7],
                     L_CODE_3[7],
                     L_CODE_4[7],
                     L_CODE_5[7],
                     L_CODE_6[7],
                     L_CODE_7[7],
                     L_CODE_8[7],
                     l_code_9[7],
                     l_code_10[7],
                     l_code_11[7],
                     l_code_12[7],
                     l_code_13[7],
                     l_code_14[7],
                     l_csexec_application[25],
                     l_processing_system[30],
                     l_rating_system[40],
                     l_territory_wording[10]="Territory:",
                     l_system_id[15],
                     L_SCREEN[15] ,
                     l_screen_1[9],
                     L_FORM_EDITION[18],
                     L_DESCRIPTION[55],
                     L_COMPUTER_DESC[50] ,
                     l_computer_desc_1[50],
                     L_DELETE_NONOWNED_HIRED[1]="N",
                     L_ADD_ENDORSEMENT[1]="Y",
                     L_PROPERTY_LIMIT_CHANGE[1]="N",
                     l_agqvehicle_str[10],
                     L_COMPANY_ID[10] ;

        local wdate l_eff_date ,
                    l_bpssupplemental_eff_date ,
                    l_prior_eff_date,
                    l_new_eff_date ;

        include "print.var"

        include "virtualdecs.var"

        Access agqvehicle,
           Set agqvehicle:app_no = G_app_no, generic

        Include "stdkeys7.inc"

Style Definition
        Include "styles.inc"
        Displayonly Field Style {
                                  backgroundcolor="#CCCCCC"
                                }


Functions

        "redisplay" display/noreturn "agtmt601" ;

        "add" sequence "new"      tagged add_fn ;
        "new" add/hidden ;

        "change" sequence "chg"   tagged change_fn ;
        "chg" change/hidden ;

        "func1" display/noreturn "agtmt602"   tagged calc_fn ;
        "func2" display/noreturn "agtmt600"   tagged vehicle_type_fn ;

        "back" display/noreturn "agtmt001" tagged back_fn;

        reaccess ;

        include "stdfunc7b.inc"

EVENT DEFINITION
        default eventhandler {
                             "REMOVE_SCREEN" { function = "exit" abort () }
                             "reload" { function = "reaccess" abort () }
                             "display_message" { warning "" + event.value }
                             "current_line_of_business" {
                                                          g_line_of_business = val(event.value)
                                                        }
                             }
Menu Definition

Toolbar Definition

Screen Entry
access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

g_initial_screen = ""
l_username = username
l_company_id = sfsdefault:company_id

l_username = username
access sfsemail, set sfsemail:company_id = l_company_id,
                     sfsemail:user_id    = l_username, generic

l_agent_no = sfsemail:agent_no
access sfsagent, set sfsagent:company_id = l_company_id,
                     sfsagent:agent_no   = l_agent_no, generic

access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

switch(g_line_of_business)
  case 15 : setproperty(t_line_of_business,iconname,"title_com_auto_std.bmp")
  case 16 : setproperty(t_line_of_business,iconname,"title_com_auto_pref.bmp")
  default : setproperty(t_line_of_business,iconname,"")
  end

l_state = sfsagent:state
if l_state = 0 then
    l_state = sfsdefault:state
Access SFSLINE_ALIAS, Set SFSLINE_alias:COMPANY_ID       = l_company_id,
                          SFSLINE_alias:LINE_OF_BUSINESS = g_line_of_business,
                          SFSLINE_alias:LOB_SUBLINE      = "00", Generic

Access SFSLINE, Set SFSLINE:COMPANY_ID       = l_company_id,
                    SFSLINE:LINE_OF_BUSINESS = g_line_of_business,
                    SFSLINE:LOB_SUBLINE      = "00", Generic

access agqvehicle,
   set agqvehicle:app_no = g_app_no, generic

access sfsprofile,
   set sfsprofile:user_id  = l_username, exact

If SFSPROFILE:USER_ID <> L_USERNAME Then
  Begin
    L_USERNAME = "default"
    Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact
  End

l_server_name = sfsprofile:UNIX_SERVER                            --"http://192.168.1.197/"

/*if l_company_id = "GGUND" then
    begin
    if agqvehicle:app_no = 0 then
        {
        l_current_web_page = "webhelp_scr_bop_rating_no_proposal_num.htm"
        do change_current_browser(l_server_name,l_current_web_page)
        }
    else
        {
        l_current_web_page = "019webhelp_agtmt601_scr_rating_info_with_name.htm"
        do change_current_browser(l_server_name,l_current_web_page)
        }
    end*/

access agqname, set agqname:app_no = g_app_no,generic

if agqname:quote_no <> 0 then
    begin
    disable(add_fn)
    disable(change_fn)
    disable(delete_fn)
    disable(accept_fn)
    end

if agqvehicle:app_no = 0 then
    begin
    disable(previous_fn)
    disable(next_fn)
    end

l_screen_name = "agtmt601"
if g_app_no = 0 then
    l_field_no = 9997
else
    l_field_no = 9999

if g_ok_to_add = "Y" then
    begin
    function = "ADD"
    end

if function one of "ADD", "NEW" then
    begin
    if g_type = 1 then
        begin
        show(truck_fn)
        hide(other_fn)
        end
    else
        begin
        hide(truck_fn)
        show(other_fn)
        end
    end
else
    begin
    g_type = agqvehicle:type
    if agqvehicle:type = 1 then
        begin
        show(truck_fn)
        hide(other_fn)
        end
    else
        begin
        hide(truck_fn)
        show(other_fn)
        end
    end

access validation
if agqvehicle:app_no <> g_app_no then
    error 1000

if function one of "NEXT", "PREVIOUS" then
    begin
    g_type = agqvehicle:type
    if agqvehicle:type = 1 then
        begin
        hide(other_fn)
        show(truck_fn)
        end
    else
        begin
        hide(truck_fn)
        show(other_fn)
        end
    end

access agqvehicle_alias, set agqvehicle_alias:app_no = agqvehicle:app_no, generic

l_first_str_vehicle = ""
l_first_vehicle = "Y"
l_last_str_vehicle = ""
l_no_vehicles = 0
while agqvehicle_alias:app_no = agqvehicle:app_no
    begin
    if l_first_vehicle = "Y" then
        begin
        l_first_str_vehicle  = str(agqvehicle_alias:vehicle_no)
        l_first_vehicle = "N"
        end
    l_last_str_vehicle  = str(agqvehicle_alias:vehicle_no)
    l_no_vehicles  = l_no_vehicles + 1

    next agqvehicle_alias
    end

l_str_vehicle = str(agqvehicle:vehicle_no)

if l_no_vehicles one of 0, 1 then
    begin
    disable(next_fn)
    disable(previous_fn)
    end
else
if l_str_vehicle = l_first_str_vehicle and
   l_no_vehicles > 1 then
    begin
    disable(previous_fn)
    enable(next_fn)
    end
else
if l_str_vehicle <> l_first_str_vehicle and
   l_str_vehicle <> l_last_str_vehicle and
   l_no_vehicles > 1 then
    begin
    enable(next_fn)
    enable(previous_fn)
    end
else
if l_str_vehicle = l_last_str_vehicle and
   l_no_vehicles > 1 then
    begin
    disable(next_fn)
    enable(previous_fn)
    end

screen at 1,1 to 30,100
Properties
        {
          Layouttype = screen
          transparent = False
          backgroundcolor = "#ADD8E6"
        }
{

    Panel at 1,1 to 2,100
        Properties
            {
            layouttype = screen
            }
        {
        components
            guidetext at 1,1 to 2,40
                properties
                    {
                    iconname = "qp_logo.gif"
                    }
            guidetext at 1,35 to 2,100 tagged t_line_of_business
                Properties
                   {
                   iconname = ""
                   }

        }

panel at 3,1 to 4,100
Properties
        {
        LayoutType = screen
        backgroundcolor = "Grey"
        transparent = False
        }
{
components
          guidetext at 1.45,1 to 1.45,40     tagged display_information_box
                properties
                  {
                    text = "Rating Information..."
                    fontsize = 18
                    fontstyle = BOLD
                    fontname = "arial"
                    transparent = False
                    backgroundcolor = "Grey"
                  }

}

Panel at 3.45,75 to 4.45, 100
Properties
        {
          LayoutType = screen
        }
{
%%
App No: ___________

%%
fields
101     begin
        l_company_id = sfsdefault:company_id
        l_username = username
        access sfsemail, set sfsemail:company_id = l_company_id,
                             sfsemail:user_id    = l_username, generic

        if l_agent_no = 0 then
            {
            l_agent_no = 9999
            }
        l_company_id = sfsdefault:company_id
        if l_state = 0 then
            l_state = sfsdefault:state
        Access agsdefault_cap,
           Set agsdefault_cap:COMPANY_ID       = L_COMPANY_ID,
               agsdefault_cap:state            = l_state,
               agsdefault_cap:agent_no         = l_agent_no,
               agsdefault_cap:LINE_OF_BUSINESS = G_LINE_OF_BUSINESS, generic

        if function one of "ADD", "NEW" and
           g_ok_to_add = "N" then
            begin
            g_display_modal = "Y"
            display modal screen "agtmt600"
            with initial function "ADD|BACK"
            if g_type = 1 then
                begin
                show(truck_fn)
                hide(other_fn)
                end
            else
                begin
                hide(truck_fn)
                show(other_fn)
                end
            g_display_modal = "N"
            agqvehicle:type = g_type
            agqvehicle:app_no = g_app_no
            agqvehicle:entry_date = todaysdate
            end
        else
        if function one of "ADD", "NEW" then
            begin
            agqvehicle:app_no = g_app_no
            agqvehicle:entry_date = todaysdate
            end

        access agqmaster, set agqmaster:app_no = g_app_no, generic

        if agqmaster:app_no <> g_app_no then
            begin
            add agqmaster
              begin
                agqmaster:app_no          = g_app_no
                agqmaster:liability       = agsdefault_cap:liability
                agqmaster:um_uim_limit[1] = agsdefault_cap:liability
                agqmaster:um_uim_limit[2] = agsdefault_cap:liability
                agqmaster:vehicle_symbol  = agsdefault_cap:vehicle_symbol
                if agsdefault_cap:vehicle_symbol = "" then
                    agqmaster:vehicle_symbol = "7"
                agqmaster:non_fleet       = "N"
                agqmaster:non_stacked     = "N"
                agqmaster:covered_by_workers_comp = "N"
              end
            end
        end
        agqvehicle:APP_NO/displayonly ;

}
-- top button bar
Panel at 5,1 to 6,100 Tagged icon_line2_tg
Properties
        {
          LayoutType = screen
        }
{
Components

        Button at 1.5,1   tagged add_fn
        Properties {
                Iconname = "btn_add_vehicle.bmp"
                }
        Events  {
                Action = add_fn
                }

        Button at 1.5,38    tagged change_fn
        Properties {
                Iconname = "btn_edit_vehicle.bmp"
                }
        Events  {
                Action = change_fn
                }

        Button at 1.5, 70 tagged delete_fn
        Properties {
                Iconname = "btn_delete_vehicle.bmp"
                }
        Events  {
                Action = delete_fn
                }
    }

    Panel at 5,94 to 6,96 tagged button_panel
        Properties
            {
            layouttype = column
            }
        {
        Components
            Button to 1,1
                properties
                    {
                    Iconname = "btn_print_screen.bmp"
                    }
                events
                    {
                    action
                        {
                        function = "print"
                        abort()
                        }
                    }
        }

   Panel at 6.45,92
        Properties
            {
            layouttype = column
            }
      {
        Components
            guidetext to 1,1
                properties
                    {
                      text = "agtmt601.sd"
                      fontsize = 9
                    }
      }

Panel at 7,60 to 7,100
      Properties
         {
           layouttype = row
         }
    {
      Components
        Button at 1,55 tagged accept_fn
          properties
            {
              Iconname = "btn_accept_edits.bmp"
            }
          Events  {
                    mouseclicked = accept
                  }

    }

Panel at 8,1 to 9,100 Tagged location
        Properties {
                LayoutType = screen
--                transparent = False
--                backgroundcolor = "White"
        }
        {
         Components
           guidetext at 1.5,5 to 2.5,17
             properties
               {
                 text = "Vehicle No:"
                 fontsize = 12
                 fontname = "arial"
               }
           guidetext at 1.5,22 to 2.5,40
             properties
               {
                 text = "Number of Vehicles:"
                 fontsize = 12
                 fontname = "arial"
               }
           guidetext at 1.5,45 to 2.5,60
             properties
               {
                 text = "Vehicle Type:"
                 fontsize = 12
                 fontname = "arial"
               }
        }

Panel at 8.5,1 to 9,100 Tagged rating_pl
Properties
        {
--          transparent = False
--          backgroundcolor = "White"
        }
{
%%
             ____                   ____              _________________________
%%

components

fields
101     begin
        if function one of "ADD", "NEW" then
            begin
            do read_agqvehicle
            l_vehicle_no = l_vehicle_no + 1
            agqvehicle:vehicle_no = l_vehicle_no
            if l_no_vehicles = 0 then
                l_no_vehicles = 1
            g_vehicle_no = l_vehicle_no

            if l_vehicle_no = 1 then
              begin
                agqvehicle:app_no           = g_app_no
                agqvehicle:vehicle_no       = l_vehicle_no
                agqvehicle:company_id       = l_company_id
                agqvehicle:line_of_business = g_line_of_business
                agqvehicle:state            = l_state
                agqvehicle:agent_no         = l_agent_no
                agqvehicle:type             = g_type
                agqvehicle:loss_payee       = "N"
                agqvehicle:county           = agsdefault_cap:county
                agqvehicle:territory        = agsdefault_cap:territory
                agqvehicle:comp_deductible  = agsdefault_cap:comp_deductible
                agqvehicle:coll_deductible  = agsdefault_cap:coll_deductible
                if g_type = 1 then
                  begin
                    agqvehicle:size_class       = agsdefault_cap:size_class
                    agqvehicle:business_class   = agsdefault_cap:business_class
                    agqvehicle:radius           = agsdefault_cap:radius
                    agqvehicle:secondary_class  = agsdefault_cap:secondary_class
                    agqvehicle:non_employee     = "N"
                    agqvehicle:no_fault         = "N"
                    agqvehicle:dump             = "N"
                  end
                else
                    begin
                    agqvehicle:class_code       = agsdefault_cap:class_code
                    if g_type one of 4, 5 then
                        agqvehicle:class_code   = casclass_alias:class_code
                    agqvehicle:non_employee = "N"
                    if agqvehicle:state = 19 then
                        agqvehicle:no_fault     = "N"
                    else
                        agqvehicle:no_fault     = "Y"
                    end
              end
            else
                begin
                access agqvehicle_alias, set agqvehicle_alias:app_no = g_app_no, generic

                agqvehicle:app_no                = g_app_no
                agqvehicle:vehicle_no            = l_vehicle_no
                agqvehicle:type                  = g_type
                agqvehicle:company_id            = agqvehicle_alias:company_id
                agqvehicle:line_of_business      = agqvehicle_alias:line_of_business
                agqvehicle:state                 = agqvehicle_alias:state
                agqvehicle:agent_no              = agqvehicle_alias:agent_no
                agqvehicle:loss_payee            = "N"
                agqvehicle:business_Name[1]      = agqvehicle_alias:business_name[1]
                agqvehicle:state                 = agqvehicle_alias:state
                agqvehicle:eff_date              = agqvehicle_alias:eff_date
                agqvehicle:exp_date              = agqvehicle_alias:exp_date
                agqvehicle:county                = agqvehicle_alias:county
                agqvehicle:territory             = agqvehicle_alias:territory
                agqvehicle:territory_description = agqvehicle_alias:territory_description
                agqvehicle:territory_sub_code    = agqvehicle_alias:territory_sub_code
                agqvehicle:comp_deductible       = agqvehicle_alias:comp_deductible
                agqvehicle:coll_deductible       = agqvehicle_alias:coll_deductible
                agqvehicle:non_employee          = agqvehicle_alias:non_employee
                if g_type = 1 then
                    begin
                    agqvehicle:no_fault         = "N"
                    agqvehicle:dump             = "N"
                    end
                else
                    begin
                    agqvehicle:non_employee = "N"
                    if agqvehicle:state = 19 then
                        agqvehicle:no_fault     = "N"
                    else
                        agqvehicle:no_fault     = "Y"
                    end
                if g_type = 1 then
                    begin
                    agqvehicle:size_class       = agsdefault_cap:size_class
                    agqvehicle:business_class   = agsdefault_cap:business_class
                    agqvehicle:radius           = agsdefault_cap:radius
                    agqvehicle:secondary_class  = agsdefault_cap:secondary_class
                    end
                end

            end
        end
        agqvehicle:vehicle_no/displayonly ;
102     l_no_vehicles/displayonly ;
103     begin
        access castype, set castype:company_id       = l_company_id,
                            castype:state            = l_state,
                            castype:line_of_business = g_line_of_business,
                            castype:type             = g_type, generic

        end
        castype:description/displayonly ;

}

Panel at 10,1 to 25,100  tagged truck_fn
        Properties {
                LayoutType = screen
        }
        {
         Components
           guidetext at 1,1 to 1,22
             properties
               {
                 text = "State:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }

           guidetext at 2,1 to 2,22
             properties
               {
                 text = "Insured's Name:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }

           guidetext at 3,1 to 3,22
             properties
               {
                 text = "Eff Date:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 4,1 to 4,22
             properties
               {
                 text = "Form Of Business:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
            guidetext at 5,1 to 5,22
             properties
               {
                 text = "Vehicle Year:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
              }
           guidetext at 6,1 to 6,22
             properties
               {
                 text = "Vehicle Make:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 7,1 to 7,22
             properties
               {
                 text = "Classification:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 8,1 to 8,22
             properties
               {
                 text = "Usage:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 9,1 to 9,22
             properties
               {
                 text = "Radius:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 10,1 to 10,22
             properties
               {
                 text = "Secondary Class:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 11,1 to 11,22
             properties
               {
                 text = "Garage Location:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 13,1 to 13,22
             properties
               {
                 text = "Physical Damage:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 14,1 to 14,22
             properties
               {
                 text = "Cost New:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 15,1 to 15,22
             properties
               {
                 text = "Dump Operations:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
         }

Panel at 10,24 to 25, 100 Tagged truck_fn
{
%%
__   ______________________________
___________________________________________________
__________
____________________________  _________________________________________
____
____________________    Model: ______________________________
_  ______________________________________________________________________
_  ______________________________________________________________________
_  ______________________________________________________________________
_  ______________________________________________________________________
County: ___  _____________________________________________
  City: _________________________________________________  ___
  Comp: _____                       Collision: _____
____________                 Medical Payments: ________
~~_
%%

components

fields
101     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            disable(calc_fn)
            enable(accept_fn)
            }
        else
            {
            disable(accept_fn)
            enable(calc_fn)
            }
/*        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "003webhelp_agtmt601_scr_rating_info_tbx_insured_name.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }      */
        end
        agqvehicle:state/default
        include "statehlp.inc"
102     sfsstate:description ;
201     agqvehicle:business_name[1]/tabstop/uppercase/default ;
301     begin
/*        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "004webhelp_agtmt601_scr_rating_info_tbx_eff_date.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }*/
        if agqvehicle:state one of 29 then
            {
            do check_for_mca825
            }

        access agqvehicle_alt, set agqvehicle_alt:app_no = g_app_no, generic

        if function one of "ADD", "NEW" then
            begin
            if agqvehicle:eff_date = 0 then
                agqvehicle:eff_date = todaysdate
            else
            if agqvehicle_alt:eff_date <> 0 then
                agqvehicle:eff_date = agqvehicle_alt:eff_date
            end
        l_prior_eff_date = agqvehicle:eff_date
        end
        agqvehicle:eff_date/tabstop/default mandatory
        if agqvehicle:eff_date <> l_prior_eff_date and
           l_prior_eff_date <> 0 then
            l_new_eff_date = agqvehicle:eff_date

        if agqvehicle:eff_date >= sfsdefault:ending_date and
           sfsdefault:ending_date <> 0 then
            error "You must enter the quote in the AXIS Insurance Company System"

        if agqvehicle:eff_date < sfsdefault:starting_date and
           sfsdefault:ending_date = 0 then
            error "You must enter the quote in the Starr Insurance Company System"

        if month(agqvehicle:eff_date) = 02 and
           day(agqvehicle:eff_date) = 29 and
           sfsemail:agent_no <> 0 then
            error "Please change your effective date to 2-28"

        if function one of "CHANGE", "CHG" and
           l_prior_eff_date <> l_new_eff_date and
           l_new_eff_date <> 0 then
            begin
            access agqvehicle_alias, set agqvehicle_alias:app_no = g_app_no, generic

            while agqvehicle_alias:app_no = g_app_no
                begin
                change agqvehicle_alias
                    begin
                    if agqvehicle_alias:eff_date <> l_new_eff_date then
                        agqvehicle_alias:eff_date = l_new_eff_date
                    end
                next agqvehicle_alias
                end

            end

        if month(agqvehicle:eff_date) = 02 and
           day(agqvehicle:eff_date) = 29 and
           sfsemail:agent_no <> 0 then
            error "Please change your effective date to 2-28"

        if agqvehicle:eff_date <> agqvehicle_alt:eff_date and
           agqvehicle_alt:eff_date <> 0 then
            begin
            error "Effective date must be the same for all vehicles"
            agqvehicle:eff_date = agqvehicle_alt:eff_date
            end

        if agqvehicle:eff_date < todaysdate - 30 and
           sfsemail:agent_no <> 0 then
            error "The effective date can not be more than 30 days from todaysdate"

        agqvehicle:exp_date = dateadd(agqvehicle:eff_date,0,1) ;
401     begin
/*        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "005webhelp_agtmt601_scr_rating_info_dbx_fob.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }*/
        l_fob = agqmaster:form_of_business
        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id,
                           sfsfob:form_of_business = agqmaster:form_of_business, generic

        l_fob_desc = sfsfob:description

        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id, approximate

        access agqmaster, set agqmaster:app_no = g_app_no, generic

        if agqvehicle:business_name[1] <> "" and
           agqmaster:form_of_business <> "" then
            begin
            access sfsfob, set sfsfob:company_id       = agqvehicle:company_id,
                               sfsfob:form_of_business = agqmaster:form_of_business, generic

            l_form_of_business = agqmaster:form_of_business
            l_fob_description  = sfsfob:description
            l_fob_description1 = agqmaster:fob_description
            end

        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id, approximate

        if l_fob_description = "" then
            activehelp()
        end
        l_fob_description/default/tabstop/uppercase
        if l_fob <> agqmaster:form_of_business or
           l_fob = "" or
           l_fob_desc <> l_fob_description then
            begin
            l_form_of_business = sfsfob:form_of_business
            if l_form_of_business <> "T" then
                l_fob_description1 = ""
            end

        activehelp sfsfob:description;
402     /*begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "006webhelp_agtmt601_scr_rating_info_tbx_fob_other.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end  */
        l_fob_description1/default/tabstop/uppercase
        hide if trun(l_fob_description) not one of "OTHER", "Other" ;

501     begin
        /*if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "007webhelp_agtmt601_scr_rating_info_tbx_veh_year.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }*/
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            do update_agqmaster
        end
        agqvehicle:year/tabstop mandatory ;

601     /*begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "008webhelp_agtmt601_scr_rating_info_tbx_veh_make.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end*/
        agqvehicle:make/tabstop ;
602     agqvehicle:model/tabstop ;
701     /*begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "009webhelp_agtmt601_scr_rating_info_dbx_class.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end*/
        agqvehicle:size_class/tabstop/default mandatory
        if agqvehicle:size_class <> cassize:size or
           agqvehicle:size_class = 0 then
            error "Invalid Classification Entered"

        activehelp cassize_alias:size,
                   cassize_alias:description[1,100];
702     cassize:description ;
801     /*begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "010webhelp_agtmt601_scr_rating_info_dbx_usage.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end*/
        agqvehicle:business_class/tabstop/default mandatory
        if agqvehicle:business_class <> casbusclass:class or
           agqvehicle:business_class = 0 then
            error "Invalid Usage Entered"

        activehelp casbusclass_alias:class,
                   casbusclass_alias:description[1,250];
802     casbusclass:description ;
901     /*begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "011webhelp_agtmt601_scr_rating_info_dbx_radius.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end*/
        agqvehicle:radius/tabstop/default  mandatory
        if agqvehicle:radius <> casradius:radius or
           agqvehicle:radius = 0 then
            error "Invalid Radius Entered"

        if agqvehicle:size_class = 1 then
            l_class_code_1 = "0" +
                             str(agqvehicle:business_class) +
                             str(agqvehicle:radius)
        else
        if agqvehicle:size_class = 4 then
            l_class_code_1 = "69" +
                             str(agqvehicle:radius)
        else
        if agqvehicle:size_class = 5 then
            l_class_code_1 = "68" +
                             str(agqvehicle:radius)
        else
            l_class_code_1 = str(agqvehicle:size_class) +
                             str(agqvehicle:business_class) +
                             str(agqvehicle:radius)

        agqvehicle:class_code = val(l_class_code_1)
        activehelp casradius_alias:radius,
                   casradius_alias:description[1,100];
902     casradius:description ;
1001    /*Begin
         if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "012webhelp_agtmt601_scr_rating_info_dbx_sec_class.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        End*/
        agqvehicle:secondary_class/tabstop/default  mandatory
        if agqvehicle:secondary_class <> casclass_alt:class_code or
           agqvehicle:secondary_class = 0 then
            error "Invalid Secondary Class Entered"

        activehelp casclass_alt2:class_code,
                   casclass_alt2:description/width=50 ;
1002    casclass_alt:description ;
1101    /*Begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "013webhelp_agtmt601_scr_rating_info_dbx_county.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        End*/
        agqvehicle:county/tabstop/default
        Error 1222 If SFSSTATE_ALIAS:DESCRIPTION = " "

        if sfsstate_alias:hide_for_auto = 1 then
            error "Invalid County Entered"

        Activehelp if sfsstate_alias:county <> 0 and
                      sfsstate_alias:hide_for_auto = 0 then
                       SFSSTATE_ALIAS:COUNTY
                   else
                       null/width=3/heading="County",
                   if sfsstate_alias:county <> 0 and
                      sfsstate_alias:hide_for_auto = 0 then
                       SFSSTATE_ALIAS:DESCRIPTION
                   else
                       null/width=30/heading="Description" ;
1102    sfsstate_alias:description ;
1201    Begin
/*          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "014webhelp_agtmt601_scr_rating_info_dbx_city.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }*/
        access sfsterritory2_alias, set sfsterritory2_alias:company_id       = agqvehicle:company_id,
                                        sfsterritory2_alias:state            = agqvehicle:state,
                                        sfsterritory2_alias:line_of_business = agqvehicle:line_of_business,
                                        sfsterritory2_alias:county           = agqvehicle:county, using second index, generic

        L_TERRITORY_DESC = agqVEHICLE:TERRITORY_DESCRIPTION
        l_territory      = agqvehicle:territory
        activehelp()
        End
        agqVEHICLE:TERRITORY_DESCRIPTION/default/uppercase/tabstop   mandatory
        access sfsterritory_alt, set sfsterritory_alt:company_id       = agqvehicle:company_id,
                                     sfsterritory_alt:state            = agqvehicle:state,
                                     sfsterritory_alt:line_of_business = agqvehicle:line_of_Business,
                                     sfsterritory_alt:county           = agqvehicle:county,
                                     sfsterritory_alt:territory        = agqvehicle:territory, generic

        If L_TERRITORY_DESC <> agqVEHICLE:TERRITORY_DESCRIPTION or
           l_territory <> sfsterritory_alt:territory then
            Begin
            agqVEHICLE:TERRITORY          = SFSTERRITORY2_ALIAS:TERRITORY
            agqVEHICLE:TERRITORY_SUB_CODE = SFSTERRITORY2_ALIAS:SUB_CODE
            End

        Activehelp if sfsterritory2_alias:hide_description = 0 then
                       SFSTERRITORY2_ALIAS:DESCRIPTION
                   else
                       null/returntofield/width=50 ,
                   if sfsterritory2_alias:hide_description = 0 then
                       SFSTERRITORY2_ALIAS:TERRITORY
                   else
                       null/width=10,
                   if sfsterritory2_alias:hide_description = 0 then
                       SFSTERRITORY2_ALIAS:SUB_CODE
                   else
                       null/width=10 ;
1202    agqVEHICLE:TERRITORY/displayonly ;

1301    /*begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "015webhelp_agtmt601_scr_rating_info_dbx_comp.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end*/
        agqvehicle:comp_deductible/tabstop/default
        if agqvehicle:comp_deductible <> cascompdeduct:comp_deductible then
          error "Invalid Comp Deductible Entered"

        activehelp if cascompdeduct_alias:allow_agent_to_view = 1 then
                        cascompdeduct_alias:comp_deductible
                   else
                        null,
                   if cascompdeduct_alias:description <> "" and
                      cascompdeduct_alias:allow_agent_to_view = 1 then
                       cascompdeduct_alias:description
                   else
                       null;
1301    cascompdeduct:description
        hide if cascompdeduct:description = "";
1302    /*begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "016webhelp_agtmt601_scr_rating_info_dbx_collision.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end*/
        agqvehicle:coll_deductible/tabstop/default
        if agqvehicle:coll_deductible <> cascolldeduct:coll_deductible then
            error "Invalid Collision Deductible Entered"

        activehelp if cascolldeduct_alias:allow_agent_to_view = 1 then
                       cascolldeduct_alias:coll_deductible
                   else
                       null ;
1401    /*begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "017webhelp_agtmt601_scr_rating_info_tbx_cost_new.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end*/
        agqvehicle:original_cost/tabstop mandatory
        if (agqvehicle:original_cost = 0 and
           (agqvehicle:comp_deductible <> 0 or
           agqvehicle:coll_deductible <> 0)) then
            error "You must enter an original cost"

        if agqvehicle:original_cost > 90000 then
            error "For limits higher than $90,000 refer to underwriting"

        if agqvehicle:original_cost = 0 then
            begin
            agqvehicle:comp_deductible = 0
            agqvehicle:coll_deductible = 0
            end

        hide if agqvehicle:comp_deductible = 0 and
                agqvehicle:coll_deductible = 0 ;
1402    /*begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "018webhelp_agtmt601_scr_rating_info_dbx_med_pay.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }

        end*/
        agqVEHICLE:MEDICAL_PAYMENTS/default
        Hide If ((agqVEHICLE:TYPE = 2 And
                agqVEHICLE:STATE = 29) Or
                (agqVEHICLE:TYPE <> 3 And
                agqVEHICLE:STATE = 07) Or
                agqVEHICLE:STATE = 37)

        If agqVEHICLE:MEDICAL_PAYMENTS <> SFSMEDICAL:LIMIT Then
            Error "Invalid Medical Payment Entered"

        Activehelp SFSMEDICAL_ALIAS:LIMIT ;

1501    begin
            L_no_years  = ((Year(agqvehicle:EFF_DATE) - (AGQVEHICLE:YEAR)) + 1)
            If Month(agqvehicle:EFF_DATE) >= 10 And
               Month(agqvehicle:EFF_DATE) <= 12 Then
                L_no_years = L_no_years + 1
            if l_no_years = 0 then
                l_no_years = 1
            If L_no_years > 10 Then
                L_no_Years = 10
            access casacv, set casacv:company_id       = agqvehicle:company_id,
                               casacv:state            = agqvehicle:state,
                               casacv:line_of_business = agqvehicle:line_of_business,
                               casacv:no_years         = l_no_years, generic

            l_acv_factor = 0
            while casacv:company_id       = agqvehicle:company_id and
                  casacv:state            = agqvehicle:state and
                  casacv:line_of_business = agqvehicle:line_of_business and
                  casacv:no_years         = l_no_years
                    begin
                    if agqvehicle:eff_date >= casacv:reff_date then
                        l_acv_factor = casacv:factor

                    next casacv
                    end

            if l_acv_factor <> 0 then
                agqvehicle:acv_limit = agqvehicle:original_cost * l_acv_factor

            if agqvehicle:original_cost = 0 then
                agqvehicle:acv_limit = 1

        end
        agqvehicle:dump/checkbox/values="N,Y" ;

}

Panel at 10,1 to 25,100  tagged other_fn
        Properties {
                LayoutType = screen
        }
        {
         Components
           guidetext at 1,1 to 1,22
             properties
               {
                 text = "State:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }

           guidetext at 2,1 to 2,22
             properties
               {
                 text = "Insured's Name:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }

           guidetext at 3,1 to 3,22
             properties
               {
                 text = "Eff Date:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 4,1 to 4,22
             properties
               {
                 text = "Form Of Business:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
            guidetext at 5,1 to 5,22
             properties
               {
                 text = "Vehicle Year:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
              }
           guidetext at 6,1 to 6,22
             properties
               {
                 text = "Vehicle Make:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 7,1 to 7,22
             properties
               {
                 text = "Classification:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 8,1 to 8,22
             properties
               {
                 text = "Garage Location:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 10,1 to 10,22
             properties
               {
                 text = "Physical Damage:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 11,1 to 11,22
             properties
               {
                 text = "Cost New:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
         }

Panel at 10,24 to 25, 100 Tagged other_fn
{
%%
__   ______________________________
___________________________________________________
__________
____________________________  _________________________________________
____
____________________ Model: ______________________________
______  __________________________________________________
County: ___  _____________________________________________
  City: __________________________________________________  ___
  Comp: _____                       Collision: _____
____________

%%

components

fields
101     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            disable(calc_fn)
            enable(accept_fn)
            }
        else
            {
            disable(accept_fn)
            enable(calc_fn)
            }
/*        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "003webhelp_agtmt601_scr_rating_info_tbx_insured_name.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }*/
        end
        agqvehicle:state/default
        include "statehlp.inc"
102     sfsstate:description ;
201     agqvehicle:business_name[1]/tabstop/uppercase/default ;
301     begin
/*        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "004webhelp_agtmt601_scr_rating_info_tbx_eff_date.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }*/
        if agqvehicle:state one of 29 then
            {
            do check_for_mca825
            }

        access agqvehicle_alt, set agqvehicle_alt:app_no = g_app_no, generic

        if function one of "ADD", "NEW" then
            begin
            if agqvehicle:eff_date = 0 then
                agqvehicle:eff_date = todaysdate
            else
            if agqvehicle_alt:eff_date <> 0 then
                agqvehicle:eff_date = agqvehicle_alt:eff_date
            end
        l_prior_eff_date = agqvehicle:eff_date
        end
        agqvehicle:eff_date/tabstop/default mandatory
        if agqvehicle:eff_date <> l_prior_eff_date and
           l_prior_eff_date <> 0 then
            l_new_eff_date = agqvehicle:eff_date

        if agqvehicle:eff_date >= sfsdefault:ending_date and
           sfsdefault:ending_date <> 0 then
            error "You must enter the quote in the AXIS Insurance Company System"

        if agqvehicle:eff_date < sfsdefault:starting_date and
           sfsdefault:ending_date = 0 then
            error "You must enter the quote in the Starr Insurance Company System"

        if month(agqvehicle:eff_date) = 02 and
           day(agqvehicle:eff_date) = 29 and
           sfsemail:agent_no <> 0 then
            error "Please change your effective date to 2-28"

        if function one of "CHANGE", "CHG" and
           l_prior_eff_date <> l_new_eff_date and
           l_new_eff_date <> 0 then
            begin
            access agqvehicle_alias, set agqvehicle_alias:app_no = g_app_no, generic

            while agqvehicle_alias:app_no = g_app_no
                begin
                change agqvehicle_alias
                    begin
                    if agqvehicle_alias:eff_date <> l_new_eff_date then
                        agqvehicle_alias:eff_date = l_new_eff_date
                    end
                next agqvehicle_alias
                end

            end

        if agqvehicle:eff_date <> agqvehicle_alt:eff_date and
           agqvehicle_alt:eff_date <> 0 then
            begin
            error "Effective date must be the same for all vehicles"
            agqvehicle:eff_date = agqvehicle_alt:eff_date
            end

        if agqvehicle:eff_date < todaysdate - 30 and
           sfsemail:agent_no <> 0 then
            error "The effective date can not be more than 30 days from todaysdate"

        agqvehicle:exp_date = dateadd(agqvehicle:eff_date,0,1) ;
401     begin
        /*if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "005webhelp_agtmt601_scr_rating_info_dbx_fob.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }*/
        l_fob = agqmaster:form_of_business
        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id,
                           sfsfob:form_of_business = agqmaster:form_of_business, generic

        l_fob_desc = sfsfob:description

        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id, approximate

        access agqmaster, set agqmaster:app_no = g_app_no, generic

        if agqvehicle:business_name[1] <> "" and
           agqmaster:form_of_business <> "" then
            begin
            access sfsfob, set sfsfob:company_id       = agqvehicle:company_id,
                               sfsfob:form_of_business = agqmaster:form_of_business, generic

            l_form_of_business = agqmaster:form_of_business
            l_fob_description  = sfsfob:description
            l_fob_description1 = agqmaster:fob_description
            end

        access sfsfob, set sfsfob:company_id       = agqvehicle:company_id, approximate

        if agqmaster:form_of_business = "" then
            activehelp()
        end
        l_fob_description/default/tabstop/uppercase
        if l_fob <> agqmaster:form_of_business or
           l_fob_desc <> l_fob_description then
            begin
            l_form_of_business = sfsfob:form_of_business
            if l_form_of_business <> "T" then
                l_fob_description1 = ""
            end

        activehelp sfsfob:description;
402     /*begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "006webhelp_agtmt601_scr_rating_info_tbx_fob_other.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end */
        l_fob_description1/default/tabstop/uppercase
        hide if trun(l_fob_description) not one of "OTHER", "Other" ;

501     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            do update_agqmaster
            }
/*        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "007webhelp_agtmt601_scr_rating_info_tbx_veh_year.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }*/
        end
        agqvehicle:year/tabstop mandatory ;

601     /*begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "008webhelp_agtmt601_scr_rating_info_tbx_veh_make.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end */
        agqvehicle:make/tabstop ;
602     agqvehicle:model/tabstop ;
701     begin
          if function one of "ADD", "NEW" then
            {
            if agqvehicle:type = 2 then
                agqvehicle:class_code = 7391
            }
/*            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "009webhelp_agtmt601_scr_rating_info_dbx_class.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end*/
        end
        agqvehicle:class_code/tabstop/default mandatory
        if agqvehicle:class_code <> casclass:class_code or
           agqvehicle:class_code = 0 then
            error "Invalid Classification Entered"

        activehelp casclass_alias:class_code,
                   casclass_alias:description;
702     casclass:description ;
801     /*Begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "013webhelp_agtmt601_scr_rating_info_dbx_county.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        End*/
        agqvehicle:county/tabstop/default
        Error 1222 If SFSSTATE_ALIAS:DESCRIPTION = " "

        if sfsstate_alias:hide_for_auto = 1 then
            error "Invalid County Entered"

        Activehelp if sfsstate_alias:county <> 0 and
                      sfsstate_alias:hide_for_auto = 0 then
                       SFSSTATE_ALIAS:COUNTY
                   else
                       null/width=3/heading="County",
                   if sfsstate_alias:county <> 0 and
                      sfsstate_alias:hide_for_auto = 0 then
                       SFSSTATE_ALIAS:DESCRIPTION
                   else
                       null/width=30/heading="Description" ;
802     sfsstate_alias:description ;
901     Begin
        /*  if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "014webhelp_agtmt601_scr_rating_info_dbx_city.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }*/
        access sfsterritory2_alias, set sfsterritory2_alias:company_id       = agqvehicle:company_id,
                                        sfsterritory2_alias:state            = agqvehicle:state,
                                        sfsterritory2_alias:line_of_business = agqvehicle:line_of_business,
                                        sfsterritory2_alias:county           = agqvehicle:county, using second index, generic

        L_TERRITORY_DESC = agqVEHICLE:TERRITORY_DESCRIPTION
        l_territory      = agqvehicle:territory
        activehelp()
        End
        agqVEHICLE:TERRITORY_DESCRIPTION/default/uppercase/tabstop   mandatory
        access sfsterritory_alt, set sfsterritory_alt:company_id       = agqvehicle:company_id,
                                     sfsterritory_alt:state            = agqvehicle:state,
                                     sfsterritory_alt:line_of_business = agqvehicle:line_of_Business,
                                     sfsterritory_alt:county           = agqvehicle:county,
                                     sfsterritory_alt:territory        = agqvehicle:territory, generic

        If L_TERRITORY_DESC <> agqVEHICLE:TERRITORY_DESCRIPTION or
           l_territory <> sfsterritory_alt:territory then
            Begin
            agqVEHICLE:TERRITORY          = SFSTERRITORY2_ALIAS:TERRITORY
            agqVEHICLE:TERRITORY_SUB_CODE = SFSTERRITORY2_ALIAS:SUB_CODE
            End

        Activehelp if sfsterritory2_alias:hide_description = 0 then
                       SFSTERRITORY2_ALIAS:DESCRIPTION
                   else
                       null/returntofield/width=50 ,
                   if sfsterritory2_alias:hide_description = 0 then
                       SFSTERRITORY2_ALIAS:TERRITORY
                   else
                       null/width=10,
                   if sfsterritory2_alias:hide_description = 0 then
                       SFSTERRITORY2_ALIAS:SUB_CODE
                   else
                       null/width=10 ;
902     agqVEHICLE:TERRITORY/displayonly ;

1001    /*begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "015webhelp_agtmt601_scr_rating_info_dbx_comp.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end*/
        agqvehicle:comp_deductible/tabstop/default
        if agqvehicle:comp_deductible <> cascompdeduct:comp_deductible then
            error "Invalid Comp Deductible Entered"

        activehelp if cascompdeduct_alias:allow_agent_to_view = 1 then
                       cascompdeduct_alias:comp_deductible
                   else
                       null ,
                   if cascompdeduct_alias:description <> "" and
                      cascompdeduct_alias:allow_agent_to_view = 1 then
                       cascompdeduct_alias:description
                   else
                       null ;
1001    cascompdeduct:description
        hide if cascompdeduct:description = "";
1002    /*begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "016webhelp_agtmt601_scr_rating_info_dbx_collision.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end*/
        agqvehicle:coll_deductible/tabstop/default
        if agqvehicle:coll_deductible <> cascolldeduct:coll_deductible then
            error "Invalid Collision Deductible Entered"

        activehelp if cascolldeduct_alias:allow_agent_to_view = 1 then
                       cascolldeduct_alias:coll_deductible
                   else
                       null ;

1101    /*begin
          if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "GGUND" then
                begin
                l_current_web_page = "017webhelp_agtmt601_scr_rating_info_tbx_cost_new.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end*/
        agqvehicle:original_cost/tabstop mandatory
        if (agqvehicle:original_cost = 0 and
           (agqvehicle:comp_deductible <> 0 or
           agqvehicle:coll_deductible <> 0)) then
            error "You must enter an original cost"

        if agqvehicle:original_cost > 90000 then
            error "For limits higher than $90,000 refer to underwriting"

        if agqvehicle:original_cost = 0 then
            begin
            agqvehicle:comp_deductible = 0
            agqvehicle:coll_deductible = 0
            end
        hide if agqvehicle:comp_deductible = 0 and
                agqvehicle:coll_deductible = 0 ;
1101    begin
            L_no_years  = ((Year(agqvehicle:EFF_DATE) - (AGQVEHICLE:YEAR)) + 1)
            If Month(agqvehicle:EFF_DATE) >= 10 And
               Month(agqvehicle:EFF_DATE) <= 12 Then
                L_no_years = L_no_years + 1
            if l_no_years = 0 then
                l_no_years = 1
            If L_no_years > 10 Then
                L_no_Years = 10
            access casacv, set casacv:company_id       = agqvehicle:company_id,
                               casacv:state            = agqvehicle:state,
                               casacv:line_of_business = agqvehicle:line_of_business,
                               casacv:no_years         = l_no_years, generic

            l_acv_factor = 0
            while casacv:company_id       = agqvehicle:company_id and
                  casacv:state            = agqvehicle:state and
                  casacv:line_of_business = agqvehicle:line_of_business and
                  casacv:no_years         = l_no_years
                    begin
                    if agqvehicle:eff_date >= casacv:reff_date then
                        l_acv_factor = casacv:factor

                    next casacv
                    end

            if l_acv_factor <> 0 then
                agqvehicle:acv_limit = agqvehicle:original_cost * l_acv_factor

            if agqvehicle:original_cost = 0 then
                agqvehicle:acv_limit = 1
        end
        agqvehicle:original_cost/displayonly ;
}

-- draw a line
panel at 26,1 to 26,100 tagged line_panel_1
    {
      Components
        line at 1,1 to 1,100
            Properties
              {
                Linestyle = embossed
                Linewidth = 5
                foregroundcolor = "black"
--                backgroundcolor = "#ADD8E6"
              }
    }

Panel at 27,1 to 27,100 Tagged icon_line2_tg
Properties
        {
          LayoutType = screen
        }
{
Components

        Button at 1,5   tagged back_fn
        Properties {
                Iconname = "btn_back_to_main_screen.bmp"
                }
        Events  {
                Action {
                          l_continue_2 = dialog("EXITING","warning.bmp","You are about to leave the application, Do you wish to continue","Yes","No")
                          if l_continue_2 = "Yes" then
                              begin
                              function = "back"
                              abort()
                              end
                       }
                }

        Button at 1,32    tagged previous_fn
        Properties {
                Iconname = "btn_prev_vehicle.bmp"
                }
        Events  {
                Action = previous_fn
                }

        Button at 1,50 tagged next_fn
        Properties {
                Iconname = "btn_next_vehicle.bmp"
                }
        Events  {
                Action = next_fn
                }


        Button at 1,75   tagged calc_fn
        Properties {
                Iconname = "btn_view_summary_totals.bmp"
                }
        Events  {
                Action {
                          function = "func1"
                          abort()
                       }
                }

}

/*panel at 27,1 to 32,100 tagged ficof_fn

Properties
        {
          LayoutType = screen
--          Transparent = False
          backgroundcolor = "white"
        }
{
      Components
         browser at 1,1 to 7,100  tagged helper_tg
             properties {
                          url = ""
                        }
} */

}

Update
if UPDATEOK = "NO" then
    {
    enable (calc_fn)
    disable(accept_fn)
    }

if abort = "YES" then
    begin
    g_ok_to_add = "N"
    g_type = 0
    end

If UPDATEOK = "YES" And
   Abort = "NO" Then
    Begin
    g_ok_to_add = "N"
    enable(calc_fn)
    disable(accept_fn)

    if function one of "ADD", "NEW", "CHANGE", "CHG" then
        begin
          if agqvehicle:state one of 29 then
            {
              do check_for_mca825
            }
        end

    if function one of "delete", "DELETE" and
       sfsline:lob_code not one of "CPORTFOLIO" then
        begin
        access agqend1, set agqend1:app_no = agqvehicle:app_no,
                            agqend1:vehicle_no = agqvehicle:vehicle_no, generic

        while agqend1:app_no = agqvehicle:app_no and
              agqend1:vehicle_no = agqvehicle:vehicle_no
                begin
                delete agqend1

                next agqend1
                end

        g_vehicle_no = 1
        function     = "redisplay"
        end

    if function one of "ADD", "NEW", "CHANGE", "CHG" then
        begin
        access agqname, set agqname:app_no = agqvehicle:app_no, generic

        if agqname:app_no <> agqvehicle:app_no then
            begin
            add agqname
                begin
                agqname:app_no            = agqvehicle:app_no
                agqname:name[1]           = agqvehicle:business_name[1]
                agqname:line_of_business  = agqvehicle:line_of_business
                agqname:trans_date        = todaysdate
                agqname:eff_date          = agqvehicle:eff_date
                agqname:exp_date          = agqvehicle:exp_date
                agqname:company_id        = agqvehicle:company_id
                agqname:original_eff_date = agqvehicle:eff_date
                agqname:agent_no          = agqvehicle:agent_no
                end
            end
        else
            begin
            change agqname
                begin
                agqname:name[1]           = agqvehicle:business_name[1]
                agqname:line_of_business  = agqvehicle:line_of_business
                agqname:eff_date          = agqvehicle:eff_date
                agqname:exp_date          = agqvehicle:exp_date
                agqname:company_id        = agqvehicle:company_id
                agqname:original_eff_date = agqvehicle:eff_date
                agqname:agent_no          = agqvehicle:agent_no
                end
            end

        end

    if function one of "ADD", "NEW" then
        begin
        L_RECORD_KEY = "DE"
        Access CASNOFAULTDE, Set CASNOFAULTDE:COMPANY_ID       = agqvehicle:COMPANY_ID,
                                 CASNOFAULTDE:STATE            = agqVEHICLE:STATE,
                                 CASNOFAULTDE:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS, Generic

        Repeat Begin
            Exit If CASNOFAULTDE:RECORD_KEY       <> L_RECORD_KEY Or
                    CASNOFAULTDE:COMPANY_ID       <> agqvehicle:COMPANY_ID Or
                    CASNOFAULTDE:STATE            <> agqVEHICLE:STATE Or
                    CASNOFAULTDE:LINE_OF_BUSINESS <> agqVEHICLE:LINE_OF_BUSINESS

            If agqvehicle:EFF_DATE >= CASNOFAULTDE:EFF_DATE Then
                Begin
                L_BASIC_LIMIT_1 = CASNOFAULTDE:BASIC_LIMITS[1]
                L_BASIC_LIMIT_2 = CASNOFAULTDE:BASIC_LIMITS[2]
                End

            Next CASNOFAULTDE
            End

        L_RECORD_KEY = "NF"
        Access CASNOFAULT, Set CASNOFAULT:COMPANY_ID       = agqvehicle:COMPANY_ID,
                               CASNOFAULT:STATE            = agqVEHICLE:STATE,
                               CASNOFAULT:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS, Generic

        Repeat Begin
            Exit If CASNOFAULT:RECORD_KEY       <> L_RECORD_KEY Or
                    CASNOFAULT:COMPANY_ID       <> agqvehicle:COMPANY_ID Or
                    CASNOFAULT:STATE            <> agqVEHICLE:STATE Or
                    CASNOFAULT:LINE_OF_BUSINESS <> agqVEHICLE:LINE_OF_BUSINESS

            If agqvehicle:EFF_DATE >= CASNOFAULT:EFF_DATE Then
                Begin
                L_EXTENDED_LIMIT      = CASNOFAULT:EXTENDED_LIMIT
                L_EXTENDED_ADDL_LIMIT = CASNOFAULT:EXTENDED_ADDL_LIMIT
                l_waiver_code_1       = casnofault:waiver_code[1]
                l_waiver_code_2       = casnofault:waiver_code[2]
                End

            Next CASNOFAULT
            End

        access agqpip, set agqpip:app_no = g_app_no, generic

        if l_waiver_code_1 <> "" then
            begin
            l_code = l_waiver_code_1
            do access_agqend1_1
            if l_add_endorsement = "Y" and
               agqmaster:form_of_business one of "I" and
               agqpip:waiver = 1 then
                do add_agqend1_1
            if ((l_add_endorsement = "N" and
               agqmaster:form_of_business not one of "I" and
               agqpip:waiver = 1) or
               (l_add_endorsement = "N" and
               agqpip:waiver = 0)) then
                do delete_agqend1_1
            end

        if l_waiver_code_2 <> "" then
            begin
            l_code = l_waiver_code_2
            do access_agqend1_1
            if l_add_endorsement = "Y" and
               agqmaster:form_of_business not one of "I" and
               agqpip:waiver = 1 then
                do add_agqend1_1
            if ((l_add_endorsement = "N" and
               agqmaster:form_of_business one of "I" and
               agqpip:waiver = 1) or
               (l_add_endorsement = "N" and
               agqpip:waiver = 0)) then
                do delete_agqend1_1
            end

        Access agqPANOFAULT, Set agqpanofault:app_no     = agqVEHICLE:app_no,
                                 agqpanofault:VEHICLE_NO = agqVEHICLE:VEHICLE_NO, Generic

        access agqpanofault_alias, set agqpanofault_alias:app_no = agqvehicle:app_no, generic

        if agqpanofault:app_no     <> agqvehicle:app_no or
           agqpanofault:vehicle_no <> agqvehicle:Vehicle_no then
            begin
            add agqpanofault
                begin
                agqpanofault:app_no         = agqvehicle:app_no
                agqpanofault:vehicle_no     = agqvehicle:vehicle_no
                agqpanofault:record_rdf     = agqpanofault_alias:record_rdf/raw
                end
            end

/*        access agqdoc, set agqdoc:app_no = g_app_no, generic

        if agqdoc:app_no <> g_app_no then
            begin
            add agqdoc
                begin
                agqdoc:app_no = g_app_no
                end
            end*/

        Access agqpip, Set agqpip:app_no     = agqVEHICLE:app_no,
                           agqpip:VEHICLE_NO = agqVEHICLE:VEHICLE_NO, Generic

        access agqpip_alias, set agqpip_alias:app_no     = agqvehicle:app_no,
                                 agqpip_alias:vehicle_no = 1, generic

        If agqpip:app_no     <> agqVEHICLE:app_no Or
           agqpip:VEHICLE_NO <> agqVEHICLE:VEHICLE_NO Then
            begin
            Add agqpip
                Begin
                agqpip:app_no = agqVEHICLE:app_no
                agqpip:VEHICLE_NO = agqVEHICLE:VEHICLE_NO
                agqpip:state = agqvehicle:state
                agqpip:EXTEND_MEDICAL_EXPENSE = "N"
                agqpip:DELETION_OF_BENEFITS = "N"
                agqpip:SECONDARY_OPTION = "N"
                agqpip:no_fault = "Y"
                if agqvehicle:company_id one of "GGUND" then
                    begin
                    if agqmaster:form_of_business one of "C", "P", "L" then
                        agqpip:limitation = "Y"
                    else
                        agqpip:limitation = "N"
                    end
                else
                    agqpip:LIMITATION = "N"
                agqpip:RESIDENT_CHILDREN = "N"
                if agqpip_alias:app_no = agqvehicle:app_no and
                   agqvehicle:type one of 2 then
                    begin
                    agqpip:additional_pip = agqpip_alias:additional_pip
                    agqpip:additional_pip_option = agqpip_alias:additional_pip_option
                    end
                else
                    begin
                    agqpip:ADDITIONAL_PIP = "N"
                    agqpip:additional_pip_option = 0
                    end
                agqpip:NAMED_FAMILY_MEMBERS = "N"
                agqpip:ADDITIONAL_UNLIMITED = "N"
                agqpip:MEDICAL_EXP_MOTOR_BUS = "N"
                agqpip:BROADENED_PIP = "N"
                agqpip:COMBINED_OPTION = "N"
                agqpip:MEDICAL_EXPENSE_LIMIT = agsdefault_cap:MEDICAL_EXP_LIMIT
                agqpip:MED_EXP_DEDUCTIBLE = agsdefault_cap:MEDICAL_EXP_DEDUCTIBLE
                If agqVEHICLE:STATE = 29 Then
                    Begin
                    agqpip:EXTENDED_MEDICAL_EXPENSE = agsdefault_cap:PIP_EXTENDED_LIMIT
                    agqpip:OPTIONAL_MED_EXP_DEDUCTIBLE = agsdefault_cap:PIP_DEDUCTIBLE
                    If agqVEHICLE:TYPE = 2 Or
                       agqVEHICLE:TYPE = 5 Or
                       agqVEHICLE:TYPE = 6 Or
                       agqVEHICLE:TYPE = 7 Then
                        Begin
/*                        if agsdefault_cap:extend_medical_expense <> "" then
                            agqpip:extend_medical_expense = agsdefault_cap:extend_medical_expense
                        else
                            agqpip:EXTEND_MEDICAL_EXPENSE = "Y"*/
                        if agqpip:extend_medical_expense = "Y" then
                            agqpip:EXTENDED_MEDICAL_EXPENSE = L_EXTENDED_LIMIT +
                                                              L_EXTENDED_ADDL_LIMIT
                        else
                            agqpip:extended_medical_expense = l_extended_limit
                        agqpip:PEDESTRIAN = "N"
                        End
                    If agqVEHICLE:TYPE = 1 Or
                       agqVEHICLE:TYPE = 3 Or
                       agqVEHICLE:TYPE = 4 Then
                        Begin
                        agqpip:EXTEND_MEDICAL_EXPENSE = "N"
                        agqpip:EXTENDED_MEDICAL_EXPENSE = L_EXTENDED_LIMIT
                        If agqVEHICLE:CLASS_CODE = 681 Or
                           agqVEHICLE:CLASS_CODE = 682 Or
                           agqVEHICLE:CLASS_CODE = 683 Or
                           agqVEHICLE:CLASS_CODE = 691 Or
                           agqVEHICLE:CLASS_CODE = 692 Or
                           agqVEHICLE:CLASS_CODE = 693 Then
                            agqpip:PEDESTRIAN = "N"
                        Else
                            agqpip:PEDESTRIAN = "Y"
                        End
                    L_ADD_MED_EXP_CODE = "N"
                    If agqVEHICLE:TYPE = 3 Then
                        Begin
                        If agqVEHICLE:CLASS_CODE = 6381 Or
                           agqVEHICLE:CLASS_CODE = 6382 Or
                           agqVEHICLE:CLASS_CODE = 6383 or
                           agqvehicle:class_code = 6384 or
                           agqvehicle:class_code = 6385 Then
                            Begin
                            L_ADD_MED_EXP_CODE = "Y"
                            agqpip:MEDICAL_EXP_MOTOR_BUS = "Y"
                            End
                        Else
                            Begin
                            agqpip:MEDICAL_EXP_MOTOR_BUS = "N"
                            End
                        End
                    Else
                        Begin
                        agqpip:MEDICAL_EXP_MOTOR_BUS = "N"
                        End
                    agqpip:PIP_LIMIT[1] = 0
                    agqpip:PIP_LIMIT[2] = 0
                    agqpip:ADDL_LIMIT[1] = 0
                    agqpip:ADDL_LIMIT[2] = 0
                    agqpip:SINGLE_LIMIT = 0
                    End
                If agqVEHICLE:STATE = 07 Then
                    Begin
                    agqpip:MEDICAL_EXP_MOTOR_BUS = "N"
                    agqpip:EXTENDED_MEDICAL_EXPENSE = 0
                    agqpip:OPTIONAL_MED_EXP_DEDUCTIBLE = 0
                    agqpip:PIP_LIMIT[1] = L_BASIC_LIMIT_1
                    agqpip:PIP_LIMIT[2] = L_BASIC_LIMIT_2
                    agqpip:ADDL_LIMIT[1] = 0
                    agqpip:ADDL_LIMIT[2] = 0
                    agqpip:SINGLE_LIMIT = 0
                    agqpip:PEDESTRIAN = "N"
                    End
                If agqVEHICLE:STATE = 37 Then
                    Begin
                    agqpip:MEDICAL_EXP_MOTOR_BUS = "N"
                    agqpip:EXTENDED_MEDICAL_EXPENSE = 0
                    agqpip:OPTIONAL_MED_EXP_DEDUCTIBLE = 0
                    agqpip:PIP_LIMIT[1] = L_BASIC_LIMIT_1
                    agqpip:PIP_LIMIT[2] = L_BASIC_LIMIT_2
                    agqpip:ADDL_LIMIT[1] = 0
                    agqpip:ADDL_LIMIT[2] = 0
                    agqpip:SINGLE_LIMIT = 0
                    agqpip:PEDESTRIAN = "N"
                    End
                End
            End
        end

    If FUNCTION one of "CHANGE", "CHG" Then
        Begin
        Access agqpip, Set agqpip:app_no = agqVEHICLE:app_no,
                           agqpip:VEHICLE_NO = agqVEHICLE:VEHICLE_NO, Generic

        If agqpip:app_no = agqVEHICLE:app_no And
           agqpip:VEHICLE_NO = agqVEHICLE:VEHICLE_NO Then
            begin
            L_RECORD_KEY = "NF"
            Access CASNOFAULT, Set CASNOFAULT:COMPANY_ID = agqvehicle:COMPANY_ID,
                                   CASNOFAULT:STATE = agqVEHICLE:STATE,
                                   CASNOFAULT:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS, Generic

            Repeat Begin
                Exit If CASNOFAULT:RECORD_KEY <> L_RECORD_KEY Or
                        CASNOFAULT:COMPANY_ID <> agqvehicle:COMPANY_ID Or
                        CASNOFAULT:STATE <> agqVEHICLE:STATE Or
                        CASNOFAULT:LINE_OF_BUSINESS <> agqVEHICLE:LINE_OF_BUSINESS

                If agqvehicle:EFF_DATE >= CASNOFAULT:EFF_DATE Then
                    Begin
                    L_EXTENDED_LIMIT = CASNOFAULT:EXTENDED_LIMIT
                    L_EXTENDED_ADDL_LIMIT = CASNOFAULT:EXTENDED_ADDL_LIMIT
                    l_waiver_code_1 = casnofault:waiver_code[1]
                    l_waiver_code_2 = casnofault:waiver_code[2]
                    End

                Next CASNOFAULT
                End

        access agqpip, set agqpip:app_no = g_app_no, generic

        if l_waiver_code_1 <> "" then
            begin
            l_code = l_waiver_code_1
            do access_agqend1_1
            if l_add_endorsement = "Y" and
               agqmaster:form_of_business one of "I" and
               agqpip:waiver = 1 then
                do add_agqend1_1
            if ((l_add_endorsement = "N" and
               agqmaster:form_of_business not one of "I" and
               agqpip:waiver = 1) or
               (l_add_endorsement = "N" and
               agqpip:waiver = 0)) then
                do delete_agqend1_1
            end

        if l_waiver_code_2 <> "" then
            begin
            l_code = l_waiver_code_2
            do access_agqend1_1
            if l_add_endorsement = "Y" and
               agqmaster:form_of_business not one of "I" and
               agqpip:waiver = 1 then
                do add_agqend1_1
            if ((l_add_endorsement = "N" and
               agqmaster:form_of_business one of "I" and
               agqpip:waiver = 1) or
               (l_add_endorsement = "N" and
               agqpip:waiver = 0)) then
                do delete_agqend1_1
            end

            Change agqpip
                Begin
                If agqVEHICLE:STATE = 29 Then
                    Begin
                    If agqVEHICLE:TYPE = 3 Then
                        Begin
                        If agqVEHICLE:CLASS_CODE = 6381 Or
                           agqVEHICLE:CLASS_CODE = 6382 Or
                           agqVEHICLE:CLASS_CODE = 6383 or
                           agqvehicle:class_code = 6384 or
                           agqvehicle:class_code = 6385 Then
                            Begin
                            L_ADD_MED_EXP_CODE = "Y"
                            agqpip:MEDICAL_EXP_MOTOR_BUS = "Y"
                            End
                        Else
                            Begin
                            agqpip:MEDICAL_EXP_MOTOR_BUS = "N"
                            End
                        End
                    Else
                        Begin
                        agqpip:MEDICAL_EXP_MOTOR_BUS = "N"
                        End

                    If agqVEHICLE:TYPE = 2 Or
                       agqVEHICLE:TYPE = 5 Or
                       agqVEHICLE:TYPE = 6 Or
                       agqVEHICLE:TYPE = 7 Then
                        Begin
                        if agsdefault_cap:extend_medical_expense <> "" then
                            agqpip:extend_medical_expense = agsdefault_cap:extend_medical_expense
                        else
                            agqpip:EXTEND_MEDICAL_EXPENSE = "Y"
                        if agqpip:extend_medical_expense = "Y" then
                            agqpip:EXTENDED_MEDICAL_EXPENSE = L_EXTENDED_LIMIT +
                                                              L_EXTENDED_ADDL_LIMIT
                        else
                            agqpip:extended_medical_expense = l_extended_limit
                        agqpip:PEDESTRIAN = "N"
                        End
                    If agqVEHICLE:TYPE = 1 Or
                       agqVEHICLE:TYPE = 3 Or
                       agqVEHICLE:TYPE = 4 Then
                        Begin
                        agqpip:EXTEND_MEDICAL_EXPENSE = "N"
                        agqpip:EXTENDED_MEDICAL_EXPENSE = L_EXTENDED_LIMIT
                        If agqVEHICLE:CLASS_CODE = 681 Or
                           agqVEHICLE:CLASS_CODE = 682 Or
                           agqVEHICLE:CLASS_CODE = 683 Or
                           agqVEHICLE:CLASS_CODE = 691 Or
                           agqVEHICLE:CLASS_CODE = 692 Or
                           agqVEHICLE:CLASS_CODE = 693 Then
                            agqpip:PEDESTRIAN = "N"
                        Else
                            agqpip:PEDESTRIAN = "Y"
                        End
                    End
                End
            end
        end

    End
    function = "redisplay"

Procedure Definition

procedure check_for_mca825
BEGIN
Access agqvEHICLE_ALIAS, Set agqvEHICLE_ALIAS:app_no = g_app_no, generic

access casdefault, set casdefault:company_id       = agqvehicle:company_id,
                       casdefault:line_of_business = agqvehicle:line_of_business, generic

if casdefault:dont_check_for_mca825 = 0 then
    {
    if agqvehicle:eff_date >= casdefault:dont_check_for_mca825_eff_date or
       casdefault:dont_check_for_mca825_eff_date = 0 then
        {
        while agqvehicle_alias:app_no = g_app_no
            begin
            l_code = "MCA825"
            if agqvehicle_alias:type one of 2 and
               agqvehicle_alias:class_code one of 7391, 7399 then
                begin
                l_app_no     = agqvehicle_alias:app_no
                l_vehicle_no = agqvehicle_alias:vehicle_no
                do access_agqend1_1                   --check to see if it has been added.
                if L_ADD_ENDORSEMENT one of "Y" then
                    begin
                    do ADD_agqEND1_1
                    end
                end
            else
            if agqvehicle_alias:type one of 3, 4, 5, 7 and
               agqvehicle_alias:eff_date >= 04.01.2016 then
                begin
                l_app_no     = agqvehicle_alias:app_no
                l_vehicle_no = agqvehicle_alias:vehicle_no
                do access_agqend1_1                   --check to see if it has been added.
                if L_ADD_ENDORSEMENT one of "Y" then
                    begin
                    do ADD_agqEND1_1
                    end
                end
            else
            if agqvehicle_alias:type = 1 and
               agqvehicle_alias:class_code not one of  681, 682, 683, 691, 692, 693 and
               agqvehicle_alias:eff_date >= 04.01.2016 then
                begin
                l_app_no     = agqvehicle_alias:app_no
                l_vehicle_no = agqvehicle_alias:vehicle_no
                do access_agqend1_1                   --check to see if it has been added.
                if L_ADD_ENDORSEMENT one of "Y" then
                    begin
                    do ADD_agqEND1_1
                    end
                end
            else
                begin
                l_app_no     = agqvehicle_alias:app_no
                l_vehicle_no = agqvehicle_alias:vehicle_no
                do delete_agqend1_1
                end

            next agqvehicle_alias
            end
        }
    }

END

Procedure ADD_agqEND1_1
Begin
Access agqEND1, Set agqEND1:app_no = L_app_no, Generic

L_SUB_CODE = 0
while agqEND1:app_no = L_app_no
    begin
    L_SUB_CODE = agqEND1:SUB_CODE

    Next agqEND1
    end

L_SUB_CODE = L_SUB_CODE + 10

Access SFSOPTEND,
     Set SFSOPTEND:COMPANY_ID       = agqVEHICLE:COMPANY_ID,
         SFSOPTEND:STATE            = agqVEHICLE:STATE,
         SFSOPTEND:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS,
         SFSOPTEND:CODE             = L_CODE, Generic

while SFSOPTEND:COMPANY_ID       = agqVEHICLE:COMPANY_ID and
      SFSOPTEND:STATE            = agqVEHICLE:STATE and
      SFSOPTEND:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS and
      SFSOPTEND:CODE             = L_CODE
    begin
    If (agqvehicle:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqvehicle:eff_date <= sfsoptend:exp_date or
       sfsoptend:exp_date = 0)) Then
        Begin
        L_FORM_EDITION = SFSOPTEND:FORM_EDITION
        L_DESCRIPTION  = SFSOPTEND:DESCRIPTION
        End

    Next SFSOPTEND
    end

if l_form_edition <> "" then
begin
Add agqEND1
    Begin
    agqEND1:app_no               =       L_app_no
    agqEND1:VEHICLE_NO           =       L_VEHICLE_NO
    agqEND1:SUB_CODE             =       L_SUB_CODE
    agqEND1:CODE                 =       L_CODE
    agqEND1:FORM_EDITION         =       L_FORM_EDITION
    agqEND1:DESCRIPTION          =       L_DESCRIPTION
    agqEND1:PREMIUM              =       0
    End
end

End

Procedure ACCESS_agqEND1_1
Begin
Access agqEND1, Set agqEND1:app_no   = L_app_no ,
                    agqEND1:VEHICLE_NO = L_VEHICLE_NO, Generic

L_ADD_ENDORSEMENT = "Y"
while agqEND1:app_no   = L_app_no and
      agqEND1:VEHICLE_NO = L_VEHICLE_NO
    begin
    If agqEND1:CODE = L_CODE Then
        begin
        L_ADD_ENDORSEMENT = "N"
        end

    Next agqEND1
    end

End

Procedure DELETE_agqEND1_1
Begin
Access agqEND1, Set agqEND1:app_no   = L_app_no ,
                    agqEND1:VEHICLE_NO = L_VEHICLE_NO, Generic

while agqEND1:app_no   = L_app_no and
      agqEND1:VEHICLE_NO = L_VEHICLE_NO
    begin
    If agqEND1:CODE = L_CODE Then
        begin
        Delete agqEND1
        end

    Next agqEND1
    end

End

procedure read_agqvehicle
begin
access agqvehicle_alias, set agqvehicle_alias:app_no = g_app_no, generic

l_no_vehicles = 0
l_vehicle_no  = 0
while agqvehicle_alias:app_no = g_app_no
    begin
    l_no_vehicles = l_no_vehicles + 1
    l_vehicle_no  = agqvehicle_alias:vehicle_no

    next agqvehicle_alias
    end

end

procedure update_agqmaster
BEGIN
access agqmaster, set agqmaster:app_no = g_app_no, exact

if agqmaster:app_no = g_app_no then
    begin
    change agqmaster
        {
        if agqmaster:form_of_business <> l_form_of_business then
            agqmaster:form_of_business  = l_form_of_business
        if agqmaster:fob_description <> l_fob_description1 then
            agqmaster:FOB_DESCRIPTION   = l_fob_description1
        }
    end
else
    begin
    add agqmaster
        begin
        agqmaster:app_no           = g_app_no
        agqmaster:form_of_business = l_form_of_business
        agqmaster:fob_description  = l_fob_description1
        end
    end

L_RECORD_KEY = "NF"
Access CASNOFAULT, Set CASNOFAULT:COMPANY_ID       = agqvehicle:COMPANY_ID,
                       CASNOFAULT:STATE            = agqVEHICLE:STATE,
                       CASNOFAULT:LINE_OF_BUSINESS = agqVEHICLE:LINE_OF_BUSINESS, Generic

Repeat Begin
    Exit If CASNOFAULT:RECORD_KEY       <> L_RECORD_KEY Or
            CASNOFAULT:COMPANY_ID       <> agqvehicle:COMPANY_ID Or
            CASNOFAULT:STATE            <> agqVEHICLE:STATE Or
            CASNOFAULT:LINE_OF_BUSINESS <> agqVEHICLE:LINE_OF_BUSINESS

    If agqvehicle:EFF_DATE >= CASNOFAULT:EFF_DATE Then
        Begin
        l_waiver_code_1       = casnofault:waiver_code[1]
        l_waiver_code_2       = casnofault:waiver_code[2]
        End

    Next CASNOFAULT
    End

access agqpip, set agqpip:app_no = g_app_no, generic

l_vehicle_no = 0
l_app_no = agqvehicle:app_no
if l_waiver_code_1 <> "" then
    begin
    l_code = l_waiver_code_1
    do access_agqend1_1
    if l_add_endorsement = "Y" and
       l_form_of_business one of "I" and
       agqpip:waiver = 1 then
        do add_agqend1_1
    if ((l_add_endorsement = "N" and
       l_form_of_business not one of "I" and
       agqpip:waiver = 1) or
       (l_add_endorsement = "N" and
       agqpip:waiver = 0)) then
        begin
        do delete_agqend1_1
        end
    end

if l_waiver_code_2 <> "" then
    begin
    l_code = l_waiver_code_2
    do access_agqend1_1
    if l_add_endorsement = "Y" and
       l_form_of_business not one of "I" and
       agqpip:waiver = 1 then
        begin
        do add_agqend1_1
        end
    if ((l_add_endorsement = "N" and
       l_form_of_business one of "I" and
       agqpip:waiver = 1) or
       (l_add_endorsement = "N" and
       agqpip:waiver = 0)) then
        do delete_agqend1_1
    end

END

/*procedure change_current_browser (string p_server_name, string p_current_web_page)
BEGIN
l_web_site_address = trun(p_server_name) + trun(p_current_web_page)
setproperty(helper_tg,url,trun(l_web_site_address))

END*/

End
