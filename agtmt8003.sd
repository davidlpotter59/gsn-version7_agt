%%                      
Screen
        Name = "agtmt8003";
        Type = "Detail" ;
        Highlight=Underscore ;
        highlightfield="Yes";
        Padcharacter=Space ;
        Screensize="dynamic";
        Windowtitle="%a     %s Rating Information - Ver. 7.00     %m";
        Domain="agqcrime1" ;
        resizeable = yes ;
        iconline = 0 ;

        Global Unsigned Ascii Number G_APP_NO[11] ;
        Global Unsigned Ascii Number G_LINE_OF_BUSINESS[4] ;
        Global Unsigned Ascii Number G_OPT[2] ;
        global unsigned ascii number g_add_prem_no[1] ;
        global unsigned ascii number g_add_build_no[1] ;
        global unsigned ascii number g_add_new_quote[1] ;
        global unsigned ascii number g_prem_no[4] ;
        global unsigned ascii number g_build_no[4];
        global unsigned ascii number g_from_search_screen[1] ;
        global unsigned ascii number g_enhancement[1] ;
        global unsigned ascii number g_state[2] ;
        global unsigned ascii number g_sub_code[4] ;

        global string g_company_id[10] ,
                      g_initial_screen[50] ,
                      g_code[7],
                      g_crime_form[1],
                      g_zipcode_change[1] ;

        local signed ascii number l_package_mod[4]=0/dec=2,
                                  l_package[4]=0/dec=2,
                                  l_premium[9]=0,
                                  l_deviation[4]=0/dec=2 ;

        array[9] of string l_literal[66] ;
        array[9] of tag l_the_tag[15] ;

        Local Unsigned Ascii Number L_SUB_CODE[4] ,
                                    L_STATE[2],
                                    l_loop[2],
                                    l_tag_position[2],
                                    L_LINE_OF_BUSINESS[4],
                                    l_last_prem_no[4],
                                    l_last_build_no[4],
                                    l_first_prem_no[4],
                                    l_first_build_no[4],
                                    l_no_locations[2]=0 ,
                                    l_prem_no[4],
                                    l_build_no[4],
                                    l_abort_program[1],
                                    l_option_1[1],
                                    l_option_2[1],
                                    l_option_3[1],
                                    l_option_4[1],
                                    l_option_5[1],
                                    l_option_6[1],
                                    l_option_7[1],
                                    l_option_8[1],
                                    l_option_9[1],
                                    l_option_10[1],
                                    l_option_11[1],
                                    l_option_12[1],
                                    l_option_13[1],
                                    l_option_14[1],
                                    l_option_15[1],
                                    l_option_16[1],
                                    l_option_17[1] ;


        Local String L_SCREEN[8] ,
                     l_screen_1[10],
                     l_display_field[1],
                     l_first_location[1]="Y",
                     L_CODE[7] ,
                     L_CODE_1[7],
                     L_CODE_2[7],
                     l_code_3[7],
                     l_code_4[7],
                     l_code_5[7],
                     l_code_6[7],
                     l_code_7[7],
                     l_code_8[7],
                     l_code_9[7],
                     l_code_10[7],
                     l_code_11[7],
                     l_code_12[7],
                     l_code_13[7],
                     l_code_14[7],
                     l_code_15[7],
                     l_code_16[7],
                     l_code_17[7],
                     l_code_20[7],
                     L_CRIME_FORM[1],
                     l_type[2],
                     l_add[1],
                     L_FORM_EDITION[18],
                     L_DESCRIPTION[55],
                     L_ADD_ENDORSEMENT[1],
                     L_DELETE_ENDORSEMENT[1],
                     L_COMPANY_ID[10] ,
                     l_first_str_location[8],
                     l_last_str_location[8],
                     l_str_location[12],
                     l_username[15],
                     l_system_id[15] ;

        Local Date L_EFF_DATE[8] ;

        Access agqcrime1,
           Set agqcrime1:app_no   = G_app_no, generic

        Include "stdkeys7.inc"

Style Definition
        Include "styles.inc"
        Displayonly Field Style {
                                  backgroundcolor="#CCCCCC"
                                }


Functions

        "redisplay" display/noreturn "agtmt8003" ;

        "CHG" sequence "change 1-11" tagged change_fn ;

        "back" display/noreturn "agtmt8000" tagged back_fn;

        "func1" display "agtmt8003b" tagged irpm_fn ;
        "opt" display "agtmt8003x" tagged optional_info_fn ;

        reaccess ;

        include "stdfunc7.inc"

EVENT DEFINITION
        default eventhandler {
                             "REMOVE_SCREEN" { function = "exit" abort () }
                             "reload" { function = "reaccess" abort () }
                             "display_message" { warning "" + event.value }
                             "current_line_of_business" {
                                                          g_line_of_business = val(event.value)
                                                        }
                             }
Menu Definition

Toolbar Definition

Screen Entry
do set_display

disable(accept_fn)
access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

g_initial_screen = ""
l_username = username
l_company_id = sfsdefault:company_id

l_username = username
access sfsemail, set sfsemail:company_id = l_company_id,
                     sfsemail:user_id    = l_username, generic

access sfsagent, set sfsagent:company_id = l_company_id,
                     sfsagent:agent_no   = sfsemail:agent_no, generic

access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

if sfsdefault:company_id one of "FLEMINGTON" then
    begin
    hide(lebins_fn)
    hide(farmers_fn)
    end
else
if sfsdefault:company_id one of "FARMERS" then
    begin
    hide(ficof_fn)
    hide(lebins_fn)
    end
else
if sfsdefault:company_id one of "LEBINS" then
    begin
    hide(ficof_fn)
    hide(farmers_fn)
    end

if sfsemail:agent_no <> 0 then
    hide(irpm_fn)

l_state = sfsagent:state
if l_state = 0 then
    l_state = sfsdefault:state
Access SFSLINE_ALIAS, Set SFSLINE_alias:COMPANY_ID       = l_company_id,
                          SFSLINE_alias:LINE_OF_BUSINESS = g_line_of_business,
                          SFSLINE_alias:LOB_SUBLINE      = "00", Generic

Access SFSLINE, Set SFSLINE:COMPANY_ID       = l_company_id,
                    SFSLINE:LINE_OF_BUSINESS = g_line_of_business,
                    SFSLINE:LOB_SUBLINE      = "00", Generic

access agqname, set agqname:app_no = g_app_no,generic

if agqname:quote_no <> 0 then
    begin
    disable(add_fn)
    disable(change_fn)
    disable(delete_fn)
    disable(accept_fn)
    end

if agqcrime1:app_no = 0 then
    begin
    disable(previous_fn)
    disable(next_fn)
    end

access validation
if agqcrime1:app_no <> g_app_no then
   error ""

access agqcrime1_alias, set agqcrime1_alias:app_no = agqcrime1:app_no, generic

l_no_locations   = 0
l_first_location = "Y"
l_first_prem_no  = 0
l_first_build_no = 0
l_last_prem_no   = 0
l_last_build_no  = 0
while agqcrime1_alias:app_no = agqcrime1:app_no
    begin
    if l_first_location = "Y" then
        begin
        l_first_str_location  = str(agqcrime1_alias:prem_no) +
                               str(agqcrime1_alias:build_no)
        l_first_location = "N"
        end
    l_last_str_location  = str(agqcrime1_alias:prem_no) +
                           str(agqcrime1_alias:build_no)
    l_no_locations  = l_no_locations + 1

    next agqcrime1_alias
    end

l_str_location = str(agqcrime1:prem_no) +
                 str(agqcrime1:build_no)

if l_no_locations one of 0, 1 then
    begin
    disable(next_fn)
    disable(previous_fn)
    end
else
if l_str_location = l_first_str_location and
   l_no_locations > 1 then
    begin
    disable(previous_fn)
    enable(next_fn)
    end
else
if l_str_location <> l_first_str_location and
   l_str_location <> l_last_str_location and
   l_no_locations > 1 then
    begin
    enable(next_fn)
    enable(previous_fn)
    end
else
if l_str_location = l_last_str_location and
   l_no_locations > 1 then
    begin
    disable(next_fn)
    enable(previous_fn)
    end

screen at 1,1 to 30,100
Properties
        {
          Layouttype = screen
          transparent = False
          fontstyle = BOLD
          backgroundcolor = "#ADD8E6"
          scrollbarpolicy = always
        }
{

    Panel at 1,1 to 2,100
        Properties
            {
            layouttype = screen
            }
        {
        components
            guidetext at 1,1 to 2,40
                properties
                    {
                    iconname = "qp_logo.gif"
                    }
            guidetext at 1,83 to 2,100 tagged ficof_fn
                properties
                    {
                    iconname = "ficof_logo.gif"
                    }
            guidetext at 1,83 to 2,100 tagged farmers_fn
                properties
                    {
                    iconname = "salem_logo.gif"
                    }
            guidetext at 1,83 to 2,100 tagged lebins_fn
                properties
                    {
                    iconname = ""
                    }
            guidetext at 1,35 to 2,100 tagged t_line_of_business
                Properties
                   {
                   iconname = ""
                   }

        }


panel at 3,1 to 4,100
Properties
        {
        LayoutType = screen
        backgroundcolor = "Grey"
        transparent = False
        }
{
components
          guidetext at 1.45,1 to 1.45,40     tagged display_information_box
                properties
                  {
                    text = "Crime Information..."
                    fontsize = 18
                    fontstyle = BOLD
                    fontname = "arial"
                    transparent = False
                    backgroundcolor = "Grey"
                  }

}

Panel at 3.45,75 to 4.45, 100
Properties {
           LayoutType = screen
           }
{
%%
App No: ___________

%%

fields
101     begin
        g_add_prem_no   = 0
        g_add_build_no  = 0
        g_prem_no       = 0
        g_build_no      = 0
        if function one of "ADD", "NEW" then
            begin
            access agqcrime1_alias, set agqcrime1_alias:app_no = g_app_no, generic

            if agqcrime1_alias:app_no = g_app_no then
                begin
                g_prem_no = agqcrime1_alias:prem_no
                g_build_no = agqcrime1_alias:build_no
                l_screen_1 = "agtmt8003a"
                display modal screen l_screen_1
                with initial function "CHANGE"

                if g_add_prem_no   = 0 and
                   g_add_build_no  = 0 then
                    begin
                    function = "redisplay"
                    abort()
                    end

                if g_add_prem_no = 1 then
                    begin
                    l_prem_no = 0
                    access agqcrime1_alias, set agqcrime1_alias:app_no = g_app_no, generic

                    while agqcrime1_alias:app_no = g_app_no
                        begin
                        l_prem_no  = agqcrime1_alias:prem_no

                        next agqcrime1_alias
                        end

                    access agqmaster, set agqmaster:app_no = g_app_no, generic

                    access agqcrime1_alias, set agqcrime1_alias:app_no = g_app_no, generic

                    agqcrime1:app_no            = g_app_no
                    agqcrime1:prem_no           = l_prem_no + 1
                    agqcrime1:build_no          = 1
                    end
                else
                if g_add_build_no = 1 then
                    begin
                    access agqcrime1_alias, set agqcrime1_alias:app_no = g_app_no, generic

                    l_build_no = 0
                    while agqcrime1_alias:app_no = g_app_no
                        begin
                        if agqcrime1_alias:prem_no = g_prem_no then
                            l_build_no  = agqcrime1_alias:build_no

                        next agqcrime1_alias
                        end

                    access agqmaster, set agqmaster:app_no = g_app_no, generic

                    access agqcrime1_alias, set agqcrime1_alias:app_no = g_app_no, generic

                    agqcrime1:app_no           = g_app_no
                    agqcrime1:prem_no          = g_prem_no
                    agqcrime1:build_no         = l_build_no + 1
                    end
                end
            else
                begin
                agqcrime1:app_no           = g_app_no
                agqcrime1:prem_no          = 1
                agqcrime1:build_no         = 1
                end

            g_prem_no                   = agqcrime1:prem_no
            g_build_no                  = agqcrime1:build_no
            end
        end
        agqcrime1:APP_NO/displayonly ;

}

Panel at 5,1 to 6,100 Tagged icon_line2_tg
    Properties {
               LayoutType = screen
               }
    {
    Components
        Button at 1.5,1   tagged add_fn
            Properties {
                       Iconname = "btn_add_location.bmp"
                       tooltip = "Add Location or Building"
                       }
            Events     {
                       Action = add_fn
                       }

        Button at 1.5,38    tagged change_fn
            Properties {
                       Iconname = "btn_edit_location.bmp"
                       }
            Events     {
                       Action = change_fn
                       }

        Button at 1.5, 70 tagged delete_fn
            Properties {
                       Iconname = "btn_delete_location.bmp"
                       }
            Events     {
                       Action = delete_fn
                       }
    }

Panel at 5,94 to 6,96 tagged button_panel
    Properties {
               layouttype = column
               }
    {
    Components
        Button to 1,1
            properties {
                       Iconname = "btn_print_screen.bmp"
                       }
            events     {
                       action {
                              function = "print"
                              abort()
                              }
                       }
    }

Panel at 6.45,92
    Properties {
               layouttype = column
               }
    {
    Components
        guidetext to 1,1
            properties {
                       text = "agtmt8003.sd"
                       fontsize = 9
                       }
    }

Panel at 7,1 to 9,100 Tagged location
    Properties {
               LayoutType = screen
               }
    {
    Components
        guidetext at 1.5,24 to 2.5,36
            properties {
                       text = "Location No:"
                       fontsize = 12
                       fontname = "arial"
                       }

        guidetext at 1.5,44 to 2.5,56
            properties {
                       text = "Building No:"
                       fontsize = 12
                       fontname = "arial"
                       }
    }

Panel at 7.5,33 to 9,60 Tagged rating_pl
{
%%
____                ____

%%

components

fields
101   agqcrime1:prem_no/displayonly ;
102   agqcrime1:build_no/displayonly ;

}

Panel at 8,70 to 8,100
    Properties {
               layouttype = row
               }
    {
    Components
        Button at 1,55 tagged accept_fn
            properties {
                       Iconname = "btn_accept_edits.bmp"
                       }
            Events     {
                       mouseclicked = accept
                       }

    }

Panel at 9,90 to 10,91 tagged irpm_fn
    Properties
        {
        layouttype = column
        }
    {
    Components
        Button at 1,1
            Properties {
                Iconname = "btn_irpm.bmp"
                }
            Events  {
                Action = irpm_fn
                }
    }

Panel at 10,1 to 11,100
    Properties {
               LayoutType = screen
               }
    {
    Components
        guidetext at 1,1 to 1,22
            properties {
                       text = "County:"
                       fontsize = 12
                       contentalignment = right
                       fontname = "arial"
                       }

        guidetext at 2,1 to 2,22
            properties {
                       text = "Territory:"
                       fontsize = 12
                       contentalignment = right
                       fontname = "arial"
                       }

    }

Panel at 10,24 to 11, 100
{
%%
___  __________________________________________________
___  __________________________________________________
%%

components

fields
101     begin
        if function one of "ADD","NEW","CHG","CHANGE" then
            {
            enable(accept_fn)
            disable(back_fn)
            disable(optional_info_fn)
            }
        else
            {
            disable(accept_fn)
            enable(back_fn)
            enable(optional_info_fn)
            }

        access agqtotals1, set agqtotals1:app_no = g_app_no, generic

        Access agqcrime1_ALIAS, Set agqcrime1_ALIAS:app_no = agqcrime1:app_no, Generic

        Access agqcrime1_ALT, Set agqcrime1_ALT:app_no   = agqcrime1:app_no,
                                  agqcrime1_alt:prem_no  = agqcrime1:prem_no,
                                  agqcrime1_alt:build_no = agqcrime1:build_no, Generic

        access agqname, set agqname:app_no = g_app_no, generic

        access agqtotals1, set agqtotals1:app_no = g_app_no, generic

        access agqgeneral1, set agqgeneral1:app_no = g_app_no, generic

        If FUNCTION one of "ADD", "NEW" Then
            Begin
            agqcrime1:COMPANY_ID              = sfsdefault:COMPANY_ID
            agqcrime1:rating_line_of_business = 0008
            agqcrime1:line_of_business        = agqtotals1:line_of_business
            agqcrime1:state                   = sfsdefault:state
            agqcrime1:county                  = agqgeneral1:county
            agqcrime1:company_deviation       = 1.00
            if agqname:package = 1 then
                begin
                do get_package_mod
                agqcrime1:package_Mod         = l_package_mod
                end
            else
                agqcrime1:package_mod         = 1.00
            End
        else
        if function one of "CHANGE", "CHG" then
            begin
            if agqname:package = 1 then
                begin
                do get_package_mod
                agqcrime1:package_Mod         = l_package_mod
                end
            else
                agqcrime1:package_mod         = 1.00
            end
        End
        agqCRIME1:COUNTY/default/tabstop mandatory
        Error 1222 If SFSSTATE_ALIAS:DESCRIPTION = " " or
                      agqcrime1:county = 0

        Activehelp if sfsstate_alias:county <> 0 then
                       SFSSTATE_ALIAS:COUNTY
                   else
                       null/width=3/heading="County",
                   if sfsstate_alias:county <> 0 then
                       SFSSTATE_ALIAS:DESCRIPTION
                   else
                       null/width=30/heading="Description" ;
102     SFSSTATE_ALIAS:DESCRIPTION;
201     begin
        if function one of "ADD", "CHANGE", "NEW", "CHG" then
            begin
            switch(agqcrime1:county)
              case 51     : agqcrime1:terr = 35
              case 2      : agqcrime1:terr = 36
              case 9, 23  : agqcrime1:terr = 91
              case 15, 46 : agqcrime1:terr = 92
              default     : agqcrime1:terr = 999
              end
            end
        end
        agqcrime1:terr/default/tabstop mandatory
        if agqcrime1:terr <> cpsisocrterrhelp:territory_code or
           agqcrime1:terr = 0  then
            error "Invalid Territory Code Entered"

        activehelp CPSISOCRTERRHELP:TERRITORY_CODE,
                   CPSISOCRTERRHELP:DESC ;
202     cpsisocrterrhelp:desc ;

}

carddialog GUI at 13,10 to 24,85
Properties
        {
        layoutconstraints = stretch
        }
{
Panel
Properties
        {
        scrollbarpolicy = asneeded
        text            = "Plan 1"
        }
{
    Panel
           Properties {
                        LayoutType = screen
                        backgroundcolor = "Grey"
                      }
                   {
                     Components
                        guidetext at 2,10 to 2,65 tagged tview1
                             properties
                               {
                                 text = ""
                                 fontsize = 12
                                 fontstyle = BOLD
                                 fontname = "arial"
                                 contentalignment = left
                               }
                             events
                                {
                                mouseclicked {
                                             do show_form_c
                                             }
                                }
                        guidetext at 3,10 to 3,65 tagged tview2
                             properties
                               {
                                 text = ""
                                 fontsize = 12
                                 fontstyle = BOLD
                                 fontname = "arial"
                                 contentalignment = left
                               }
                             events
                                {
                                mouseclicked {
                                             do show_form_d
                                             }
                                }
                        guidetext at 4,10 to 4,65 tagged tview3
                             properties
                               {
                                 text = ""
                                 fontsize = 12
                                 fontstyle = BOLD
                                 fontname = "arial"
                                 contentalignment = left
                               }
                             events
                                {
                                mouseclicked {
                                             do show_form_e
                                             }
                                }
                        guidetext at 5,10 to 5,65 tagged tview4
                             properties
                               {
                                 text = ""
                                 fontsize = 12
                                 fontstyle = BOLD
                                 fontname = "arial"
                                 contentalignment = left
                               }
                             events
                                {
                                mouseclicked {
                                             do show_form_h
                                             }
                                }
                        guidetext at 6,10 to 6,65 tagged tview5
                             properties
                               {
                                 text = ""
                                 fontsize = 12
                                 fontstyle = BOLD
                                 fontname = "arial"
                                 contentalignment = left
                               }
                             events
                                {
                                mouseclicked {
                                             do show_form_q
                                             }
                                }
    }

Panel at 1,60 to 6,65
{
%%

~~~_
~~~_
~~~_
~~~_
~~~_

%%

components

fields
201     begin
            g_state    = agqcrime1:state
            l_option_1 = agqcrime1:option[1]
            l_option_2 = agqcrime1:option[2]
            l_option_3 = agqcrime1:option[3]
            l_option_4 = agqcrime1:option[6]
            l_option_5 = agqcrime1:option[9]
            l_option_6 = agqcrime1:option[10]
            l_option_7 = agqcrime1:option[11]
            l_option_8 = agqcrime1:option[12]
            l_option_9 = agqcrime1:option[14]
            if agqcrime1:option[1] = 1 then
                do display_blue(l_the_tag[1],"blue")
            else
                do remove_blue(l_the_tag[1],"black")
        end
        agqcrime1:option[1]/checkbox/values="0,1"/tabstop ;
301     begin
        if agqcrime1:option[2] = 1 then
            do display_blue(l_the_tag[2],"blue")
        else
            do remove_blue(l_the_tag[2],"black")
        end
        agqcrime1:option[2]/checkbox/values="0,1"/tabstop ;
401     begin
        if agqcrime1:option[3] = 1 then
            do display_blue(l_the_tag[3],"blue")
        else
            do remove_blue(l_the_tag[3],"black")
        end
        agqcrime1:option[3]/checkbox/values="0,1"/tabstop ;
501     begin
        if agqcrime1:option[6] = 1 then
            do display_blue(l_the_tag[4],"blue")
        else
            do remove_blue(l_the_tag[4],"black")
        end
        agqcrime1:option[6]/checkbox/values="0,1"/tabstop ;
601     begin
        if agqcrime1:option[9] = 1 then
            do display_blue(l_the_tag[5],"blue")
        else
            do remove_blue(l_the_tag[5],"black")
        end
        agqcrime1:option[9]/checkbox/values="0,1"/tabstop ;

}

}

Panel
Properties
        {
        scrollbarpolicy = asneeded
        text            = "Other Plans"
        }
{
    Panel
           Properties {
                        LayoutType = screen
                        backgroundcolor = "Grey"
                      }
                   {
                     Components
                        guidetext at 2,10 to 2,65 tagged tview6
                             properties
                               {
                                 text = ""
                                 fontsize = 12
                                 fontstyle = BOLD
                                 fontname = "arial"
                                 contentalignment = left
                               }
                             events
                                {
                                mouseclicked {
                                             do show_form_3
                                             }
                                }
                        guidetext at 3,10 to 3,65 tagged tview7
                             properties
                               {
                                 text = ""
                                 fontsize = 12
                                 fontstyle = BOLD
                                 fontname = "arial"
                                 contentalignment = left
                               }
                             events
                                {
                                mouseclicked {
                                             do show_form_4
                                             }
                                }
                        guidetext at 4,10 to 4,65 tagged tview8
                             properties
                               {
                                 text = ""
                                 fontsize = 12
                                 fontstyle = BOLD
                                 fontname = "arial"
                                 contentalignment = left
                               }
                             events
                                {
                                mouseclicked {
                                             do show_form_5
                                             }
                                }
                        guidetext at 5,10 to 5,65 tagged tview9
                             properties
                               {
                                 text = ""
                                 fontsize = 12
                                 fontstyle = BOLD
                                 fontname = "arial"
                                 contentalignment = left
                               }
                             events
                                {
                                mouseclicked {
                                             do show_form_7
                                             }
                                }
    }

Panel at 1,60 to 6,65
Properties
        {
        scrollbarpolicy = asneeded
        text            = "Other Plans"
        }
{
%%

~~~_
~~~_
~~~_
~~~_

%%

components

fields
201     begin
        if agqcrime1:option[10] = 1 then
            do display_blue(l_the_tag[6],"blue")
        else
            do remove_blue(l_the_tag[6],"black")
        end
        agqcrime1:option[10]/checkbox/values="0,1"/tabstop ;
301     begin
        if agqcrime1:option[11] = 1 then
            do display_blue(l_the_tag[7],"blue")
        else
            do remove_blue(l_the_tag[7],"black")
        end
        agqcrime1:option[11]/checkbox/values="0,1"/tabstop ;
401     begin
        if agqcrime1:option[12] = 1 then
            do display_blue(l_the_tag[8],"blue")
        else
            do remove_blue(l_the_tag[8],"black")
        end
        agqcrime1:option[12]/checkbox/values="0,1"/tabstop ;
501     begin
        if agqcrime1:option[14] = 1 then
            do display_blue(l_the_tag[9],"blue")
        else
            do remove_blue(l_the_tag[9],"black")
        end
        agqcrime1:option[14]/checkbox/values="0,1"/tabstop ;

}

}

}

-- draw a line
panel at 25,1 to 25,100 tagged line_panel_1
    {
    Components
        line at 1,1 to 1,120
            Properties {
                       Linestyle = embossed
                       Linewidth = 5
                       foregroundcolor = "black"
                       }
    }

Panel at 26,5 to 26,100 Tagged optional_info_fn
Properties
        {
        LayoutType = screen
        }
{
Components

        Button at 1,30    tagged optional_info_fn
        Properties {
                Iconname = "btn_opt_endt.bmp"
                }
        Events  {
                action {
                       if agqcrime1:county = 0 then
                           begin
                           warning "You must enter the county and territory, then click accept edits"
                           access agqcrime1_alias, set agqcrime1_alias:app_no = g_app_no, generic

                           if agqcrime1_alias:app_no <> g_app_no then
                               begin
                               function = "ADD"
                               abort()
                               end
                            else
                                begin
                                function = "CHANGE"
                                abort()
                                end
                            end
                       else
                           begin
                           function = "opt"
                           abort()
                           end

                       }
                }

        }

}

-- draw a line
panel at 27,1 to 27,100 tagged line_panel_1
    {
    Components
        line at 1,1 to 1,120
            Properties {
                       Linestyle = embossed
                       Linewidth = 5
                       foregroundcolor = "black"
                       }
    }

Panel at 28,1 to 28,100 Tagged icon_line2_tg
Properties {
           LayoutType = screen
           }
{
Components
    Button at 1,5   tagged back_fn
        Properties {
                   Iconname = "btn_premium_summary.bmp"
                   }
        Events     {
                   Action {
                          function = "back"
                          abort()
                          }
                    }

    Button at 1,36    tagged previous_fn
        Properties {
                   Iconname = "btn_prev_loc.bmp"
                   }
        Events     {
                   Action = previous_fn
                   }

    Button at 1, 51 tagged next_fn
        Properties {
                   Iconname = "btn_next_loc.bmp"
                   }
        Events     {
                   Action = next_fn
                   }


}

Update
if UPDATEOK = "NO" then
    begin
    disable(accept_fn)
    enable(back_fn)
    end

If UPDATEOK = "YES" And
   Abort = "NO" Then
    Begin
    disable(accept_fn)
    enable(back_fn)
    if function one of "DELETE" then
        begin
        access agqcrime1_alias, set agqcrime1_alias:app_no = g_app_no, generic

        access agqend, set agqend:app_no = g_app_no, generic

        while agqend:app_no = g_app_no
            begin
            if agqend:lob_end_code = "C" then
                begin
                if agqcrime1_alias:app_no <> g_app_no then
                    delete agqend
                else
                if agqend:prem_no = agqcrime1:prem_no and
                   agqend:build_no = agqcrime1:build_no then
                    delete agqend
                end

            next agqend
            end

        end

    if function one of "CHANGE", "CHG" then
        begin
        l_crime_form = "C"
        if agqcrime1:option[1] = 0 then
            do delete_agqisocrime
        l_crime_form = "D"
        if agqcrime1:option[2] = 0 then
            do delete_agqisocrime
        l_crime_form = "E"
        if agqcrime1:option[3] = 0 then
            do delete_agqisocrime
        l_crime_form = "H"
        if agqcrime1:option[6] = 0 then
            do delete_agqisocrime
        l_crime_form = "Q"
        if agqcrime1:option[9] = 0 then
            do delete_agqisocrime
        l_crime_form = "3"
        if agqcrime1:option[10] = 0 then
            do delete_agqisocrime
        l_crime_form = "4"
        if agqcrime1:option[11] = 0 then
            do delete_agqisocrime
        l_crime_form = "5"
        if agqcrime1:option[12] = 0 then
            do delete_agqisocrime
        l_crime_form = "7"
        if agqcrime1:option[14] = 0 then
            do delete_agqisocrime
        end

    if function one of "DELETE" then
        begin
        access agqend, set agqend:app_no = agqcrime1:app_no,
                           agqend:prem_no  = agqcrime1:prem_no,
                           agqend:build_no = agqcrime1:build_no, generic

        while agqend:app_no = agqcrime1:app_no and
              agqend:prem_no  = agqcrime1:prem_no and
              agqend:build_no = agqcrime1:build_no
                begin
                if agqend:lob_end_code = "C" then
                    delete agqend

                next agqend
                end

        access agqisocrime, set agqisocrime:app_no = agqcrime1:app_no,
                                agqisocrime:prem_no  = agqcrime1:prem_no,
                                agqisocrime:build_no = agqcrime1:build_no, generic

        while agqisocrime:app_no = agqcrime1:app_no and
              agqisocrime:prem_no  = agqcrime1:prem_no and
              agqisocrime:build_no = agqcrime1:build_no
                begin
                delete agqisocrime

                next agqisocrime
                end
        end

    if function one of "ADD", "NEW", "CHG", "CHANGE" then
        begin
        g_state = agqcrime1:state
        Access cpscrtrigger, Set cpscrtrigger:COMPANY_ID       = agqcrime1:COMPANY_ID,
                                 cpscrtrigger:STATE            = agqcrime1:STATE,
                                 cpscrtrigger:LINE_OF_BUSINESS = agqcrime1:rating_LINE_OF_BUSINESS, Generic

        While cpscrtrigger:COMPANY_ID       = agqcrime1:COMPANY_ID And
              cpscrtrigger:STATE            = agqcrime1:STATE And
              cpscrtrigger:LINE_OF_BUSINESS = agqcrime1:rating_LINE_OF_BUSINESS
                Begin
                If (agqNAME:EFF_DATE >= cpscrtrigger:EFF_DATE and
                   (agqname:eff_date <= cpscrtrigger:exp_date or
                   cpscrtrigger:exp_date = 0)) Then
                    Begin
                    l_code_1  = cpscrtrigger:trigger_endorsement[1]    -- Form C
                    l_code_2  = cpscrtrigger:trigger_endorsement[2]    -- Form D
                    l_code_3  = cpscrtrigger:trigger_endorsement[3]    -- Form E
                    l_code_4  = cpscrtrigger:trigger_endorsement[4]    -- Form F
                    l_code_5  = cpscrtrigger:trigger_endorsement[5]    -- Form G
                    l_code_6  = cpscrtrigger:trigger_endorsement[6]    -- Form H
                    l_code_7  = cpscrtrigger:trigger_endorsement[7]    -- Form I
                    l_code_8  = cpscrtrigger:trigger_endorsement[8]    -- Form J
                    l_code_9  = cpscrtrigger:trigger_endorsement[9]    -- Form Q
                    l_code_10 = cpscrtrigger:trigger_endorsement[10]   -- Plan 3
                    l_code_11 = cpscrtrigger:trigger_endorsement[11]   -- Plan 4
                    l_code_12 = cpscrtrigger:trigger_endorsement[12]   -- Plan 5
                    l_code_13 = cpscrtrigger:trigger_endorsement[13]   -- Plan 6
                    l_code_14 = cpscrtrigger:trigger_endorsement[14]   -- Plan 7
                    l_code_15 = cpscrtrigger:trigger_endorsement[15]   -- Plan 8
                    l_code_16 = cpscrtrigger:trigger_endorsement[16]   -- Plan 9
                    l_code_17 = cpscrtrigger:trigger_endorsement[17]   -- Plan 10
                    l_code_20 = cpscrtrigger:trigger_endorsement[20]   -- lmc
                    End

                Next cpscrtrigger
                End

        if l_code_1 <> "" then
            begin
            l_code = l_code_1
            do access_agqend
            if l_add_endorsement = "Y" and
               agqcrime1:option[1] = 1 then
                do add_agqend
            if l_add_endorsement = "N" and
               agqcrime1:option[1] = 0 then
                do delete_agqend
            end

        if l_code_2 <> "" then
            begin
            l_code = l_code_2
            do access_agqend
            if l_add_endorsement = "Y" and
               agqcrime1:option[2] = 1 then
                do add_agqend
            if l_add_endorsement = "N" and
               agqcrime1:option[2] = 0 then
                do delete_agqend
            end

        if l_code_3 <> "" then
            begin
            l_code = l_code_3
            do access_agqend
            if l_add_endorsement = "Y" and
               agqcrime1:option[3] = 1 then
                do add_agqend
            if l_add_endorsement = "N" and
               agqcrime1:option[3] = 0 then
                do delete_agqend
            end

        if l_code_11 <> "" then
            begin
            l_code = l_code_11
            do access_agqend
            if l_add_endorsement = "Y" and
               agqcrime1:option[11] = 1 then
                do add_agqend
            if l_add_endorsement = "N" and
               agqcrime1:option[11] = 0 then
                do delete_agqend
            end

        if ((agqcrime1:option[1] = 1 and
           function one of "ADD", "NEW") or
           (agqcrime1:option[1] = 1 and
           l_option_1 = 0 and
           function one of "CHG", "CHANGE")) then
            begin
            g_code  = l_code_1
            g_crime_form = "C"
            g_sub_code = agqcrime1:sub_code
            g_prem_no = agqcrime1:prem_no
            g_build_no = agqcrime1:build_no
            g_state = agqcrime1:state
            display modal screen "agtmt8003c"
            with initial function "ADD"
            end
        if ((agqcrime1:option[2] = 1 and
           function one of "ADD", "NEW") or
           (agqcrime1:option[2] = 1 and
           l_option_2 = 0 and
           function one of "CHG", "CHANGE")) then
            begin
            g_code  = l_code_2
            g_sub_code = agqcrime1:sub_code
            g_prem_no = agqcrime1:prem_no
            g_build_no = agqcrime1:build_no
            g_crime_form = "D"
            g_state = agqcrime1:state
            display modal screen "agtmt8003d"
            with initial function "ADD"
            end
        if ((agqcrime1:option[3] = 1 and
           function one of "ADD", "NEW") or
           (agqcrime1:option[3] = 1 and
           l_option_3 = 0 and
           function one of "CHG", "CHANGE")) then
            begin
            g_code  = l_code_3
            g_sub_code = agqcrime1:sub_code
            g_crime_form = "E"
            g_prem_no = agqcrime1:prem_no
            g_build_no = agqcrime1:build_no
            g_state = agqcrime1:state
            display modal screen "agtmt8003e"
            with initial function "ADD"
            end
        if ((agqcrime1:option[6] = 1 and
           function one of "ADD", "NEW") or
           (agqcrime1:option[6] = 1 and
           l_option_4 = 0 and
           function one of "CHG", "CHANGE")) then
            begin
            g_code  = l_code_6
            g_sub_code = agqcrime1:sub_code
            g_prem_no = agqcrime1:prem_no
            g_build_no = agqcrime1:build_no
            g_crime_form = "H"
            g_state = agqcrime1:state
            display modal screen "agtmt8003h"
            with initial function "ADD"
            end
        if ((agqcrime1:option[9] = 1 and
           function one of "ADD", "NEW") or
           (agqcrime1:option[9] = 1 and
           l_option_5 = 0 and
           function one of "CHG", "CHANGE")) then
            begin
            g_code  = l_code_9
            g_sub_code = agqcrime1:sub_code
            g_prem_no = agqcrime1:prem_no
            g_build_no = agqcrime1:build_no
            g_crime_form = "Q"
            g_state = agqcrime1:state
            display modal screen "agtmt8003q"
            with initial function "ADD"
            end
        if ((agqcrime1:option[10] = 1 and
           function one of "ADD", "NEW") or
           (agqcrime1:option[10] = 1 and
           l_option_6 = 0 and
           function one of "CHG", "CHANGE")) then
            begin
            g_code  = l_code_10
            g_sub_code = agqcrime1:sub_code
            g_prem_no = agqcrime1:prem_no
            g_build_no = agqcrime1:build_no
            g_crime_form = "3"
            g_state = agqcrime1:state
            display modal screen "agtmt80033"
            with initial function "ADD"
            end
        if ((agqcrime1:option[11] = 1 and
           function one of "ADD", "NEW") or
           (agqcrime1:option[11] = 1 and
           l_option_7 = 0 and
           function one of "CHG", "CHANGE")) then
            begin
            g_code  = l_code_11
            g_sub_code = agqcrime1:sub_code
            g_crime_form = "4"
            g_prem_no = agqcrime1:prem_no
            g_build_no = agqcrime1:build_no
            g_state = agqcrime1:state
            display modal screen "agtmt80034"
            with initial function "ADD"
            end
        if ((agqcrime1:option[12] = 1 and
           function one of "ADD", "NEW") or
           (agqcrime1:option[12] = 1 and
           l_option_8 = 0 and
           function one of "CHG", "CHANGE")) then
            begin
            g_code  = l_code_12
            g_sub_code = agqcrime1:sub_code
            g_crime_form = "5"
            g_prem_no = agqcrime1:prem_no
            g_build_no = agqcrime1:build_no
            g_state = agqcrime1:state
            display modal screen "agtmt80035"
            with initial function "ADD"
            end
        if ((agqcrime1:option[14] = 1 and
           function one of "ADD", "NEW") or
           (agqcrime1:option[14] = 1 and
           l_option_9 = 0 and
           function one of "CHG", "CHANGE")) then
            begin
            g_code  = l_code_14
            g_sub_code = agqcrime1:sub_code
            g_crime_form = "7"
            g_prem_no = agqcrime1:prem_no
            g_build_no = agqcrime1:build_no
            g_state = agqcrime1:state
            display modal screen "agtmt80037"
            with initial function "ADD"
            end

        If L_CODE_20 <> "" Then
            Begin
            L_CODE = L_CODE_20
            Do ACCESS_agqEND
            If L_ADD_ENDORSEMENT = "Y" And
               agqname:bill_plan = "DB" Then
                Do ADD_agqEND
            If L_ADD_ENDORSEMENT = "N" And
               agqname:bill_plan not one of "DB" Then
                Do DELETE_agqEND
            End

        end

    function = "redisplay"
    End

screen exit
if g_app_no = 0 then
    g_app_no = agqcrime1:app_no
g_prem_no   = agqcrime1:prem_no
g_build_no  = agqcrime1:build_no

Procedure Definition

procedure display_blue(tag l_tag, string l_color)
begin
    setproperty(l_tag,foregroundcolor,l_color)
end

procedure remove_blue(tag l_tag, string l_color)
begin
    setproperty(l_tag,foregroundcolor,l_color)
end

procedure set_display
begin
l_loop = 1
while l_loop <= 9
    begin
    l_literal[1] = "Theft, Disappearance and Destruction - (C):"
    l_literal[2] = "Robbery and Safe Burglary (Other than Money and Securities) - (D):"
    l_literal[3] = "Premises Burglary - (E):"
    l_literal[4] = "Premises Theft and Robbery Outside the Premises - (H):"
    l_literal[5] = "Robbery and Safe Burglary - Money and Securities - (Q):"
    l_literal[6] = "Storekeepers Broad Form - (Plan 3):"
    l_literal[7] = "Storekeepers Burglary and Robbery - (Plan 4):"
    l_literal[8] = "Office Burglary and Robbery - (Plan 5):"
    l_literal[9] = "Guests' Property - Premises - (Plan 7):"
    l_tag_position = l_loop
    l_the_tag[l_loop] = tag("tview" + trun(str(l_loop)))
    do printguidetext(l_the_tag[l_tag_position],trun(l_literal[l_tag_position]))

    l_loop = l_loop + 1
    end

end

procedure printguidetext(tag current_tag, string display_string)
BEGIN
    Setproperty(current_tag, text, display_string)
END

Procedure show_form_c
begin
if agqcrime1:option[1] = 1 then
    begin
    g_app_no     = agqcrime1:app_no
    g_prem_no    = agqcrime1:prem_no
    g_build_no   = agqcrime1:build_no
    g_crime_form = "C"
    display modal screen "agtmt8003c"
    end

end

Procedure show_form_d
begin
if agqcrime1:option[2] = 1 then
    begin
    g_app_no     = agqcrime1:app_no
    g_prem_no    = agqcrime1:prem_no
    g_build_no   = agqcrime1:build_no
    g_crime_form = "D"
    display modal screen "agtmt8003d"
    end

end

Procedure show_form_e
begin
if agqcrime1:option[3] = 1 then
    begin
    g_app_no     = agqcrime1:app_no
    g_prem_no    = agqcrime1:prem_no
    g_build_no   = agqcrime1:build_no
    g_crime_form = "E"
    display modal screen "agtmt8003e"
    end

end

Procedure show_form_h
begin
if agqcrime1:option[6] = 1 then
    begin
    g_app_no     = agqcrime1:app_no
    g_prem_no    = agqcrime1:prem_no
    g_build_no   = agqcrime1:build_no
    g_crime_form = "H"
    display modal screen "agtmt8003h"
    end

end

Procedure show_form_q
begin
if agqcrime1:option[9] = 1 then
    begin
    g_app_no     = agqcrime1:app_no
    g_prem_no    = agqcrime1:prem_no
    g_build_no   = agqcrime1:build_no
    g_crime_form = "Q"
    display modal screen "agtmt8003q"
    end

end

Procedure show_form_3
begin
if agqcrime1:option[10] = 1 then
    begin
    g_app_no     = agqcrime1:app_no
    g_prem_no    = agqcrime1:prem_no
    g_build_no   = agqcrime1:build_no
    g_crime_form = "3"
    display modal screen "agtmt80033"
    end

end

Procedure show_form_4
begin
if agqcrime1:option[11] = 1 then
    begin
    g_app_no     = agqcrime1:app_no
    g_prem_no    = agqcrime1:prem_no
    g_build_no   = agqcrime1:build_no
    g_crime_form = "4"
    display modal screen "agtmt80034"
    end

end

Procedure show_form_5
begin
if agqcrime1:option[12] = 1 then
    begin
    g_app_no     = agqcrime1:app_no
    g_prem_no    = agqcrime1:prem_no
    g_build_no   = agqcrime1:build_no
    g_crime_form = "5"
    display modal screen "agtmt80035"
    end

end

Procedure show_form_7
begin
if agqcrime1:option[14] = 1 then
    begin
    g_app_no     = agqcrime1:app_no
    g_prem_no    = agqcrime1:prem_no
    g_build_no   = agqcrime1:build_no
    g_crime_form = "7"
    display modal screen "agtmt80037"
    end

end

procedure get_package_mod
begin
access agqgeneral1, set agqgeneral1:app_no = g_app_no, generic

l_type = agqgeneral1:type
access cpsisopackage, set cpsisopackage:company_id       = agqcrime1:company_id,
                          cpsisopackage:state            = agqcrime1:state,
                          cpsisopackage:line_of_business = agqcrime1:rating_line_of_business,
                          cpsisopackage:type             = l_type, generic

l_package_mod = 0
while cpsisopackage:company_id       = agqcrime1:company_id and
      cpsisopackage:state            = agqcrime1:state and
      cpsisopackage:line_of_business = agqcrime1:rating_line_of_business and
      cpsisopackage:type             = l_type
        begin
        if (agqname:eff_date >= cpsisopackage:eff_date and
           (agqname:eff_date <= cpsisopackage:exp_date or
           cpsisopackage:exp_date = 0)) then
            begin
            l_package_mod = cpsisopackage:package_mod[2]

            end

        next cpsisopackage
        end

if l_package_mod = 0 then
    l_package_mod = 1.00
end

procedure delete_agqisocrime
begin
access agqisocrime, set agqisocrime:app_no   = g_app_no,
                        agqisocrime:prem_no    = agqcrime1:prem_no,
                        agqisocrime:build_no   = agqcrime1:build_no,
                        agqisocrime:crime_form = l_crime_form, generic

while agqisocrime:app_no   = g_app_no and
      agqisocrime:prem_no    = agqcrime1:prem_no and
      agqisocrime:build_no   = agqcrime1:build_no and
      agqisocrime:crime_form = l_crime_form
       begin
       delete agqisocrime

       next agqisocrime
       end

end

procedure access_cpscrtrigger
begin
g_state = agqcrime1:state
Access cpscrtrigger, Set cpscrtrigger:COMPANY_ID       = agqNAME:COMPANY_ID,
                         cpscrtrigger:STATE            = agqcrime1:STATE,
                         cpscrtrigger:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS, Generic

While cpscrtrigger:COMPANY_ID       = agqNAME:COMPANY_ID And
      cpscrtrigger:STATE            = agqcrime1:STATE And
      cpscrtrigger:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS
        Begin
        If (agqNAME:EFF_DATE >= cpscrtrigger:EFF_DATE and
           (agqname:eff_date <= cpscrtrigger:exp_date or
           cpscrtrigger:exp_date = 0)) Then
            Begin
            l_code_1  = cpscrtrigger:trigger_endorsement[1]    -- Form C
            l_code_2  = cpscrtrigger:trigger_endorsement[2]    -- Form D
            l_code_3  = cpscrtrigger:trigger_endorsement[3]    -- Form E
            l_code_4  = cpscrtrigger:trigger_endorsement[4]    -- Form F
            l_code_5  = cpscrtrigger:trigger_endorsement[5]    -- Form G
            l_code_6  = cpscrtrigger:trigger_endorsement[6]    -- Form H
            l_code_7  = cpscrtrigger:trigger_endorsement[7]    -- Form I
            l_code_8  = cpscrtrigger:trigger_endorsement[8]    -- Form J
            l_code_9  = cpscrtrigger:trigger_endorsement[9]    -- Form Q
            l_code_10 = cpscrtrigger:trigger_endorsement[10]   -- Plan 3
            l_code_11 = cpscrtrigger:trigger_endorsement[11]   -- Plan 4
            l_code_12 = cpscrtrigger:trigger_endorsement[12]   -- Plan 5
            l_code_13 = cpscrtrigger:trigger_endorsement[13]   -- Plan 6
            l_code_14 = cpscrtrigger:trigger_endorsement[14]   -- Plan 7
            l_code_15 = cpscrtrigger:trigger_endorsement[15]   -- Plan 8
            l_code_16 = cpscrtrigger:trigger_endorsement[16]   -- Plan 9
            l_code_17 = cpscrtrigger:trigger_endorsement[17]   -- Plan 10
            End

        Next cpscrtrigger
        End

end

Procedure ACCESS_agqEND
Begin
Access agqEND, Set agqEND:app_no   = agqcrime1:app_no ,
                   agqEND:PREM_NO  = agqcrime1:prem_no,
                   agqEND:BUILD_NO = agqcrime1:build_no, Generic

L_ADD_ENDORSEMENT = "Y"
l_add = "Y"
while agqEND:app_no   = agqcrime1:app_no and
      agqEND:PREM_NO  = agqcrime1:prem_no and
      agqEND:BUILD_NO = agqcrime1:build_no
    begin
    l_add = "N"
    If agqEND:CODE = L_CODE Then
        L_ADD_ENDORSEMENT = "N"

    Next agqEND
    End

End

Procedure ADD_agqEND
Begin
Access agqEND, Set agqEND:app_no = agqcrime1:app_no ,
                   agqEND:PREM_NO  = agqcrime1:prem_no,
                   agqEND:BUILD_NO = agqcrime1:build_no, Generic

L_SUB_CODE = 0
while agqEND:app_no = agqcrime1:app_no and
      agqEND:PREM_NO  = agqcrime1:prem_no and
      agqEND:BUILD_NO = agqcrime1:build_no
    begin
    L_SUB_CODE = agqEND:SUB_CODE

    Next agqEND
    End

L_SUB_CODE = L_SUB_CODE + 10
Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID       = agqcrime1:COMPANY_ID,
                      SFSOPTEND:STATE            = agqcrime1:STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = agqcrime1:rating_LINE_OF_BUSINESS,
                      SFSOPTEND:CODE             = L_CODE, Generic

while SFSOPTEND:COMPANY_ID       = agqcrime1:COMPANY_ID and
      SFSOPTEND:STATE            = agqcrime1:STATE and
      SFSOPTEND:LINE_OF_BUSINESS = agqcrime1:rating_LINE_OF_BUSINESS and
      SFSOPTEND:CODE             = L_CODE
    begin
    If (agqNAME:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqname:eff_date <= sfsoptend:exp_date or
       sfsoptend:exp_date = 0)) Then
        Begin
        L_FORM_EDITION = SFSOPTEND:FORM_EDITION
        L_DESCRIPTION  = SFSOPTEND:DESCRIPTION
        End

    Next SFSOPTEND
    End

Add agqEND
    Begin
    agqEND:app_no               =       agqcrime1:app_no
    agqEND:PREM_NO              =       agqcrime1:prem_no
    agqEND:BUILD_NO             =       agqcrime1:build_no
    agqEND:SUB_CODE             =       L_SUB_CODE
    agqEND:CODE                 =       L_CODE
    agqEND:FORM_EDITION         =       L_FORM_EDITION
    agqEND:LOB_END_CODE         =       "C"
    agqEND:DESCRIPTION          =       L_DESCRIPTION
    agqEND:PREMIUM              =       0
    End

End

Procedure DELETE_agqEND
Begin
Access agqEND, Set agqEND:app_no = agqcrime1:app_no ,
                   agqEND:PREM_NO  = agqcrime1:prem_no,
                   agqEND:BUILD_NO = agqcrime1:build_no, Generic

while agqEND:app_no = agqcrime1:app_no and
      agqEND:PREM_NO  = agqcrime1:prem_no and
      agqEND:BUILD_NO = agqcrime1:build_no
    begin
    If agqEND:CODE = L_CODE Then
        Delete agqEND

    Next agqEND
    End

end

End
