%%                      
Screen
        Name = "agtmt701";
        Type = "Detail" ;
        Highlight=Underscore ;
        highlightfield="Yes";
        Padcharacter=Space ;
        Screensize="dynamic";
        Windowtitle="%a     %s Rating Information - Ver. 7.00     %m";
        Domain="agqcontractor" ;
        resizeable = yes ;
        iconline = 0 ;

        Global Unsigned Ascii Number G_APP_NO[11] ;
        Global Unsigned Ascii Number G_LINE_OF_BUSINESS[4] ;
        Global Unsigned Ascii Number G_OPT[2] ;
        global unsigned ascii number g_add_prem_no[1] ;
        global unsigned ascii number g_add_build_no[1] ;
        global unsigned ascii number g_add_new_quote[1] ;
        global unsigned ascii number g_prem_no[4] ;
        global unsigned ascii number g_build_no[4];
        global unsigned ascii number g_from_search_screen[1] ;
        global unsigned ascii number g_enhancement[1] ;
        global unsigned ascii number g_form[1] ;
        global unsigned ascii number g_waive[1] ;
        global unsigned ascii number g_class_code[5] ;

        global string g_company_id[10] ,
                      g_initial_screen[50] ,
                      g_zipcode_change[1] ,
                      g_ok_to_add[1] ;

        rwdate l_agqcontractor_eff_date;
        wdate  l_rich_date;

        array[10] of string l_view_desc[85] ;
        array[10] of tag l_the_tag[15] ;

        Local Unsigned Ascii Number L_SUB_CODE[4] ,
                                    L_STATE[2],
                                    l_special_exposure_factor[5]=0/dec=3,
                                    l_first_prem_no[4],
                                    l_first_build_no[4],
                                    l_val_zipcode[5],
                                    l_zipcode_5[5],
                                    l_restricted[1],
                                    l_no_owners[2],
                                    l_full_time[2],
                                    l_part_time[2],
                                    l_restricted_distance[5]=0/dec=2,
                                    l_tier[2]=0,
                                    l_last_prem_no[4],
                                    l_last_build_no[4],
                                    l_agent_no[4],
                                    l_county[3],
                                    l_app_no[11],
                                    l_rating_territory[3],
                                    l_loop[4],
                                    l_exclude_terrorism[1]=0,
                                    l_prem_no[4]=0,
                                    l_first_bold_one[1]=0,
                                    l_second_bold_one[1]=0,
                                    l_no_locations[2]=0,
                                    l_distance_to_shore[2],
                                    l_prior_distance_to_shore[2],
                                    l_build_no[4]=0,
                                    l_off_premises_limit[8]=0,
                                    l_mcp140_limit[8],
                                    l_mm[2],
                                    l_signs_limit[5],
                                    l_valuable_papers_limit[5],
                                    l_water_limit[5],
                                    l_credit_card_limit[5],
                                    l_yyyy[4],
                                    l_dd[2],
                                    l_territory[3],
                                    l_minimum_limit[8],
                                    l_maximum_limit[8],
                                    l_zipcode[9],
                                    l_building_minimum_limit[8],
                                    l_contents_minimum_limit[8],
                                    l_combined_minimum_limit[8],
                                    l_building_maximum_limit[8],
                                    l_contents_maximum_limit[8],
                                    l_combined_maximum_limit[8],
                                    l_building_binding_limit[8],
                                    l_contents_binding_limit[8],
                                    l_combined_binding_limit[8],
                                    l_min_error[1],
                                    l_sub[2],
                                    l_sub_1[5],
                                    l_field_no[4]=0,
                                    l_tag_position[2]=0,
                                    l_len_string[5]=0,
                                    l_max_error[1],
                                    l_binding_error[1],
                                    l_combined_limit[8]=0,
                                    l_rating_territory_group_1[1],
                                    l_rating_territory_group_2[1],
                                    l_rating_territory_group_3[1],
                                    L_CLASS_CODE[5],
                                    l_restaurant[1],
                                    l_year[4],
                                    l_end_sequence[4],
                                    L_PROPERTY_LIMIT[8]=0,
                                    l_property_limit_1[8]=0,
                                    L_LINE_OF_BUSINESS[2] ,
                                    L_AR_LIMIT[8],
                                    L_COMPUTER_LIMIT[8],
                                    l_computer_limit_1[8],
                                    l_computer_limit_2[8],
                                    l_abort_program[1],
                                    L_UTILITY_LIMIT[8],
                                    L_MECHANICAL_LIMIT[8],
                                    L_EXTERIOR_SIGNS_LIMIT[8],
                                    L_EMPLOYEE_LIMIT[8],
                                    L_GLASS_LIMIT[8],
                                    L_SEWER_LIMIT[8],
                                    L_VALUABLE_LIMIT[8],
                                    L_FORM[1] ,
                                    l_fire_alarm[1],
                                    l_burglar_alarm[1],
                                    i_csexec_number[12],
                                    l_csexec_number[12],
                                    L_COVERAGE_A[8],
                                    L_COVERAGE_B[8],
                                    L_COVERAGE_C[8],
                                    L_COVERAGE_D[8] ,
                                    l_group_1[4]/dec=3,
                                    l_group_2[4]/dec=4,
                                    l_deductible[5]=0,
                                    l_tool_limit[5]=0,
                                    l_tool_per[5]=0,
                                    L_limit_1[8]=0,
                                    l_limit_2[8]=0,
                                    l_Form_1[1] ;

        Local String L_DESC[50] ,
                     L_REINSURANCE[1] ,
                     l_special_exposure[17]="Special Exposure:",
                     l_mcl156_desc_1[75]="",
                     l_mcl156_desc_2[75]="",
                     l_mcl156_desc_3[75]="",
                     l_mcl156_desc_4[75]="",
                     l_mcl156_desc_5[75]="",
                     l_lob_code[10],
                     l_sub_line[2],
                     l_zip_code_5[5],
                     l_screen_name[15],
                     l_agent_wording[9]="Agent No:",
                     l_fob[1],
                     l_fob_desc[50],
                     l_fob_description[50],
                     l_fob_description1[75],
                     l_form_of_business[1],
                     l_text_1[85],
                     l_text_2[85],
                     l_server_name[100],
                     l_current_web_page[50],
                     l_web_site_address[150],
                     l_first_bold[1]="Y",
                     l_last_bold[1]="N",
                     l_first_str_location[8],
                     l_last_str_location[8],
                     l_str_location[8],
                     i_csexec_application[25] ,
                     l_first_location[1]="Y",
                     l_string_view[15],
                     l_printers_credit_wording[23]="Printers Credit:",
                     l_total_printers_wording[23]="Total Printers:",
                     l_first[1],
                     l_str_zipcode[9]="",
                     l_buyback_option_wording[23]="Buyback Option Charge:",
                     l_fungi_mold_wording[23]="Fungi/Mold Limitations:",
                     l_irpm_wording[12]="IRPM:",
                     l_enter[1],
                     l_minimum_message[200],
                     l_combined_minimum_message[200],
                     l_maximum_message[200],
                     l_combined_maximum_message[200],
                     l_binding_message[200],
                     l_combined_binding_message[200],
                     l_contact_message[200],
                     l_mp_wording[4]="M.P.",
                     l_continue_1[2]="",
                     l_continue_2[3]="",
                     l_continue_3[3]="",
                     l_dec[15]="",
                     l_app[3]="agq",
                     L_CODE[7],
                     L_CODE_1[7],
                     L_CODE_2[7],
                     L_CODE_3[7],
                     L_CODE_4[7],
                     L_CODE_5[7],
                     L_CODE_6[7],
                     L_CODE_7[7],
                     L_CODE_8[7],
                     l_code_9[7],
                     l_code_10[7],
                     l_code_11[7],
                     l_code_12[7],
                     l_code_13[7],
                     l_code_14[7],
                     l_code_20[7],
                     l_csexec_application[25],
                     l_processing_system[30],
                     l_rating_system[40],
                     l_territory_wording[10]="Territory:",
                     l_system_id[15],
                     L_SCREEN[15] ,
                     l_screen_1[9],
                     L_FORM_EDITION[18],
                     L_DESCRIPTION[55],
                     L_COMPUTER_DESC[50] ,
                     l_computer_desc_1[50],
                     L_DELETE_NONOWNED_HIRED[1]="N",
                     L_ADD_ENDORSEMENT[1]="Y",
                     L_PROPERTY_LIMIT_CHANGE[1]="N",
                     l_agqcontractor_str[10],
                     L_COMPANY_ID[10] ;

        local wdate l_eff_date ,
                    l_bpssupplemental_eff_date ;

        include "print.var"

        include "virtualdecs.var"

        Access agqcontractor,
           Set agqcontractor:app_no = G_app_no, generic

        Include "stdkeys7.inc"

Style Definition
        Include "styles.inc"
        Displayonly Field Style {
                                  backgroundcolor="#CCCCCC"
                                }


Functions

        "redisplay" display/noreturn "agtmt701" ;

--        "add" sequence "new"      tagged add_fn ;
--        "new" add/hidden ;

        add tagged add_fn ;
        "change" sequence "chg"   tagged change_fn ;
        "chg" change/hidden ;

        "nextscreen" display "agtmt701a"  tagged nextscreen_fn ;

        "func1" display "agtmt702"   tagged calc_fn ;

        "back" display/noreturn "agtmt001" tagged back_fn;

        reaccess ;

        include "stdfunc7b.inc"

EVENT DEFINITION
        default eventhandler {
                             "REMOVE_SCREEN" { function = "exit" abort () }
                             "reload" { function = "reaccess" abort () }
                             "display_message" { warning "" + event.value }
                             "current_line_of_business" {
                                                          g_line_of_business = val(event.value)
                                                        }
                             }
Menu Definition

Toolbar Definition

Screen Entry
disable(accept_fn)
access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

g_initial_screen = ""
l_username = username
l_company_id = sfsdefault:company_id

access sfsprofile,
   set sfsprofile:user_id  = l_username, exact

If SFSPROFILE:USER_ID <> L_USERNAME Then
  Begin
    L_USERNAME = "default"
    Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact
  End

l_server_name = sfsprofile:UNIX_SERVER                            --"http://192.168.1.197/"

l_username = username
access sfsemail, set sfsemail:company_id = l_company_id,
                     sfsemail:user_id    = l_username, generic

access sfsagent, set sfsagent:company_id = l_company_id,
                     sfsagent:agent_no   = sfsemail:agent_no, generic

access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

switch(g_form)
  case 4  : setproperty(t_line_of_business,iconname,"title_sc_liability_only.bmp")
  default : setproperty(t_line_of_business,iconname,"title_sc_liability_property.bmp")
  end

Access SFSLINE_ALIAS, Set SFSLINE_alias:COMPANY_ID       = l_company_id,
                          SFSLINE_alias:LINE_OF_BUSINESS = g_line_of_business,
                          SFSLINE_alias:LOB_SUBLINE      = "00", Generic

Access SFSLINE, Set SFSLINE:COMPANY_ID       = l_company_id,
                    SFSLINE:LINE_OF_BUSINESS = g_line_of_business,
                    SFSLINE:LOB_SUBLINE      = "00", Generic

access agqcontractor,
   set agqcontractor:app_no = g_app_no, generic

/*if l_company_id = "FLEMINGTON" then
    begin
    if agqcontractor:app_no = 0 then
        {
        l_current_web_page = "webhelp_scr_bop_rating_no_proposal_num.htm"
        do change_current_browser(l_server_name,l_current_web_page)
        }
    else
        {
        l_current_web_page = "webhelp_scr_bop_rating_yes_proposal_num.htm"
        do change_current_browser(l_server_name,l_current_web_page)
        }
    end*/

access agqname, set agqname:app_no = g_app_no,generic

if agqname:quote_no <> 0 then
    begin
    disable(add_fn)
    disable(change_fn)
    disable(delete_fn)
    disable(accept_fn)
    end

if agqcontractor:app_no = 0 then
    begin
    disable(previous_fn)
    disable(next_fn)
    end

access sfscompany, set sfscompany:company_id = l_company_id, generic

l_screen_name = "agtmt701"
if g_app_no = 0 then
    l_field_no = 9997
else
    l_field_no = 9999

if g_ok_to_add = "Y" then
    begin
    function = "ADD"
    end

if function one of "ADD", "NEW" then
    begin
    if g_form = 4 or
       agqcontractor:form = 4 then
        begin
        hide(property_fn)
        end
    else
        begin
        show(property_fn)
        end
    end

if sfscompany:company_id = "FLEMINGTON" then
    hide(farmers_fn)
else
if sfscompany:company_id = "FARMERS" then
    hide(ficof_fn)
else
    begin
    hide(farmers_fn)
    hide(ficof_fn)
    end

--if function one of "REDISPLAY", "DISPLAYIT", "FUNC5", "DISPLAY_RATING_INFO" then
--    begin
    if g_form = 4 or
       agqcontractor:form = 4 then
        begin
        hide(property_fn)
        end
    else
        begin
        show(property_fn)
        end
--    end

if agqcontractor:app_no <> g_app_no then
    function = "ADD"

access validation
if agqcontractor:app_no <> g_app_no then
    error 1000

screen at 1,1 to 30,100
Properties
        {
          Layouttype = screen
          transparent = False
          backgroundcolor = "#ADD8E6"
          scrollbarpolicy = asneeded
        }
{

    Panel at 1,1 to 2,100
        Properties
            {
            layouttype = screen
            }
        {
        components
            guidetext at 1,1 to 2,40
                properties
                    {
                    iconname = "qp_logo.gif"
                    }
            guidetext at 1,83 to 2,100 tagged ficof_fn
                properties
                    {
                    iconname = "ficof_logo.gif"
                    }
            guidetext at 1,83 to 2,100 tagged farmers_fn
                properties
                    {
                    iconname = "salem_logo.gif"
                    }
            guidetext at 1,35 to 2,100 tagged t_line_of_business
                Properties
                   {
                   iconname = "title_bop.gif"
                   }

        }


panel at 3,1 to 4,100
Properties
        {
        LayoutType = screen
        backgroundcolor = "Grey"
        transparent = False
        }
{
components
          guidetext at 1.45,1 to 1.45,40     tagged display_information_box
                properties
                  {
                    text = "Rating Information..."
                    fontsize = 18
                    fontstyle = BOLD
                    fontname = "arial"
                    transparent = False
                    backgroundcolor = "Grey"
                  }

}

Panel at 3.45,75 to 4.45, 100
Properties
        {
          LayoutType = screen
        }
{
%%
App No: ___________

%%
fields
101   begin
      if g_app_no = 0 then
          begin
          do access_sfscsexec
          g_app_no                 = i_csexec_number
          end

        l_agent_no   = sfsemail:agent_no
        if l_agent_no = 0 then
            {
            l_agent_no = 9999
            }
        l_company_id = sfsdefault:company_id
        l_state = 29
        Access agsdefault_scp, Set agsdefault_scp:COMPANY_ID       = l_COMPANY_ID,
                                   agsdefault_scp:state            = l_state,
                                   agsdefault_scp:agent_no         = l_agent_no,
                                   agsdefault_scp:LINE_OF_BUSINESS = G_LINE_OF_BUSINESS, generic

        g_add_prem_no  = 0
        g_add_build_no = 0
        g_prem_no      = 0
        if function one of "ADD", "NEW" and
           g_ok_to_add = "Y" then
            begin
            agqcontractor:app_no        = g_app_no
            agqcontractor:prem_no       = 1
            agqcontractor:build_no      = 1
            agqcontractor:form          = g_form
            agqcontractor:entry_date    = todaysdate
            g_prem_no                   = agqcontractor:prem_no
            g_build_no                  = agqcontractor:build_no
            if agqcontractor:state = 0 then
                agqcontractor:state            = agsdefault_scp:state
--            if agqcontractor:county = 0 then
--                agqcontractor:COUNTY           = agsdefault_scp:COUNTY
            if agqcontractor:company_id = "" then
                agqcontractor:company_id       = agsdefault_scp:company_id
            if agqcontractor:line_of_business = 0 then
                agqcontractor:line_of_business = g_line_of_business
            if agqcontractor:agent_no = 0 then
                agqcontractor:agent_no         = l_agent_no
            end
        else
            begin
            l_no_owners = agqclasscode:no_owners
            l_full_time = agqclasscode:no_workers
            l_part_time = agqclasscode:no_helpers
            end

        access agqliablimits, set agqliablimits:app_no = g_app_no, generic

        if agqliablimits:app_no <> g_app_no then
            begin
            add agqliablimits
                begin
                agqliablimits:app_no = g_app_no
                if agsdefault_scp:rating_code one of 4 then
                    agqLIABLIMITS:INCREASED_AGGREGATE = 1
                if agqLIABLIMITS:Special_program_AGGREGATE one of 1 then
                    agqLIABLIMITS:INCREASED_AGGREGATE = 0
                agqLIABLIMITS:OCCURRENCE = agsdefault_scp:OCCURRENCE
                agqliablimits:liab_deductible = agsdefault_scp:deductible[2]
                agqLIABLIMITS:PERSONAL_INJURY = agqLIABLIMITS:OCCURRENCE
                if agsdefault_scp:rating_code = 2 then
                    begin
                    agqliablimits:General_aggregate = agqliablimits:occurrence *
                                                      agsdefault_scp:aggregate_increase
                    agqliablimits:aggregate         = agqliablimits:occurrence
                    end
                else
                    begin
                    If agqLIABLIMITS:INCREASED_AGGREGATE = 0 Then
                        Begin
                        agqLIABLIMITS:GENERAL_AGGREGATE = agqLIABLIMITS:OCCURRENCE
                        agqLIABLIMITS:AGGREGATE         = agqLIABLIMITS:OCCURRENCE
                        End
                    Else
                        Begin
                        agqLIABLIMITS:GENERAL_AGGREGATE = agqLIABLIMITS:OCCURRENCE *
                                                          agsdefault_scp:AGGREGATE_INCREASE
                        if agsdefault_scp:rating_code one of 4 then
                            begin
                            if agqliablimits:Special_program_AGGREGATE one of 1 then
                                begin
                                agqLIABLIMITS:General_AGGREGATE = agqLIABLIMITS:OCCURRENCE * (agsdefault_scp:AGGREGATE_INCREASE + 1)
                                agqLIABLIMITS:AGGREGATE         = agqLIABLIMITS:OCCURRENCE
                                end
                            else
                                begin
                                agqLIABLIMITS:General_AGGREGATE = agqLIABLIMITS:OCCURRENCE * agsdefault_scp:AGGREGATE_INCREASE
                                agqLIABLIMITS:AGGREGATE         = agqLIABLIMITS:OCCURRENCE
                                end
                            end
                        End
                    if agqliablimits:Special_program_AGGREGATE one of 1 and
                       agsdefault_scp:rating_code = 4 then
                        begin
                        agqLIABLIMITS:General_AGGREGATE = agqLIABLIMITS:OCCURRENCE *
                                                          (agsdefault_scp:AGGREGATE_INCREASE + 1)
                        agqLIABLIMITS:AGGREGATE         = agqLIABLIMITS:OCCURRENCE
                        end
                    End

                agqLIABLIMITS:MEDICAL_PAYMENTS = agsdefault_scp:MEDICAL_PAYMENTS
                agqLIABLIMITS:FIRE_LEGAL       = agsdefault_scp:FIRE_LEGAL
                end
            end

        access agqmaster, set agqmaster:app_no = g_app_no, generic

        if agqmaster:app_no <> g_app_no then
            begin
            add agqmaster
                begin
                agqmaster:app_no            = g_app_no
                agqmaster:form              = g_form
                agqmaster:exclude_terrorism = agsdefault_scp:exclude_terrorism
                end
            end
        else
            begin
            change agqmaster
                begin
                agqmaster:form              = g_form
                agqmaster:exclude_terrorism = agsdefault_scp:exclude_terrorism
                end
            end
        end
        agqcontractor:APP_NO/displayonly ;

}
-- top button bar
Panel at 5,5 to 6,100 Tagged icon_line2_tg
Properties
        {
          LayoutType = screen
        }
{
Components

        Button at 1.5,33    tagged change_fn
        Properties {
                Iconname = "btn_edit_location.bmp"
                }
        Events  {
                Action = change_fn
                }

    }

    Panel at 5,94 to 6,96 tagged button_panel
        Properties
            {
            layouttype = column
            }
        {
        Components
            Button to 1,1
                properties
                    {
                    Iconname = "btn_print_screen.bmp"
                    }
                events
                    {
                    action
                        {
                        function = "print"
                        abort()
                        }
                    }
        }

   Panel at 6.45,92
        Properties
            {
            layouttype = column
            }
      {
        Components
            guidetext to 1,1
                properties
                    {
                      text = "agtmt701.sd"
                      fontsize = 9
                    }
      }

Panel at 7,1 to 9,100 Tagged location
        Properties {
                LayoutType = screen
--                transparent = False
--                backgroundcolor = "White"
        }
        {
         Components
           guidetext at 1.5,24 to 2.5,36
             properties
               {
                 text = "Location No:"
                 fontsize = 12
                 fontname = "arial"
               }
           guidetext at 1.5,44 to 2.5,56
             properties
               {
                 text = "Building No:"
                 fontsize = 12
                 fontname = "arial"
               }
        }

Panel at 7.5,33 to 9,60 Tagged rating_pl
Properties
        {
--          transparent = False
--          backgroundcolor = "White"
        }
{
%%
____                ____
%%

components

fields
101   agqcontractor:prem_no/displayonly ;
102   agqcontractor:build_no/displayonly ;
}

Panel at 8,70 to 8,100
      Properties
         {
           layouttype = row
         }
    {
      Components
        Button at 1,55 tagged accept_fn
          properties
            {
              Iconname = "btn_accept_edits.bmp"
            }
          Events  {
                    mouseclicked = accept
                  }

    }

Panel at 9,1 to 16,100
        Properties {
                LayoutType = screen
        }
        {
         Components
           guidetext at 2,1 to 2,22
             properties
               {
                 text = "Insured's Name:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }

           guidetext at 3,1 to 3,22
             properties
               {
                 text = "Eff Date:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 4,1 to 4,22
             properties
               {
                 text = "Form Of Business:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 5,1 to 5,22
             properties
               {
                 text = "State:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 6,1 to 6,22
             properties
               {
                 text = "Location Zip Code:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 7,1 to 7,22
             properties
               {
                 text = "County:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 8,1 to 8,22
             properties
               {
                 text = "Rating Territory:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }

        }

Panel at 9,24 to 16, 120
{
%%

___________________________________________________
__________                    _________  ____
____________________________  _________________________________________
__   ________________________________________________
__________          Distance to Shore: __ _____________________________
___  ________________________________________________
___  ________________________________________________

%%

components

fields
201    begin
         if function one of "ADD","NEW","CHG","CHANGE" then
           {
             enable(accept_fn)
             disable(calc_fn)
           }
         else
           {
             disable(accept_fn)
             enable(calc_fn)
           }
       end
       agqcontractor:business_name[1]/tabstop/uppercase/default ;
301     begin
        if function one of "ADD", "NEW" then
            begin
            agqcontractor:eff_date = todaysdate
            end
        end
        agqcontractor:eff_date/tabstop/default mandatory
        if agqcontractor:eff_date < todaysdate - 30 then
            error "The effective date can not be more than 30 days from todaysdate"

        agqcontractor:exp_date = dateadd(agqcontractor:eff_date,0,1) ;
302     l_agent_wording/displayonly/showasguidetext tagged ficof_fn
        hide if sfsemail:agent_No <> 0 ;
303     begin
        access sfsagent_alias, set sfsagent_alias:company_id = agqcontractor:company_id, generic

        end
        agqcontractor:agent_no/showasguidetext/default  tagged ficof_fn
        hide if sfsemail:agent_no <> 0
        access sfsagent, set sfsagent:company_id = agqcontractor:company_id,
                             sfsagent:agent_no = agqcontractor:agent_no, generic

        if agqcontractor:agent_no <> sfsagent:agent_No then
            error "Invalid Agent No"

        activehelp sfsagent_alias:agent_no,
                   sfsagent_alias:name[1] ;

401     begin
        l_fob = agqmaster:form_of_business
        access sfsfob, set sfsfob:company_id       = agqcontractor:company_id,
                           sfsfob:form_of_business = agqmaster:form_of_business, generic

        l_fob_desc = sfsfob:description

        access sfsfob, set sfsfob:company_id       = agqcontractor:company_id, approximate

        access agqmaster, set agqmaster:app_no = g_app_no, generic

        if agqcontractor:business_name[1] <> "" and
           agqmaster:form_of_business <> "" then
            begin
            access sfsfob, set sfsfob:company_id       = agqcontractor:company_id,
                               sfsfob:form_of_business = agqmaster:form_of_business, generic

            l_form_of_business = agqmaster:form_of_business
            l_fob_description  = sfsfob:description
            l_fob_description1 = agqmaster:fob_description
            end

        access sfsfob, set sfsfob:company_id       = agqcontractor:company_id, approximate

        if l_fob_description = "" then
            activehelp()
        end
        l_fob_description/default/tabstop/uppercase
        if l_fob <> agqmaster:form_of_business or
           l_fob = "" or
           l_fob_desc <> l_fob_description then
            begin
            l_form_of_business = sfsfob:form_of_business
            if l_form_of_business <> "T" then
                l_fob_description1 = ""
            end

        activehelp sfsfob:description;
402     l_fob_description1/default/tabstop/uppercase
        hide if trun(l_fob_description) not one of "OTHER", "Other" ;
501     begin
        if function one of "ADD", "NEW" then
             agqcontractor:state = agsdefault_scp:state

        access sfsstate, set sfsstate:company_id = agqcontractor:company_id, generic
        end
        agqcontractor:state/default/tabstop
        access sfsstate, set sfsstate:company_id = agqcontractor:company_id,
                             sfsstate:state      = agqcontractor:state,
                             sfsstate:county     = "000", generic

        if agqcontractor:state <> sfsstate:state then
            error "Invalid State Entered"

        Activehelp If SFSSTATE:STATE < 99 And
                      SFSSTATE:COUNTY = 0 Then
                       SFSSTATE:STATE Else NULL /width=5/heading="State",
                   If SFSSTATE:STATE < 99 And
                      SFSSTATE:COUNTY = 0 Then
                       SFSSTATE:DESCRIPTION Else NULL /width=30/heading="Description" ;
502     begin
        access sfsstate, set sfsstate:company_id = agqcontractor:company_id,
                             sfsstate:state      = agqcontractor:state,
                             sfsstate:county     = "000", generic
        end
        sfsstate:description/displayonly ;
601     agqcontractor:str_zipcode/tabstop mandatory;
601     Begin
        If agqcontractor:STR_ZIPCODE[6,9] = "" Then
             agqcontractor:STR_ZIPCODE[6,9] = "0000"
        End
        agqcontractor:STR_ZIPCODE/displayonly;
602     begin
        access agqlocation, set agqlocation:app_no   = agqcontractor:app_no,
                                agqlocation:prem_no  = agqcontractor:prem_no,
                                agqlocation:build_no = agqcontractor:build_no, generic

        l_prior_distance_to_shore = agqlocation:distance_to_shore
        l_distance_to_shore = agqlocation:distance_to_shore
        access sfsdistance_alias, set sfsdistance_alias:company_id       = agqcontractor:company_id,
                                      sfsdistance_alias:state            = agqcontractor:state,
                                      sfsdistance_alias:line_of_business = agqcontractor:line_of_business, generic

        if l_distance_to_shore = 0 then
            activehelp()
        end
        l_distance_to_shore/default  mandatory
        hide if agqcontractor:state not one of 29, 7
        access sfsdistance, set sfsdistance:company_id        = agqcontractor:company_id,
                                sfsdistance:state             = agqcontractor:state,
                                sfsdistance:line_of_business  = agqcontractor:line_of_business,
                                sfsdistance:distance_to_shore = l_distance_to_shore, generic

        if l_distance_to_shore <> sfsdistance:distance_to_shore or
           l_distance_to_shore = 0 then
            error "Invalid Code Entered"

        activehelp sfsdistance_alias:distance_to_shore,
                   sfsdistance_alias:description ;
603     begin
        if agqcontractor:state = 37 and
           l_distance_to_shore = 0 then
            l_distance_to_shore = 9
        access agqlocation, set agqlocation:app_no   = agqcontractor:app_no,
                                agqlocation:prem_no  = agqcontractor:prem_no,
                                agqlocation:build_no = agqcontractor:build_no, generic

        if agqlocation:app_no   <> agqcontractor:app_no or
           agqlocation:prem_no  <> agqcontractor:prem_no or
           agqlocation:build_no <> agqcontractor:build_no then
            begin
            add agqlocation
                begin
                agqlocation:app_no            = agqcontractor:app_no
                agqlocation:prem_no           = agqcontractor:prem_no
                agqlocation:build_no          = agqcontractor:build_no
                agqlocation:sub_code          = 10
                agqlocation:distance_to_shore = l_distance_to_shore
                end
            end
        else
            begin
            change agqlocation
                begin
                agqlocation:distance_to_shore = l_distance_to_shore
                end
            end

        access sfsdistance, set sfsdistance:company_id        = agqcontractor:company_id,
                                sfsdistance:state             = agqcontractor:state,
                                sfsdistance:line_of_business  = agqcontractor:line_of_business,
                                sfsdistance:distance_to_shore = l_distance_to_shore, generic
        end
        sfsdistance:description ;

701     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            do update_agqmaster

--        if function one of "ADD", "NEW" then
--            begin
--            agqcontractor:county = agsdefault_scp:county
--            end

        access sfsstate_alias, set sfsstate_alias:company_id = agqcontractor:company_id,
                                   sfsstate_alias:state      = agqcontractor:state, generic
        end
        agqcontractor:COUNTY/default/tabstop
        access sfsstate_alias, set sfsstate_alias:company_id = agqcontractor:company_id,
                                   sfsstate_alias:state      = agqcontractor:state,
                                   sfsstate_alias:county     = agqcontractor:county, generic

        if agqcontractor:county <> sfsstate_alias:county or
           agqcontractor:county = 0 or
           sfsstate_alias:hide_for_bop = 1 then
            error 1222

        access sfsterritory, set sfsterritory:company_id       = agqcontractor:company_Id,
                                 sfsterritory:state            = agqcontractor:state,
                                 sfsterritory:line_of_business = agqcontractor:line_of_business,
                                 sfsterritory:county           = agqcontractor:county, generic

--        agqcontractor:territory = sfsterritory:territory
        if agqcontractor:state <> 29 then
            begin
            l_str_zipcode = str(agqcontractor:zipcode[1,5]) + "0000"
            l_zipcode     = val(l_str_zipcode)
            Access sfsterritory1, Set sfsterritory1:COMPANY_ID       = agqcontractor:COMPANY_ID,
                                      sfsterritory1:STATE            = agqcontractor:STATE,
                                      sfsterritory1:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS,
                                      sfsterritory1:zipcode          = l_zipcode,
                                      sfsterritory1:territory        = agqcontractor:county, generic

            while sfsterritory1:COMPANY_ID       = agqcontractor:COMPANY_ID and
                  sfsterritory1:STATE            = agqcontractor:STATE and
                  sfsterritory1:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS and
                  sfsterritory1:zipcode          = l_zipcode and
                  sfsterritory1:territory        = agqcontractor:county
                    begin
                    if agqcontractor:eff_date >= sfsterritory1:eff_date then
                        begin
                        l_group_1 = sfsterritory1:factor[1]
                        end

                    next sfsterritory1
                    end

            access sfsterritory, set sfsterritory:company_id       = agqcontractor:company_Id,
                                     sfsterritory:state            = agqcontractor:state,
                                     sfsterritory:line_of_business = agqcontractor:line_of_business,
                                     sfsterritory:county           = agqcontractor:county,
                                     sfsterritory:territory        = agqcontractor:county, generic

            l_territory = sfsterritory:territory_group[1]
            Access sfsterrfactors, Set sfsterrfactors:COMPANY_ID       = agqcontractor:COMPANY_ID,
                                       sfsterrfactors:STATE            = agqcontractor:STATE,
                                       sfsterrfactors:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS,
                                       sfsterrfactors:territory        = l_territory, generic

            while sfsterrfactors:COMPANY_ID       = agqcontractor:COMPANY_ID and
                  sfsterrfactors:STATE            = agqcontractor:STATE and
                  sfsterrfactors:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS and
                  sfsterrfactors:territory        = l_territory
                begin
                if agqcontractor:eff_date >= sfsterrfactors:eff_date then
                    begin
                    l_group_1 = sfsterrfactors:factor[1]
                    end

                next sfsterrfactors
                end

            agqcontractor:territory_factors[2]    = l_group_1
            agqcontractor:rating_territory_factor = l_group_1

            if function one of "ADD", "NEW" or
               l_distance_to_shore <> l_prior_distance_to_shore then
                begin
                access sfsdistance, set sfsdistance:company_id        = agqcontractor:company_id,
                                        sfsdistance:state             = agqcontractor:state,
                                        sfsdistance:line_of_business  = agqcontractor:line_of_business,
                                        sfsdistance:distance_to_shore = l_distance_to_shore, generic

                l_special_exposure_factor = 1.00
                while sfsdistance:company_id        = agqcontractor:company_id and
                      sfsdistance:state             = agqcontractor:state and
                      sfsdistance:line_of_business  = agqcontractor:line_of_business and
                      sfsdistance:distance_to_shore = l_distance_to_shore
                    begin
                    if (agqcontractor:eff_date >= sfsdistance:EfF_date and
                       (agqcontractor:eff_date <= sfsdistance:exp_date or
                       sfsdistance:exp_date = 0)) then
                        l_special_exposure_factor = sfsdistance:factor

                    next sfsdistance
                    end

                if l_special_exposure_factor <> 1.00 then
                    agqcontractor:special_exposure = 1
                else
                    agqcontractor:special_exposure = 0
                agqcontractor:special_exposure_factor = l_special_exposure_factor
                end
            end

        activehelp if sfsstate_alias:county <> 0 and
                      sfsstate_alias:hide_for_bop = 0 then
                       sfsstate_alias:county
                   else
                       null,
                   if sfsstate_alias:county <> 0 and
                      sfsstate_alias:hide_for_bop = 0 then
                       sfsstate_alias:description
                   else
                       null ;
701     Begin
        l_company_id       = agqcontractor:company_id
        l_state            = agqcontractor:state
        l_line_of_business = agqcontractor:line_of_business
        l_county           = agqcontractor:county
        access sfsterritory, set sfsterritory:company_id       = l_company_id,
                                 sfsterritory:state            = l_state,
                                 sfsterritory:line_of_business = l_line_of_business,
                                 sfsterritory:county           = l_county, generic

--        agqcontractor:TERRITORY = SFSTERRITORY:TERRITORY
        End
        agqcontractor:COUNTY/displayonly
        if sfscompany:special_territory_rating not one of 1 then
            agqcontractor:rating_territory = agqcontractor:county;
702     begin
        access sfsstate_alias, set sfsstate_alias:company_id = agqcontractor:company_id,
                                   sfsstate_alias:state      = agqcontractor:state,
                                   sfsstate_alias:county     = agqcontractor:county, generic
        end
        SFSSTATE_ALIAS:DESCRIPTION ;

801     agqcontractor:rating_territory/displayonly
        hide if agqcontractor:state <> 29
        hide if sfscompany:special_territory_rating one of 1 ;
801     begin
        l_county = agqcontractor:county
        Access scsRATINGTERR_alias, Set scsRATINGTERR_alias:COMPANY_ID       = L_COMPANY_ID,
                                        scsRATINGTERR_alias:STATE            = L_STATE,
                                        scsRATINGTERR_alias:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                                        scsRATINGTERR_alias:COUNTY           = L_COUNTY, generic
        l_eff_date = agqcontractor:eff_date
        end
        agqcontractor:RATING_TERRITORY/tabstop/default
        hide if agqcontractor:state <> 29
        l_rating_territory = agqcontractor:rating_territory
        hide if SFSCOMPANY:SPECIAL_TERRITORY_RATING not one of 1
        Access scsRATINGTERR, Set scsRATINGTERR:COMPANY_ID       = L_COMPANY_ID,
                                  scsRATINGTERR:STATE            = L_STATE,
                                  scsRATINGTERR:LINE_OF_BUSINESS = L_LINE_OF_BUSINESS,
                                  scsRATINGTERR:COUNTY           = L_COUNTY,
                                  scsRATINGTERR:TERRITORY        = L_RATING_TERRITORY, Generic

        If agqcontractor:RATING_TERRITORY <> scsRATINGTERR:TERRITORY or
           agqcontractor:rating_territory = 0 Then
            Error 1206

        agqcontractor:RATING_TERRITORY_SUB_CODE = scsRATINGTERR_ALIAS:SUB_CODE
        agqcontractor:rating_territory_group    = 1

        Activehelp if (l_eff_date >= scsratingterr_alias:eff_date and
                      (l_eff_date <= scsratingterr_alias:exp_date or
                      scsratingterr_alias:exp_date = 0)) then
                       scsRATINGTERR_ALIAS:TERRITORY
                   else
                       null,
                   if (l_eff_date >= scsratingterr_alias:eff_date and
                      (l_eff_date <= scsratingterr_alias:exp_date or
                      scsratingterr_alias:exp_date = 0)) then
                       scsRATINGTERR_ALIAS:DESCRIPTION
                   else
                       null ;
802     scsratingterr:description ;
802     begin
        Access scsRATINGTERR, Set scsRATINGTERR:COMPANY_ID       = agqcontractor:COMPANY_ID,
                                  scsRATINGTERR:STATE            = agqcontractor:STATE,
                                  scsRATINGTERR:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS,
                                  scsRATINGTERR:COUNTY           = agqcontractor:COUNTY,
                                  scsRATINGTERR:TERRITORY        = agqcontractor:RATING_TERRITORY, Generic

        while scsRATINGTERR:COMPANY_ID       = agqcontractor:COMPANY_ID and
              scsRATINGTERR:STATE            = agqcontractor:STATE and
              scsRATINGTERR:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS and
              scsRATINGTERR:COUNTY           = agqcontractor:COUNTY and
              scsRATINGTERR:TERRITORY        = agqcontractor:RATING_TERRITORY
                begin
                if (l_eff_date >= scsratingterr:eff_date and
                   (l_eff_date <= scsratingterr:exp_date or
                   scsratingterr:exp_date = 0)) then
                    begin
                    l_group_2 = scsratingterr:group_2
                    l_group_1 = scsratingterr:group_1
                    end

                next scsratingterr
                end
        Access scsRATINGTERR, Set scsRATINGTERR:COMPANY_ID       = agqcontractor:COMPANY_ID,
                                  scsRATINGTERR:STATE            = agqcontractor:STATE,
                                  scsRATINGTERR:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS,
                                  scsRATINGTERR:COUNTY           = agqcontractor:COUNTY,
                                  scsRATINGTERR:TERRITORY        = agqcontractor:RATING_TERRITORY, Generic

        End
        scsratingterr:description/displayonly
        hide if agqcontractor:state <> 29
        If agqcontractor:RATING_TERRITORY_GROUP = 2 Then
            agqcontractor:RATING_TERRITORY_FACTOR = L_GROUP_2
        else
            agqcontractor:rating_territory_factor = l_group_1

        if agqcontractor:rating_territory_factor = 0 then
            agqcontractor:rating_territory_factor = 1.00
        if function one of "ADD", "NEW" or
           l_distance_to_shore <> l_prior_distance_to_shore then
            begin
            access sfsdistance, set sfsdistance:company_id        = agqcontractor:company_id,
                                    sfsdistance:state             = agqcontractor:state,
                                    sfsdistance:line_of_business  = agqcontractor:line_of_business,
                                    sfsdistance:distance_to_shore = l_distance_to_shore, generic

            l_special_exposure_factor = 1.00
            while sfsdistance:company_id        = agqcontractor:company_id and
                  sfsdistance:state             = agqcontractor:state and
                  sfsdistance:line_of_business  = agqcontractor:line_of_business and
                  sfsdistance:distance_to_shore = l_distance_to_shore
                begin
                if (agqcontractor:eff_date >= sfsdistance:EfF_date and
                   (agqcontractor:eff_date <= sfsdistance:exp_date or
                   sfsdistance:exp_date = 0)) then
                    l_special_exposure_factor = sfsdistance:factor

                next sfsdistance
                end

            if l_special_exposure_factor <> 1.00 then
                agqcontractor:special_exposure = 1
            else
                agqcontractor:special_exposure = 0
            agqcontractor:special_exposure_factor = l_special_exposure_factor
            end  ;

/*        if l_distance_to_shore one of 1, 2, 3, 4, 5, 6 then
            agqcontractor:windstorm_exclusion = 1
        else
            agqcontractor:windstorm_exclusion = 0 ;*/

}


Panel at 17,1 to 26,100  tagged property_fn
        Properties {
                LayoutType = screen
        }
        {
         Components
           guidetext at 1,1 to 1,22
             properties
               {
                 text = "Construction:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }

           guidetext at 1,44 to 1,66
             properties
               {
                 text = "Protection:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 2,1 to 2,22
             properties
               {
                 text = "Risk Type:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 2,44 to 2,66
             properties
               {
                 text = "Year of Construction:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 3,1 to 3,22
             properties
               {
                 text = "Deductible:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 3,44 to 3,66
             properties
               {
                 text = "Wind Deductible:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }

           guidetext at 5,1 to 5,22
             properties
               {
                 text = "Building Limit:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 5,44 to 5,66
             properties
               {
                 text = "ACV Building:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 6,1 to 6,22
             properties
               {
                 text = "Business Personal Property:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 6,44 to 6,66
             properties
               {
                 text = "ACV Personal Property:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 7,1 to 7,22
             properties
               {
                 text = "Personal Property of Others:"
                 fontsize = 12
                 contentalignment = right
                 fontname = "arial"
               }
           guidetext at 8,20 to 8,37
             properties
               {
                 text = "Only on Insured Premises"
                 fontsize = 12
--                 contentalignment = right
                 fontname = "arial"
               }
        }

Panel at 17,24 to 26, 120  tagged property_fn
{
%%
_  _____________________                    __ ________________________
_  _____________________                    ____
_____                                       _____

__________                                  ~~__
__________                                  ~~__
__________                        No Stories: __  # Res Units: ___
                                           _________________ _____

%%

components

fields
101     Begin
        If FUNCTION one of "ADD", "NEW" Then
            agqCONTRACTOR:CONSTRUCTION = agsdefault_scp:CONSTRUCTION
        End
        agqCONTRACTOR:CONSTRUCTION/default/tabstop
        If agqCONTRACTOR:CONSTRUCTION <> SFSCONSTRUCTION:CONSTRUCTION or
           agqcontractor:construction = 0 Then
            Error 1203

        Activehelp SFSCONSTRUCTION_ALIAS:CONSTRUCTION,
                   SFSCONSTRUCTION_ALIAS:DESCRIPTION ;
102     sfsconstruction:description ;
103     Begin
        If FUNCTION one of "ADD", "NEW" Then
            agqCONTRACTOR:PROTECTION = agsdefault_scp:PROTECTION
        End
        agqCONTRACTOR:PROTECTION/default/tabstop
        If agqCONTRACTOR:PROTECTION <> SFSPROTECTION:PROTECTION or
           agqcontractor:protection = 0 Then
            Error 1204

        Activehelp SFSPROTECTION_ALIAS:PROTECTION,
                   SFSPROTECTION_ALIAS:DESCRIPTION ;
104     sfsprotection:description ;
201     Begin
        If FUNCTION one of "ADD", "NEW" Then
            agqCONTRACTOR:RATING_TYPE = agsdefault_scp:RATING_TYPE
        End
        agqCONTRACTOR:RATING_TYPE/default/tabstop
        If agqCONTRACTOR:RATING_TYPE <> SCSTYPE:CONTRACTOR_TYPE or
           agqcontractor:rating_type = 0 Then
            Error 1202

        Activehelp SCSTYPE_ALIAS:CONTRACTOR_TYPE,
                   SCSTYPE_ALIAS:TYPE_DESCRIPTION ;
202     scstype:type_description ;
203     agqCONTRACTOR:YEAR_CONSTRUCTION ;
301     Begin
        If FUNCTION one of "ADD", "NEW" Then
            agqCONTRACTOR:DEDUCTIBLE = agsdefault_scp:DEDUCTIBLE[1]
        End
        agqCONTRACTOR:DEDUCTIBLE/default/tabstop
        If agqCONTRACTOR:DEDUCTIBLE <> SFSDEDUCTIBLE:DEDUCTIBLE or
           agqcontractor:deductible = 0 Then
            Error 1207

        Activehelp If SFSDEDUCTIBLE_ALIAS:LIABILITY = 0 and
                      sfsdeductible_alias:show_in_activehelp = 1 Then
                       SFSDEDUCTIBLE_ALIAS:DEDUCTIBLE
                   Else
                       NULL/width=10/heading="Deductible" ;
302     Begin
        If FUNCTION one of "ADD", "NEW" Then
            agqCONTRACTOR:WIND_DEDUCTIBLE = 0
        End
        agqCONTRACTOR:WIND_DEDUCTIBLE/default/tabstop
        If agqCONTRACTOR:WIND_DEDUCTIBLE <> SFSWINDDEDUCT:WIND_DEDUCTIBLE Then
            Error 1207

        Activehelp SFSWINDDEDUCT_ALIAS:WIND_DEDUCTIBLE ;

501     Begin
        If FUNCTION one of "ADD", "NEW", "CHANGE", "CHG" then
            Begin
            L_COMPANY_ID       = agqcontractor:COMPANY_ID
            L_LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS
            Access agsdefault_scp, Set agsdefault_scp:COMPANY_ID       = agqcontractor:COMPANY_ID,
                                       agsdefault_scp:STATE            = agqCONTRACTOR:STATE,
                                       agsdefault_scp:agent_no         = agqcontractor:agent_no,
                                       agsdefault_scp:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS, Generic

            while agsdefault_scp:COMPANY_ID       = agqcontractor:COMPANY_ID and
                  agsdefault_scp:STATE            = agqCONTRACTOR:STATE and
                  agsdefault_scp:agent_no         = agqcontractor:agent_no and
                  agsdefault_scp:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS
                begin
                If agqcontractor:EFF_DATE >= agsdefault_scp:EFF_DATE Then
                    Begin
                    L_COVERAGE_A = agsdefault_scp:COVERAGE_A
                    L_COVERAGE_B = agsdefault_scp:COVERAGE_B
                    L_COVERAGE_C = agsdefault_scp:PROPERTY_OF_OTHERS
                    L_COVERAGE_D = agsdefault_scp:COVERAGE_D
                    End

                Next agsdefault_scp
                End
            End
        End
        agqCONTRACTOR:BUILDING_LIMIT/tabstop
        If agqCONTRACTOR:BUILDING_LIMIT < L_COVERAGE_A And
           agqCONTRACTOR:BUILDING_LIMIT <> 0 Then
            Error "Minimum Limit is $5,000" ;
502     agqCONTRACTOR:BUILDING_ACV/checkbox/values="0,1"/default/tabstop
        hide if agqcontractor:building_limit = 0
        hide if agqcontractor:form = 4 ;
601     agqCONTRACTOR:PROPERTY_LIMIT/tabstop
        If agqCONTRACTOR:PROPERTY_LIMIT < 15000 And
           agqCONTRACTOR:PROPERTY_LIMIT <> 0 Then
            Error "Minimum Limit is $15,000"

        If agqCONTRACTOR:PROPERTY_LIMIT = 0 And
           agqCONTRACTOR:BUILDING_LIMIT = 0 Then
            Error "Must enter a limit in Building or Business Personal Property" ;
602     agqCONTRACTOR:CONTENTS_ACV/checkbox/values="0,1"/default/tabstop
        hide if agqcontractor:property_limit = 0
        hide if agqcontractor:form = 4 ;

701     agqCONTRACTOR:PERSONAL_LIMIT/default/tabstop
        if agqcontractor:personal_limit > l_coverage_c and
           l_coverage_c <> 0 and
           agqcontractor:personal_limit <> 0 then
            error "Maximum Limit is $3,000" ;
702     agqcontractor:stories ;
703     agqcontractor:no_units ;
801     l_special_exposure/showasguidetext/displayonly
        hide if sfsemail:agent_no <> 0 ;
802     agqcontractor:special_exposure_factor/showasguidetext/default
        hide if sfsemail:agent_no <> 0 ;

}

-- draw a line
panel at 27,1 to 27,120 tagged line_panel_1
    {
      Components
        line at 1,1 to 1,120
            Properties
              {
                Linestyle = embossed
                Linewidth = 5
                foregroundcolor = "black"
--                backgroundcolor = "#ADD8E6"
              }
    }

Panel at 28,5 to 28,120 Tagged icon_line2_tg
Properties
        {
          LayoutType = screen
        }
{
Components

        Button at 1,1   tagged back_fn
        Properties {
                Iconname = "btn_back_to_main_screen.bmp"
                }
        Events  {
                Action {
                          l_continue_2 = dialog("EXITING","warning.bmp","You are about to leave the application, Do you wish to continue","Yes","No")
                          if l_continue_2 = "Yes" then
                              begin
                              function = "back"
                              abort()
                              end
                       }
                }
        Button at 1,75   tagged calc_fn
        Properties {
                Iconname = "btn_view_summary_totals.bmp"
                }
        Events  {
                Action {
                          function = "func1"
                          abort()
                       }
                }

}

panel at 28,1 to 32,100  tagged ficof_fn

Properties
        {
          LayoutType = screen
--          Transparent = False
          backgroundcolor = "white"
        }
{
      Components
         browser at 1,1 to 7,100  tagged helper_tg
             properties {
                          url = ""
                        }
}

}

Update
if UPDATEOK = "NO" then
  {
    enable (calc_fn)
    disable(accept_fn)
  }

if abort = "YES" then
    begin
    enable (calc_fn)
    disable(accept_fn)
    g_ok_to_add = "N"
    end

If UPDATEOK = "YES" And
   Abort = "NO" Then
    Begin
    enable (calc_fn)
    disable(accept_fn)
    g_ok_to_add = "N"
    if function one of "delete", "DELETE" then
        begin
        access agqprotect, agqprotect:app_no   = agqcontractor:app_no,
                           agqprotect:prem_no  = agqcontractor:prem_no,
                           agqprotect:build_no = agqcontractor:build_no, generic

        if agqprotect:app_no   = agqcontractor:app_no and
           agqprotect:prem_no  = agqcontractor:prem_no and
           agqprotect:build_no = agqcontractor:build_no then
            delete agqprotect

        access agqprotective, agqprotective:app_no   = agqcontractor:app_no,
                              agqprotective:prem_no  = agqcontractor:prem_no,
                              agqprotective:build_no = agqcontractor:build_no, generic

        if agqprotective:app_no   = agqcontractor:app_no and
           agqprotective:prem_no  = agqcontractor:prem_no and
           agqprotective:build_no = agqcontractor:build_no then
            delete agqprotective

        access agqlocation, set agqlocation:app_no   = agqcontractor:app_no,
                                agqlocation:prem_no  = agqcontractor:prem_no,
                                agqlocation:build_no = agqcontractor:build_no, generic

        if agqlocation:app_no   = agqcontractor:app_no and
           agqlocation:prem_no  = agqcontractor:prem_no and
           agqlocation:build_no = agqcontractor:build_no then
            delete agqlocation

        access agqend, set agqend:app_no   = agqcontractor:app_no,
                           agqend:prem_no  = agqcontractor:prem_no,
                           agqend:build_no = agqcontractor:build_no, generic

        while agqend:app_no   = agqcontractor:app_no and
              agqend:prem_no  = agqcontractor:prem_no and
              agqend:build_no = agqcontractor:build_no
            begin

            delete agqend

            next agqend
            end

        access agqclasscode, set agqclasscode:app_no   = agqcontractor:app_no,
                                 agqclasscode:prem_no  = agqcontractor:prem_no,
                                 agqclasscode:build_no = agqcontractor:build_no, generic

        while agqclasscode:app_no   = agqcontractor:app_no and
              agqclasscode:prem_no  = agqcontractor:prem_no and
              agqclasscode:build_no = agqcontractor:build_no
            begin

            delete agqclasscode

            next agqclasscode
            end

        g_prem_no  = 1
        g_build_no = 1
        do update_final_rating
        function = "redisplay"
        end

    if function one of "ADD", "NEW", "CHANGE", "CHG" then
        begin
        access agqname, set agqname:app_no = agqcontractor:app_no, generic

        if agqname:app_no <> agqcontractor:app_no then
            begin
            add agqname
                begin
                agqname:app_no            = agqcontractor:app_no
                agqname:name[1]           = agqcontractor:business_name[1]
                agqname:line_of_business  = agqcontractor:line_of_business
                agqname:trans_date        = todaysdate
                agqname:eff_date          = agqcontractor:eff_date
                agqname:exp_date          = agqcontractor:exp_date
                agqname:company_id        = agqcontractor:company_id
                agqname:original_eff_date = agqcontractor:eff_date
                agqname:agent_no          = agqcontractor:agent_no
                end
            end
        else
            begin
            change agqname
                begin
                agqname:name[1]           = agqcontractor:business_name[1]
                agqname:line_of_business  = agqcontractor:line_of_business
                agqname:eff_date          = agqcontractor:eff_date
                agqname:exp_date          = agqcontractor:exp_date
                agqname:company_id        = agqcontractor:company_id
                agqname:original_eff_date = agqcontractor:eff_date
                agqname:agent_no          = agqcontractor:agent_no
                end
            end

        end

    If FUNCTION one of "ADD", "NEW" Then
        Begin
        Access agqCLASSCODE, Set agqCLASSCODE:app_no = G_app_no,
                                 agqCLASSCODE:PREM_NO = G_PREM_NO,
                                 agqCLASSCODE:BUILD_NO = G_BUILD_NO, Generic

        If agqCLASSCODE:app_no <> G_app_no Or
           agqCLASSCODE:PREM_NO <> G_PREM_NO Or
           agqCLASSCODE:BUILD_NO <> G_BUILD_NO  Then
            Begin
            Access agqCONTRACTOR_ALIAS,
               Set agqCONTRACTOR_ALIAS:app_no = agqCONTRACTOR:app_no,
                   agqCONTRACTOR_ALIAS:PREM_NO  = agqCONTRACTOR:PREM_NO,
                   agqCONTRACTOR_ALIAS:BUILD_NO = agqCONTRACTOR:BUILD_NO, Generic

            if agqcontractor_alias:app_no = agqcontractor:app_no and
               agqcontractor_alias:prem_no  = agqcontractor:prem_no and
               agqcontractor_alias:build_no = agqcontractor:build_no then
                begin
                change agqcontractor_alias
                    begin
                    agqcontractor_alias:dont_allow_waived_deductible = g_waive
                    end
                end
            End
        End

    if function one of "ADD", "NEW", "CHANGE", "CHG" then
        begin
        if agqCONTRACTOR:CONTENTS_ACV one of 1 or
           agqCONTRACTOR:BUILDING_ACV one of 1 then
            begin
            do access_scstrigger
            l_code_1 = scstrigger:code[10]  --Mcp523
            L_CODE = L_CODE_1
            if l_code <> "" then
                begin
                Do ACCESS_agqEND
                If L_ADD_ENDORSEMENT = "Y" Then
                    begin
                    Do ADD_agqEND
                    end
                end
            end
        else
        if agqCONTRACTOR:CONTENTS_ACV one of 0 and
           agqCONTRACTOR:BUILDING_ACV one of 0 then
            begin
            do access_scstrigger
            l_code_1 = scstrigger:code[10]  --Mcp523
            L_CODE = L_CODE_1
            if l_code <> "" then
                begin
                Do ACCESS_agqEND
                If L_ADD_ENDORSEMENT = "N" Then
                    begin
                    Do delete_agqEND
                    end
                end
            end
        end

    Access SCSRATES, Set SCSRATES:COMPANY_ID       = agqcontractor:COMPANY_ID,
                         SCSRATES:STATE            = agqCONTRACTOR:STATE,
                         SCSRATES:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS, Generic

    while SCSRATES:RECORD_KEY       = "RT" and
          SCSRATES:COMPANY_ID       = agqcontractor:COMPANY_ID and
          SCSRATES:STATE            = agqCONTRACTOR:STATE and
          SCSRATES:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS
        begin
        If agqcontractor:EFF_DATE >= SCSRATES:EFF_DATE Then
            Begin
            L_CODE_1     = SCSRATES:WIND_DEDUCT_CODE
            l_code_2     = scsrates:tool_floater
            l_deductible = scsrates:tool_deductible
            l_tool_limit = scsrates:tool_limit
            l_tool_per   = scsrates:tool_limit_per
            l_limit_1    = 0
            l_limit_2    = 0
            End

        Next SCSRATES
        End

    If L_CODE_1 <> "" Then
        Begin
        -- wind deductible
        L_CODE = L_CODE_1
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqCONTRACTOR:WIND_DEDUCTIBLE <> 0 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqCONTRACTOR:WIND_DEDUCTIBLE = 0 Then
            Do DELETE_agqEND
        End

/*    If L_CODE_2 <> "" Then
        Begin
        -- tool floater
        L_CODE = L_CODE_2
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" Then
            begin
            Do ADD_agqEND
            do add_agqendorse3
            end
        End*/

    Access scstrigger, Set scstrigger:COMPANY_ID       = agqcontractor:COMPANY_ID,
                           scstrigger:STATE            = agqCONTRACTOR:STATE,
                           scstrigger:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS, Generic

    l_code_1 = ""
    l_code_2 = ""
    l_code_3 = ""
    l_code_4 = ""
    l_code_5 = ""
    l_code_6 = ""
    l_code_7 = ""
    l_code_8 = ""
    l_code_9 = ""
    l_code_10 = ""
    l_code_20 = ""
    while scstrigger:COMPANY_ID       = agqcontractor:COMPANY_ID and
          scstrigger:STATE            = agqCONTRACTOR:STATE and
          scstrigger:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS
        begin
        If agqcontractor:EFF_DATE >= scstrigger:rate_DATE Then
            Begin
--            L_CODE_3        = scstrigger:code[5] -- mim120
--            l_code_4        = scstrigger:code[1] -- mcl180
--            l_code_5        = scstrigger:code[2] -- mcl154
            l_code_6        = scstrigger:code[11] -- mcl156
--            l_code_7        = scstrigger:code[4] -- mcl158
--            l_code_8        = scstrigger:code[9] -- scp100
--            l_code_9        = scstrigger:code[16] -- mcp010
--            l_code_10       = scstrigger:code[17] -- mcp011
            l_code_20       = scstrigger:code[20] -- MCP523
--            l_limit_1       = scstrigger:limit[1]
--            l_limit_2       = scstrigger:limit[2]
--            l_deductible    = 0
 --           l_tool_limit    = 0
--            l_tool_per      = 0
            l_mcl156_desc_1 = scstrigger:description[1]
--            l_mcl156_desc_2 = scstrigger:description[2]
--            l_mcl156_desc_3 = scstrigger:description[3]
--            l_mcl156_desc_4 = scstrigger:description[4]
--            l_mcl156_desc_5 = scstrigger:description[5]
            End

        Next scstrigger
        End

/*    If L_CODE_3 <> "" Then
        Begin
        -- MIM120
        L_CODE = L_CODE_3
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" Then
            Do ADD_agqEND
        End

    If L_CODE_4 <> "" Then
        Begin
        -- MCL180
        L_CODE = L_CODE_4
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" Then
            begin
            Do ADD_agqEND
            if l_form_edition <> "" then
               do add_agqendorse3
            end
        End

    If L_CODE_5 <> "" Then
        Begin
        -- MCL154
        L_CODE = L_CODE_5
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" Then
            begin
            Do ADD_agqEND
            end
        End*/

    If L_CODE_6 <> "" Then
        Begin
        -- MCL156
        L_CODE = L_CODE_6
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" Then
            begin
            Do ADD_agqEND
            do add_agqdesc3
            end
        End

/*    If L_CODE_7 <> "" Then
        Begin
        -- MCL158
        L_CODE = L_CODE_7
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" Then
            begin
            Do ADD_agqEND
            end
        End

    If L_CODE_8 <> "" Then
        Begin
        -- MCL158
        L_CODE = L_CODE_8
        Do ACCESS_agqEND_1
        If L_ADD_ENDORSEMENT = "Y" and
           agqcontractor:exclude_scp100 = 0 Then
            begin
            Do ADD_agqEND_1
            end
        If L_ADD_ENDORSEMENT = "N" and
           agqcontractor:exclude_scp100 = 1 Then
            begin
            Do DELETE_agqEND_1
            end
        End

    If L_CODE_9 <> "" Then
        Begin
        L_CODE = L_CODE_9
        Do ACCESS_agqEND
        If (L_ADD_ENDORSEMENT = "Y" and
           (agqcontractor:building_limit <> 0 or
           agqcontractor:property_limit <> 0 or
           agqcontractor:personal_limit <> 0)) Then
            begin
            Do ADD_agqEND
            end
        If L_ADD_ENDORSEMENT = "N" and
           agqcontractor:building_limit = 0 and
           agqcontractor:property_limit = 0 and
           agqcontractor:personal_limit = 0  Then
            begin
            Do DELETE_agqEND
            end
        End

    If L_CODE_10 <> "" Then
        Begin
        L_CODE = L_CODE_10
        Do ACCESS_agqEND
        If (L_ADD_ENDORSEMENT = "Y" and
           (agqcontractor:building_limit <> 0 or
           agqcontractor:property_limit <> 0 or
           agqcontractor:personal_limit <> 0)) Then
            begin
            Do ADD_agqEND
            end
        If L_ADD_ENDORSEMENT = "N" and
           agqcontractor:building_limit = 0 and
           agqcontractor:property_limit = 0 and
           agqcontractor:personal_limit = 0  Then
            begin
            Do DELETE_agqEND
            end
        End*/

    If L_CODE_20 <> "" Then
        Begin
        L_CODE = L_CODE_20
        Do ACCESS_agqEND
        If ((L_ADD_ENDORSEMENT = "Y" and
           agqcontractor:building_acv = 1) or
           (l_add_endorsement = "Y" and
           agqcontractor:contents_acv = 1)) then
            begin
            Do ADD_agqEND
            end
        If L_ADD_ENDORSEMENT = "N" and
           agqcontractor:building_acv = 0 and
           agqcontractor:contents_acv = 0 then
            begin
            Do DELETE_agqEND
            end
        End

    Access agqCONTRACTOR_ALIAS,
       Set agqCONTRACTOR_ALIAS:app_no = agqCONTRACTOR:app_no,
           agqCONTRACTOR_ALIAS:PREM_NO  = agqCONTRACTOR:PREM_NO,
           agqCONTRACTOR_ALIAS:BUILD_NO = agqCONTRACTOR:BUILD_NO, Generic

    If agqCONTRACTOR_ALIAS:FIRE_ALARM     = 0 And
       agqCONTRACTOR_ALIAS:BURGLARY_ALARM = 0 Then
        Begin
        Access agqCONTRACTOR_ALIAS,
           Set agqCONTRACTOR_ALIAS:app_no = agqCONTRACTOR:app_no,
               agqCONTRACTOR_ALIAS:PREM_NO  = agqCONTRACTOR:PREM_NO,
               agqCONTRACTOR_ALIAS:BUILD_NO = agqCONTRACTOR:BUILD_NO, Generic

        Change agqCONTRACTOR_ALIAS
            Begin
            agqCONTRACTOR_ALIAS:SUPERIOR_CONDITIONS = 0
            End
        End

    Do UPDATE_ENDORSEMENTS

    Access SCSRATES, Set SCSRATES:COMPANY_ID       = agqcontractor:COMPANY_ID,
                         SCSRATES:STATE            = agqCONTRACTOR:STATE,
                         SCSRATES:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS, Generic

    while SCSRATES:RECORD_KEY       = "RT" and
          SCSRATES:COMPANY_ID       = agqcontractor:COMPANY_ID and
          SCSRATES:STATE            = agqCONTRACTOR:STATE and
          SCSRATES:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS
        begin
        If agqcontractor:EFF_DATE >= SCSRATES:EFF_DATE Then
            Begin
--            L_CODE_1  = SCSRATES:GLASS_CODE -- exterior glass
--            L_CODE_2  = SCSRATES:MONEY_CODE[1]
--            L_CODE_3  = SCSRATES:MONEY_CODE[2]
--            L_CODE_4  = SCSRATES:WATER_BKUP_CODE
            L_CODE_5  = SCSRATES:ACV_CODE
--            L_CODE_6  = SCSRATES:MONEY_CODE[3]
            End

        Next SCSRATES
        End

    Access agqCONTRACTOR_ALIAS,
       Set agqCONTRACTOR_ALIAS:app_no = agqCONTRACTOR:app_no,
           agqCONTRACTOR_ALIAS:PREM_NO  = agqCONTRACTOR:PREM_NO,
           agqCONTRACTOR_ALIAS:BUILD_NO = agqCONTRACTOR:BUILD_NO, Generic

/*    If L_CODE_1 <> "" Then
        Begin
        -- glass code
        L_CODE = L_CODE_1
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqCONTRACTOR_alias:EXTERIOR_GLASS <> 0 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqCONTRACTOR_alias:EXTERIOR_GLASS = 0 Then
            Do DELETE_agqEND
        End

    If L_CODE_4 <> "" Then
        Begin
        -- waterbkup
        L_CODE = L_CODE_4
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqCONTRACTOR_alias:LIMIT_WATER_BKUP = 1 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqCONTRACTOR_alias:LIMIT_WATER_BKUP = 0 Then
            Do DELETE_agqEND
        End*/

    If L_CODE_5 <> "" Then
        Begin
        -- ACV basis
        L_CODE = L_CODE_5
        Do ACCESS_agqEND
        If (L_ADD_ENDORSEMENT = "Y" And
           (agqCONTRACTOR_alias:CONTENTS_ACV = 1 Or
           agqCONTRACTOR_alias:BUILDING_ACV = 1)) Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqCONTRACTOR_alias:CONTENTS_ACV = 0 And
           agqCONTRACTOR_alias:BUILDING_ACV = 0 Then
            Do DELETE_agqEND
        End

/*    If L_CODE_2 <> "" Then
        Begin
        -- money
        L_CODE = L_CODE_2
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqCONTRACTOR_alias:MONEY_LIMIT_ON <> 0 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqCONTRACTOR_alias:MONEY_LIMIT_ON = 0 Then
            Do DELETE_agqEND
        End

    If L_CODE_3 <> "" Then
        Begin
        -- money
        L_CODE = L_CODE_3
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqCONTRACTOR_alias:MONEY_LIMIT_ON <> 0 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqCONTRACTOR_alias:MONEY_LIMIT_ON = 0 Then
            Do DELETE_agqEND
        End

    If L_CODE_6 <> "" Then
        Begin
        -- money
        L_CODE = L_CODE_6
        Do ACCESS_agqEND
        If L_ADD_ENDORSEMENT = "Y" And
           agqCONTRACTOR_alias:MONEY_LIMIT_ON <> 0 Then
            Do ADD_agqEND
        If L_ADD_ENDORSEMENT = "N" And
           agqCONTRACTOR_alias:MONEY_LIMIT_ON = 0 Then
            Do DELETE_agqEND
        End*/

    if function one of "ADD", "NEW" then
        begin
        g_prem_no  = agqcontractor:prem_no
        g_build_no = agqcontractor:build_no
        end

    if function one of "ADD", "NEW" then
        begin
        g_prem_no  = agqcontractor:prem_no
        g_build_no = agqcontractor:build_no
        function   = "nextscreen"
        end

    End

screen exit
g_prem_no = agqcontractor:prem_no
g_build_no = agqcontractor:build_no

Procedure Definition

procedure access_scstrigger
BEGIN
l_state = agqcontractor:state
Access scstrigger,
     Set scstrigger:COMPANY_ID       = agqcontractor:COMPANY_ID,
         scstrigger:STATE            = L_STATE,
         scstrigger:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS, Generic

while scstrigger:COMPANY_ID       = agqcontractor:COMPANY_ID and
      scstrigger:STATE            = L_STATE and
      scstrigger:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS
    {
    If agqcontractor:EFF_DATE >= scstrigger:rate_DATE Then
        Begin
        l_eff_date = scstrigger:rate_date
        End

    Next scstrigger
    }

Access scstrigger,
     Set scstrigger:COMPANY_ID       = agqcontractor:COMPANY_ID,
         scstrigger:STATE            = L_STATE,
         scstrigger:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS,
         scstrigger:rate_date        = l_eff_date

END

procedure access_sfscsexec
begin
i_csexec_application = "APQQUOTE                 "

access sfscsexec, set sfscsexec:application = i_csexec_application, generic

change sfscsexec
    begin
    i_csexec_number = sfscsexec:application_number + 1
    sfscsexec:application_number = i_csexec_number
    end

end

procedure update_final_rating
begin

postevent("agqmt702","reload")

end

/*procedure add_optional_coverages
begin
Access agqMASTER, Set agqMASTER:app_no = G_app_no, Exact

Access agqcontractor, Set agqcontractor:app_no = G_app_no, Exact

L_COMPANY_ID       = agqcontractor:COMPANY_ID
L_LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS
Access agsdefault_scp, Set agsdefault_scp:COMPANY_ID       = agqcontractor:COMPANY_ID,
                           agsdefault_scp:STATE            = agqCONTRACTOR:STATE,
                           agsdefault_scp:agent_no         = agqcontractor:agent_No,
                           agsdefault_scp:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS, Generic

while agsdefault_scp:COMPANY_ID       = agqcontractor:COMPANY_ID and
      agsdefault_scp:STATE            = agqCONTRACTOR:STATE and
      agsdefault_scp:line_of_business = agqcontractor:line_of_business and
      agsdefault_scp:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS
    begin
    If agqcontractor:EFF_DATE >= agsdefault_scp:EFF_DATE Then
        Begin
        If G_FORM < 4 Then
            begin
            agqCONTRACTOR:SIGNS_NOT_ATTACHED_LIMIT = agsdefault_scp:SIGNS_NOT_ATTACHED_LIMIT
            agqCONTRACTOR:SIGNS_ATTACHED_LIMIT     = agsdefault_scp:SIGNS_ATTACHED_LIMIT
            agqCONTRACTOR:AR_LIMIT                 = agsdefault_scp:AR_LIMIT
            agqCONTRACTOR:VALUABLE_PAPERS          = agsdefault_scp:VALUABLE_PAPERS
            agqCONTRACTOR:BUILDING_CODE_LAW        = agsdefault_scp:BUILDING_CODE * 100
            agqCONTRACTOR:LIMIT_WATER_BKUP         = 0
            agqCONTRACTOR:DEBRIS_LIMIT             = agsdefault_scp:DEBRIS_LIMIT
            if g_form one of 1, 2 then
                begin
                agqCONTRACTOR:GLASS_LIMIT          = 0
                agqCONTRACTOR:GLASS_PER            = 0
                end
            else
                begin
                agqCONTRACTOR:GLASS_LIMIT          = agsdefault_scp:GLASS_LIMIT
                agqCONTRACTOR:GLASS_PER            = agsdefault_scp:GLASS_PER
                end
            agqCONTRACTOR:OFF_PREM_LIMIT           = agsdefault_scp:OFF_PREM_LIMIT
            agqCONTRACTOR:OUTDOOR_PROPERTY_LIMIT   = agsdefault_scp:OUTDOOR_PROP_LIMIT
            agqCONTRACTOR:OUTDOOR_PROPERTY_PER     = agsdefault_scp:OUTDOOR_PROP_PER
            agqCONTRACTOR:PERSONAL_EFFECTS         = agsdefault_scp:PERSONAL_EFFECTS
--            agqCONTRACTOR:BUILDING_ACV             = 0
--            agqCONTRACTOR:CONTENTS_ACV             = 0
            end

        End

    Next agsdefault_scp
    End

End*/


Procedure UPDATE_ENDORSEMENTS
Begin
Access SCSRATES, Set SCSRATES:COMPANY_ID = agqcontractor:COMPANY_ID,
                     SCSRATES:STATE = agqCONTRACTOR:STATE,
                     SCSRATES:LINE_OF_BUSINESS = agqcontractor:LINE_OF_BUSINESS, Generic

Repeat Begin
    Exit If SCSRATES:RECORD_KEY  <> "RT" Or
            SCSRATES:COMPANY_ID <> agqcontractor:COMPANY_ID Or
            SCSRATES:STATE <> agqCONTRACTOR:STATE Or
            SCSRATES:LINE_OF_BUSINESS <> agqcontractor:LINE_OF_BUSINESS

    If agqcontractor:EFF_DATE >= SCSRATES:EFF_DATE Then
        Begin
        L_CODE_1 = SCSRATES:FIRE_CODE
        L_CODE_2 = SCSRATES:BURGLARY_CODE
        L_CODE_3 = SCSRATES:EXCLUDE_THEFT_CODE
        L_CODE_4 = SCSRATES:LIMIT_THEFT_CODE
        End

    Next SCSRATES
    End

    Access agqCONTRACTOR_ALIAS,
       set agqCONTRACTOR_ALIAS:app_no = agqCONTRACTOR:app_no,
           agqCONTRACTOR_ALIAS:PREM_NO  = agqCONTRACTOR:PREM_NO,
           agqCONTRACTOR_ALIAS:BUILD_NO = agqCONTRACTOR:BUILD_NO, Generic

        If L_CODE_1 <> "" Then
            Begin
            -- fire
            L_CODE = L_CODE_1
            Do ACCESS_agqEND
            If L_ADD_ENDORSEMENT = "Y" And
               agqCONTRACTOR_alias:FIRE_ALARM = 1 Then
                Do ADD_agqEND
            If L_ADD_ENDORSEMENT = "N" And
               agqCONTRACTOR_alias:FIRE_ALARM = 0 Then
                Do DELETE_agqEND
            End

        If L_CODE_2 <> "" Then
            Begin
            -- burglary alarm
            L_CODE = L_CODE_2
            Do ACCESS_agqEND
            If L_ADD_ENDORSEMENT = "Y" And
               agqCONTRACTOR_alias:BURGLARY_ALARM = 1 Then
                Do ADD_agqEND
            If L_ADD_ENDORSEMENT = "N" And
               agqCONTRACTOR_alias:BURGLARY_ALARM = 0 Then
                Do DELETE_agqEND
            End

        If L_CODE_3 <> "" Then
            Begin
            -- exclude theft
            L_CODE = L_CODE_3
            Do ACCESS_agqEND
            If L_ADD_ENDORSEMENT = "Y" And
               agqCONTRACTOR_alias:EXCLUDING_THEFT = 1 Then
                Do ADD_agqEND
            If L_ADD_ENDORSEMENT = "N" And
               agqCONTRACTOR_alias:EXCLUDING_THEFT = 0 Then
                Do DELETE_agqEND
            End

        If L_CODE_4 <> "" Then
            Begin
            -- limit theft
            L_CODE = L_CODE_4
            Do ACCESS_agqEND
            If L_ADD_ENDORSEMENT = "Y" And
               agqCONTRACTOR_alias:LIMIT_THEFT = 1 Then
                Do ADD_agqEND
            If L_ADD_ENDORSEMENT = "N" And
               agqCONTRACTOR_alias:LIMIT_THEFT = 0 Then
                Do DELETE_agqEND
            End

End

Procedure ACCESS_agqEND
Begin
Access agqEND, Set agqEND:app_no = agqCONTRACTOR:app_no ,
                   agqEND:PREM_NO = agqCONTRACTOR:PREM_NO,
                   agqEND:BUILD_NO = agqCONTRACTOR:BUILD_NO, Generic

L_ADD_ENDORSEMENT = "Y"
Repeat Begin
    Exit If agqEND:app_no <> agqCONTRACTOR:app_no Or
            agqEND:PREM_NO <> agqCONTRACTOR:PREM_NO Or
            agqEND:BUILD_NO <> agqCONTRACTOR:BUILD_NO

    If agqEND:CODE = L_CODE Then
        L_ADD_ENDORSEMENT = "N"

    Next agqEND
    End

End

Procedure ACCESS_agqEND_1
Begin
Access agqEND, Set agqEND:app_no = agqCONTRACTOR:app_no ,
                   agqEND:PREM_NO  = 0,
                   agqEND:BUILD_NO = 0, Generic

L_ADD_ENDORSEMENT = "Y"
Repeat Begin
    Exit If agqEND:app_no <> agqCONTRACTOR:app_no Or
            agqEND:PREM_NO  <> 0 Or
            agqEND:BUILD_NO <> 0

    If agqEND:CODE = L_CODE Then
        L_ADD_ENDORSEMENT = "N"

    Next agqEND
    End

End

Procedure ADD_agqEND
Begin
Access agqEND, Set agqEND:app_no = agqCONTRACTOR:app_no ,
                   agqEND:PREM_NO = agqCONTRACTOR:PREM_NO,
                   agqEND:BUILD_NO = agqCONTRACTOR:BUILD_NO, Generic

L_SUB_CODE = 0
Repeat Begin
    Exit If agqEND:app_no <> agqCONTRACTOR:app_no Or
            agqEND:PREM_NO <> agqCONTRACTOR:PREM_NO Or
            agqEND:BUILD_NO <> agqCONTRACTOR:BUILD_NO

    L_SUB_CODE = agqEND:SUB_CODE

    Next agqEND
    End

L_SUB_CODE = L_SUB_CODE + 10

Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID = agqCONTRACTOR:COMPANY_ID,
                      SFSOPTEND:STATE = agqCONTRACTOR:STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = agqCONTRACTOR:LINE_OF_BUSINESS,
                      SFSOPTEND:CODE = L_CODE, Generic

Repeat Begin
    Exit If SFSOPTEND:COMPANY_ID <> agqCONTRACTOR:COMPANY_ID Or
            SFSOPTEND:STATE <> agqCONTRACTOR:STATE Or
            SFSOPTEND:LINE_OF_BUSINESS <> agqCONTRACTOR:LINE_OF_BUSINESS Or
            SFSOPTEND:CODE <> L_CODE

    If (agqcontractor:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqcontractor:eff_date <= sfsoptend:exp_date or
       sfsoptend:exp_date = 0)) Then
        Begin
        L_FORM_EDITION = SFSOPTEND:FORM_EDITION
        L_DESCRIPTION = SFSOPTEND:DESCRIPTION
        End

    Next SFSOPTEND
    End

if l_form_edition <> "" then
begin
Add agqEND
    Begin
    agqEND:app_no             =       agqCONTRACTOR:app_no
    agqEND:PREM_NO              =       agqCONTRACTOR:PREM_NO
    agqEND:BUILD_NO             =       agqCONTRACTOR:BUILD_NO
    agqEND:SUB_CODE             =       L_SUB_CODE
    agqEND:CODE                 =       L_CODE
    agqEND:FORM_EDITION         =       L_FORM_EDITION
    agqEND:DESCRIPTION          =       L_DESCRIPTION
    agqEND:PREMIUM              =       0
    End
end

End

Procedure ADD_agqEND_1
Begin
Access agqEND, Set agqEND:app_no = agqCONTRACTOR:app_no ,
                   agqEND:PREM_NO  = 0,
                   agqEND:BUILD_NO = 0, Generic

L_SUB_CODE = 0
Repeat Begin
    Exit If agqEND:app_no <> agqCONTRACTOR:app_no Or
            agqEND:PREM_NO  <> 0 Or
            agqEND:BUILD_NO <> 0

    L_SUB_CODE = agqEND:SUB_CODE

    Next agqEND
    End

L_SUB_CODE = L_SUB_CODE + 10

Access SFSOPTEND, Set SFSOPTEND:COMPANY_ID = agqCONTRACTOR:COMPANY_ID,
                      SFSOPTEND:STATE = agqCONTRACTOR:STATE,
                      SFSOPTEND:LINE_OF_BUSINESS = agqCONTRACTOR:LINE_OF_BUSINESS,
                      SFSOPTEND:CODE = L_CODE, Generic

Repeat Begin
    Exit If SFSOPTEND:COMPANY_ID <> agqCONTRACTOR:COMPANY_ID Or
            SFSOPTEND:STATE <> agqCONTRACTOR:STATE Or
            SFSOPTEND:LINE_OF_BUSINESS <> agqCONTRACTOR:LINE_OF_BUSINESS Or
            SFSOPTEND:CODE <> L_CODE

    If (agqcontractor:EFF_DATE >= SFSOPTEND:EFF_DATE and
       (agqcontractor:eff_date <= sfsoptend:exp_date or
       sfsoptend:exp_date = 0)) Then
        Begin
        L_FORM_EDITION = SFSOPTEND:FORM_EDITION
        L_DESCRIPTION = SFSOPTEND:DESCRIPTION
        End

    Next SFSOPTEND
    End

if l_form_edition <> "" then
begin
Add agqEND
    Begin
    agqEND:app_no             =       agqCONTRACTOR:app_no
    agqEND:PREM_NO              =       0
    agqEND:BUILD_NO             =       0
    agqEND:SUB_CODE             =       L_SUB_CODE
    agqEND:CODE                 =       L_CODE
    agqEND:FORM_EDITION         =       L_FORM_EDITION
    agqEND:DESCRIPTION          =       L_DESCRIPTION
    agqEND:PREMIUM              =       0
    End
end

End

Procedure DELETE_agqEND
Begin
Access agqEND, Set agqEND:app_no = agqCONTRACTOR:app_no ,
                   agqEND:PREM_NO = agqCONTRACTOR:PREM_NO,
                   agqEND:BUILD_NO = agqCONTRACTOR:BUILD_NO, Generic

Repeat Begin
    Exit If agqEND:app_no <> agqCONTRACTOR:app_no Or
            agqEND:PREM_NO <> agqCONTRACTOR:PREM_NO Or
            agqEND:BUILD_NO <> agqCONTRACTOR:BUILD_NO

    If agqEND:CODE = L_CODE Then
        Delete agqEND

    Next agqEND
    End

End

Procedure DELETE_agqEND_1
Begin
Access agqEND, Set agqEND:app_no = agqCONTRACTOR:app_no ,
                   agqEND:PREM_NO  = 0,
                   agqEND:BUILD_NO = 0, Generic

Repeat Begin
    Exit If agqEND:app_no <> agqCONTRACTOR:app_no Or
            agqEND:PREM_NO  <> 0 Or
            agqEND:BUILD_NO <> 0

    If agqEND:CODE = L_CODE Then
        Delete agqEND

    Next agqEND
    End

End

procedure add_agqendorse3
begin
access agqendorse3, set agqendorse3:app_no = agqcontractor:app_no,
                       agqendorse3:prem_no = agqcontractor:prem_no,
                       agqendorse3:build_no = agqcontractor:build_no,
                       agqendorse3:code = l_code, generic

if agqendorse3:app_no <> agqcontractor:app_no or
   agqendorse3:prem_no <> agqcontractor:prem_no or
   agqendorse3:build_no <> agqcontractor:build_no or
   agqendorse3:code <> l_code then
    begin
    add agqendorse3
        begin
        agqendorse3:app_no = agqcontractor:app_no
        agqendorse3:prem_no = agqcontractor:prem_no
        agqendorse3:build_no = agqcontractor:build_no
        agqendorse3:code = l_code
        agqendorse3:sub_code = l_sub_code
        if agqendorse3:code one of "MIM121" then
            begin
            agqendorse3:deductible = l_deductible
            agqendorse3:limit[1] = l_tool_limit
            agqendorse3:limit[2] = l_tool_per
            end
        if agqendorse3:code one of "MCL180" then
            begin
            agqendorse3:limit[1] = l_limit_1
            agqendorse3:limit[2] = l_limit_2
            end
        end
    end

end

procedure add_agqdesc3
begin
access agqdesc3, set agqdesc3:app_no = agqcontractor:app_no,
                    agqdesc3:prem_no = agqcontractor:prem_no,
                    agqdesc3:build_no = agqcontractor:build_no,
                    agqdesc3:code = l_code, generic

if agqdesc3:app_no <> agqcontractor:app_no or
   agqdesc3:prem_no <> agqcontractor:prem_no or
   agqdesc3:build_no <> agqcontractor:build_no or
   agqdesc3:code <> l_code then
    begin
    add agqdesc3
        begin
        agqdesc3:app_no = agqcontractor:app_no
        agqdesc3:prem_no = agqcontractor:prem_no
        agqdesc3:build_no = agqcontractor:build_no
        agqdesc3:code = l_code
        agqdesc3:sub_code = l_sub_code
        agqdesc3:description_1[1] = l_mcl156_desc_1
--        agqdesc3:description_1[2] = l_mcl156_desc_2
--        agqdesc3:description_1[3] = l_mcl156_desc_3
--        agqdesc3:description_1[4] = l_mcl156_desc_4
--        agqdesc3:description_1[5] = l_mcl156_desc_5
        end
    end

end

procedure displayscreen
begin
  access scsdisplayscreen,
     set scsdisplayscreen:company_id = agqcontractor:company_id,
         scsdisplayscreen:state      = agqcontractor:state, generic

  l_screen = scsdisplayscreen:display_screen[1]

end

procedure update_agqmaster
BEGIN
access agqmaster, set agqmaster:app_no = g_app_no, exact

if agqmaster:app_no = g_app_no then
    {
    change agqmaster
        {
        agqmaster:form_of_business  = l_form_of_business
        agqmaster:FOB_DESCRIPTION   = l_fob_description1
        agqmaster:form              = g_form
        }
    }

END

End
