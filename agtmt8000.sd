%%
Screen
        Name = "agtmt8000" ;
        Type = "Multiline" ;
        Repeat LINE_ITEMS, 40 times down ;
        Padcharacter = Space ;
        Highlight = Underscore ;
        Screensize = "dynamic" ;
--        Windowtitle = "%a    %s Location Totals - Ver. 7.00     %m" ;
        Domain = "agqtotals1" ;
        showunusedrecords=false
        autoscroll=true
        resizeable = yes ;
        iconline = 0 ;

        Global Unsigned Ascii Number G_app_NO[11] ;
        Global Unsigned Ascii Number G_prem_no[4] ;
        Global Unsigned Ascii Number G_build_no[4] ;
        Global Unsigned Ascii Number G_line_of_business[4] ;

        global string g_inquiry[1],
                      g_portfolio[1] ;

        local tag l_tag[8] ;

        Local Unsigned Ascii Number L_TOTAL_1[8]=0,
                                    L_TOTAL_2[8]=0,
                                    L_TOTAL_3[8]=0,
                                    L_TOTAL_4[8]=0,
                                    L_TOTAL_5[8]=0,
                                    L_TOTAL_6[8]=0,
                                    L_TOTAL_7[8]=0,
                                    L_TOTAL_8[8]=0,
                                    L_TOTAL_9[8]=0,
                                    l_total_10[8]=0,
                                    l_app_no[11],
                                    l_terrorism_total[8]=0,
                                    l_reins_co[6]=0,
                                    l_rating_line_of_business[4]=0008,
                                    l_protection[2]=0,
                                    l_force_to_subject[1]=0,
                                    l_exclude_terrorism[1],
                                    l_include_prop_opt_cov[1]=0,
                                    l_include_business_income[1]=0,
                                    l_general_total[8]=0,
                                    l_include_glass[1]=0,
                                    l_include_crime[1]=0,
                                    l_include_inland_marine[1]=0,
                                    l_include_boiler[1]=0,
                                    l_include_irpm[1]=0,
                                    l_business_total[8]=0,
                                    l_mp_total[8]=0,
                                    l_liability_terrorism[8]=0,
                                    l_terror_line_of_business[4]=0011,
                                    l_property_terrorism[8]=0,
                                    l_premium_2[8]=0,
                                    l_premium_3[8]=0,
                                    l_premium_4[8]=0,
                                    l_prem_no[4]=0,
                                    l_build_no[4]=0,
                                    l_minimum_premium[4]=0,
                                    l_location_premium_10[8]=0,
                                    l_agqmaster_total_10[8]=0,
                                    l_fire_minimum_total[8]=0,
                                    l_location_premium_11[8]=0,
                                    l_rating_territory_factor[5]=0/dec=3,
                                    l_county[3]=0,
                                    L_PREM_TOTAL[8]=0,
                                    L_PROD_TOTAL[8]=0,
                                    l_artisan_prem_total[8]=0,
                                    l_artisan_prod_total[8]=0,
                                    l_farm_prem_total[8]=0,
                                    l_farm_prod_total[8]=0,
                                    l_min_total[8]=0,
                                    L_LIABILITY_TOTAL[8]=0,
                                    l_artisan_liability_total[8]=0,
                                    l_farm_liability_total[8]=0,
                                    L_PROPERTY_TOTAL[8]=0,
                                    L_PROPERTY_TOTAL_1[8]=0,
                                    l_property_total_2[8]=0,
                                    l_property_final_total[8]=0,
                                    l_business_income_final_total[8]=0,
                                    l_crime_final_total[8],
                                    l_inland_marine_final_total[8],
                                    l_liability_final_total[8]=0,
                                    l_artisan_final_total[8]=0,
                                    L_BI_TOTAL[8]=0,
                                    L_BI_TOTAL_1[8]=0,
                                    L_FIRE_TOTAL[8]=0,
                                    l_reins_fire_total[8]=0,
                                    l_reins_ecvmm_total[8]=0,
                                    l_reins_other_total[8]=0,
                                    L_EC_VMM_TOTAL[8]=0,
                                    L_OTHER_TOTAL[8]=0,
                                    L_BOILER_TOTAL[8]=0,
                                    L_FARM_FIRE_TOTAL[8]=0,
                                    L_FARM_ALLIED_TOTAL[8]=0,
                                    L_FARM_INLAND_TOTAL[8]=0,
                                    L_FARM_TOTAL[8]=0,
                                    L_OPTION_1[1]=0,
                                    L_OPTION_2[1]=0,
                                    L_OPTION_3[1]=0,
                                    L_OPTION_4[1]=0,
                                    L_OPTION_5[1]=0,
                                    L_OPTION_6[1]=0,
                                    L_OPTION_7[1]=0,
                                    L_OPTION_8[1]=0,
                                    L_OPTION_9[1]=0,
                                    l_option_10[1]=0,
                                    L_TOTAL[8]=0,
                                    L_MINIMUM[4]=0,
                                    L_STATE[2]=0,
                                    L_BOILER_PREM_TOTAL[8]=0,
                                    L_SURCHARGE_FACTOR[8]=0/decimals=6,
                                    L_SURCHARGE_MINIMUM[2]=0,
                                    L_FINAL_TOTAL[8]=0,
                                    L_LOC_TOTAL[8]=0,
                                    L_SURCHARGE[6]=0 ,
                                    L_LIMIT[8]=0,
                                    l_crime_limit[8]=0,
                                    l_inland_limit[8]=0,
                                    l_glass_limit[8]=0,
                                    L_CSEXEC_NUMBER[12] ,
                                    I_CSEXEC_NUMBER[12],
                                    L_INSTALLMENT[4]=0,
                                    L_DAYS_RATE[5]=0/decimals=4,
                                    L_PRO_RATA_PREMIUM[8]=0/decimals=4 ,
                                    l_abort_program[1],
                                    l_line_of_business[4]=08 ,
                                    l_line_of_business_1[4]=0;

        Local Signed Ascii Number L_DAYS ,
                                  l_location_new_total[8]=0,
                                  l_crime_premium[9]=0/dec=2,
                                  L_FINAL_TOTAL_1[8]=0,
                                  L_FINAL_TOTAL_2[8]=0,
                                  L_FINAL_TOTAL_3[8]=0,
                                  l_subline_percent[10]=0/dec=4 ,
                                  l_final_total_4[8]=0,
                                  L_IRPM_TOTAL[8]=0,
                                  l_reins_irpm_total[8]=0,
                                  l_irpm_property[8]=0,
                                  l_irpm_liability[8]=0,
                                  l_irpm_inland[8]=0,
                                  l_irpm_crime[8]=0,
                                  l_irpm_glass[8]=0,
                                  l_location_irpm_prop[8]=0,
                                  l_location_irpm_liab[8]=0,
                                  l_location_irpm_crime[8]=0,
                                  l_location_irpm_diff[8]=0,
                                  l_total_all_irpm[8]=0,
                                  l_irpm_difference[8]=0,
                                  l_package[4]=0/dec=2,
                                  l_deviation[4]=0/dec=2,
                                  l_optional_coverages[8]=0,
                                  l_end_premium[6]=0,
                                  l_misc_premium[6]=0,
                                  l_irpm[8]=0/dec=4 ,
                                  l_irpm_1[8]=0/dec=4 ;

        local wdate l_eff_date ;

        Local String L_TYPE[1] ,
                     L_CSEXEC_APPLICATION[25]="" ,
                     l_liability_warning[1],
                     l_property_warning[1],
                     l_artisan_warning[1],
                     l_fob[1],
                     l_fob_desc[50],
                     l_screen_1[9],
                     l_server_name[100],
                     l_current_web_page[50],
                     l_web_site_address[150] ,
                     l_continue_2[3],
                     l_user_id[15],
                     l_fob_description[50],
                     l_fob_description1[75],
                     l_lob_end_code[1]="",
                     l_name[50],
                     l_agqgeneral[1]="N",
                     l_form_business[50],
                     l_agqliability[1]="N",
                     l_agqartisan[1]="N",
                     l_agqfarm[1]="N",
                     l_agqinland[1]="N",
                     l_key_risk[1]="N",
                     L_COMMANDLINE[8],
                     l_commandline_1[15],
                     l_str_state[2],
                     l_zip_code_5[5],
                     L_APP[3]="cpq",
                     l_enter,
                     L_DEC[15],
                     l_company_id[10],
                     l_minimum_applies[1]="N",
                     L_FORM_EDITION[25],
                     l_system_id[15],
                     l_First[1]="Y",
                     l_first_1[1]="Y",
                     L_DESCRIPTION[75],
                     l_mp_1="N",
                     l_mp_2="N",
                     l_mp_3="N",
                     l_mp_4="N",
                     l_mp_5="N",
                     l_mp_6="N",
                     l_mp_7="N",
                     L_SCREEN[11] ,
                     L_CODE[7],
                     L_PRO_RATE="PRO RATA" ;

        Local Date L_EFF_DATE_1[8] ,
                   l_surcharge_date[8] ;

        Local Mmddyyyy Date L_CORRECT_DATE[8] ;
        Local String L_FIRST_TIME[1]="Y";
        Unsigned Ascii Number L_HOLD_PAYMENT_PLAN[4]=0;
        Signed Ascii Number L_SUB_TOTAL[9]=0/decimals=2;
        Local Unsigned Ascii Number L_OPT[1]=0 ;

        Local Signed Ascii Number  l_reins_premium[9]=0 ,
                                   l_reins_total[9]=0,
                                   l_premium[9]=0 ,
                                   l_premium_1[9]=0 ,
                                   l_irpm_reins_total[9]=0 ;

        Local Unsigned Ascii Number l_reins_factor[5]=0/dec=4,
                                    l_reins_limit[8]=0,
                                    l_reins_limit1[8]=0 ,
                                    l_property_limit[8]=0,
                                    l_key_risk_limit[8]=0,
                                    l_key_risk_prem_no[4]=0,
                                    l_key_risk_build_no[4]=0,
                                    l_business_income_limit[8]=0;

        Unsigned Ascii Number L_TERRORISM_PREMIUM[8]/decimals =0;
        Unsigned Ascii Number L_general_TERRORISM_PREMIUM[8]/decimals =0;
        Unsigned Ascii Number L_TERROR_PERCENTAGE[5]/decimals=4;
        Unsigned Ascii Number L_TERROR_MINIMUM[3];
        Unsigned Ascii Number L_FOUND[1];
        Unsigned Ascii Number L_SUB_CODE[4];
        Wdate L_TERROR_EFF_DATE;

        Include "print.var"

        Include "virtualdecs.var"

        Access agqtotals1, Set agqtotals1:app_NO = G_app_NO, generic ;

        scrollmessage = "" ;

        Include "stdkeys7.inc"

Style definition

                include "styles.inc"
                Displayonly Field Style {
                                  backgroundcolor="#CCCCCC"
                                }
                repeated displayonly field style {backgroundcolor="#CCCCCC"
                                }


Functions

        "redisplay" display/noreturn "agtmt8000" ;

        "func1" display/noreturn "agtmt8001" tagged property_fn;
        "func2" display/noreturn "agtmt8002" tagged liability_fn ;
        "func3" display/noreturn "agtmt8003" tagged crime_fn ;
        "func4" display/noreturn "agtmt8004" tagged inland_marine_fn ;
        "func5" display/noreturn "agtmt8005" tagged artisan_fn ;
        "func6" display/noreturn "agtmt8000a" tagged submit_fn ;

        "func7" sequence "worksheet"  tagged worksheet_fn ;
        "worksheet" continue begin
                             do create_macro
                             end  ;

        "func8" sequence "quoteletter"  tagged quote_letter_fn ;
        "quoteletter" continue begin
                               do print_quote_letter
                               end ;

        "back" sequence "goto" tagged back_fn ;
        "goto" continue begin
                        if g_portfolio not one of "Y" then
                            l_screen_1 = "agtmt001"
                        else
                            l_screen_1 = "agtmt9999"
                        function = "popup"
                        end ;
        "popup" display/noreturn l_screen_1 ;


        Include "stdfunc7.inc"

        reaccess ;

EVENT DEFINITION
        default eventhandler {
                                "REMOVE_SCREEN"  { function = "exit" abort () }
--                                "set_info_box" { setproperty(display_information_box, text, event.value) }
                             }

        eventHandler {
                  mousedoubleclicked {
                                       function = "select" abort()}
                                     } tagged t_listbox_field_event


Toolbar Definition
-- needs to be blank

Screen Entry
access agqname, set agqname:app_no = g_app_no, generic

access agqmaster, set agqmaster:app_no = g_app_no, generic

access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

access sfscompany, set sfscompany:company_id = agqname:company_id, generic

l_user_id = username
access sfsemail, set sfsemail:company_id = sfsdefault:company_id,
                     sfsemail:user_id    = l_user_id, generic

if agqname:quote_no <> 0 and
   agqname:company_id <> "FARMERS" then
    disable(submit_fn)

if agqname:line_of_business = 99 then
    disable(submit_fn)

if agqname:quote_no <> 0 and
   sfsemail:agent_no <> 0 and
   sfsdefault:company_id = "FARMERS" then
    disable(submit_fn)

access agqgeneral1, set agqgeneral1:app_no = g_app_no, generic

if agqgeneral1:app_no <> 0 then
begin
while agqgeneral1:app_no = g_app_no
    begin
    if agqgeneral1:perpetual_rated = 0 then
        begin
        access cpsgroupi, set cpsgroupi:company_id       = agqgeneral1:company_id,
                              cpsgroupi:state            = agqgeneral1:state,
                              cpsgroupi:line_of_business = agqgeneral1:rating_line_of_business,
                              cpsgroupi:class_code       = agqgeneral1:class_code, generic

        if cpsgroupi:class_code <> agqgeneral1:class_code and
           agqgeneral1:app_no = g_app_no and
           agqgeneral1:new_rate[1] = 0 then
            begin
            disable(worksheet_fn)
            disable(submit_fn)
            disable(quote_letter_fn)
            end
        end
    else
    if agqgeneral1:perpetual_rated = 1 and
       agqgeneral1:app_no = g_app_no and
       agqgeneral1:new_rate[1] = 0 then
        begin
        disable(worksheet_fn)
        disable(submit_fn)
        disable(quote_letter_fn)
        end

    next agqgeneral1
    end
end

access agqliability, set agqliability:app_no = g_app_no, generic

if agqliability:app_no <> 0 then
begin
while agqliability:app_no = g_app_no
    begin
    if agqliability:base_rate[1] = 0 and
       agqliability:company_rate[1] = 1 then
        begin
        disable(worksheet_fn)
        disable(quote_letter_fn)
        disable(submit_fn)
        end

    if agqliability:base_rate[2] = 0 and
       agqliability:company_rate[2] = 1 then
        begin
        disable(worksheet_fn)
        disable(quote_letter_fn)
        disable(submit_fn)
        end

    next agqliability
    end
end

Access SFSLINE_alt, Set SFSLINE_alt:COMPANY_ID = agqname:company_id,
                        SFSLINE_alt:LINE_OF_BUSINESS = agqname:line_of_business,
                        SFSLINE_alt:LOB_SUBLINE = "00",Generic

--setproperty(t_line_of_business,iconname,"")

if sfsdefault:company_id one of "FLEMINGTON" then
    hide(farmers_fn)
else
if sfsdefault:company_id one of "FARMERS" then
    hide(ficof_fn)
else
if sfsdefault:company_id one of "LEBINS" then
    begin
    hide(farmers_fn)
    hide(ficof_fn)
    end

l_username = username
l_company_id = sfsdefault:company_id

access sfsprofile,
   set sfsprofile:user_id  = l_username, exact

If SFSPROFILE:USER_ID <> L_USERNAME Then
  Begin
    L_USERNAME = "default"
    Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact
  End

if l_company_id = "FLEMINGTON" then
    begin
    l_server_name = sfsprofile:UNIX_SERVER
    l_current_web_page = "020webhelp_agtmt8000_scr_proposal_summary.htm"
    do change_current_browser(l_server_name,l_current_web_page)
    end

if agqtotals1:app_no = 0 then
    begin
    disable(worksheet_fn)
    disable(quote_letter_fn)
    disable(submit_info)
    hide(totals)
    hide(location_info)
    end
else
    hide(first_time_info)

access sfsline, set sfsline:company_id = sfsdefault:company_id,
                    sfsline:line_of_business = agqtotals1:line_of_business,
                    sfsline:lob_subline = "00", generic

access agqgeneral1, set agqgeneral1:app_no = g_app_no, generic

if agqgeneral1:app_no <> g_app_no then
    disable(crime_fn)

if sfsline:lob_code one of "LIABILITY" then
    begin
    disable(property_fn)
    disable(artisan_fn)
    disable(crime_fn)
    disable(inland_marine_fn)
    end

if sfsline:lob_code one of "ARTISAN" then
    begin
    disable(property_fn)
    disable(liability_fn)
    disable(crime_fn)
    disable(inland_marine_fn)
    end

if sfsline:lob_code one of "PROPERTY" then
    begin
    disable(liability_fn)
    disable(artisan_fn)
    end

if sfsline:lob_code one of "CINLAND" then
    begin
    disable(liability_fn)
    disable(artisan_fn)
    disable(property_fn)
    disable(crime_fn)
    end

if function = "BACK" then
    begin
    access agqgeneral1, set agqgeneral1:app_no = g_app_no, generic

    access agqbusiness, set agqbusiness:app_no = g_app_no, generic

    access agqliability, set agqliability:app_no = g_app_no, generic

    access agqartisan, set agqartisan:app_no = g_app_no, generic

    access agqcrime1, set agqcrime1:app_no = g_app_no, generic

    access agqinland, set agqinland:app_no = g_app_no, generic

    if sfscompany:debug_mode = 0 then
        begin
        if agqgeneral1:app_no = g_app_no and
           g_app_no <> 0 then
            proc("csbatch agtup8001 %s",str(g_app_no))/noconsole
        if agqbusiness:app_no = g_app_no and
           g_app_no <> 0 then
            proc("csbatch agtup8001a %s",str(g_app_no))/noconsole
        if agqliability:app_no = g_app_no and
           g_app_no <> 0 then
            proc("csbatch agtup8002 %s",str(g_app_no))/noconsole
        if agqcrime1:app_no = g_app_no and
           g_app_no <> 0 then
            begin
            l_commandline_1 = str(g_app_no,11) + str(g_line_of_business,4)
            proc("csbatch agtup8003 %s",l_commandline_1)/noconsole
            end
        if agqinland:app_no = g_app_no and
           g_app_no <> 0 then
            begin
            l_commandline_1 = str(g_app_no,11) + str(g_line_of_business,4)
            proc("csbatch agtup8004 %s",l_commandline_1)/noconsole
            end
        if agqartisan:app_no = g_app_no and
           g_app_no <> 0 then
            proc("csbatch agtup8005 %s",str(g_app_no))/noconsole
        end
    else
        begin
        if agqgeneral1:app_no = g_app_no and
           g_app_no <> 0 then
            proc("csbatch agtup8001 %s",str(g_app_no))
        if agqbusiness:app_no = g_app_no and
           g_app_no <> 0 then
            proc("csbatch agtup8001a %s",str(g_app_no))
        if agqliability:app_no = g_app_no and
           g_app_no <> 0 then
            proc("csbatch agtup8002 %s",str(g_app_no))
        if agqcrime1:app_no = g_app_no and
           g_app_no <> 0 then
            begin
            l_commandline_1 = str(g_app_no,11) + str(g_line_of_business,4)
            proc("csbatch agtup8003 %s",l_commandline_1)
            end
        if agqinland:app_no = g_app_no and
           g_app_no <> 0 then
            begin
            l_commandline_1 = str(g_app_no,11) + str(g_line_of_business,4)
            proc("csbatch agtup8004 %s",l_commandline_1)
            end
        if agqartisan:app_no = g_app_no and
           g_app_no <> 0 then
            proc("csbatch agtup8005 %s",str(g_app_no))
        end


    if ((agqgeneral1:app_no = g_app_no or
       agqbusiness:app_no = g_app_no or
       agqliability:app_no = g_app_no or
       agqartisan:app_no = g_app_no or
       agqinland:app_no = g_app_no) and
       g_app_no <> 0) then
        begin
        do get_totals
        do final_total
        function = "redisplay"
        end
    else
        begin
        access agqtotals1_alias, set agqtotals1_alias:app_no = g_app_no, generic

        if agqtotals1_alias:app_no = g_app_no then
            begin
            access agqamt, set agqamt:app_no = g_app_no, generic

            if agqamt:app_no = g_app_no then
                begin
                change agqamt
                    begin
                    agqamt:lob_totals[2]    = 0
                    agqamt:lob_terrorism[2] = 0
                    agqamt:lob_surcharge[2] = 0
                    end
                end

            change agqtotals1_alias
                begin
                agqtotals1_alias:property_total = 0
                agqtotals1_alias:business_income_total = 0
                agqtotals1_alias:liability_Total = 0
                agqtotals1_alias:artisan_total = 0
                agqtotals1_alias:crime_total = 0
                agqtotals1_alias:inland_marine_total = 0
                agqtotals1_alias:terrorism_premium = 0
                end
        function = "redisplay"
            end

        end
    end

if agqtotals1:app_no = 0 or
   agqtotals1:line_of_business = 0 then
    function = "ADD"

Access Validation
If agqtotals1:app_NO <> G_app_NO Then
    Error 1000 ;

screen at 1,1 to 30,100
Properties
        {
        Layouttype = screen
        transparent = False
        backgroundcolor = "#ADD8E6"
        scrollbarpolicy = always
        }
{

    Panel at 1,1 to 2,100
        Properties
            {
            layouttype = screen
            }
        {
        components
            guidetext at 1,1 to 2,40
                properties
                    {
                    iconname = "qp_logo.gif"
                    }
            guidetext at 1,83 to 2,100 tagged ficof_fn
                properties
                    {
                    iconname = "ficof_logo.gif"
                    }
            guidetext at 1,83 to 2,100 tagged farmers_fn
                properties
                    {
                    iconname = "salem_logo.gif"
                    }
            guidetext at 1,35 to 2,100 tagged t_line_of_business
                Properties
                   {
                   iconname = ""
                   }

        }

panel at 3,1 to 4,100
Properties
        {
        LayoutType = screen
        backgroundcolor = "Grey"
        transparent = False
        }
{
components
          guidetext at 1.45,1 to 1.45,40     tagged display_information_box
                properties
                  {
                    text = "Commercial Multi Peril..."
                    fontsize = 18
                    fontstyle = BOLD
                    transparent = False
                    fontname = "arial"
                    backgroundcolor = "Grey"
                  }
        event
                {
                mouseclicked = ""
                }

}

Panel at 3.45,75 to 4.45, 100 Tagged quote_no
Properties
        {
          LayoutType = screen
        }
{
%%
App No: ___________

%%
fields
101     begin
        if function one of "ADD" and
           agqtotals1:app_no = 0 then
            begin
            if g_portfolio <> "Y" then
                begin
                do access_sfscsexec
                agqtotals1:app_no = i_csexec_number
                g_app_no         = i_csexec_number
                l_app_no         = i_csexec_number
                end
            else
                begin
                do access_sfscsexec
                agqtotals1:app_no = g_app_no
                l_app_no         = g_app_no
                end

            access agqmaster, set agqmaster:app_no = g_app_no, generic

            if agqmaster:app_no <> g_app_no then
                begin
                add agqmaster
                    begin
                    agqmaster:app_no = g_app_no
                    agqmaster:state  = sfsdefault:state
                    end
                end

            l_user_id = username
            access sfsemail, set sfsemail:company_id = sfsdefault:company_id,
                                 sfsemail:user_id    = l_user_id, generic

/*            access agqname, set agqname:app_no = g_app_no, generic

            if agqname:app_no <> g_app_no then
                begin
                add agqname
                    begin
                    agqname:app_no   = g_app_no
                    agqname:company_id = sfsdefault:company_id
                    agqname:agent_no = sfsemail:agent_no
                    if agqname:agent_no = 0 then
                        agqname:agent_No = 9999
                    end
                end*/
            end
        end
        agqtotals1:APP_NO/displayonly ;

}

Panel at 5,1 to 6,100 Tagged icon_line2_tg
Properties
        {
          LayoutType = screen
--          Transparent = False
--          backgroundcolor = "#ADD8E6"
        }
{
Components

        Button at 1.5,5   tagged worksheet_fn
        Properties {
                Iconname = "btn_view_print_worksheet.bmp"
                }
        Events  {
                Action = worksheet_fn
                }

        Button at 1.5,35   tagged change_fn
        Properties {
                Iconname = "btn_edit.bmp"
                }
        Events  {
                Action = change_fn
                }

        Button at 1.5,60 tagged quote_letter_fn
        Properties {
                Iconname = "btn_view_print_proposal.bmp"
                }
        Events  {
                Action = quote_letter_fn
                }
    }

Panel at 7,35 to 7,65
    Properties {
               layouttype = row
               }
    {
    Components
        Button at 1,55 tagged accept_fn
            properties {
                       Iconname = "btn_accept_edits.bmp"
                       }
            Events     {
                       mouseclicked = accept
                       }

    }

    Panel at 5,94 to 6,96 tagged button_panel
        Properties
            {
            layouttype = column
            }
        {
        Components
            Button to 1,1
                properties
                    {
                    Iconname = "btn_print_screen.bmp"
                    }
                events
                    {
                    action
                        {
                        function = "print"
                        abort()
                        }
                    }
        }


   Panel at 6.45,92
        Properties
            {
            layouttype = column
            }
      {
        Components
            guidetext to 1,1
                properties
                    {
                      text = "agtmt8000.sd"
                      fontsize = 9
                    }
      }

-- draw a line
panel at 8,1 to 8,100 tagged line_panel_1
    {
    Components
        line at 1,1 to 1,100
            Properties
                {
                Linestyle = embossed
                Linewidth = 5
                Backgroundcolor = "black"
                }
    }


Panel at 9,2 to 9,100
Properties
        {
          LayoutType = screen
        }
{
%%
  Effective Date: __________  Form of Business: _ ____________________________________________

%%

fields
101     begin
        if function one of "ADD", "CHANGE" then
            begin
            enable(accept_fn)
            disable(back_fn)
            end
        else
            begin
            disable(accept_fn)
            enable(back_fn)
            end

        access agqamt, set agqamt:app_no = g_app_no, generic

        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "004webhelp_agtmt401_scr_rating_info_tbx_eff_date.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        if function one of "ADD", "NEW" then
            begin
            if agqtotals1:eff_date = 0 and
               g_portfolio <> "Y" then
                agqtotals1:eff_date = todaysdate
            else
                agqtotals1:eff_date = agqamt:eff_date
            end
        access agqname, set agqname:app_no = g_app_no, generic

        access agqmaster, set agqmaster:app_no = g_app_no, generic

        if function one of "ADD", "NEW" then
        begin
        if agqname:line_of_business = 99 then
            begin
            l_fob = agqmaster:form_of_business
            l_fob_desc = agqmaster:fob_description
            agqtotals1:form_of_business = agqmaster:form_of_business
            if agqmaster:form_of_business one of "T" then
                agqtotals1:fob_description = agqmaster:fob_description
            end
        else
            begin
            l_fob = agqtotals1:form_of_business
            l_company_id = sfsdefault:company_id
            access sfsfob, set sfsfob:company_id       = l_company_id,
                               sfsfob:form_of_business = agqtotals1:form_of_business, generic

            l_fob_desc = sfsfob:description
            end
        end

        end
        agqtotals1:eff_date/tabstop/default mandatory
        if agqtotals1:eff_date < todaysdate - 30 then
            error "The effective date can not be more than 30 days from todaysdate" ;
102     begin
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "005webhelp_agtmt401_scr_rating_info_dbx_fob.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        access sfsfob_alias, set sfsfob_alias:company_id = l_company_id, generic

        if agqtotals1:form_of_business = "" and
           agqname:line_of_business <> 99 then
            activehelp()
        end
        agqtotals1:form_of_business/default/tabstop/uppercase mandatory
        hide if agqname:line_of_business = 99
        access sfsfob, set sfsfob:company_id = l_company_id,
                           sfsfob:form_of_business = agqtotals1:form_of_business, generic
        if agqtotals1:form_of_business <> sfsfob:form_of_business then
            error "Invalid Form of Business Entered"

        activehelp sfsfob_alias:description;
102     agqtotals1:form_of_business/displayonly ;
103     agqtotals1:fob_description/displayonly ;
103     begin
        access sfsfob, set sfsfob:company_id = l_company_id,
                           sfsfob:form_of_business = agqtotals1:form_of_business, generic
        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            {
            if l_company_id = "FLEMINGTON" then
                begin
                l_current_web_page = "006webhelp_agtmt401_scr_rating_info_tbx_fob_other.htm"
                do change_current_browser(l_server_name,l_current_web_page)
                end
            }
        end
        sfsfob:description/default/tabstop/uppercase
        hide if agqtotals1:form_of_business one of "T"
        hide if agqname:line_of_business = 99;
103     agqtotals1:fob_description/default/tabstop/uppercase
        hide if agqtotals1:form_of_business not one of "T"
        hide if agqname:line_of_business = 99 ;



}

Panel at 10,2 to 11,100
Properties
        {
          LayoutType = screen
        }
{
%%
    Insured Name: __________________________________________________  Exclude Terrorism:~~_
Line of Business: ____   __________________________________________________

%%

fields
101     begin
        if g_portfolio = "Y" and
           function one of "ADD", "NEW" then
            agqtotals1:name = agqamt:name
        end
        agqtotals1:name/default/uppercase/tabstop mandatory;
102     agqtotals1:exclude_terrorism/checkbox/values="0,1"/default ;
201     begin
        access sfsline_alias, set sfsline_alias:company_id = sfsdefault:company_id, generic

        end
        agqtotals1:line_of_business/default/tabstop  mandatory
        access sfsline, set sfsline:company_id = sfsdefault:company_id,
                            sfsline:line_of_business = agqtotals1:line_of_business,
                            sfsline:lob_subline = "00", generic

        if agqtotals1:line_of_business <> sfsline:line_of_business or
           agqtotals1:line_of_business = 0 then
            error "Invalid Line of Business Entered"

        Activehelp If SFSLINE_alias:USE = "Y" and
                      sfsline_alias:lob_subline = "00" and
                      sfsline_alias:lob_code one of "LIABILITY", "PROPERTY", "CINLAND", "ARTISAN", "SMP" Then
                       SFSLINE_alias:LINE_OF_BUSINESS
                   Else
                       NULL/width=5/heading="Line"/returntext ,

                   If SFSLINE_alias:USE = "Y" and
                      sfsline_alias:lob_subline = "00" and
                      sfsline_alias:lob_code one of "LIABILITY", "PROPERTY", "CINLAND", "ARTISAN", "SMP" Then
                       SFSLINE_alias:DESCRIPTION
                   Else
                       NULL/width=30/heading="Description" ;
202     begin
        access sfsline, set sfsline:company_id = sfsdefault:company_id,
                            sfsline:line_of_business = agqtotals1:line_of_business,
                            sfsline:lob_subline = "00", generic

        if sfsline:lob_code one of "LIABILITY" then
            begin
            disable(property_fn)
            disable(crime_fn)
            disable(artisan_fn)
            disable(inland_marine_fn)
            end

        if sfsline:lob_code one of "ARTISAN" then
            begin
            disable(property_fn)
            disable(liability_fn)
            disable(crime_fn)
            disable(inland_marine_fn)
            end

        if sfsline:lob_code one of "PROPERTY" then
            begin
            disable(liability_fn)
            disable(artisan_fn)
            end

        if sfsline:lob_code one of "CINLAND" then
            begin
            disable(liability_fn)
            disable(artisan_fn)
            disable(property_fn)
            disable(crime_fn)
            end

        if function one of "ADD", "NEW", "CHANGE", "CHG" then
            begin
            do update_agqmaster
            end
        end
        sfsline:description ;

}

-- draw a line
panel at 12,1 to 12,100 tagged line_panel_1
    {
    Components
        line at 1,1 to 1,100
            Properties
                {
                Linestyle = embossed
                Linewidth = 5
                Backgroundcolor = "black"
                }
    }


Panel at 13,1 to 14,95   tagged location_info
        Properties {
                LayoutType = screen
        }
        {
         Components
           guidetext at 2,10 to 2,18
             properties
               {
                 text = "Property"
                 fontsize = 12
                 fontname = "arial"
               }
           guidetext at 1,22 to 1,30
             properties
               {
                 text = "Business"
                 fontsize = 12
                 fontname = "arial"
               }
           guidetext at 2,36 to 2,43
             properties
               {
                 text = "Liability"
                 fontsize = 12
                 fontname = "arial"
               }
           guidetext at 2,49 to 2,57
             properties
               {
                 text = "Artisan"
                 fontsize = 12
                 fontname = "arial"
               }
           guidetext at 2,62 to 2,70
             properties
               {
                 text = "Crime"
                 fontsize = 12
                 fontname = "arial"
               }
           guidetext at 1,73 to 1,80
             properties
               {
                 text = "Inland"
                 fontsize = 12
                 fontname = "arial"
               }

           guidetext at 2,83 to 2,93
             properties
               {
                 text = "Terrorism"
                 fontsize = 12
                 fontname = "arial"
               }
           guidetext at 2,22 to 2,30
             properties
               {
                 text = "  Income"
                 fontsize = 12
                 fontname = "arial"
               }
           guidetext at 2,73 to 2,80
             properties
               {
                 text = "Marine"
                 fontsize = 12
                 fontname = "arial"
               }
        }

scrollpanel at 16,5 to 19,100 tagged location_info
properties
        {
        scrollbarpolicy = asneeded
        }
{

Panel
properties
        {
--        scrollbarpolicy = asneeded
        }
{
%%
  __________   __________   __________   __________   _________   _________  _________

%%

components

fields
0101    agqtotals1:property_total/displayonly      tagged LINE_ITEMS ;
0102    agqtotals1:business_income_total/displayonly      tagged LINE_ITEMS ;
0103    agqtotals1:liability_total/displayonly     tagged LINE_ITEMS ;
0104    agqtotals1:artisan_total/displayonly       tagged LINE_ITEMS ;
0105    agqtotals1:crime_total/displayonly         tagged LINE_ITEMS ;
0106    agqtotals1:inland_marine_total/displayonly tagged LINE_ITEMS ;
0107    agqtotals1:terrorism_premium/displayonly     tagged LINE_ITEMS ;

}

}

panel at 20,1 to 20,100 tagged totals
    {
    Components
        line at 1,1 to 1,100
            Properties
                {
                Linestyle = embossed
                Linewidth = 5
                Backgroundcolor = "black"
                }
    }


Panel at 21,1 to 21,100 Tagged totals
Properties
        {
        Scrollbarpolicy    = asneeded
        foregroundcolor    = "blue"
        }
event
        {
        mouseclicked = ""
        }
{
%%
                              Policy Premium:  ___________
%%

components

fields
101     begin
        l_total = agqtotals1:property_total +
                  agqtotals1:business_income_total +
                  agqtotals1:liability_total +
                  agqtotals1:artisan_total +
                  agqtotals1:crime_total +
                  agqtotals1:inland_marine_total +
                  agqtotals1:terrorism_premium
        l_tag = tag("totals_fn")
        setproperty(l_tag,foregroundcolor,"blue")
        end
        l_total/displayonly/mask="ZZZ,ZZZ,ZZZ" tagged totals_fn ;

}

panel at 13,15 to 15,85 tagged first_time_info
Properties
        {
        LayoutType = screen
        backgroundcolor = "Grey"
        transparent = False
        }
{
components
          guidetext at 2,1
                properties
                  {
                    text = "     To start a quote select one of the coverage buttons below"
                    fontsize = 18
                    fontstyle = BOLD
                    transparent = False
                    fontname = "arial"
                    backgroundcolor = "Grey"
                  }
        event
                {
                mouseclicked = ""
                }

}

panel at 23,1 to 23,100 tagged line_panel_1
    {
    Components
        line at 1,1 to 1,100
            Properties
                {
                Linestyle = embossed
                Linewidth = 5
                Backgroundcolor = "black"
                }
    }

panel at 24,1 to 28,100
Properties
        {
        scrollbarpolicy = asneeded
        }
{

Panel at 1,2 to 1, 100 tagged property_fn--24,2 to 24,100 Tagged property_fn
Properties
        {
        LayoutType = screen
        }
{
Components
        Button at 1,1   tagged property_fn
            Properties
                {
                Iconname = "btn_view_property.bmp"
                }
            Events
                {
                Action = property_fn
                }
        }

Panel at 1,35 to 1, 100 tagged liability_fn--24,35 to 24,100 Tagged liability_fn
Properties
        {
        LayoutType = screen
        }
{
Components
        Button at 1,1    tagged liability_fn
        Properties {
                Iconname = "btn_view_liability.bmp"
                }
        Events  {
                Action = liability_fn
                }

}

Panel at 1,70 to 1,100 tagged artisan_fn--24,70 to 24,100 Tagged artisan_fn
Properties
        {
        LayoutType = screen
        }
{
Components
        Button at 1,1    tagged artisan_fn
        Properties {
                Iconname = "btn_view_artisan.bmp"
                }
        Events  {
                Action = artisan_fn
                }

}

Panel at 3,10 to 3,100 tagged crime_Fn--26,10 to 26,100 Tagged crime_fn
Properties
        {
        LayoutType = screen
        }
{
Components
        Button at 1,1    tagged crime_fn
        Properties {
                Iconname = "btn_view_crime.bmp"
                }
        Events  {
                Action = crime_fn
                }

}

Panel at 3,55 to 3, 100 tagged inland_marine_fn--26,55 to 26,100 Tagged inland_marine_fn
Properties
        {
        LayoutType = screen
        }
{
Components
        Button at 1,1     tagged inland_marine_fn
        Properties {
                Iconname = "btn_view_inland_marine.bmp"
                }
        Events  {
                Action = inland_marine_fn
                }

}

}

panel at 27,1 to 27,100 tagged line_panel_1
    {
    Components
        line at 1,1 to 1,100
            Properties
                {
                Linestyle = embossed
                Linewidth = 5
                Backgroundcolor = "black"
                }
    }


Panel at 28,5 to 28,100 Tagged icon_line2_tg
Properties
        {
        LayoutType = screen
        }
{
Components
        Button at 1,1   tagged back_fn
        Properties {
                Iconname = "btn_back_to_main_screen.bmp"
                }
        Events  {
                Action {
                       if g_portfolio <> "Y" then
                          begin
                          l_continue_2 = dialog("EXITING","warning.bmp","You are about to leave the application, Do you wish to continue","Yes","No")
                          if l_continue_2 = "Yes" then
                              begin
                              function = "back"
                              abort()
                              end
                          end
                       else
                          begin
                          function = "back"
                          abort()
                          end
                       }
                }

}

Panel at 28,70 to 28,100 Tagged ficof_fn
Properties
        {
        LayoutType = screen
        }
{
Components
        Button at 1,1   tagged submit_info
        Properties {
  --              Text = "Submit to Underwriting"
                Iconname = "btn_app_entry.bmp"
                }
        Events  {
                Action = submit_fn
                }

}

Panel at 28,70 to 28,100 Tagged farmers_fn
Properties
        {
        LayoutType = screen
        }
{
Components
        Button at 1,1   tagged submit_info
        Properties {
  --              Text = "Submit to Underwriting"
                Iconname = "btn_app_entry.bmp"
                }
        Events  {
                Action = submit_fn
                }

}

Panel at 28,60 to 30,90 Tagged lebins_fn
Properties
        {
        LayoutType = column
        }
{
Components
        Button at 1,1   tagged submit_info
        Properties {
  --              Text = "Submit to Underwriting"
                Iconname = "btn_app_entry_lebins.bmp"
                }
        Events  {
                Action = submit_fn
                }

}

panel at 29,1 to 34,100 tagged ficof_fn

Properties
        {
          LayoutType = screen
--          Transparent = False
          backgroundcolor = "white"
        }
{
      Components
         browser at 1,1 to 7,100  tagged helper_tg
             properties {
                          url = ""
                        }
}


}

update
if updateok = "YES" and
   abort = "NO" then
    begin
    access agqgeneral1, set agqgeneral1:app_no = g_app_no, generic

    access agqbusiness, set agqbusiness:app_no = g_app_no, generic

    access agqliability, set agqliability:app_no = g_app_no, generic

    access agqartisan, set agqartisan:app_no = g_app_no, generic

    access agqcrime1, set agqcrime1:app_no = g_app_no, generic

    access agqinland, set agqinland:app_no = g_app_no, generic

    if sfscompany:debug_mode = 0 then
        begin
        if agqgeneral1:app_no = g_app_no then
            proc("csbatch agtup8001 %s",str(g_app_no))/noconsole
        if agqbusiness:app_no = g_app_no then
            proc("csbatch agtup8001a %s",str(g_app_no))/noconsole
        if agqliability:app_no = g_app_no then
            proc("csbatch agtup8002 %s",str(g_app_no))/noconsole
        if agqcrime1:app_no = g_app_no and
           g_app_no <> 0 then
            begin
            l_commandline_1 = str(g_app_no,11) + str(g_line_of_business,4)
            proc("csbatch agtup8003 %s",l_commandline_1)/noconsole
            end
        if agqinland:app_no = g_app_no and
           g_app_no <> 0 then
            begin
            l_commandline_1 = str(g_app_no,11) + str(g_line_of_business,4)
            proc("csbatch agtup8004 %s",l_commandline_1)/noconsole
            end
        if agqartisan:app_no = g_app_no then
            proc("csbatch agtup8005 %s",str(g_app_no))/noconsole
        end
    else
        begin
        if agqgeneral1:app_no = g_app_no then
            proc("csbatch agtup8001 %s",str(g_app_no))
        if agqbusiness:app_no = g_app_no then
            proc("csbatch agtup8001a %s",str(g_app_no))
        if agqliability:app_no = g_app_no then
            proc("csbatch agtup8002 %s",str(g_app_no))
        if agqcrime1:app_no = g_app_no and
           g_app_no <> 0 then
            begin
            l_commandline_1 = str(g_app_no,11) + str(g_line_of_business,4)
            proc("csbatch agtup8003 %s",l_commandline_1)
            end
        if agqinland:app_no = g_app_no and
           g_app_no <> 0 then
            begin
            l_commandline_1 = str(g_app_no,11) + str(g_line_of_business,4)
            proc("csbatch agtup8004 %s",l_commandline_1)
            end
        if agqartisan:app_no = g_app_no then
            proc("csbatch agtup8005 %s",str(g_app_no))
        end

    if agqgeneral1:app_no = g_app_no or
       agqbusiness:app_no = g_app_no or
       agqliability:app_no = g_app_no or
       agqartisan:app_no = g_app_no or
       agqinland:app_no = g_app_no then
        begin
        do get_totals
        do final_total
--        function = "redisplay"
        end
    else
        begin
        access agqtotals1_alias, set agqtotals1_alias:app_no = g_app_no, generic

        if agqtotals1_alias:app_no = g_app_no then
            begin
            change agqtotals1_alias
                begin
                agqtotals1_alias:property_total = 0
                agqtotals1_alias:business_income_total = 0
                agqtotals1_alias:liability_Total = 0
                agqtotals1_alias:artisan_total = 0
                agqtotals1_alias:crime_total = 0
                agqtotals1_alias:inland_marine_total = 0
                agqtotals1_alias:terrorism_premium = 0
                end
            end

        end
    function = "redisplay"
    end

screen exit
do update_agqmaster

procedure definition

procedure update_agqmaster
BEGIN
access agqliability, set agqliability:app_no = g_app_no, generic

while agqliability:app_no = g_app_no
    begin
    change agqliability
        begin
        agqliability:remove_terrorism_form = agqtotals1:exclude_terrorism
        end

    next agqliability
    end

access agqartisan, set agqartisan:app_no = g_app_no, generic

while agqartisan:app_no = g_app_no
    begin
    change agqartisan
        begin
        agqartisan:remove_terrorism_form = agqtotals1:exclude_terrorism
        end

    next agqartisan
    end

access agqgeneral1, set agqgeneral1:app_no = g_app_no, generic

while agqgeneral1:app_no = g_app_no
    begin
    change agqgeneral1
        begin
        agqgeneral1:remove_terrorism_form = agqtotals1:exclude_terrorism
        end

    next agqgeneral1
    end

access agqinland, set agqinland:app_no = g_app_no, generic

while agqinland:app_no = g_app_no
    begin
    change agqinland
        begin
        agqinland:remove_terrorism_form = agqtotals1:exclude_terrorism
        end

    next agqinland
    end

access agqmaster, set agqmaster:app_no = g_app_no, exact

if agqmaster:app_no = g_app_no then
    begin
    change agqmaster
        {
        if agqmaster:exclude_terrorism <> agqtotals1:exclude_terrorism then
            agqmaster:exclude_terrorism = agqtotals1:exclude_terrorism
        if agqmaster:form_of_business <> agqtotals1:form_of_business then
            agqmaster:form_of_business  = agqtotals1:form_of_business
        if agqmaster:fob_description <> l_fob_description1 then
            agqmaster:FOB_DESCRIPTION   = l_fob_description1
        }
    end
else
    begin
    add agqmaster
        begin
        agqmaster:app_no            = g_app_no
        agqmaster:exclude_terrorism = agqtotals1:exclude_terrorism
        agqmaster:form_of_business  = agqtotals1:form_of_business
        agqmaster:fob_description   = l_fob_description1
        end
    end

access agqname, set agqname:app_no = g_app_no, generic

access agqamt, set agqamt:app_no = g_app_no, generic

if agqname:app_no = g_app_no then
    begin
    change agqname
        begin
        agqname:name[1]          = agqtotals1:name
        if agqname:line_of_business <> 99 then
            agqname:line_of_business = agqtotals1:line_of_business
        if agqname:eff_date <> agqtotals1:eff_date then
            begin
            agqname:eff_date     = agqtotals1:eff_date
            agqname:exp_date      = dateadd(agqtotals1:eff_date,0,1)
            end
        if agqtotals1:line_of_business = 8 then
            agqname:package      = 1
        else
            agqname:package      = 0
        end
    end
else
    begin
    add agqname
        begin
        agqname:app_no           = g_app_no
        agqname:trans_date       = todaysdate
        agqname:company_id       = sfsdefault:company_id
        agqname:agent_no = sfsemail:agent_no
        if agqname:agent_no      = 0 then
            agqname:agent_No     = 9999
        agqname:name[1]          = agqtotals1:name
        agqname:eff_date         = agqtotals1:eff_date
        agqname:exp_date         = dateadd(agqtotals1:eff_date,0,1)
        if agqname:line_of_business <> 99 then
            agqname:line_of_business = agqtotals1:line_of_business
        if agqtotals1:line_of_business = 8 then
            agqname:package      = 1
        else
            agqname:package      = 0
        end
    end

if agqname:line_of_business <> 99 then
    begin
    change agqname
        begin
        agqname:line_of_business = agqtotals1:line_of_business
        end
    end

END

procedure access_sfscsexec
begin
l_csexec_application = "APQQUOTE                 "

access sfscsexec, set sfscsexec:application = l_csexec_application, generic

change sfscsexec
    begin
    i_csexec_number = sfscsexec:application_number + 1
    sfscsexec:application_number = i_csexec_number
    end

end

procedure change_current_browser (string p_server_name, string p_current_web_page)
BEGIN
l_web_site_address = trun(p_server_name) + trun(p_current_web_page)
setproperty(helper_tg,url,trun(l_web_site_address))

END

procedure print_quote_letter
begin
L_CSEXEC_APPLICATION = "PRINT"/raw

Access SFSCSEXEC, Set SFSCSEXEC:APPLICATION = L_CSEXEC_APPLICATION , Exact

If SFSCSEXEC:APPLICATION_NUMBER = 0 Then
    Begin
    L_CSEXEC_NUMBER = 99999
    End
Else
    Begin
    L_CSEXEC_NUMBER = SFSCSEXEC:APPLICATION_NUMBER + 1

    Change SFSCSEXEC
        Begin
        SFSCSEXEC:APPLICATION_NUMBER = L_CSEXEC_NUMBER
        End
    End

l_app           = "agq"
I_CSEXEC_NUMBER = L_CSEXEC_NUMBER
L_DEC           = L_APP+Str(I_CSEXEC_NUMBER)+".cq"
L_DEC_PDF       = L_APP+Str(I_CSEXEC_NUMBER)+".pdf"

If agqname:company_id = "LEBINS" then
  {
  if sfscompany:debug_mode = 0 then
      begin
      proc("cli csbatch agqmso8000e %s",str(g_app_no,11))/noconsole
      Proc("cli joinit agqmso8000e.cq %s<nl>",l_dec)/noconsole
      end
  else
      begin
      proc("cli csbatch agqmso8000e %s",str(g_app_no,11))
      Proc("cli joinit agqmso8000e.cq %s<nl>",l_dec)
      end

  }

access agqgeneral1, set agqgeneral1:app_no = g_app_no, generic

if agqgeneral1:app_no = g_app_no then
    begin
    if sfscompany:debug_mode = 0 then
        begin
        proc("cli csbatch agqmso8000 %s",str(g_app_no,11))/noconsole
        Proc("cli joinit agqmso8000.cq %s<nl>",l_dec)/noconsole
        end
    else
        begin
        proc("cli csbatch agqmso8000 %s",str(g_app_no,11))
        Proc("cli joinit agqmso8000.cq %s<nl>",l_dec)
        end
    end

access agqliability, set agqliability:app_no = g_app_no, generic

if agqliability:app_no = g_app_no then
    begin
    proc("cli csbatch agqmso8000a %s",str(g_app_no,11))/noconsole
    Proc("cli joinit agqmso8000a.cq %s<nl>",l_dec)/noconsole
    end

access agqartisan, set agqartisan:app_no = g_app_no, generic

if agqartisan:app_no = g_app_no then
    begin
    proc("cli csbatch agqmso8000b %s",str(g_app_no,11))/noconsole
    Proc("cli joinit agqmso8000b.cq %s<nl>",l_dec)/noconsole
    end

access agqcrime1, set agqcrime1:app_no = g_app_no, generic

if agqcrime1:app_no = g_app_no then
    begin
    proc("cli csbatch agqmso8000c %s",str(g_app_no,11))/noconsole
    Proc("cli joinit agqmso8000c.cq %s<nl>",l_dec)/noconsole
    end

access agqinland, set agqinland:app_no = g_app_no, generic

if agqinland:app_no = g_app_no then
    begin
    proc("cli csbatch agqmso8000d %s",str(g_app_no,11))/noconsole
    Proc("cli joinit agqmso8000d.cq %s<nl>",l_dec)/noconsole
    end

access agqapplication,
   set agqapplication:app_no = g_app_no, generic

/*if agqapplication:app_no = g_app_no then
  begin
    proc("cli csbatch agqmso8000a %s",str(g_app_no,11))/noconsole
    Proc("cli joinit agqmso8000a.cq %s<nl>",l_dec)/noconsole
  end*/

L_USERNAME = Trun(USERNAME)

Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact

If SFSPROFILE:USER_ID <> L_USERNAME Then
    Begin
    L_USERNAME = "default"
    Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact
    End

L_UNIX_PATH   = SFSPROFILE:UNIX_PATH/raw
L_UNIX_SERVER = SFSPROFILE:UNIX_SERVER/raw
L_CLIENT_PATH = SFSPROFILE:CLIENT_PATH/raw

access sfscompany, set sfscompany:company_id = sfsdefault:company_id, generic

If SFSCOMPANY:DEBUG_MODE = 0 Then
    Begin
    Proc("pcl2pdf -letter -csize -ra %s %s ",L_DEC, L_DEC_PDF)/noconsole
    Proc("chmod 777 %s ",L_DEC_PDF)/noconsole
    Proc("mv %s %s %s", L_DEC_PDF," ",Trun(L_UNIX_PATH))/noconsole
    End
Else
    Begin
    Proc("pcl2pdf -letter -csize -ra %s %s ",L_DEC, L_DEC_PDF)
    Proc("chmod 777 %s ",L_DEC_PDF)
    Proc("mv %s %s %s", L_DEC_PDF," ",Trun(L_UNIX_PATH))
    End

Proc("%s %s%s",L_CLIENT_PATH,Trun(L_UNIX_SERVER),Trun(L_DEC_PDF))/client
end

Procedure CREATE_MACRO
Begin
Do REFRESH_WORK_FILES
L_CSEXEC_APPLICATION = "PRINT"/raw

Access SFSCSEXEC, Set SFSCSEXEC:APPLICATION = L_CSEXEC_APPLICATION , Exact

If SFSCSEXEC:APPLICATION_NUMBER = 0 Then
    Begin
    L_CSEXEC_NUMBER = 99999
    End
Else
    Begin
    L_CSEXEC_NUMBER = SFSCSEXEC:APPLICATION_NUMBER + 1

    Change SFSCSEXEC
        Begin
        SFSCSEXEC:APPLICATION_NUMBER = L_CSEXEC_NUMBER
        End
    End

L_USERNAME = USERNAME
I_REPORTA = "agqpr8000"
I_REPORT = "agqpr8000.cq"
I_REPORT_CQE = "agqpr8000.cqe"
I_APP = "agq"
I_CSEXEC_NUMBER = L_CSEXEC_NUMBER
L_DEC = L_APP+Str(I_CSEXEC_NUMBER)+".cq"
L_DEC_PDF = L_APP+Str(I_CSEXEC_NUMBER)+".pdf"
I_PARAMETER = I_APP+Str(I_CSEXEC_NUMBER)+".par"
I_MACROA = I_APP+Str(I_CSEXEC_NUMBER)
I_MACRO = I_APP+Str(I_CSEXEC_NUMBER)+".mf"

access agqprint1, set agqprint1:app_no = g_app_no, generic

if agqprint1:app_no <> g_app_no then
    begin
    Add agqprint1
        Begin
        agqprint1:app_no = G_app_no
        end
    End
else
    begin
    delete agqprint1
    Add agqprint1
        Begin
        agqprint1:app_no = G_app_no
        end
    End

Deletefile(I_MACRO)
Writefile(I_MACRO,"cli rm agqpr8000.cq<nl>")
Writefile(I_MACRO,"cli csbatch agqpr8000<nl>")
Writefile(I_MACRO,"cli pcl2pdf agqpr8000.cq %s<nl>",l_dec)
Closefile(I_MACRO)

If SFSCOMPANY:DEBUG_MODE = 0 Then
    Proc("cli cq %s",I_MACRO)/noconsole
Else
    Proc("cli cq %s",I_MACRO)

L_USERNAME = Trun(USERNAME)

Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact

If SFSPROFILE:USER_ID <> L_USERNAME Then
    Begin
    L_USERNAME = "default"
    Access SFSPROFILE, Set SFSPROFILE:USER_ID = L_USERNAME, Exact
    End

L_UNIX_PATH   = SFSPROFILE:UNIX_PATH/raw
L_UNIX_SERVER = SFSPROFILE:UNIX_SERVER/raw
L_CLIENT_PATH = SFSPROFILE:CLIENT_PATH/raw

If SFSCOMPANY:DEBUG_MODE = 0 Then
    Begin
    Proc("cli mv %s %s",L_DEC,L_DEC_PDF)/noconsole
    Proc("cli chmod 777 %s ",L_DEC_PDF)/noconsole
    Proc("cli rm %s",L_DEC)/noconsole
    Proc("cli mv %s %s %s", L_DEC_PDF," ",Trun(L_UNIX_PATH))/noconsole
    End
Else
    Begin
    Proc("cli mv %s %s",L_DEC,L_DEC_PDF)
    Proc("cli chmod 777 %s ",L_DEC_PDF)
    Proc("cli rm %s",L_DEC)
    Proc("cli mv %s %s %s", L_DEC_PDF," ",Trun(L_UNIX_PATH))
    End

Proc("%s %s%s",L_CLIENT_PATH,Trun(L_UNIX_SERVER),Trun(L_DEC_PDF))/client/noconsole

access agqprint1, set agqprint1:app_no = g_app_no, generic

delete agqprint1

Do REFRESH_WORK_FILES
End

Procedure REFRESH_WORK_FILES
Begin
Proc ("cli agqprint1.mk")/noconsole
End

procedure check_state
begin
l_agqgeneral   = "N"
l_agqliability = "N"
l_agqartisan   = "N"
l_agqinland    = "N"
l_agqfarm      = "N"
access agqgeneral1, set agqgeneral1:app_no = g_app_no, generic

if agqgeneral1:app_no = g_app_no then
    begin
    l_state = agqgeneral1:state
    l_agqgeneral = "Y"
    end

access agqliability, set agqliability:app_no = g_app_no, generic

if agqliability:app_no = g_app_no then
    begin
    l_agqliability = "Y"
    if l_state = 0 then
        l_state = agqliability:state
    end

access agqartisan, set agqartisan:app_no = g_app_no, generic

if agqartisan:app_no = g_app_no then
    begin
    l_agqartisan = "Y"
    if l_state = 0 then
        l_state = agqartisan:state
    end

access agqinland, set agqinland:app_no = g_app_no, generic

if agqinland:app_no = g_app_no then
    begin
    l_agqinland = "Y"
    if l_state = 0 then
        l_state = agqinland:state
    end

access agqfarm, set agqfarm:app_no = g_app_no, generic

if agqfarm:app_no = g_app_no then
    begin
    l_agqfarm = "Y"
    if l_state = 0 then
        l_state = agqfarm:state
    end

if agqmaster:state = 0 or
   agqmaster:state <> l_state then
    begin
    access agqmaster_alias, set agqmaster_alias:app_no = g_app_no, exact

    if agqmaster_alias:app_no = g_app_no then
        begin
        change agqmaster_alias
            begin
            agqmaster_alias:state = l_state
            end
        end

    end

end

procedure cleanup_agqlocation
begin
Access agqLOCATION, Set agqLOCATION:app_no = agqmaster:app_no, generic

while agqlocation:app_no = agqmaster:app_no
    begin
    change agqlocation
        begin
        agqlocation:premium[10] = 0
        end

    next agqlocation
    end

end

procedure get_totals
begin
Access agqGENERAL1, Set agqgeneral1:app_no = agqtotals1:app_no, Generic

L_TOTAL_1             = 0
l_ec_vmm_total        = 0
l_fire_total          = 0
l_other_total         = 0
l_boiler_total        = 0
l_property_total_1    = 0
l_property_total      = 0
l_location_premium_11 = 0
l_property_warning    = "N"
While agqgeneral1:app_no = agqtotals1:app_no
    Begin
    access agqproperty2, set agqproperty2:app_no = agqgeneral1:app_no,
                             agqproperty2:prem_no  = agqgeneral1:prem_no,
                             agqproperty2:build_no = agqgeneral1:build_no, generic

    if agqgeneral1:total_premium[2] <> 0 then
        l_total_1  = agqgeneral1:total_premium[2] +
                     l_total_1
    else
        L_TOTAL_1  = agqgeneral1:TOTAL_PREMIUM[1] +
                     L_TOTAL_1
    if agqgeneral1:premium[5] <> 0 then
        l_fire_total = l_fire_total +
                       agqgeneral1:premium[5] +
                       agqgeneral1:premium[12]
    else
        l_fire_total = l_fire_total +
                       agqgeneral1:premium[1] +
                       agqgeneral1:premium[12]
    if agqgeneral1:premium[6] <> 0 then
        l_ec_vmm_total = l_ec_vmm_total +
                         agqgeneral1:premium[6]
    else
        l_ec_vmm_total = l_ec_vmm_total +
                         agqgeneral1:premium[2]
    l_boiler_total = l_boiler_total +
                     agqgeneral1:boilers_premium
    l_total_1      = l_total_1
    l_county       = agqgeneral1:county
    l_prem_no      = agqgeneral1:prem_no
    l_build_no     = agqgeneral1:build_no
    if agqgeneral1:total_premium[2] <> 0 then
        l_location_premium_11 = agqgeneral1:total_premium[2]
    else
        l_location_premium_11 = agqgeneral1:total_premium[1]
    if agqgeneral1:premium[7] <> 0 or
       agqgeneral1:premium[8] <> 0 then
        l_other_total      = l_other_total +
                             agqgeneral1:premium[7] +
                             agqgeneral1:premium[8]
    else
        l_other_total      = l_other_total +
                             agqgeneral1:premium[3] +
                             agqgeneral1:premium[4]

    if agqgeneral1:total_premium[2] <> 0 then
        l_property_total_1 = l_property_total_1 +
                             agqgeneral1:premium[5] +
                             agqgeneral1:premium[6] +
                             agqgeneral1:premium[7] +
                             agqgeneral1:premium[8]
    else
        l_property_total_1 = agqgeneral1:premium[1] +
                             agqgeneral1:premium[2] +
                             agqgeneral1:premium[3] +
                             agqgeneral1:premium[4]

    access cpsgroupi, set cpsgroupi:company_id       = agqgeneral1:company_id,
                          cpsgroupi:state            = agqgeneral1:state,
                          cpsgroupi:line_of_business = agqgeneral1:rating_line_of_business,
                          cpsgroupi:class_code       = agqgeneral1:class_code, generic

    if cpsgroupi:class_code <> agqgeneral1:class_code and
       agqgeneral1:app_no = g_app_no and
       agqgeneral1:new_rate[1] = 0 and
       agqgeneral1:perpetual_rated = 0 then
        l_property_warning = "Y"

    if agqgeneral1:perpetual_rated = 1 and
       agqgeneral1:app_no = g_app_no and
       agqgeneral1:new_rate[1] = 0 then
        l_property_warning = "Y"

    Next agqGENERAL1
    End

Access agqGENERAL1, Set agqgeneral1:app_no = agqMASTER:app_no, Generic

if agqgeneral1:app_no = g_app_no then
    begin
    l_lob_end_code = "P"
    do access_agqmisc
    l_fire_total          = l_fire_total + l_misc_premium
    l_total_1             = l_total_1 + l_misc_premium
    if sfsline_alt:lob_code one of "CPORTFOLIO" then
        begin
        access agqmastsupp, set agqmastsupp:app_no = g_app_no,
                                agqmastsupp:line_of_business = agqtotals1:line_of_business, generic

        Access agqGENERAL1, Set agqgeneral1:app_no = agqMASTER:app_no, Generic

        if agqgeneral1:app_no = agqmaster:app_no and
           l_boiler_total <> 0 then
            begin
            l_total_1             = l_total_1 + l_boiler_total --agqmastsupp:other_totals[4]
            l_location_premium_11 = l_location_premium_11 + l_boiler_total -- agqmastsupp:other_totals[4]
            end
/*        else
        if agqmastsupp:app_no = g_app_no then
            begin
            change agqmastsupp
                begin
                agqmastsupp:other_totals[4] = 0
                end
            end*/
        end
    else
        begin
        Access agqGENERAL1, Set agqgeneral1:app_no = agqMASTER:app_no, Generic

        if agqgeneral1:app_no = agqmaster:app_no and
           l_boiler_total <> 0 then
            begin
            l_total_1             = l_total_1 + l_boiler_total --agqmaster:other_totals[4]
            l_location_premium_11 = l_location_premium_11 + l_boiler_total --agqmaster:other_totals[4]
            end
/*        else
            begin
            access agqmaster_alias, set agqmaster_alias:app_no = g_app_no, generic

            if agqmaster_alias:app_no = g_app_no then
                begin
                change agqmaster_alias
                    begin
                    agqmaster_alias:other_totals[4] = 0
                    end
                end
            end*/
        end

    L_EFF_DATE_1 = Dateadd(agqNAME:EFF_DATE,0,1)
    If agqNAME:EXP_DATE < L_EFF_DATE_1 Then
        Begin
        L_DAYS_RATE = L_TOTAL_1 Divide 365
        L_DAYS = agqNAME:EXP_DATE - agqNAME:EFF_DATE
        L_PRO_RATA_PREMIUM = L_DAYS * L_DAYS_RATE
        L_TOTAL_1 = L_PRO_RATA_PREMIUM
        end
    end

Access agqBUSINESS, Set agqBUSINESS:app_no = agqtotals1:app_no, Generic

L_TOTAL_2             = 0
l_bi_total            = l_total_1
l_bi_total_1          = 0
l_location_premium_11 = 0
While agqBUSINESS:app_no = agqtotals1:app_no
    Begin
    L_TOTAL_2  = agqBUSINESS:TOTAL_PREMIUM + L_TOTAL_2
    l_prem_no  = agqbusiness:prem_no
    l_build_no = agqbusiness:build_no
    l_location_premium_11 = agqbusiness:total_premium -
                            agqbusiness:boiler_premium
    l_bi_total       = l_bi_total + agqbusiness:total_premium
    l_ec_vmm_total   = l_ec_vmm_total +
                       agqbusiness:bi_premium[2]
    l_other_total    = l_other_total +
                       agqbusiness:bi_premium[3]
    l_boiler_total   = l_boiler_total +
                       agqbusiness:boiler_premium
    l_bi_total_1     = l_bi_total_1 +
                       agqbusiness:bi_premium[2] +
                       agqbusiness:bi_premium[3] +
                       agqbusiness:boiler_premium
    l_fire_total     = l_fire_total +
                       agqbusiness:bi_premium[1]
    l_property_total = l_property_total +
                       l_ec_vmm_total +
                       l_other_total +
                       l_boiler_total +
                       l_fire_total

    Next agqBUSINESS
    End

Access agqGENERAL1, Set agqgeneral1:app_no = agqtotals1:app_no, Generic

if agqgeneral1:app_no = g_app_no then
    begin
    L_TOTAL_2 = l_total_2 + l_misc_premium

    do property_minimum_premium

    L_EFF_DATE_1 = Dateadd(agqNAME:EFF_DATE,0,1)
    If agqNAME:EXP_DATE < L_EFF_DATE_1 Then
        Begin
        L_DAYS_RATE = L_TOTAL_2 Divide 365
        L_DAYS = agqNAME:EXP_DATE - agqNAME:EFF_DATE
        L_PRO_RATA_PREMIUM = L_DAYS * L_DAYS_RATE
        L_TOTAL_2 = L_PRO_RATA_PREMIUM
        end

    if l_property_warning = "Y" then
        begin
        l_total_1 = 0
        l_total_2 = 0
        warning "This quote is incomplete"
        end

    access agqtotals1_alias, set agqtotals1_alias:app_no = g_app_no, generic

    if agqtotals1_alias:app_no = g_app_no then
        begin
        change agqtotals1_alias
            begin
            agqtotals1_alias:property_total = l_total_1
            agqtotals1_alias:business_income_total = l_total_2
            end
        end

    l_property_final_total = l_total_1
    l_business_income_final_total = l_total_1
    end
else
    begin
    access agqtotals1_alias, set agqtotals1_alias:app_no = g_app_no, generic

    if agqtotals1_alias:app_no = g_app_no then
        begin
        change agqtotals1_alias
            begin
            if agqgeneral1:app_no <> g_app_no then
                agqtotals1_alias:property_total = 0
            if agqbusiness:app_no <> g_app_no then
                agqtotals1_alias:business_income_total = 0
            end
        end

    end

Access agqglass1, Set agqglass1:app_no = agqtotals1:app_no, Generic

L_TOTAL_3             = 0
l_location_premium_11 = 0
While agqglass1:app_no = agqtotals1:app_no
    Begin
    L_TOTAL_3  = agqglass1:GLASS_PREMIUM + L_TOTAL_3
    l_prem_no  = agqglass1:prem_no
    l_build_no = agqglass1:build_no
    l_location_premium_11 = agqglass1:glass_premium

    Next agqglass1
    End

Access agqglass1, Set agqglass1:app_no = agqtotals1:app_no, Generic

if agqglass1:app_no = agqtotals1:app_no then
    begin
    L_TOTAL_3 = l_total_3 + l_misc_premium

    L_EFF_DATE_1 = Dateadd(agqNAME:EFF_DATE,0,1)
    If agqNAME:EXP_DATE < L_EFF_DATE_1 Then
        Begin
        L_DAYS_RATE = L_TOTAL_3 Divide 365
        L_DAYS = agqNAME:EXP_DATE - agqNAME:EFF_DATE
        L_PRO_RATA_PREMIUM = L_DAYS * L_DAYS_RATE
        L_TOTAL_3 = L_PRO_RATA_PREMIUM
        end
    end

Access agqCRIME1, Set agqCRIME1:app_no = agqtotals1:app_no, Generic

L_TOTAL_4             = 0
l_location_premium_11 = 0
While agqCRIME1:app_no = agqtotals1:app_no
    Begin
    L_TOTAL_4  = agqCRIME1:PREMIUM +
                 L_TOTAL_4
    l_prem_no  = agqcrime1:prem_no
    l_build_no = agqcrime1:build_no
    l_location_premium_11 = agqcrime1:premium

    Next agqCRIME1
    End

Access agqCRIME1, Set agqCRIME1:app_no = agqtotals1:app_no, Generic

if agqcrime1:app_no = agqtotals1:app_no then
    begin
    l_lob_end_code = "C"
    do access_agqmisc
    L_TOTAL_4 = L_TOTAL_4 + l_misc_premium

    if l_total_4 <> 0 then
        do crime_minimum_premium

    L_EFF_DATE_1 = Dateadd(agqNAME:EFF_DATE,0,1)
    If agqNAME:EXP_DATE < L_EFF_DATE_1 Then
        Begin
        L_DAYS_RATE = L_TOTAL_4 Divide 365
        L_DAYS = agqNAME:EXP_DATE - agqNAME:EFF_DATE
        L_PRO_RATA_PREMIUM = L_DAYS * L_DAYS_RATE
        L_TOTAL_4 = L_PRO_RATA_PREMIUM
        end

    access agqtotals1_alias, set agqtotals1_alias:app_no = g_app_no, generic

    if agqtotals1_alias:app_no = g_app_no then
        begin
        change agqtotals1_alias
            begin
            agqtotals1_alias:crime_total = l_total_4
            end
        end

    l_crime_final_total = l_total_4
    end
else
    begin
    access agqtotals1_alias, set agqtotals1_alias:app_no = g_app_no, generic

    if agqtotals1_alias:app_no = g_app_no then
        begin
        change agqtotals1_alias
            begin
            agqtotals1_alias:crime_total = 0
            end
        end

    end

Access agqLIABILITY, Set agqLIABILITY:app_no = agqtotals1:app_no, Generic

l_total_5             = 0
l_prem_total          = 0
l_prod_total          = 0
l_liability_total     = 0
l_mp_5                = "N"
l_location_premium_11 = 0
l_liability_warning   = "N"
While agqLIABILITY:app_no = agqtotals1:app_no
    Begin
    access agqmaster_alias, set agqmaster_alias:app_no = agqtotals1:app_no, generic

    if agqliability:rating_territory_factor <> 0 then
        l_rating_territory_factor = agqliability:rating_territory_factor
    else
        l_rating_territory_factor = 1.00

    l_total_5 = l_total_5 +
                agqliability:prem[1] +
                agqliability:prem[2] +
                agqliability:minimum_premium_adjustment[1] +
                agqliability:minimum_premium_adjustment[2] +
                agqliability:total_misc +
                agqliability:fire_legal_premium +
                agqliability:total_endorsements

    l_prod_total = l_prod_total +
                   agqliability:prem[2] +
                   agqliability:minimum_premium_adjustment[2]

    l_prem_total = l_prem_total +
                   agqliability:prem[1] +
                   agqliability:minimum_premium_adjustment[1] +
                   agqliability:total_endorsements +
                   agqliability:total_misc +
                   agqliability:fire_legal_premium

    l_liability_total = l_liability_total +
                        l_prem_total +
                        l_prod_total

    l_county   = agqliability:county
    l_prem_no  = agqliability:prem_no
    l_build_no = agqliability:build_no
    l_location_premium_11 = l_prem_total + l_prod_total
    change agqliability
        begin
        agqliability:total_premium = l_total_5 + agqliability:total_premium
        end

    if agqliability:arate[1] = 1 and
       agqliability:base_rate[1] = 0 and
       agqliability:exposure[1] <> 0 then
        l_liability_warning = "Y"

    if agqliability:arate[2] = 1 and
       agqliability:base_rate[2] = 0 and
       agqliability:exposure[2] <> 0 then
        l_liability_warning = "Y"

    Next agqLIABILITY
    End

Access agqLIABILITY, Set agqLIABILITY:app_no = agqtotals1:app_no, Generic

if agqliability:app_no = g_app_no then
    begin
    l_lob_end_code = "L"
    do access_agqmisc
    L_TOTAL_5 = L_TOTAL_5 + l_misc_premium
    l_prem_total = l_prem_total + l_misc_premium

    l_lob_end_code = "X"
    do access_agqmisc
    L_TOTAL_5 = L_TOTAL_5 + l_misc_premium
    l_prod_total = l_prod_total + l_misc_premium

    L_EFF_DATE_1 = Dateadd(agqNAME:EFF_DATE,0,1)
    If agqNAME:EXP_DATE < L_EFF_DATE_1 Then
        Begin
        L_DAYS_RATE = L_TOTAL_5 Divide 365
        L_DAYS = agqNAME:EXP_DATE - agqNAME:EFF_DATE
        L_PRO_RATA_PREMIUM = L_DAYS * L_DAYS_RATE
        L_TOTAL_5 = L_PRO_RATA_PREMIUM
        end

    if sfsline_alt:lob_code one of "CPORTFOLIO" and
       agqamt:line_of_business[2] = 6 then
        begin
        l_total_5 = 0
        end

    if l_liability_warning = "Y" then
        begin
        l_total_5 = 0
        warning "This quote is incomplete"
        end

    access agqtotals1_alias, set agqtotals1_alias:app_no = g_app_no, generic

    if agqtotals1_alias:app_no = g_app_no then
        begin
        change agqtotals1_alias
            begin
            agqtotals1_alias:liability_total = l_total_5
            end
        end

    l_liability_final_total = l_total_5
    end
else
    begin
    access agqtotals1_alias, set agqtotals1_alias:app_no = g_app_no, generic

    if agqtotals1_alias:app_no = g_app_no then
        begin
        change agqtotals1_alias
            begin
            agqtotals1_alias:liability_total = 0
            end
        end

    end

Access agqartisan, Set agqartisan:app_no = agqtotals1:app_no, Generic

l_total_6                 = 0
l_artisan_prem_total      = 0
l_artisan_prod_total      = 0
l_artisan_liability_total = 0
l_mp_7                    = "N"
l_location_premium_11     = 0
l_artisan_warning         = "N"
While agqartisan:app_no = agqtotals1:app_no
    Begin
    access agqmaster_alias, set agqmaster_alias:app_no = agqtotals1:app_no, generic

    if agqartisan:rating_territory_factor <> 0 then
        l_rating_territory_factor = agqartisan:rating_territory_factor
    else
        l_rating_territory_factor = 1.00

    l_total_6 = l_total_6 +
                agqartisan:prem[1] +
                agqartisan:prem[2] +
                agqartisan:minimum_premium_adjustment[1] +
                agqartisan:minimum_premium_adjustment[2] +
                agqartisan:total_misc +
                agqartisan:fire_legal_premium +
                agqartisan:total_endorsements

    l_artisan_prod_total = l_artisan_prod_total +
                           agqartisan:prem[2] +
                           agqartisan:minimum_premium_adjustment[2]

    l_artisan_prem_total = l_artisan_prem_total +
                           agqartisan:prem[1] +
                           agqartisan:minimum_premium_adjustment[1] +
                           agqartisan:total_endorsements +
                           agqartisan:total_misc +
                           agqartisan:fire_legal_premium

    l_artisan_liability_total = l_artisan_liability_total +
                                l_artisan_prem_total +
                                l_artisan_prod_total

    l_county = agqartisan:county
    l_prem_no = agqartisan:prem_no
    l_build_no = agqartisan:build_no
    l_location_premium_11 = l_artisan_prem_total + l_artisan_prod_total
    change agqartisan
        begin
        agqartisan:total_premium = l_total_6 + agqartisan:total_premium
        end

    if agqartisan:arate[1] = 1 and
       agqartisan:base_rate[1] = 0 then
        l_artisan_warning = "Y"

    if agqartisan:arate[2] = 1 and
       agqartisan:base_rate[2] = 0 then
        l_artisan_warning = "Y"

    Next agqartisan
    End

Access agqartisan, Set agqartisan:app_no = agqtotals1:app_no, Generic

if agqartisan:app_no = agqtotals1:app_no then
    begin
    l_lob_end_code = "R"
    do access_agqmisc
    L_TOTAL_6 = L_TOTAL_6 + l_misc_premium
    l_artisan_prem_total = l_artisan_prem_total + l_misc_premium

    l_lob_end_code = "W"
    do access_agqmisc
    L_TOTAL_6 = L_TOTAL_6 + l_misc_premium
    l_artisan_prod_total = l_artisan_prod_total + l_misc_premium

    L_EFF_DATE_1 = Dateadd(agqNAME:EFF_DATE,0,1)
    If agqNAME:EXP_DATE < L_EFF_DATE_1 Then
        Begin
        L_DAYS_RATE = L_TOTAL_6 Divide 365
        L_DAYS = agqNAME:EXP_DATE - agqNAME:EFF_DATE
        L_PRO_RATA_PREMIUM = L_DAYS * L_DAYS_RATE
        L_TOTAL_6 = L_PRO_RATA_PREMIUM
        end

    if sfsline_alt:lob_code one of "CPORTFOLIO" and
       agqamt:line_of_business[2] = 2 then
        begin
        l_total_6 = 0
        end

    if l_artisan_warning = "Y" then
        begin
        l_total_6 = 0
        warning "This quote is incomplete"
        end

    access agqtotals1_alias, set agqtotals1_alias:app_no = g_app_no, generic

    if agqtotals1_alias:app_no = g_app_no then
        begin
        change agqtotals1_alias
            begin
            agqtotals1_alias:artisan_total = l_total_6
            end
        end

    l_artisan_final_total = l_total_6
    end
else
    begin
    access agqtotals1_alias, set agqtotals1_alias:app_no = g_app_no, generic

    if agqtotals1_alias:app_no = g_app_no then
        begin
        change agqtotals1_alias
            begin
            agqtotals1_alias:artisan_total = 0
            end
        end
    end


L_TOTAL_7             = 0
l_location_premium_11 = 0
l_first               = "Y"
access agqinland, set agqinland:app_no = agqtotals1:app_no, generic

while agqinland:app_no = agqtotals1:app_no
    begin
    l_total_7  = l_total_7 + agqinland:total_premium
    l_prem_no  = agqinland:prem_no
    l_build_no = agqinland:build_no
    l_location_premium_11 = agqinland:total_premium

    next agqinland
    end

access agqinland, set agqinland:app_no = agqtotals1:app_no, generic

if agqinland:app_no = agqtotals1:app_no then
    begin
    l_lob_end_code = "I"
    do access_agqmisc
    L_TOTAL_7 = L_TOTAL_7 + l_misc_premium

    L_EFF_DATE_1 = Dateadd(agqNAME:EFF_DATE,0,1)
    If agqNAME:EXP_DATE < L_EFF_DATE_1 Then
        Begin
        L_DAYS_RATE = L_TOTAL_7 Divide 365
        L_DAYS = agqNAME:EXP_DATE - agqNAME:EFF_DATE
        L_PRO_RATA_PREMIUM = L_DAYS * L_DAYS_RATE
        L_TOTAL_7 = L_PRO_RATA_PREMIUM
        end

    access agqtotals1_alias, set agqtotals1_alias:app_no = g_app_no, generic

    if agqtotals1_alias:app_no = g_app_no then
        begin
        change agqtotals1_alias
            begin
            agqtotals1_alias:inland_marine_total = l_total_7
            end
        end

    l_inland_marine_final_total = l_total_7
    end
else
    begin
    access agqtotals1_alias, set agqtotals1_alias:app_no = g_app_no, generic

    if agqtotals1_alias:app_no = g_app_no then
        begin
        change agqtotals1_alias
            begin
            agqtotals1_alias:inland_marine_total = 0
            end
        end
    end

L_TOTAL = L_TOTAL_1 +
          L_TOTAL_2 +
          L_TOTAL_3 +
          L_TOTAL_4 +
          L_TOTAL_5 +
          L_TOTAL_6 +
          l_total_7 +
          l_total_10

-- terrorism
if l_total_1  <> 0 or
   l_total_2  <> 0 or
   l_total_3  <> 0 or
   l_total_4  <> 0 or
   l_total_5  <> 0 or
   l_total_6  <> 0 or
   l_total_7  <> 0 or
   l_total_10 <> 0 then
    begin
    access agqend, set agqend:app_no = g_app_no, generic

    l_total_8 = 0
    while agqend:app_no = g_app_no
        begin
        if ((agqend:lob_end_code one of "P" and
           l_total_1 <> 0 and
           agqend:terrorism_form = 1) or
           (agqend:lob_end_code one of "L" and
           l_total_5 <> 0 and
           agqend:terrorism_form = 1) or
           (agqend:lob_end_code one of "R" and
           l_total_6 <> 0 and
           agqend:terrorism_form = 1) or
           (agqend:lob_end_code one of "I" and
           l_total_7 <> 0 and
           agqend:terrorism_form = 1) or
           (agqend:lob_end_code one of "C" and
           l_total_4 <> 0 and
           agqend:terrorism_Form = 1) or
           (agqend:lob_end_code one of "G" and
           l_total_3 <> 0 and
           agqend:terrorism_form = 1)) then
            l_total_8 = agqend:premium + l_total_8

        if agqend:terrorism_form = 1 and
           agqend:lob_end_code one of "P" then
            l_property_terrorism = agqend:premium

        if agqend:terrorism_form = 1 and
           agqend:lob_end_code one of "L", "R" then
            l_liability_terrorism = agqend:premium

        if ((agqend:lob_end_code one of "P" and
           l_total_1 = 0 and
           agqend:terrorism_form = 1) or
           (agqend:lob_end_code one of "L" and
           l_total_5 = 0 and
           agqend:terrorism_form = 1) or
           (agqend:lob_end_code one of "R" and
           l_total_6 = 0 and
           agqend:terrorism_Form = 1) or
           (agqend:lob_end_code one of "I" and
           l_total_7 = 0 and
           agqend:terrorism_form = 1) or
           (agqend:lob_end_code one of "C" and
           l_total_4 = 0 and
           agqend:terrorism_form = 1) or
           (agqend:lob_end_code one of "G" and
           l_total_3 = 0 and
           agqend:terrorism_form = 1)) then
            delete agqend

    next agqend
    end

if sfsline_alt:lob_code one of "CPORTFOLIO" then
    begin
    access agqmastsupp, set agqmastsupp:app_no = g_app_no,
                            agqmastsupp:line_of_business = agqtotals1:line_of_business, generic

    if agqmastsupp:app_no = g_app_no and
       agqmastsupp:line_of_business = agqtotals1:line_of_business then
        begin
        change agqmastsupp
            begin
            agqmastsupp:terrorism_premium = l_total_8
            end
        end

    access agqmaster_alias, set agqmaster_alias:app_no = g_app_no, exact

    if agqmaster_alias:app_no = g_app_no then
        begin
        change agqmaster_alias
            begin
            agqmaster_alias:terrorism_premium = l_total_8
            end
        end

    access agqtotals1_alias, set agqtotals1_alias:app_no = g_app_no, generic

    if agqtotals1_alias:app_no = g_app_no then
        begin
        change agqtotals1_alias
            begin
            agqtotals1_alias:terrorism_premium = l_total_8
            end
        end
    end
else
    begin
    access agqmaster_alias, set agqmaster_alias:app_no = g_app_no, exact

    if agqmaster_alias:app_no = g_app_no then
        begin
        change agqmaster_alias
            begin
            agqmaster_alias:terrorism_premium = l_total_8
            end
        end

    access agqtotals1_alias, set agqtotals1_alias:app_no = g_app_no, generic

    if agqtotals1_alias:app_no = g_app_no then
        begin
        change agqtotals1_alias
            begin
            agqtotals1_alias:terrorism_premium = l_total_8
            end
        end
    end

l_total = l_total + l_total_8

end

End

procedure property_minimum_premium
begin
access agqgeneral1, set agqgeneral1:app_no = g_app_no, generic

l_company_id = agqname:company_id
Access SFSCONTROL, Set SFSCONTROL:COMPANY_ID       = l_company_id,
                       SFSCONTROL:STATE            = agqgeneral1:STATE,
                       SFSCONTROL:LINE_OF_BUSINESS = agqgeneral1:line_of_business, Approximate

while SFSCONTROL:COMPANY_ID       = l_company_id and
      SFSCONTROL:STATE            = agqgeneral1:STATE and
      SFSCONTROL:LINE_OF_BUSINESS = agqgeneral1:line_of_business
    begin
    If (agqNAME:EFF_DATE >= SFSCONTROL:EFF_DATE and
       (agqname:eff_date < sfscontrol:exp_date or
       sfscontrol:exp_date = 0)) Then
        begin
        L_MINIMUM               = SFSCONTROL:MINIMUM_PREMIUM
        end

    Next SFSCONTROL
    End

access agqgeneral1_alias, set agqgeneral1_alias:app_no  = agqgeneral1:app_no, generic

l_general_total = 0
while agqgeneral1_alias:app_no = agqgeneral1:app_no
    begin
    l_general_total = l_general_total + agqgeneral1_alias:total_premium[1]

    next agqgeneral1_alias
    end

l_minimum_applies = "N"
if sfsline_alt:lob_code one of "CPORTFOLIO" then
    l_property_total_2 = l_total_1 - agqmastsupp:other_totals[4]
else
    l_property_total_2 = l_total_1 - agqmaster:other_totals[4]
l_property_total_2 = l_property_total_2 + l_total_2
if l_property_total_2 < l_minimum then
    begin
    l_minimum_applies = "Y"
    if sfsline_alt:lob_code one of "CPORTFOLIO" then
        l_mp_total = ((l_total_1 - agqmastsupp:other_totals[4]) + l_total_2)
    else
        l_mp_total = ((l_total_1 - agqmaster:other_totals[4]) + l_total_2)

    access agqgeneral1_alias, set agqgeneral1_alias:app_no  = agqgeneral1:app_no, generic

    l_total_1                         = (l_general_total +
                                        (l_minimum -
                                        l_mp_total))
    l_terrorism_total                 = l_minimum
    if sfsline_alt:lob_code one of "CPORTFOLIO" then
        l_total_1                     = l_total_1 +
                                        agqmastsupp:other_totals[4]
    else
        l_total_1                     = l_total_1 +
                                        agqmaster:other_totals[4]

    change agqgeneral1_alias
        begin
        agqgeneral1_alias:premium[12]      = l_minimum -
                                            l_mp_total
        end

    If agqgeneral1_alias:REMOVE_TERRORISM_FORM = 0 Then
        begin
        L_TERRORISM_PREMIUM = 0
        Do GET_TERRORISM_PREMIUM
        end
    end
else
    begin
    access agqgeneral1_alias, set agqgeneral1_alias:app_no = agqgeneral1:app_no, generic

    while agqgeneral1_alias:app_no = agqgeneral1:app_no
        begin
        change agqgeneral1_alias
            begin
            agqgeneral1_alias:premium[12]      = 0
            end

        next agqgeneral1_alias
        end
    end
end

procedure crime_minimum_premium
begin
access agqcrime, set agqcrime:app_no = g_app_no, generic

l_company_id = agqname:company_id
Access SFSCONTROL, Set SFSCONTROL:COMPANY_ID       = l_company_id,
                       SFSCONTROL:STATE            = agqcrime:STATE,
                       SFSCONTROL:LINE_OF_BUSINESS = l_rating_line_of_business, Approximate

while SFSCONTROL:COMPANY_ID       = l_company_id and
      SFSCONTROL:STATE            = agqcrime:STATE and
      SFSCONTROL:LINE_OF_BUSINESS = l_rating_line_of_business
    begin
    If (agqNAME:EFF_DATE >= SFSCONTROL:EFF_DATE and
       (agqname:eff_date < sfscontrol:exp_date or
       sfscontrol:exp_date = 0)) Then
        begin
        L_MINIMUM               = SFSCONTROL:MINIMUM_PREMIUM
        end

    Next SFSCONTROL
    End

if l_total_4 < l_minimum then
    l_total_4 = l_minimum
end

Procedure GET_TERRORISM_PREMIUM
begin
access agqbusiness, set agqbusiness:app_no = g_app_no, generic

while agqbusiness:app_no = g_app_no
    begin
    l_business_total = agqbusiness:total_premium +
                       l_business_total

    next agqbusiness
    end

Access agqgeneral1_alias, Set agqgeneral1_alias:app_no  = G_app_no,
                             agqgeneral1_alias:PREM_NO  = G_PREM_NO,
                             agqgeneral1_alias:BUILD_NO = G_BUILD_NO, generic

L_STATE = agqgeneral1_alias:state
Do ACCESS_SFSMSOTERROR
l_general_terrorism_premium = 0
if l_terror_percentage <> 0 then
    begin
    L_TERRORISM_PREMIUM = l_terrorism_total * l_terror_PERCENTAGE
    l_general_terrorism_premium = ((l_terrorism_total +
                                  l_business_total) *
                                  l_terror_percentage)

    If L_TERRORISM_PREMIUM <= L_TERROR_MINIMUM Then
        L_TERRORISM_PREMIUM = L_TERROR_MINIMUM
    end

access agqend, set agqend:app_no = g_app_no,
                   agqend:prem_no  = 0,
                   agqend:build_no = 0, generic

while agqend:app_no = g_app_no and
      agqend:prem_no  = 0 and
      agqend:build_no = 0
        begin
        if agqend:terrorism_form = 1 and
           agqend:code = sfsmsoterror:terrorism_form_to_add and
           agqend:lob_end_code = "P" then
            begin
            change agqend
                begin
                agqend:premium = l_general_terrorism_premium
                end
            end

        next agqend
        end

end

Procedure ACCESS_SFSMSOTERROR
begin
l_state = agqmaster:state
Access SFSMSOTERROR, Set SFSMSOTERROR:COMPANY_ID       = agqname:company_id,
                         SFSMSOTERROR:STATE            = l_STATE,
                         SFSMSOTERROR:LINE_OF_BUSINESS = l_terror_line_of_business, generic

l_terror_percentage = 0
l_terror_minimum = 0
While SFSMSOTERROR:COMPANY_ID       = agqname:company_id And
      SFSMSOTERROR:STATE            = l_STATE And
      SFSMSOTERROR:LINE_OF_BUSINESS = l_terror_line_of_business
    begin
    if agqname:eff_date >= sfsmsoterror:eff_date then
        begin
        L_TERROR_EFF_DATE   = SFSMSOTERROR:EFF_DATE
        L_TERROR_PERCENTAGE = SFSMSOTERROR:PERCENTAGE
        L_TERROR_MINIMUM    = SFSMSOTERROR:MINIMUM_PREMIUM
        end

    Next SFSMSOTERROR
    end

Access SFSMSOTERROR, Set SFSMSOTERROR:COMPANY_ID       = agqname:company_id,
                         SFSMSOTERROR:STATE            = l_STATE,
                         SFSMSOTERROR:LINE_OF_BUSINESS = l_terror_line_of_business,
                         SFSMSOTERROR:EFF_DATE         = L_TERROR_EFF_DATE, Exact

end

Procedure SUBCODE
Begin
Access agqEND_alias, Set agqEND_alias:app_no = G_app_no,
                         agqend_alias:prem_no  = 0,
                         agqend_alias:build_no = 0, generic

L_SUB_CODE = 0
while agqEND_alias:app_no = G_app_no and
      agqend_alias:prem_no  = 0 and
      agqend_alias:build_no = 0
        begin
        L_SUB_CODE = agqEND_alias:SUB_CODE

        Next agqEND_alias
        End

End

procedure access_agqmisc
begin
access agqmisc, set agqmisc:app_no = g_app_no, generic

l_misc_premium = 0
while agqmisc:app_no = g_app_no
    begin
    if agqmisc:lob_end_code = l_lob_end_code then
        l_misc_premium = l_misc_premium + agqmisc:premium

    next agqmisc
    end

end

Procedure FINAL_TOTAL
Begin
/*L_EFF_DATE_1 = Dateadd(agqNAME:EFF_DATE,0,1)
If agqNAME:EXP_DATE < L_EFF_DATE_1 Then
    Begin
    L_DAYS_RATE = L_TOTAL Divide 365
    L_DAYS = agqNAME:EXP_DATE - agqNAME:EFF_DATE
    L_PRO_RATA_PREMIUM = L_DAYS * L_DAYS_RATE
    L_TOTAL = L_PRO_RATA_PREMIUM
    end*/

If SFSCOMPANY:INCLUDE_INSTALLMENT_RATING = "Y" Then
    L_FINAL_TOTAL = L_TOTAL + L_INSTALLMENT
Else
    L_FINAL_TOTAL = L_TOTAL

l_state = agqmaster:state
access sfssurcharge, set sfssurcharge:company_id = agqname:company_id,
                         sfssurcharge:state = l_state,
                         sfssurcharge:line_of_business = agqname:line_of_business, generic

l_surcharge_date = 0
while sfssurcharge:company_id = agqname:company_id and
      sfssurcharge:state = l_state and
      sfssurcharge:line_of_business = agqname:line_of_business
        begin
        if (agqname:eff_date >= sfssurcharge:eff_date and
           (l_surcharge_date < sfssurcharge:eff_date or
           l_surcharge_date = 0)) then
            begin
            l_surcharge_date    = sfssurcharge:eff_date
            l_surcharge_factor  = sfssurcharge:surcharge_factor
            l_surcharge_minimum = sfssurcharge:minimum_premium
            end
        next sfssurcharge
        end

L_SURCHARGE = L_FINAL_TOTAL * L_SURCHARGE_FACTOR

If L_SURCHARGE < L_SURCHARGE_MINIMUM Then
    L_SURCHARGE = L_SURCHARGE_MINIMUM

if sfsline_alt:lob_code one of "CPORTFOLIO" then
    begin
    access agqamt, set agqamt:app_no = g_app_no, exact

    if agqamt:app_no = g_app_no then
        begin
        change agqamt
            begin
            agqamt:lob_totals[2]     = l_final_total - l_total_8
            agqamt:lob_surcharge[2]  = l_surcharge
            agqamt:lob_terrorism[2]  = l_total_8
            agqamt:print_totals[1]   = l_total_1 + l_total_2 + l_total_3 +
                                       l_property_terrorism
            agqamt:print_totals[2]   = l_total_5 + l_total_6 +
                                       l_liability_terrorism
            agqamt:print_totals[3]   = l_total_4
            agqamt:print_totals[4]   = l_total_7
            agqamt:line_of_business[2] = agqtotals1:line_of_business
            end
        end
    else
        begin
        add agqamt
            begin
            agqamt:app_no          = g_app_no
            agqamt:lob_totals[2]     = l_final_total
            agqamt:lob_surcharge[2]  = l_surcharge
            agqamt:lob_terrorism[2]  = l_total_8
            agqamt:print_totals[1]   = l_total_1 + l_total_2 + l_total_3 +
                                       l_property_terrorism
            agqamt:print_totals[2]   = l_total_5 + l_total_6 +
                                       l_liability_terrorism
            agqamt:print_totals[3]   = l_total_4
            agqamt:print_totals[4]   = l_total_7
            agqamt:line_of_business[2] = agqtotals1:line_of_business
            end
        end

    Access agqmastsupp, Set agqmastsupp:app_no = G_app_no,
                            agqmastsupp:line_of_business = agqtotals1:line_of_business, Generic

    If agqmastsupp:app_no = G_app_no and
       agqmastsupp:line_of_business = agqtotals1:line_of_business Then
        Begin
        Change agqmastsupp
            Begin
            agqmastsupp:state     = agqmaster:state
            agqmastsupp:TOTAL[1]  = L_TOTAL_1 - l_boiler_total --agqmastsupp:other_totals[4] -- property
            agqmastsupp:TOTAL[2]  = L_TOTAL_2 -- business income
            agqmastsupp:TOTAL[3]  = L_TOTAL_3 -- glass
            agqmastsupp:TOTAL[4]  = L_TOTAL_4 -- crime
            agqmastsupp:TOTAL[5]  = L_TOTAL_5 -- liability
            agqmastsupp:TOTAL[6]  = L_TOTAL_7 -- inland marine
            agqmastsupp:total[8]  = 0
            agqmastsupp:total[15] = l_total_6 -- artisan
            l_agqmaster_total_10 = l_total_1 + l_total_2 + l_total_3 + l_total_4 +
                                   l_total_5 + l_total_6 + l_total_7 + l_boiler_total --agqmastsupp:other_totals[4]
            agqmastsupp:minimum_premium[1] = l_mp_1
            agqmastsupp:minimum_premium[2] = l_mp_2
            agqmastsupp:minimum_premium[3] = l_mp_3
            agqmastsupp:minimum_premium[4] = l_mp_4
            agqmastsupp:minimum_premium[5] = l_mp_5
            agqmastsupp:minimum_premium[6] = l_mp_6
            agqmastsupp:other_totals[1] = l_fire_total
            agqmastsupp:other_totals[2] = l_ec_vmm_total
            agqmastsupp:other_totals[3] = l_other_total
            agqmastsupp:other_totals[4] = l_boiler_total
            agqmastsupp:other_totals[5] = l_total_3
            agqmastsupp:other_totals[6] = l_total_4
            agqmastsupp:other_totals[7] = l_total_7
            agqmastsupp:other_totals[11] = l_prem_total
            agqmastsupp:other_totals[12] = l_prod_total
            agqmastsupp:other_totals[15] = l_artisan_prem_total
            agqmastsupp:other_totals[16] = l_artisan_prod_total
            agqmastsupp:terrorism_premium = l_total_8
            agqmastsupp:TOTAL[18] = L_FINAL_TOTAL
            agqmastsupp:TOTAL[20] = L_FINAL_TOTAL + L_SURCHARGE
            agqmastsupp:SURCHARGE = L_SURCHARGE
            agqmastsupp:RAW_PREMIUM_AMT_DUE = L_FINAL_TOTAL - l_boiler_total
            end
        End
    else
        begin
        add agqmastsupp
            Begin
            agqmastsupp:app_no    = g_app_no
            agqmastsupp:line_of_business = agqtotals1:line_of_business
            agqmastsupp:state     = agqmaster:state
            agqmastsupp:TOTAL[1]  = L_TOTAL_1 - l_boiler_total -- agqmastsupp:other_totals[4] -- property
            agqmastsupp:TOTAL[2]  = L_TOTAL_2 -- business income
            agqmastsupp:TOTAL[3]  = L_TOTAL_3 -- glass
            agqmastsupp:TOTAL[4]  = L_TOTAL_4 -- crime
            agqmastsupp:TOTAL[5]  = L_TOTAL_5 -- liability
            agqmastsupp:TOTAL[6]  = L_TOTAL_7 -- inland marine
            agqmastsupp:total[8]  = 0
            agqmastsupp:total[15] = l_total_6 -- artisan
            l_agqmaster_total_10 = l_total_1 + l_total_2 + l_total_3 + l_total_4 +
                                   l_total_5 + l_total_6 + l_total_7 + l_boiler_total --agqmastsupp:other_totals[4]
            agqmastsupp:minimum_premium[1] = l_mp_1
            agqmastsupp:minimum_premium[2] = l_mp_2
            agqmastsupp:minimum_premium[3] = l_mp_3
            agqmastsupp:minimum_premium[4] = l_mp_4
            agqmastsupp:minimum_premium[5] = l_mp_5
            agqmastsupp:minimum_premium[6] = l_mp_6
            agqmastsupp:other_totals[1] = l_fire_total
            agqmastsupp:other_totals[2] = l_ec_vmm_total
            agqmastsupp:other_totals[3] = l_other_total
            agqmastsupp:other_totals[4] = l_boiler_total
            agqmastsupp:other_totals[5] = l_total_3
            agqmastsupp:other_totals[6] = l_total_4
            agqmastsupp:other_totals[7] = l_total_7
            agqmastsupp:other_totals[11] = l_prem_total
            agqmastsupp:other_totals[12] = l_prod_total
            agqmastsupp:other_totals[15] = l_artisan_prem_total
            agqmastsupp:other_totals[16] = l_artisan_prod_total
            agqmastsupp:terrorism_premium = l_total_8
            agqmastsupp:TOTAL[18] = L_FINAL_TOTAL
            agqmastsupp:TOTAL[20] = L_FINAL_TOTAL + L_SURCHARGE
            agqmastsupp:SURCHARGE = L_SURCHARGE
            agqmastsupp:RAW_PREMIUM_AMT_DUE = L_FINAL_TOTAL - l_boiler_total
            end
        End
    End
else
    begin
    Access agqMASTER_ALIAS, Set agqMASTER_ALIAS:app_no = agqtotals1:app_no, Generic

    If agqMASTER_ALIAS:app_no = agqtotals1:app_no Then
        Begin
        Change agqMASTER_ALIAS
            Begin
            agqMASTER_ALIAS:TOTAL[1]  = L_TOTAL_1 - l_boiler_total --agqmaster_alias:other_totals[4] -- property
            agqMASTER_ALIAS:TOTAL[2]  = L_TOTAL_2 -- business income
            agqMASTER_ALIAS:TOTAL[3]  = L_TOTAL_3 -- glass
            agqMASTER_ALIAS:TOTAL[4]  = L_TOTAL_4 -- crime
            agqMASTER_ALIAS:TOTAL[5]  = L_TOTAL_5 -- liability
            agqMASTER_ALIAS:TOTAL[6]  = L_TOTAL_7 -- inland marine
            agqmaster_alias:total[8]  = 0
            agqmaster_alias:total[15] = l_total_6 -- artisan
            l_agqmaster_total_10 = l_total_1 + l_total_2 + l_total_3 + l_total_4 +
                                   l_total_5 + l_total_6 + l_total_7 + l_boiler_total --agqmaster_alias:other_totals[4]
            agqmaster_alias:minimum_premium[1] = l_mp_1
            agqmaster_alias:minimum_premium[2] = l_mp_2
            agqmaster_alias:minimum_premium[3] = l_mp_3
            agqmaster_alias:minimum_premium[4] = l_mp_4
            agqmaster_alias:minimum_premium[5] = l_mp_5
            agqmaster_alias:minimum_premium[6] = l_mp_6
            agqmaster_alias:other_totals[1] = l_fire_total
            agqmaster_alias:other_totals[2] = l_ec_vmm_total
            agqmaster_alias:other_totals[3] = l_other_total
            agqmaster_alias:other_totals[4] = l_boiler_total
            agqmaster_alias:other_totals[5] = l_total_3
            agqmaster_alias:other_totals[6] = l_total_4
            agqmaster_alias:other_totals[7] = l_total_7
            agqmaster_alias:other_totals[11] = l_prem_total
            agqmaster_alias:other_totals[12] = l_prod_total
            agqmaster_alias:other_totals[15] = l_artisan_prem_total
            agqmaster_alias:other_totals[16] = l_artisan_prod_total
            agqmaster_alias:terrorism_premium = l_total_8
            agqMASTER_ALIAS:TOTAL[18] = L_FINAL_TOTAL
            agqMASTER_ALIAS:TOTAL[20] = L_FINAL_TOTAL + L_SURCHARGE
            agqMASTER_ALIAS:INSTALLMENT_CHARGE = L_INSTALLMENT
            agqMASTER_ALIAS:SURCHARGE = L_SURCHARGE
            agqMASTER_ALIAS:RAW_PREMIUM_AMT_DUE = L_FINAL_TOTAL - l_boiler_total
            end
        End
    End

End

end
